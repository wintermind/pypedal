<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>PyPedal: PyPedal/pyp_newclasses.py Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">PyPedal&#160;<span id="projectnumber">2.0.0</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">PyPedal/pyp_newclasses.py</div>  </div>
</div>
<div class="contents">
<div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">#!/usr/bin/python</span>
<a name="l00002"></a>00002 
<a name="l00003"></a>00003 <span class="comment">###############################################################################</span>
<a name="l00004"></a>00004 <span class="comment"># NAME: pyp_newclasses.py</span>
<a name="l00005"></a>00005 <span class="comment"># VERSION: 2.0.0 (29SEPTEMBER2010)</span>
<a name="l00006"></a>00006 <span class="comment"># AUTHOR: John B. Cole, PhD (john.cole@ars.usda.gov)</span>
<a name="l00007"></a>00007 <span class="comment"># LICENSE: LGPL</span>
<a name="l00008"></a>00008 <span class="comment">###############################################################################</span>
<a name="l00009"></a>00009 
<a name="l00010"></a>00010 <span class="comment">## @package pyp_newclasses</span>
<a name="l00011"></a>00011 <span class="comment"># pyp_newclasses contains the new class structure that will be a part of PyPedal 2.0.0Final.</span>
<a name="l00012"></a>00012 <span class="comment"># It includes a master class to which most of the computational routines will be bound as</span>
<a name="l00013"></a>00013 <span class="comment"># methods, a NewAnimal() class, and a PedigreeMetadata() class.</span>
<a name="l00014"></a>00014 <span class="comment">##</span>
<a name="l00015"></a>00015 
<a name="l00016"></a>00016 <span class="keyword">import</span> cPickle
<a name="l00017"></a>00017 <span class="keyword">import</span> logging
<a name="l00018"></a>00018 <span class="keyword">import</span> numpy
<a name="l00019"></a>00019 <span class="keyword">import</span> os
<a name="l00020"></a>00020 <span class="keyword">import</span> string
<a name="l00021"></a>00021 <span class="keyword">import</span> sys
<a name="l00022"></a>00022 
<a name="l00023"></a>00023 <span class="comment"># Import the other pieces of PyPedal.  This will probably go away as most of these are rolled into</span>
<a name="l00024"></a>00024 <span class="comment"># NewPedigree as methods.</span>
<a name="l00025"></a>00025 <span class="keyword">import</span> pyp_db
<a name="l00026"></a>00026 <span class="keyword">import</span> pyp_demog
<a name="l00027"></a>00027 <span class="keyword">import</span> pyp_io
<a name="l00028"></a>00028 <span class="keyword">import</span> pyp_metrics
<a name="l00029"></a>00029 <span class="keyword">import</span> pyp_nrm
<a name="l00030"></a>00030 <span class="keyword">import</span> pyp_utils
<a name="l00031"></a>00031 
<a name="l00032"></a>00032 <span class="keywordflow">try</span>:
<a name="l00033"></a>00033     <span class="keyword">from</span> psyco.classes <span class="keyword">import</span> __metaclass__
<a name="l00034"></a>00034 <span class="keywordflow">except</span> ImportError:
<a name="l00035"></a>00035     <span class="keywordflow">pass</span>
<a name="l00036"></a>00036 
<a name="l00037"></a>00037 <span class="comment">##</span>
<a name="l00038"></a>00038 <span class="comment"># The NewPedigree class is the main data structure for PyP 2.0.0Final.</span>
<a name="l00039"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html">00039</a> <span class="keyword">class </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html" title="The NewPedigree class is the main data structure for PyP 2.0.0Final.">NewPedigree</a>:
<a name="l00040"></a>00040     <span class="comment">##</span>
<a name="l00041"></a>00041     <span class="comment"># __init__() initializes a NewPedigree object.</span>
<a name="l00042"></a>00042     <span class="comment"># @param self Reference to the current NewPedigree() object</span>
<a name="l00043"></a>00043     <span class="comment"># @param kw A dictionary of options.</span>
<a name="l00044"></a>00044     <span class="comment"># @param kwfile An optionsl configuration file name</span>
<a name="l00045"></a>00045     <span class="comment"># @retval An instance of a NewPedigree() object</span>
<a name="l00046"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#ad6a2650eb959399a93d9c445b53a5b10">00046</a>     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#ad6a2650eb959399a93d9c445b53a5b10" title="__init__() initializes a NewPedigree object.">__init__</a>(self, kw={}, kwfile=&#39;pypedal.ini&#39;):
<a name="l00047"></a>00047         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00048"></a>00048 <span class="stringliteral">        __init__() initializes a NewPedigree object.</span>
<a name="l00049"></a>00049 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l00050"></a>00050 
<a name="l00051"></a>00051         <span class="comment"># This hacks-in support for configuration files.  This is not</span>
<a name="l00052"></a>00052         <span class="comment"># a perfect solution because it can let a naked exception</span>
<a name="l00053"></a>00053         <span class="comment"># propagate back to the used, but __init__() methods can only</span>
<a name="l00054"></a>00054         <span class="comment"># return None, so there is no nice way to pass back a message</span>
<a name="l00055"></a>00055         <span class="comment"># if an exception is thrown.  If dict4ini.DictIni(kwfile) fails,</span>
<a name="l00056"></a>00056         <span class="comment"># then kw will be an empty dictionary.  The user will only see</span>
<a name="l00057"></a>00057         <span class="comment"># this when the load() method is called on the NewPedigree</span>
<a name="l00058"></a>00058         <span class="comment"># instance.</span>
<a name="l00059"></a>00059         <span class="keywordflow">if</span> len(kw) == 0:
<a name="l00060"></a>00060             <span class="keyword">import</span> dict4ini
<a name="l00061"></a>00061             kw = dict4ini.DictIni(kwfile)
<a name="l00062"></a>00062             <span class="keywordflow">if</span> kw == {}:
<a name="l00063"></a>00063                 <span class="keywordflow">print</span> <span class="stringliteral">&#39;[ERROR]: pyp_newclasses.NewPedigree.__init__() was unable to load a configuration file named %s!&#39;</span> % ( kwfile )
<a name="l00064"></a>00064                 <span class="keyword">import</span> sys
<a name="l00065"></a>00065                 sys.exit(0)
<a name="l00066"></a>00066             <span class="comment"># The dict method converts the Dict4Ini object to an actual</span>
<a name="l00067"></a>00067             <span class="comment"># Python dictionary.</span>
<a name="l00068"></a>00068 <span class="comment">#             print &#39;Starting kw: %s&#39; % ( kw )</span>
<a name="l00069"></a>00069             kw = kw.dict()
<a name="l00070"></a>00070             <span class="comment">#print &#39;Starting kw: %s&#39; % ( kw )</span>
<a name="l00071"></a>00071 
<a name="l00072"></a>00072         <span class="comment"># Handle the Main Keywords.</span>
<a name="l00073"></a>00073 
<a name="l00074"></a>00074         <span class="comment"># Here are the keywords used for simulating pedigrees.  We need to</span>
<a name="l00075"></a>00075         <span class="comment"># set simulate_pedigree before we do anything else; if the user</span>
<a name="l00076"></a>00076         <span class="comment"># wants to simulate a pedigree they do not need to provide a</span>
<a name="l00077"></a>00077         <span class="comment"># pedfile.</span>
<a name="l00078"></a>00078         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">&#39;simulate_pedigree&#39;</span>): kw[<span class="stringliteral">&#39;simulate_pedigree&#39;</span>] = 0
<a name="l00079"></a>00079         <span class="keywordflow">if</span> kw[<span class="stringliteral">&#39;simulate_pedigree&#39;</span>]:
<a name="l00080"></a>00080             <span class="comment"># These defaults will produce a three-generation pedigree</span>
<a name="l00081"></a>00081             <span class="comment"># in which each sire and dam has a single progeny.</span>
<a name="l00082"></a>00082             <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">&#39;simulate_n&#39;</span>): kw[<span class="stringliteral">&#39;simulate_n&#39;</span>] = 15
<a name="l00083"></a>00083             <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">&#39;simulate_g&#39;</span>): kw[<span class="stringliteral">&#39;simulate_g&#39;</span>] = 3
<a name="l00084"></a>00084             <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">&#39;simulate_ns&#39;</span>): kw[<span class="stringliteral">&#39;simulate_ns&#39;</span>] = 4
<a name="l00085"></a>00085             <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">&#39;simulate_nd&#39;</span>): kw[<span class="stringliteral">&#39;simulate_nd&#39;</span>] = 4
<a name="l00086"></a>00086             <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">&#39;simulate_mp&#39;</span>): kw[<span class="stringliteral">&#39;simulate_mp&#39;</span>] = 0
<a name="l00087"></a>00087             <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">&#39;simulate_po&#39;</span>): kw[<span class="stringliteral">&#39;simulate_po&#39;</span>] = 0
<a name="l00088"></a>00088             <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">&#39;simulate_fs&#39;</span>): kw[<span class="stringliteral">&#39;simulate_fs&#39;</span>] = 0
<a name="l00089"></a>00089             <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">&#39;simulate_sr&#39;</span>): kw[<span class="stringliteral">&#39;simulate_sr&#39;</span>] = 0.5
<a name="l00090"></a>00090             <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">&#39;simulate_ir&#39;</span>): kw[<span class="stringliteral">&#39;simulate_ir&#39;</span>] = 0.0
<a name="l00091"></a>00091             <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">&#39;simulate_pmd&#39;</span>): kw[<span class="stringliteral">&#39;simulate_pmd&#39;</span>] = 100
<a name="l00092"></a>00092             <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">&#39;simulate_save&#39;</span>): kw[<span class="stringliteral">&#39;simulate_save&#39;</span>] = 0
<a name="l00093"></a>00093         <span class="keywordflow">else</span>:
<a name="l00094"></a>00094             <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">&#39;pedfile&#39;</span>): <span class="keywordflow">raise</span> PyPedalPedigreeInputFileNameError
<a name="l00095"></a>00095         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">&#39;pedformat&#39;</span>): kw[<span class="stringliteral">&#39;pedformat&#39;</span>] = <span class="stringliteral">&#39;asd&#39;</span>
<a name="l00096"></a>00096         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">&#39;has_header&#39;</span>): kw[<span class="stringliteral">&#39;has_header&#39;</span>] = 0
<a name="l00097"></a>00097         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">&#39;pedname&#39;</span>): kw[<span class="stringliteral">&#39;pedname&#39;</span>] = <span class="stringliteral">&#39;Untitled&#39;</span>
<a name="l00098"></a>00098         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">&#39;messages&#39;</span>): kw[<span class="stringliteral">&#39;messages&#39;</span>] = <span class="stringliteral">&#39;verbose&#39;</span>
<a name="l00099"></a>00099         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">&#39;renumber&#39;</span>): kw[<span class="stringliteral">&#39;renumber&#39;</span>] = 1
<a name="l00100"></a>00100         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">&#39;reorder&#39;</span>): kw[<span class="stringliteral">&#39;reorder&#39;</span>] = 0
<a name="l00101"></a>00101         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">&#39;reorder_max_rounds&#39;</span>): kw[<span class="stringliteral">&#39;reorder_max_rounds&#39;</span>] = 100
<a name="l00102"></a>00102         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">&#39;pedigree_is_renumbered&#39;</span>): kw[<span class="stringliteral">&#39;pedigree_is_renumbered&#39;</span>] = 0
<a name="l00103"></a>00103         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">&#39;set_generations&#39;</span>): kw[<span class="stringliteral">&#39;set_generations&#39;</span>] = 0
<a name="l00104"></a>00104         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">&#39;gen_coeff&#39;</span>): kw[<span class="stringliteral">&#39;gen_coeff&#39;</span>] = 0
<a name="l00105"></a>00105         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">&#39;set_ancestors&#39;</span>): kw[<span class="stringliteral">&#39;set_ancestors&#39;</span>] = 0
<a name="l00106"></a>00106         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">&#39;set_alleles&#39;</span>): kw[<span class="stringliteral">&#39;set_alleles&#39;</span>] = 0
<a name="l00107"></a>00107         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">&#39;set_offspring&#39;</span>): kw[<span class="stringliteral">&#39;set_offspring&#39;</span>] = 0
<a name="l00108"></a>00108         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">&#39;set_sexes&#39;</span>): kw[<span class="stringliteral">&#39;set_sexes&#39;</span>] = 0
<a name="l00109"></a>00109         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">&#39;pedcomp&#39;</span>): kw[<span class="stringliteral">&#39;pedcomp&#39;</span>] = 0
<a name="l00110"></a>00110         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">&#39;pedcomp_gens&#39;</span>): kw[<span class="stringliteral">&#39;pedcomp_gens&#39;</span>] = 3
<a name="l00111"></a>00111         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">&#39;sepchar&#39;</span>): kw[<span class="stringliteral">&#39;sepchar&#39;</span>] = <span class="stringliteral">&#39; &#39;</span>
<a name="l00112"></a>00112         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">&#39;alleles_sepchar&#39;</span>): kw[<span class="stringliteral">&#39;alleles_sepchar&#39;</span>] = <span class="stringliteral">&#39;/&#39;</span>
<a name="l00113"></a>00113         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">&#39;counter&#39;</span>): kw[<span class="stringliteral">&#39;counter&#39;</span>] = 1000
<a name="l00114"></a>00114         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">&#39;slow_reorder&#39;</span>): kw[<span class="stringliteral">&#39;slow_reorder&#39;</span>] = 1
<a name="l00115"></a>00115     <span class="comment"># Default missing values for NewAnimal objects.</span>
<a name="l00116"></a>00116         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">&#39;missing_bdate&#39;</span>): kw[<span class="stringliteral">&#39;missing_bdate&#39;</span>] = <span class="stringliteral">&#39;01011900&#39;</span>
<a name="l00117"></a>00117         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">&#39;missing_byear&#39;</span>): kw[<span class="stringliteral">&#39;missing_byear&#39;</span>] = 1900
<a name="l00118"></a>00118         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">&#39;missing_parent&#39;</span>): kw[<span class="stringliteral">&#39;missing_parent&#39;</span>] = 0
<a name="l00119"></a>00119         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">&#39;missing_name&#39;</span>): kw[<span class="stringliteral">&#39;missing_name&#39;</span>] = <span class="stringliteral">&#39;Unknown_Name&#39;</span>
<a name="l00120"></a>00120         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">&#39;missing_breed&#39;</span>): kw[<span class="stringliteral">&#39;missing_breed&#39;</span>] = <span class="stringliteral">&#39;Unknown_Breed&#39;</span>
<a name="l00121"></a>00121         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">&#39;missing_herd&#39;</span>): kw[<span class="stringliteral">&#39;missing_herd&#39;</span>] = <span class="stringliteral">&#39;Unknown_Herd&#39;</span>
<a name="l00122"></a>00122         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">&#39;missing_sex&#39;</span>): kw[<span class="stringliteral">&#39;missing_sex&#39;</span>] = <span class="stringliteral">&#39;</span><span class="stringliteral">u&#39;</span>
<a name="l00123"></a>00123 <span class="stringliteral">    </span><span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">&#39;missing_inbreeding&#39;</span>): kw[<span class="stringliteral">&#39;missing_inbreeding&#39;</span>] = 0.
<a name="l00124"></a>00124         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">&#39;missing_alive&#39;</span>): kw[<span class="stringliteral">&#39;missing_alive&#39;</span>] = 0
<a name="l00125"></a>00125         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">&#39;missing_age&#39;</span>): kw[<span class="stringliteral">&#39;missing_age&#39;</span>] = -999
<a name="l00126"></a>00126         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">&#39;missing_gen&#39;</span>): kw[<span class="stringliteral">&#39;missing_gen&#39;</span>] = -999.
<a name="l00127"></a>00127         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">&#39;missing_gencoeff&#39;</span>): kw[<span class="stringliteral">&#39;missing_gencoeff&#39;</span>] = -999.
<a name="l00128"></a>00128         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">&#39;missing_igen&#39;</span>): kw[<span class="stringliteral">&#39;missing_igen&#39;</span>] = -999.
<a name="l00129"></a>00129         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">&#39;missing_pedcomp&#39;</span>): kw[<span class="stringliteral">&#39;missing_pedcomp&#39;</span>] = -999.
<a name="l00130"></a>00130     <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">&#39;missing_alleles&#39;</span>): kw[<span class="stringliteral">&#39;missing_alleles&#39;</span>] = [<span class="stringliteral">&#39;&#39;</span>,<span class="stringliteral">&#39;&#39;</span>]
<a name="l00131"></a>00131     <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">&#39;missing_userfield&#39;</span>): kw[<span class="stringliteral">&#39;missing_userfield&#39;</span>] = <span class="stringliteral">&#39;&#39;</span>
<a name="l00132"></a>00132     <span class="comment"># End of default missing values for NewAnimal objects.</span>
<a name="l00133"></a>00133         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">&#39;file_io&#39;</span>): kw[<span class="stringliteral">&#39;file_io&#39;</span>] = <span class="stringliteral">&#39;1&#39;</span>
<a name="l00134"></a>00134         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">&#39;debug_messages&#39;</span>): kw[<span class="stringliteral">&#39;debug_messages&#39;</span>] = 0
<a name="l00135"></a>00135         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">&#39;form_nrm&#39;</span>): kw[<span class="stringliteral">&#39;form_nrm&#39;</span>] = 0
<a name="l00136"></a>00136         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">&#39;nrm_method&#39;</span>): kw[<span class="stringliteral">&#39;nrm_method&#39;</span>] = <span class="stringliteral">&#39;nrm&#39;</span>
<a name="l00137"></a>00137         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">&#39;nrm_format&#39;</span>): kw[<span class="stringliteral">&#39;nrm_format&#39;</span>] = <span class="stringliteral">&#39;text&#39;</span>
<a name="l00138"></a>00138         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">&#39;f_computed&#39;</span>): kw[<span class="stringliteral">&#39;f_computed&#39;</span>] = 0
<a name="l00139"></a>00139         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">&#39;log_ped_lines&#39;</span>): kw[<span class="stringliteral">&#39;log_ped_lines&#39;</span>] = 0
<a name="l00140"></a>00140         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">&#39;log_long_filenames&#39;</span>): kw[<span class="stringliteral">&#39;log_long_filenames&#39;</span>] = 0
<a name="l00141"></a>00141         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">&#39;pedigree_summary&#39;</span>): kw[<span class="stringliteral">&#39;pedigree_summary&#39;</span>] = 1
<a name="l00142"></a>00142         <span class="keywordflow">if</span> kw[<span class="stringliteral">&#39;pedigree_summary&#39;</span>] <span class="keywordflow">not</span> <span class="keywordflow">in</span> [0,1,2]:
<a name="l00143"></a>00143             kw[<span class="stringliteral">&#39;pedigree_summary&#39;</span>] = 1
<a name="l00144"></a>00144         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">&#39;animal_type&#39;</span>): kw[<span class="stringliteral">&#39;animal_type&#39;</span>] = <span class="stringliteral">&#39;new&#39;</span>
<a name="l00145"></a>00145         <span class="keywordflow">if</span> kw[<span class="stringliteral">&#39;animal_type&#39;</span>] <span class="keywordflow">not</span> <span class="keywordflow">in</span> [<span class="stringliteral">&#39;new&#39;</span>,<span class="stringliteral">&#39;light&#39;</span>]:
<a name="l00146"></a>00146             kw[<span class="stringliteral">&#39;animal_type&#39;</span>] = <span class="stringliteral">&#39;new&#39;</span>
<a name="l00147"></a>00147         <span class="keywordflow">if</span> <span class="stringliteral">&#39;f&#39;</span> <span class="keywordflow">in</span> kw[<span class="stringliteral">&#39;pedformat&#39;</span>]:
<a name="l00148"></a>00148             kw[<span class="stringliteral">&#39;f_computed&#39;</span>] = 1
<a name="l00149"></a>00149         <span class="comment"># We have to check for the pedfile key in case this is a</span>
<a name="l00150"></a>00150         <span class="comment"># simulated pedigree, which does not have a pedfile.</span>
<a name="l00151"></a>00151         <span class="keywordflow">if</span> kw[<span class="stringliteral">&#39;simulate_pedigree&#39;</span>]:
<a name="l00152"></a>00152             kw[<span class="stringliteral">&#39;pedfile&#39;</span>] = <span class="stringliteral">&#39;simulated_pedigree&#39;</span>
<a name="l00153"></a>00153         kw[<span class="stringliteral">&#39;filetag&#39;</span>] = string.split(kw[<span class="stringliteral">&#39;pedfile&#39;</span>],<span class="stringliteral">&#39;.&#39;</span>)[0]
<a name="l00154"></a>00154         <span class="keywordflow">if</span> len(kw[<span class="stringliteral">&#39;filetag&#39;</span>]) == 0:
<a name="l00155"></a>00155             kw[<span class="stringliteral">&#39;filetag&#39;</span>] = <span class="stringliteral">&#39;untitled_pedigree&#39;</span>
<a name="l00156"></a>00156         <span class="comment"># The database name and default database table name are needed by pyp_db.</span>
<a name="l00157"></a>00157         <span class="comment"># If the defaults are not overridden &#39;pypedal&#39; and the filetag are used</span>
<a name="l00158"></a>00158         <span class="comment"># for the defaults, respectively.</span>
<a name="l00159"></a>00159         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">&#39;database_name&#39;</span>): kw[<span class="stringliteral">&#39;database_name&#39;</span>] = <span class="stringliteral">&#39;pypedal&#39;</span>
<a name="l00160"></a>00160         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">&#39;database_table&#39;</span>):
<a name="l00161"></a>00161             kw[<span class="stringliteral">&#39;database_table&#39;</span>] = pyp_utils.string_to_table_name(kw[<span class="stringliteral">&#39;filetag&#39;</span>])
<a name="l00162"></a>00162         <span class="keywordflow">else</span>:
<a name="l00163"></a>00163             kw[<span class="stringliteral">&#39;database_table&#39;</span>] = pyp_utils.string_to_table_name(kw[<span class="stringliteral">&#39;database_table&#39;</span>])
<a name="l00164"></a>00164         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">&#39;database_debug&#39;</span>): kw[<span class="stringliteral">&#39;database_debug&#39;</span>] = <span class="keyword">False</span>
<a name="l00165"></a>00165         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">&#39;database_type&#39;</span>): kw[<span class="stringliteral">&#39;database_type&#39;</span>] = <span class="stringliteral">&#39;sqlite&#39;</span>
<a name="l00166"></a>00166         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">&#39;database_host&#39;</span>): kw[<span class="stringliteral">&#39;database_host&#39;</span>] = <span class="stringliteral">&#39;localhost&#39;</span>
<a name="l00167"></a>00167         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">&#39;database_user&#39;</span>): kw[<span class="stringliteral">&#39;database_user&#39;</span>] = <span class="stringliteral">&#39;anonymous&#39;</span>
<a name="l00168"></a>00168         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">&#39;database_passwd&#39;</span>): kw[<span class="stringliteral">&#39;database_passwd&#39;</span>] = <span class="stringliteral">&#39;anonymous&#39;</span>
<a name="l00169"></a>00169         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">&#39;database_port&#39;</span>): kw[<span class="stringliteral">&#39;database_port&#39;</span>] = <span class="stringliteral">&#39;&#39;</span>
<a name="l00170"></a>00170         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">&#39;database_sql&#39;</span>): kw[<span class="stringliteral">&#39;database_sql&#39;</span>] = <span class="stringliteral">&#39;SELECT * FROM %s&#39;</span>
<a name="l00171"></a>00171         <span class="comment"># This keyword is used by pyp_nrm/fast_a_matrix() to determine if the diagonals</span>
<a name="l00172"></a>00172         <span class="comment"># of the relationship matrix should be augmented by founder coefficients of</span>
<a name="l00173"></a>00173         <span class="comment"># inbreeding or not. This is disabled by default.</span>
<a name="l00174"></a>00174         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">&#39;foundercoi&#39;</span>): kw[<span class="stringliteral">&#39;foundercoi&#39;</span>] = 0
<a name="l00175"></a>00175         <span class="keywordflow">if</span> kw[<span class="stringliteral">&#39;foundercoi&#39;</span>] <span class="keywordflow">not</span> <span class="keywordflow">in</span> [0, 1]: kw[<span class="stringliteral">&#39;foundercoi&#39;</span>] = 0
<a name="l00176"></a>00176         <span class="comment"># If the user provides a paper size make sure that it is a supported value.</span>
<a name="l00177"></a>00177         <span class="comment"># Right now, only a4 and letter are supported.  Note that &#39;a4&#39; is silently</span>
<a name="l00178"></a>00178         <span class="comment"># changed to &#39;A4&#39; because ReportLab is case-sensitive.  Also handle setting</span>
<a name="l00179"></a>00179         <span class="comment"># the defualt unit of measurement.</span>
<a name="l00180"></a>00180         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">&#39;paper_size&#39;</span>): kw[<span class="stringliteral">&#39;paper_size&#39;</span>] = <span class="stringliteral">&#39;letter&#39;</span>
<a name="l00181"></a>00181         <span class="keywordflow">if</span> kw[<span class="stringliteral">&#39;paper_size&#39;</span>] == <span class="stringliteral">&#39;a4&#39;</span>:
<a name="l00182"></a>00182             kw[<span class="stringliteral">&#39;paper_size&#39;</span>] = <span class="stringliteral">&#39;A4&#39;</span>
<a name="l00183"></a>00183         <span class="keywordflow">if</span> kw[<span class="stringliteral">&#39;paper_size&#39;</span>] <span class="keywordflow">not</span> <span class="keywordflow">in</span> [<span class="stringliteral">&#39;A4&#39;</span>,<span class="stringliteral">&#39;letter&#39;</span>]:
<a name="l00184"></a>00184             kw[<span class="stringliteral">&#39;paper_size&#39;</span>] = <span class="stringliteral">&#39;letter&#39;</span>
<a name="l00185"></a>00185         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">&#39;default_unit&#39;</span>): kw[<span class="stringliteral">&#39;default_unit&#39;</span>] = <span class="stringliteral">&#39;inch&#39;</span>
<a name="l00186"></a>00186         <span class="keywordflow">if</span> kw[<span class="stringliteral">&#39;default_unit&#39;</span>] <span class="keywordflow">not</span> <span class="keywordflow">in</span> [<span class="stringliteral">&#39;cm&#39;</span>,<span class="stringliteral">&#39;inch&#39;</span>]:
<a name="l00187"></a>00187             kw[<span class="stringliteral">&#39;default_unit&#39;</span>] = <span class="stringliteral">&#39;inch&#39;</span>
<a name="l00188"></a>00188         <span class="comment"># Defining the default font size to be used in graphs as a keyword</span>
<a name="l00189"></a>00189         <span class="comment"># saces some cruft in pyp_graphics and makes it easier for the user</span>
<a name="l00190"></a>00190         <span class="comment"># to understand what is going on.</span>
<a name="l00191"></a>00191         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">&#39;default_fontsize&#39;</span>): kw[<span class="stringliteral">&#39;default_fontsize&#39;</span>] = 10
<a name="l00192"></a>00192         <span class="keywordflow">try</span>:
<a name="l00193"></a>00193             kw[<span class="stringliteral">&#39;default_fontsize&#39;</span>] = int(kw[<span class="stringliteral">&#39;default_fontsize&#39;</span>])
<a name="l00194"></a>00194         <span class="keywordflow">except</span>:
<a name="l00195"></a>00195             kw[<span class="stringliteral">&#39;default_fontsize&#39;</span>] = 10
<a name="l00196"></a>00196         <span class="keywordflow">if</span> kw[<span class="stringliteral">&#39;default_fontsize&#39;</span>] &lt; 1:
<a name="l00197"></a>00197             kw[<span class="stringliteral">&#39;default_fontsize&#39;</span>] = 10
<a name="l00198"></a>00198         <span class="comment"># default_report is used by pyp_reports as a root name when writing</span>
<a name="l00199"></a>00199         <span class="comment"># reports to files.</span>
<a name="l00200"></a>00200         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">&#39;default_report&#39;</span>): kw[<span class="stringliteral">&#39;default_report&#39;</span>] = kw[<span class="stringliteral">&#39;filetag&#39;</span>]
<a name="l00201"></a>00201         <span class="comment"># This is a hack to fix it so that the inbreeding routines in</span>
<a name="l00202"></a>00202         <span class="comment"># pyp_nrm can be told to use sparse matrices when necessary.</span>
<a name="l00203"></a>00203         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">&#39;matrix_type&#39;</span>): kw[<span class="stringliteral">&#39;matrix_type&#39;</span>] = <span class="stringliteral">&#39;dense&#39;</span>
<a name="l00204"></a>00204         <span class="keywordflow">if</span> kw[<span class="stringliteral">&#39;matrix_type&#39;</span>] <span class="keywordflow">not</span> <span class="keywordflow">in</span> [<span class="stringliteral">&#39;dense&#39;</span>,<span class="stringliteral">&#39;sparse&#39;</span>]:
<a name="l00205"></a>00205             kw[<span class="stringliteral">&#39;matrix_type&#39;</span>] = <span class="stringliteral">&#39;dense&#39;</span>
<a name="l00206"></a>00206 
<a name="l00207"></a>00207         <span class="comment">### This is for internal use only! I left it out of the documentation</span>
<a name="l00208"></a>00208         <span class="comment">### on purpose so that people won&#39;t break things with it.</span>
<a name="l00209"></a>00209         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">&#39;newanimal_caller&#39;</span>): kw[<span class="stringliteral">&#39;newanimal_caller&#39;</span>] = <span class="stringliteral">&#39;loader&#39;</span>
<a name="l00210"></a>00210 
<a name="l00211"></a>00211         <span class="comment">### Options related to traits</span>
<a name="l00212"></a>00212         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">&#39;trait_names&#39;</span>): kw[<span class="stringliteral">&#39;trait_names&#39;</span>] = []
<a name="l00213"></a>00213         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">&#39;trait_auto_name&#39;</span>): kw[<span class="stringliteral">&#39;trait_auto_name&#39;</span>] = 1
<a name="l00214"></a>00214         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">&#39;trait_count&#39;</span>): kw[<span class="stringliteral">&#39;trait_count&#39;</span>] = 0
<a name="l00215"></a>00215 
<a name="l00216"></a>00216         <span class="comment"># We need a match rule to use with the __add__() method.</span>
<a name="l00217"></a>00217         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">&#39;match_rule&#39;</span>): kw[<span class="stringliteral">&#39;match_rule&#39;</span>] = <span class="stringliteral">&#39;asd&#39;</span>
<a name="l00218"></a>00218 
<a name="l00219"></a>00219         <span class="comment"># Now that we have processed all of the arguments in the options dictionary</span>
<a name="l00220"></a>00220         <span class="comment"># we need to attach it to this object.</span>
<a name="l00221"></a>00221 <span class="comment">#         print &#39;Ending kw: %s&#39; % ( kw )</span>
<a name="l00222"></a>00222         self.kw = kw
<a name="l00223"></a>00223 
<a name="l00224"></a>00224         <span class="comment"># Initialize the Big Main Data Structures to null values</span>
<a name="l00225"></a>00225         self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a28eed1e3039de3a74d2597d556ac831f">pedigree</a> = []                         <span class="comment"># We may start storing animals in a dictionary rather than in a list.  Maybe,</span>
<a name="l00226"></a>00226         self.metadata = {}                         <span class="comment"># Metadata will also be stored in a dictionary.</span>
<a name="l00227"></a>00227         self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#ae1358ecde62705c1e68fef7a1d943d7e">idmap</a> = {}                            <span class="comment"># Used to map between original and renumbered IDs.</span>
<a name="l00228"></a>00228         self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a6b8ebfe1128f217497e0604e450066db">backmap</a> = {}                          <span class="comment"># Used to map between renumbered and original IDs.</span>
<a name="l00229"></a>00229         self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#aab4ab96d9bbce43c2d7c09977bd82d9a">namemap</a> = {}                           <span class="comment"># This is needed to map IDs to names when IDs are read using the string formats (ASD).</span>
<a name="l00230"></a>00230         self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a6b8ebfe1128f217497e0604e450066db">backmap</a> = {}
<a name="l00231"></a>00231         self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#adb79d76cbccbc5c03edc64c116f3f43a">namebackmap</a> = {}
<a name="l00232"></a>00232         self.stringmap = {}                         <span class="comment"># Maps original IDs to names in ASD pedigrees</span>
<a name="l00233"></a>00233         <span class="comment"># Maybe these will go in a configuration file later</span>
<a name="l00234"></a>00234         self.starline = <span class="stringliteral">&#39;*&#39;</span>*80
<a name="l00235"></a>00235         <span class="comment"># This is the list of valid pedformat codes</span>
<a name="l00236"></a>00236         self.pedformat_codes = [<span class="stringliteral">&#39;a&#39;</span>,<span class="stringliteral">&#39;s&#39;</span>,<span class="stringliteral">&#39;d&#39;</span>,<span class="stringliteral">&#39;g&#39;</span>,<span class="stringliteral">&#39;x&#39;</span>,<span class="stringliteral">&#39;b&#39;</span>,<span class="stringliteral">&#39;f&#39;</span>,<span class="stringliteral">&#39;</span><span class="stringliteral">r&#39;,&#39;</span>n&#39;,&#39;y&#39;,&#39;l&#39;,&#39;e&#39;,&#39;p&#39;,&#39;A&#39;,&#39;S&#39;,&#39;D&#39;,&#39;L&#39;,&#39;Z&#39;,&#39;h&#39;,&#39;H&#39;,&#39;<span class="stringliteral">u&#39;]</span>
<a name="l00237"></a>00237 <span class="stringliteral">        </span><span class="comment"># This dictionary maps pedformat codes to NewAnimal attributes</span>
<a name="l00238"></a>00238         self.new_animal_attr = {
<a name="l00239"></a>00239         <span class="stringliteral">&#39;a&#39;</span>: <span class="stringliteral">&#39;animalID&#39;</span>,
<a name="l00240"></a>00240         <span class="stringliteral">&#39;s&#39;</span>: <span class="stringliteral">&#39;sireID&#39;</span>,
<a name="l00241"></a>00241         <span class="stringliteral">&#39;d&#39;</span>: <span class="stringliteral">&#39;damID&#39;</span>,
<a name="l00242"></a>00242         <span class="stringliteral">&#39;g&#39;</span>: <span class="stringliteral">&#39;gen&#39;</span>,
<a name="l00243"></a>00243         <span class="stringliteral">&#39;x&#39;</span>: <span class="stringliteral">&#39;sex&#39;</span>,
<a name="l00244"></a>00244         <span class="stringliteral">&#39;b&#39;</span>: <span class="stringliteral">&#39;bd&#39;</span>,
<a name="l00245"></a>00245         <span class="stringliteral">&#39;f&#39;</span>: <span class="stringliteral">&#39;fa&#39;</span>,
<a name="l00246"></a>00246         <span class="stringliteral">&#39;</span><span class="stringliteral">r&#39;: &#39;</span>breed&#39;,
<a name="l00247"></a>00247         <span class="stringliteral">&#39;n&#39;</span>: <span class="stringliteral">&#39;name&#39;</span>,
<a name="l00248"></a>00248         <span class="stringliteral">&#39;y&#39;</span>: <span class="stringliteral">&#39;by&#39;</span>,
<a name="l00249"></a>00249         <span class="stringliteral">&#39;l&#39;</span>: <span class="stringliteral">&#39;alive&#39;</span>,
<a name="l00250"></a>00250         <span class="stringliteral">&#39;e&#39;</span>: <span class="stringliteral">&#39;age&#39;</span>,
<a name="l00251"></a>00251         <span class="stringliteral">&#39;p&#39;</span>: <span class="stringliteral">&#39;gencoeff&#39;</span>,
<a name="l00252"></a>00252         <span class="stringliteral">&#39;A&#39;</span>: <span class="stringliteral">&#39;name&#39;</span>,
<a name="l00253"></a>00253         <span class="stringliteral">&#39;S&#39;</span>: <span class="stringliteral">&#39;sireName&#39;</span>,
<a name="l00254"></a>00254         <span class="stringliteral">&#39;D&#39;</span>: <span class="stringliteral">&#39;damName&#39;</span>,
<a name="l00255"></a>00255         <span class="stringliteral">&#39;L&#39;</span>: <span class="stringliteral">&#39;alleles&#39;</span>,
<a name="l00256"></a>00256         <span class="stringliteral">&#39;Z&#39;</span>: <span class="keyword">False</span>,
<a name="l00257"></a>00257         <span class="stringliteral">&#39;h&#39;</span>: <span class="stringliteral">&#39;herd&#39;</span>,
<a name="l00258"></a>00258         <span class="stringliteral">&#39;H&#39;</span>: <span class="stringliteral">&#39;originalHerd&#39;</span>,
<a name="l00259"></a>00259         <span class="stringliteral">&#39;</span><span class="stringliteral">u&#39;: &#39;</span>userField&#39;,
<a name="l00260"></a>00260         <span class="stringliteral">&#39;T&#39;</span>: <span class="stringliteral">&#39;traits&#39;</span>,
<a name="l00261"></a>00261     }
<a name="l00262"></a>00262         <span class="comment"># Start logging!</span>
<a name="l00263"></a>00263         <span class="keywordflow">if</span> <span class="keywordflow">not</span> self.kw.has_key(<span class="stringliteral">&#39;logfile&#39;</span>):
<a name="l00264"></a>00264             <span class="keywordflow">if</span> kw[<span class="stringliteral">&#39;log_long_filenames&#39;</span>]:
<a name="l00265"></a>00265                 self.kw[<span class="stringliteral">&#39;logfile&#39;</span>] = <span class="stringliteral">&#39;%s_%s.log&#39;</span> % ( self.kw[<span class="stringliteral">&#39;filetag&#39;</span>], pyp_utils.pyp_datestamp() )
<a name="l00266"></a>00266             <span class="keywordflow">else</span>:
<a name="l00267"></a>00267                 self.kw[<span class="stringliteral">&#39;logfile&#39;</span>] = <span class="stringliteral">&#39;%s.log&#39;</span> % ( self.kw[<span class="stringliteral">&#39;filetag&#39;</span>] )
<a name="l00268"></a>00268         logging.basicConfig(level=logging.DEBUG, format=<span class="stringliteral">&#39;%(asctime)s %(levelname)-8s %(message)s&#39;</span>, datefmt=<span class="stringliteral">&#39;%a, %d %b %Y %H:%M:%S&#39;</span>, filename=self.kw[<span class="stringliteral">&#39;logfile&#39;</span>], filemode=<span class="stringliteral">&#39;w&#39;</span>)
<a name="l00269"></a>00269         logging.info(<span class="stringliteral">&#39;Logfile %s instantiated.&#39;</span>,self.kw[<span class="stringliteral">&#39;logfile&#39;</span>])
<a name="l00270"></a>00270         <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span> <span class="keywordflow">and</span> self.kw[<span class="stringliteral">&#39;pedigree_summary&#39;</span>]:
<a name="l00271"></a>00271             <span class="keywordflow">print</span> <span class="stringliteral">&#39;[INFO]: Logfile %s instantiated.&#39;</span> % (self.kw[<span class="stringliteral">&#39;logfile&#39;</span>])
<a name="l00272"></a>00272         <span class="comment"># Deal with abberant cases of log_ped_lines here.</span>
<a name="l00273"></a>00273         <span class="keywordflow">try</span>:
<a name="l00274"></a>00274             _lpl = kw[<span class="stringliteral">&#39;log_ped_lines&#39;</span>]
<a name="l00275"></a>00275             kw[<span class="stringliteral">&#39;log_ped_lines&#39;</span>] = int(kw[<span class="stringliteral">&#39;log_ped_lines&#39;</span>])
<a name="l00276"></a>00276         <span class="keywordflow">except</span> ValueError:
<a name="l00277"></a>00277             kw[<span class="stringliteral">&#39;log_ped_lines&#39;</span>] = 0
<a name="l00278"></a>00278             logging.warning(<span class="stringliteral">&#39;An incorrect value (%s) was provided for the option log_ped_lines, which must be a number greater than or equal 0.  It has been set to 0.&#39;</span>, _lpl)
<a name="l00279"></a>00279         <span class="keywordflow">if</span>  kw[<span class="stringliteral">&#39;log_ped_lines&#39;</span>] &lt; 0:
<a name="l00280"></a>00280             kw[<span class="stringliteral">&#39;log_ped_lines&#39;</span>] = 0
<a name="l00281"></a>00281             logging.warning(<span class="stringliteral">&#39;A negative value (%s) was provided for the option log_ped_lines, which must be greater than or equal 0.  It has been set to 0.&#39;</span>, kw[<span class="stringliteral">&#39;log_ped_lines&#39;</span>])
<a name="l00282"></a>00282 
<a name="l00283"></a>00283     <span class="comment">##</span>
<a name="l00284"></a>00284     <span class="comment"># Method to add two pedigrees and return a new pedigree representing the</span>
<a name="l00285"></a>00285     <span class="comment"># merged pedigrees.</span>
<a name="l00286"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a8e61f8a2dd95d5e0eb3c8ed0ad5dfc01">00286</a>     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a8e61f8a2dd95d5e0eb3c8ed0ad5dfc01" title="Method to add two pedigrees and return a new pedigree representing the merged pedigrees.">__add__</a>(self, other, filename=False, debugLoad=False):
<a name="l00287"></a>00287         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00288"></a>00288 <span class="stringliteral">        Method to add two pedigree and return a new pedigree representing the</span>
<a name="l00289"></a>00289 <span class="stringliteral">        merged pedigrees.</span>
<a name="l00290"></a>00290 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l00291"></a>00291         <span class="keywordflow">if</span> self.__class__.__name__ == <span class="stringliteral">&#39;NewPedigree&#39;</span> <span class="keywordflow">and</span> other.__class__.__name__ == <span class="stringliteral">&#39;NewPedigree&#39;</span>:
<a name="l00292"></a>00292             logging.info(<span class="stringliteral">&#39;Adding pedigrees %s and %s&#39;</span>, self.kw[<span class="stringliteral">&#39;pedname&#39;</span>], \
<a name="l00293"></a>00293                 other.kw[<span class="stringliteral">&#39;pedname&#39;</span>] )
<a name="l00294"></a>00294             <span class="comment">#print &#39;self and other both are NewPedigree objects. We can start combining them&#39;</span>
<a name="l00295"></a>00295             <span class="comment">#print &#39;Using match rule: %s&#39; % ( self.kw[&#39;match_rule&#39;])</span>
<a name="l00296"></a>00296             logging.info(<span class="stringliteral">&#39;Using match rule %s to merge pedigrees&#39;</span>, \
<a name="l00297"></a>00297                 self.kw[<span class="stringliteral">&#39;match_rule&#39;</span>] )
<a name="l00298"></a>00298             <span class="comment"># Pedigrees must be renumbered</span>
<a name="l00299"></a>00299             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;pedigree_is_renumbered&#39;</span>] != 1:
<a name="l00300"></a>00300                 self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#aef198ff1c3c2ac1c666486deb2d2e92a" title="renumber() updates the ID map after a pedigree has been renumbered so that all references are to renu...">renumber</a>()
<a name="l00301"></a>00301                 logging.info(<span class="stringliteral">&#39;Renumbering pedigree %s&#39;</span>, self.kw[<span class="stringliteral">&#39;pedname&#39;</span>] )
<a name="l00302"></a>00302             <span class="keywordflow">if</span> other.kw[<span class="stringliteral">&#39;pedigree_is_renumbered&#39;</span>] != 1:
<a name="l00303"></a>00303                 other.renumber()
<a name="l00304"></a>00304                 logging.info(<span class="stringliteral">&#39;Renumbering pedigree %s&#39;</span>, other.kw[<span class="stringliteral">&#39;pedname&#39;</span>] )
<a name="l00305"></a>00305             <span class="comment"># We need to compare each animal in self and other to see if they</span>
<a name="l00306"></a>00306             <span class="comment"># match based on the match_rule.</span>
<a name="l00307"></a>00307             <span class="comment">#</span>
<a name="l00308"></a>00308             <span class="comment"># We&#39;re going to use a dictionary to keep track of which animals</span>
<a name="l00309"></a>00309             <span class="comment"># need to be written to the new pedigree file from which the merged</span>
<a name="l00310"></a>00310             <span class="comment"># pedigree will be loaded. By default, I assume that all animal</span>
<a name="l00311"></a>00311             <span class="comment"># records are unique, and only change the ped_to_write flag  when a</span>
<a name="l00312"></a>00312             <span class="comment"># duplicate has been detected.</span>
<a name="l00313"></a>00313             <span class="comment">#</span>
<a name="l00314"></a>00314             <span class="comment"># NOTE: It&#39;s nagging at me that there may be a logic error in the</span>
<a name="l00315"></a>00315             <span class="comment"># checking and flagging, so this code needs to be thoroughly tested!</span>
<a name="l00316"></a>00316             ped_to_write = {<span class="stringliteral">&#39;a&#39;</span>: {}, <span class="stringliteral">&#39;b&#39;</span>: {}}
<a name="l00317"></a>00317             <span class="keywordflow">for</span> a <span class="keywordflow">in</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a28eed1e3039de3a74d2597d556ac831f">pedigree</a>:
<a name="l00318"></a>00318                 ped_to_write[<span class="stringliteral">&#39;a&#39;</span>][a.animalID] = <span class="keyword">True</span>
<a name="l00319"></a>00319                 <span class="keywordflow">for</span> b <span class="keywordflow">in</span> other.pedigree:
<a name="l00320"></a>00320                     mismatches = 0      <span class="comment"># Count places where the animals don&#39;t match</span>
<a name="l00321"></a>00321                     <span class="comment">#print &#39;Comparing animal %s in a and animal %s in b&#39; % \</span>
<a name="l00322"></a>00322                     <span class="comment">#    ( a.animalID, b.animalID )</span>
<a name="l00323"></a>00323                     <span class="keywordflow">for</span> match <span class="keywordflow">in</span> self.kw[<span class="stringliteral">&#39;match_rule&#39;</span>]:
<a name="l00324"></a>00324                         <span class="comment">#print &#39;First match criterion: %s (%s)&#39; % \</span>
<a name="l00325"></a>00325                         <span class="comment">#    ( match, self.new_animal_attr[match] )</span>
<a name="l00326"></a>00326                         <span class="comment"># If we&#39;re comparing animal IDs, make sure that we</span>
<a name="l00327"></a>00327                         <span class="comment"># compare original IDs, not renumbered IDs.</span>
<a name="l00328"></a>00328                         <span class="keywordflow">if</span> match <span class="keywordflow">in</span> [<span class="stringliteral">&#39;a&#39;</span>,<span class="stringliteral">&#39;A&#39;</span>]:
<a name="l00329"></a>00329                             <span class="keywordflow">if</span> a.originalID != b.originalID:
<a name="l00330"></a>00330                                 mismatches = mismatches + 1
<a name="l00331"></a>00331                         <span class="keywordflow">elif</span> match <span class="keywordflow">in</span> [<span class="stringliteral">&#39;s&#39;</span>,<span class="stringliteral">&#39;S&#39;</span>]:
<a name="l00332"></a>00332                             <span class="keywordflow">if</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a28eed1e3039de3a74d2597d556ac831f">pedigree</a>[a.sireID-1].originalID != \
<a name="l00333"></a>00333                                 other.pedigree[b.sireID-1].originalID:
<a name="l00334"></a>00334                                 mismatches = mismatches + 1
<a name="l00335"></a>00335                         <span class="keywordflow">elif</span> match <span class="keywordflow">in</span> [<span class="stringliteral">&#39;d&#39;</span>,<span class="stringliteral">&#39;D&#39;</span>]:
<a name="l00336"></a>00336                             <span class="keywordflow">if</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a28eed1e3039de3a74d2597d556ac831f">pedigree</a>[a.damID-1].originalID != \
<a name="l00337"></a>00337                                 other.pedigree[b.damID-1].originalID:
<a name="l00338"></a>00338                                 mismatches = mismatches + 1
<a name="l00339"></a>00339                         <span class="keywordflow">elif</span> getattr(a, self.new_animal_attr[match]) != \
<a name="l00340"></a>00340                             getattr(b, self.new_animal_attr[match]):
<a name="l00341"></a>00341                             <span class="comment">#print &#39;%s == %s&#39; % ( \</span>
<a name="l00342"></a>00342                             <span class="comment">#    getattr(a, self.new_animal_attr[match]), \</span>
<a name="l00343"></a>00343                             <span class="comment">#    getattr(b, self.new_animal_attr[match]) )</span>
<a name="l00344"></a>00344                             mismatches = mismatches + 1
<a name="l00345"></a>00345                         <span class="keywordflow">else</span>:
<a name="l00346"></a>00346                             <span class="comment">#print &#39;%s != %s&#39; % ( \</span>
<a name="l00347"></a>00347                             <span class="comment">#    getattr(a, self.new_animal_attr[match]), \</span>
<a name="l00348"></a>00348                             <span class="comment">#    getattr(b, self.new_animal_attr[match]) )</span>
<a name="l00349"></a>00349                             <span class="keywordflow">pass</span>
<a name="l00350"></a>00350             <span class="comment"># If there are no mismatches then the two animals are identical</span>
<a name="l00351"></a>00351             <span class="comment"># based on the match rule and only one of them needs to be written</span>
<a name="l00352"></a>00352             <span class="comment"># to the merged pedigree.</span>
<a name="l00353"></a>00353             <span class="keywordflow">if</span> ( mismatches == 0 ):
<a name="l00354"></a>00354                 <span class="comment"># Animals are identical</span>
<a name="l00355"></a>00355                 ped_to_write[<span class="stringliteral">&#39;b&#39;</span>][b.animalID] = <span class="keyword">False</span>
<a name="l00356"></a>00356             <span class="keywordflow">else</span>:
<a name="l00357"></a>00357                 <span class="comment"># Animals are different</span>
<a name="l00358"></a>00358                 ped_to_write[<span class="stringliteral">&#39;b&#39;</span>][b.animalID] = <span class="keyword">True</span>
<a name="l00359"></a>00359             <span class="comment"># Once we have matches, we are going to write a new pedigree</span>
<a name="l00360"></a>00360             <span class="comment"># file to disc, and we will load that file to get the new</span>
<a name="l00361"></a>00361             <span class="comment"># pedigree.</span>
<a name="l00362"></a>00362             <span class="comment">#</span>
<a name="l00363"></a>00363             <span class="comment"># First, save the unique animals from the union of pedigrees a and</span>
<a name="l00364"></a>00364             <span class="comment"># b based on the match rule. Note that the pedformat from the first</span>
<a name="l00365"></a>00365             <span class="comment"># pedigree passed to __add__() will be used for both pedigrees. This</span>
<a name="l00366"></a>00366             <span class="comment"># makes sense because you cannot have two different pedformats in</span>
<a name="l00367"></a>00367             <span class="comment"># the same file.</span>
<a name="l00368"></a>00368             <span class="keywordflow">if</span> filename == <span class="keyword">False</span>:
<a name="l00369"></a>00369                 filename = <span class="stringliteral">&#39;%s_%s.ped&#39;</span> % ( self.kw[<span class="stringliteral">&#39;pedname&#39;</span>], \
<a name="l00370"></a>00370                 other.kw[<span class="stringliteral">&#39;pedname&#39;</span>] )
<a name="l00371"></a>00371                 <span class="keywordflow">print</span> <span class="stringliteral">&#39;[INFO]: filename = %s&#39;</span> % ( filename )
<a name="l00372"></a>00372             self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#ab2c07236058bb89d5318a7453cb6db29" title="save() writes a PyPedal pedigree to a user-specified file.">save</a>(filename=filename, write_list=ped_to_write[<span class="stringliteral">&#39;a&#39;</span>], \
<a name="l00373"></a>00373                 pedformat=self.kw[<span class="stringliteral">&#39;pedformat&#39;</span>], originalID=<span class="keyword">True</span>)
<a name="l00374"></a>00374             other.save(filename=filename, write_list=ped_to_write[<span class="stringliteral">&#39;b&#39;</span>], \
<a name="l00375"></a>00375                 pedformat=self.kw[<span class="stringliteral">&#39;pedformat&#39;</span>], originalID=<span class="keyword">True</span>, append=<span class="keyword">True</span> )
<a name="l00376"></a>00376             <span class="comment"># Now we need to load the new pedigree and return it. This should be</span>
<a name="l00377"></a>00377             <span class="comment"># dead easy.</span>
<a name="l00378"></a>00378             <span class="comment">#</span>
<a name="l00379"></a>00379             <span class="comment"># Create the options dictionary</span>
<a name="l00380"></a>00380             merged_pedname = <span class="stringliteral">&#39;Merged Pedigree: %s + %s&#39;</span> % \
<a name="l00381"></a>00381                 ( self.kw[<span class="stringliteral">&#39;pedname&#39;</span>], other.kw[<span class="stringliteral">&#39;pedname&#39;</span>] )
<a name="l00382"></a>00382             new_options = {}
<a name="l00383"></a>00383             new_options[<span class="stringliteral">&#39;messages&#39;</span>] = self.kw[<span class="stringliteral">&#39;messages&#39;</span>]
<a name="l00384"></a>00384             new_options[<span class="stringliteral">&#39;pedname&#39;</span>] = merged_pedname
<a name="l00385"></a>00385             new_options[<span class="stringliteral">&#39;renumber&#39;</span>] = 1
<a name="l00386"></a>00386             new_options[<span class="stringliteral">&#39;pedfile&#39;</span>] = filename
<a name="l00387"></a>00387             new_options[<span class="stringliteral">&#39;pedformat&#39;</span>] = self.kw[<span class="stringliteral">&#39;pedformat&#39;</span>]
<a name="l00388"></a>00388             <span class="comment"># Load the new pedigree and return it.</span>
<a name="l00389"></a>00389             <span class="keywordflow">try</span>:
<a name="l00390"></a>00390                 new_pedigree = loadPedigree(new_options, debugLoad=<span class="keyword">True</span>)
<a name="l00391"></a>00391                 <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span>:
<a name="l00392"></a>00392                     <span class="keywordflow">print</span> <span class="stringliteral">&#39;[INFO]: Loaded merged pedigree %s from file %s!&#39;</span> % \
<a name="l00393"></a>00393                         ( merged_pedname, filename )
<a name="l00394"></a>00394                 logging.info(<span class="stringliteral">&#39;Cannot complete __add__() operation becuase types do not match.&#39;</span>)
<a name="l00395"></a>00395                 <span class="keywordflow">return</span> new_pedigree
<a name="l00396"></a>00396             <span class="keywordflow">except</span>:
<a name="l00397"></a>00397                 <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span>:
<a name="l00398"></a>00398                     <span class="keywordflow">print</span> <span class="stringliteral">&#39;[ERROR]: Could not load merged pedigree %s from file %s!&#39;</span> % \
<a name="l00399"></a>00399                         ( merged_pedname, filename )
<a name="l00400"></a>00400                 logging.error(<span class="stringliteral">&#39;Could not load merged pedigree %s from file %s!&#39;</span>, \
<a name="l00401"></a>00401                     merged_pedname, filename)
<a name="l00402"></a>00402                 <span class="keywordflow">return</span> <span class="keyword">False</span>
<a name="l00403"></a>00403         <span class="keywordflow">else</span>:
<a name="l00404"></a>00404             logging.error(<span class="stringliteral">&#39;Cannot complete __add__() operation becuase types do not match.&#39;</span>)
<a name="l00405"></a>00405             <span class="keywordflow">return</span> NotImplemented
<a name="l00406"></a>00406 
<a name="l00407"></a>00407     <span class="comment">##</span>
<a name="l00408"></a>00408     <span class="comment"># Method to subtract two pedigree and return a new pedigree representing the</span>
<a name="l00409"></a>00409     <span class="comment"># first pedigree without any animals shared in common with the second pedigree,</span>
<a name="l00410"></a>00410     <span class="comment"># or: A - B = A - (A \cap B).</span>
<a name="l00411"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a422caca98648557dd76722f135751e5e">00411</a>     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a422caca98648557dd76722f135751e5e" title="Method to subtract two pedigree and return a new pedigree representing the first pedigree without any...">__sub__</a>(self, other, filename=False, debugLoad=False):
<a name="l00412"></a>00412         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00413"></a>00413 <span class="stringliteral">        Method to subtract two pedigree and return a new pedigree representing the</span>
<a name="l00414"></a>00414 <span class="stringliteral">        first pedigree without any animals shared in common with the second pedigree,</span>
<a name="l00415"></a>00415 <span class="stringliteral">    or: A - B = A - (A \cap B).</span>
<a name="l00416"></a>00416 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l00417"></a>00417         <span class="keywordflow">if</span> self.__class__.__name__ == <span class="stringliteral">&#39;NewPedigree&#39;</span> <span class="keywordflow">and</span> other.__class__.__name__ == <span class="stringliteral">&#39;NewPedigree&#39;</span>:
<a name="l00418"></a>00418             logging.info(<span class="stringliteral">&#39;Subtracting pedigrees %s and %s&#39;</span>, self.kw[<span class="stringliteral">&#39;pedname&#39;</span>], \
<a name="l00419"></a>00419                 other.kw[<span class="stringliteral">&#39;pedname&#39;</span>] )
<a name="l00420"></a>00420             <span class="comment">#print &#39;self and other both are NewPedigree objects. We can start combining them&#39;</span>
<a name="l00421"></a>00421             <span class="comment">#print &#39;Using match rule: %s&#39; % ( self.kw[&#39;match_rule&#39;])</span>
<a name="l00422"></a>00422             logging.info(<span class="stringliteral">&#39;Using match rule %s to subtract pedigrees&#39;</span>, \
<a name="l00423"></a>00423                 self.kw[<span class="stringliteral">&#39;match_rule&#39;</span>] )
<a name="l00424"></a>00424             <span class="comment"># Pedigrees must be renumbered</span>
<a name="l00425"></a>00425             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;pedigree_is_renumbered&#39;</span>] != 1:
<a name="l00426"></a>00426                 self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#aef198ff1c3c2ac1c666486deb2d2e92a" title="renumber() updates the ID map after a pedigree has been renumbered so that all references are to renu...">renumber</a>()
<a name="l00427"></a>00427                 logging.info(<span class="stringliteral">&#39;Renumbering pedigree %s&#39;</span>, self.kw[<span class="stringliteral">&#39;pedname&#39;</span>] )
<a name="l00428"></a>00428             <span class="keywordflow">if</span> other.kw[<span class="stringliteral">&#39;pedigree_is_renumbered&#39;</span>] != 1:
<a name="l00429"></a>00429                 other.renumber()
<a name="l00430"></a>00430                 logging.info(<span class="stringliteral">&#39;Renumbering pedigree %s&#39;</span>, other.kw[<span class="stringliteral">&#39;pedname&#39;</span>] )
<a name="l00431"></a>00431             <span class="comment"># We need to compare each animal in self and other to see if they</span>
<a name="l00432"></a>00432             <span class="comment"># match based on the match_rule.</span>
<a name="l00433"></a>00433             <span class="comment">#</span>
<a name="l00434"></a>00434             <span class="comment"># We&#39;re going to use a dictionary to keep track of which animals</span>
<a name="l00435"></a>00435             <span class="comment"># need to be written to the new pedigree file from which the merged</span>
<a name="l00436"></a>00436             <span class="comment"># pedigree will be loaded. By default, I assume that all animal</span>
<a name="l00437"></a>00437             <span class="comment"># records are unique, and only change the ped_to_write flag  when a</span>
<a name="l00438"></a>00438             <span class="comment"># duplicate has been detected.</span>
<a name="l00439"></a>00439             <span class="comment">#</span>
<a name="l00440"></a>00440             <span class="comment"># NOTE: It&#39;s nagging at me that there may be a logic error in the</span>
<a name="l00441"></a>00441             <span class="comment"># checking and flagging, so this code needs to be thoroughly tested!</span>
<a name="l00442"></a>00442             ped_to_write = {<span class="stringliteral">&#39;a&#39;</span>: {}, <span class="stringliteral">&#39;b&#39;</span>: {}}
<a name="l00443"></a>00443             <span class="keywordflow">for</span> a <span class="keywordflow">in</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a28eed1e3039de3a74d2597d556ac831f">pedigree</a>:
<a name="l00444"></a>00444                 ped_to_write[<span class="stringliteral">&#39;a&#39;</span>][a.animalID] = <span class="keyword">True</span>
<a name="l00445"></a>00445                 <span class="keywordflow">for</span> b <span class="keywordflow">in</span> other.pedigree:
<a name="l00446"></a>00446             ped_to_write[<span class="stringliteral">&#39;b&#39;</span>][b.animalID] = <span class="keyword">False</span>
<a name="l00447"></a>00447                     mismatches = 0      <span class="comment"># Count places where the animals don&#39;t match</span>
<a name="l00448"></a>00448                     <span class="comment">#print &#39;Comparing animal %s in a and animal %s in b&#39; % \</span>
<a name="l00449"></a>00449                     <span class="comment">#    ( a.animalID, b.animalID )</span>
<a name="l00450"></a>00450                     <span class="keywordflow">for</span> match <span class="keywordflow">in</span> self.kw[<span class="stringliteral">&#39;match_rule&#39;</span>]:
<a name="l00451"></a>00451                         <span class="comment">#print &#39;First match criterion: %s (%s)&#39; % \</span>
<a name="l00452"></a>00452                         <span class="comment">#    ( match, self.new_animal_attr[match] )</span>
<a name="l00453"></a>00453                         <span class="comment"># If we&#39;re comparing animal IDs, make sure that we</span>
<a name="l00454"></a>00454                         <span class="comment"># compare original IDs, not renumbered IDs.</span>
<a name="l00455"></a>00455                         <span class="keywordflow">if</span> match <span class="keywordflow">in</span> [<span class="stringliteral">&#39;a&#39;</span>,<span class="stringliteral">&#39;A&#39;</span>]:
<a name="l00456"></a>00456                             <span class="keywordflow">if</span> a.originalID != b.originalID:
<a name="l00457"></a>00457                                 mismatches = mismatches + 1
<a name="l00458"></a>00458                         <span class="keywordflow">elif</span> match <span class="keywordflow">in</span> [<span class="stringliteral">&#39;s&#39;</span>,<span class="stringliteral">&#39;S&#39;</span>]:
<a name="l00459"></a>00459                             <span class="keywordflow">if</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a28eed1e3039de3a74d2597d556ac831f">pedigree</a>[a.sireID-1].originalID != \
<a name="l00460"></a>00460                                 other.pedigree[b.sireID-1].originalID:
<a name="l00461"></a>00461                                 mismatches = mismatches + 1
<a name="l00462"></a>00462                         <span class="keywordflow">elif</span> match <span class="keywordflow">in</span> [<span class="stringliteral">&#39;d&#39;</span>,<span class="stringliteral">&#39;D&#39;</span>]:
<a name="l00463"></a>00463                             <span class="keywordflow">if</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a28eed1e3039de3a74d2597d556ac831f">pedigree</a>[a.damID-1].originalID != \
<a name="l00464"></a>00464                                 other.pedigree[b.damID-1].originalID:
<a name="l00465"></a>00465                                 mismatches = mismatches + 1
<a name="l00466"></a>00466                         <span class="keywordflow">elif</span> getattr(a, self.new_animal_attr[match]) != \
<a name="l00467"></a>00467                             getattr(b, self.new_animal_attr[match]):
<a name="l00468"></a>00468                             mismatches = mismatches + 1
<a name="l00469"></a>00469                         <span class="keywordflow">else</span>:
<a name="l00470"></a>00470                             <span class="keywordflow">pass</span>
<a name="l00471"></a>00471             <span class="comment"># If there are no mismatches then the two animals are identical</span>
<a name="l00472"></a>00472             <span class="comment"># based on the match rule and only one of them needs to be written</span>
<a name="l00473"></a>00473             <span class="comment"># to the merged pedigree.</span>
<a name="l00474"></a>00474             <span class="keywordflow">if</span> ( mismatches == 0 ):
<a name="l00475"></a>00475                 <span class="comment"># Animals are identical. Do not write animals from self that are</span>
<a name="l00476"></a>00476         <span class="comment"># identical to animals in other.</span>
<a name="l00477"></a>00477         ped_to_write[<span class="stringliteral">&#39;a&#39;</span>][a.animalID] = <span class="keyword">False</span>
<a name="l00478"></a>00478             <span class="keywordflow">else</span>:
<a name="l00479"></a>00479                 <span class="comment"># Animals are different</span>
<a name="l00480"></a>00480                 ped_to_write[<span class="stringliteral">&#39;b&#39;</span>][b.animalID] = <span class="keyword">True</span>
<a name="l00481"></a>00481             <span class="comment"># Once we have matches, we are going to write a new pedigree</span>
<a name="l00482"></a>00482             <span class="comment"># file to disc, and we will load that file to get the new</span>
<a name="l00483"></a>00483             <span class="comment"># pedigree.</span>
<a name="l00484"></a>00484             <span class="comment">#</span>
<a name="l00485"></a>00485             <span class="comment"># First, save the unique animals from the union of pedigrees a and</span>
<a name="l00486"></a>00486             <span class="comment"># b based on the match rule. Note that the pedformat from the first</span>
<a name="l00487"></a>00487             <span class="comment"># pedigree passed to __add__() will be used for both pedigrees. This</span>
<a name="l00488"></a>00488             <span class="comment"># makes sense because you cannot have two different pedformats in</span>
<a name="l00489"></a>00489             <span class="comment"># the same file.</span>
<a name="l00490"></a>00490             <span class="keywordflow">if</span> filename == <span class="keyword">False</span>:
<a name="l00491"></a>00491                 filename = <span class="stringliteral">&#39;%s_%s.ped&#39;</span> % ( self.kw[<span class="stringliteral">&#39;pedname&#39;</span>], \
<a name="l00492"></a>00492                 other.kw[<span class="stringliteral">&#39;pedname&#39;</span>] )
<a name="l00493"></a>00493                 <span class="keywordflow">print</span> <span class="stringliteral">&#39;[INFO]: filename = %s&#39;</span> % ( filename )
<a name="l00494"></a>00494             self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#ab2c07236058bb89d5318a7453cb6db29" title="save() writes a PyPedal pedigree to a user-specified file.">save</a>(filename=filename, write_list=ped_to_write[<span class="stringliteral">&#39;a&#39;</span>], \
<a name="l00495"></a>00495                 pedformat=self.kw[<span class="stringliteral">&#39;pedformat&#39;</span>], originalID=<span class="keyword">True</span>)
<a name="l00496"></a>00496             other.save(filename=filename, write_list=ped_to_write[<span class="stringliteral">&#39;b&#39;</span>], \
<a name="l00497"></a>00497                 pedformat=self.kw[<span class="stringliteral">&#39;pedformat&#39;</span>], originalID=<span class="keyword">True</span>, append=<span class="keyword">True</span> )
<a name="l00498"></a>00498             <span class="comment"># Now we need to load the new pedigree and return it. This should be</span>
<a name="l00499"></a>00499             <span class="comment"># dead easy.</span>
<a name="l00500"></a>00500             <span class="comment">#</span>
<a name="l00501"></a>00501             <span class="comment"># Create the options dictionary</span>
<a name="l00502"></a>00502             merged_pedname = <span class="stringliteral">&#39;Merged Pedigree: %s + %s&#39;</span> % \
<a name="l00503"></a>00503                 ( self.kw[<span class="stringliteral">&#39;pedname&#39;</span>], other.kw[<span class="stringliteral">&#39;pedname&#39;</span>] )
<a name="l00504"></a>00504             new_options = {}
<a name="l00505"></a>00505             new_options[<span class="stringliteral">&#39;messages&#39;</span>] = self.kw[<span class="stringliteral">&#39;messages&#39;</span>]
<a name="l00506"></a>00506             new_options[<span class="stringliteral">&#39;pedname&#39;</span>] = merged_pedname
<a name="l00507"></a>00507             new_options[<span class="stringliteral">&#39;renumber&#39;</span>] = 1
<a name="l00508"></a>00508             new_options[<span class="stringliteral">&#39;pedfile&#39;</span>] = filename
<a name="l00509"></a>00509             new_options[<span class="stringliteral">&#39;pedformat&#39;</span>] = self.kw[<span class="stringliteral">&#39;pedformat&#39;</span>]
<a name="l00510"></a>00510             <span class="comment"># Load the new pedigree and return it.</span>
<a name="l00511"></a>00511             <span class="keywordflow">try</span>:
<a name="l00512"></a>00512                 new_pedigree = loadPedigree(new_options, debugLoad=<span class="keyword">True</span>)
<a name="l00513"></a>00513                 <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span>:
<a name="l00514"></a>00514                     <span class="keywordflow">print</span> <span class="stringliteral">&#39;[INFO]: Loaded merged pedigree %s from file %s!&#39;</span> % \
<a name="l00515"></a>00515                         ( merged_pedname, filename )
<a name="l00516"></a>00516                 logging.info(<span class="stringliteral">&#39;Cannot complete __add__() operation becuase types do not match.&#39;</span>)
<a name="l00517"></a>00517                 <span class="keywordflow">return</span> new_pedigree
<a name="l00518"></a>00518             <span class="keywordflow">except</span>:
<a name="l00519"></a>00519                 <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span>:
<a name="l00520"></a>00520                     <span class="keywordflow">print</span> <span class="stringliteral">&#39;[ERROR]: Could not load merged pedigree %s from file %s!&#39;</span> % \
<a name="l00521"></a>00521                         ( merged_pedname, filename )
<a name="l00522"></a>00522                 logging.error(<span class="stringliteral">&#39;Could not load merged pedigree %s from file %s!&#39;</span>, \
<a name="l00523"></a>00523                     merged_pedname, filename)
<a name="l00524"></a>00524                 <span class="keywordflow">return</span> <span class="keyword">False</span>
<a name="l00525"></a>00525         <span class="keywordflow">else</span>:
<a name="l00526"></a>00526             logging.error(<span class="stringliteral">&#39;Cannot complete __add__() operation becuase types do not match.&#39;</span>)
<a name="l00527"></a>00527             <span class="keywordflow">return</span> NotImplemented            
<a name="l00528"></a>00528 
<a name="l00529"></a>00529     <span class="comment">##</span>
<a name="l00530"></a>00530     <span class="comment"># __union__() is an alias to NewPedigree::__add__().</span>
<a name="l00531"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a919f89374a53fbd6bcc6556ca7f29b95">00531</a>     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a919f89374a53fbd6bcc6556ca7f29b95" title="__union__() is an alias to NewPedigree.__add__().">union</a>(self, other, filename=False, debugLoad=False):
<a name="l00532"></a>00532     <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00533"></a>00533 <span class="stringliteral">        __union__() is an alias to NewPedigree::__add__().</span>
<a name="l00534"></a>00534 <span class="stringliteral">    &quot;&quot;&quot;</span>
<a name="l00535"></a>00535         self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a8e61f8a2dd95d5e0eb3c8ed0ad5dfc01" title="Method to add two pedigrees and return a new pedigree representing the merged pedigrees.">__add__</a>(self, other, filename=filename, debugLoad=debugLoad)
<a name="l00536"></a>00536 
<a name="l00537"></a>00537     <span class="comment">##</span>
<a name="l00538"></a>00538     <span class="comment"># __intersection__() returns a PyPedal pedigree object which contains the animals that are</span>
<a name="l00539"></a>00539     <span class="comment"># common to both input pedigrees. If there are no animals in common between the two pedgrees,</span>
<a name="l00540"></a>00540     <span class="comment"># a value of false is returned.</span>
<a name="l00541"></a>00541     <span class="comment"># @param pedobj_b Another PyPedal pedigree.</span>
<a name="l00542"></a>00542     <span class="comment"># @param filename The file to which the new pedigree should be written</span>
<a name="l00543"></a>00543     <span class="comment"># @retval A new PyPedal pedigree containing the animals that are common to both input pedigrees.</span>
<a name="l00544"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a72abb3e03546d4268714ea9debc3218f">00544</a>     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a72abb3e03546d4268714ea9debc3218f" title="__intersection__() returns a PyPedal pedigree object which contains the animals that are common to bo...">intersection</a>(self, other, filename=False):
<a name="l00545"></a>00545         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00546"></a>00546 <span class="stringliteral">        intersection() returns a PyPedal pedigree object which contains the animals that are common to</span>
<a name="l00547"></a>00547 <span class="stringliteral">        both input pedigrees. If there are no animals in common between the two pedgrees, a value</span>
<a name="l00548"></a>00548 <span class="stringliteral">        of false is returned.</span>
<a name="l00549"></a>00549 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l00550"></a>00550         <span class="keywordflow">if</span> self.__class__.__name__ == <span class="stringliteral">&#39;NewPedigree&#39;</span> <span class="keywordflow">and</span> other.__class__.__name__ == <span class="stringliteral">&#39;NewPedigree&#39;</span>:
<a name="l00551"></a>00551             logging.info(<span class="stringliteral">&#39;Computing intersection of pedigrees %s and %s&#39;</span>, self.kw[<span class="stringliteral">&#39;pedname&#39;</span>], other.kw[<span class="stringliteral">&#39;pedname&#39;</span>])
<a name="l00552"></a>00552             logging.info(<span class="stringliteral">&#39;Using match rule %s to compare pedigrees&#39;</span>, self.kw[<span class="stringliteral">&#39;match_rule&#39;</span>])
<a name="l00553"></a>00553             <span class="comment"># Pedigrees must be renumbered</span>
<a name="l00554"></a>00554             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;pedigree_is_renumbered&#39;</span>] != 1:
<a name="l00555"></a>00555                 self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#aef198ff1c3c2ac1c666486deb2d2e92a" title="renumber() updates the ID map after a pedigree has been renumbered so that all references are to renu...">renumber</a>()
<a name="l00556"></a>00556                 logging.info(<span class="stringliteral">&#39;Renumbering pedigree %s&#39;</span>, self.kw[<span class="stringliteral">&#39;pedname&#39;</span>])
<a name="l00557"></a>00557             <span class="keywordflow">if</span> other.kw[<span class="stringliteral">&#39;pedigree_is_renumbered&#39;</span>] != 1:
<a name="l00558"></a>00558                 other.renumber()
<a name="l00559"></a>00559                 logging.info(<span class="stringliteral">&#39;Renumbering pedigree %s&#39;</span>, other.kw[<span class="stringliteral">&#39;pedname&#39;</span>])
<a name="l00560"></a>00560             <span class="comment"># We need to compare each animal in self and other to see if they</span>
<a name="l00561"></a>00561             <span class="comment"># match based on the match_rule.</span>
<a name="l00562"></a>00562             <span class="comment">#</span>
<a name="l00563"></a>00563             <span class="comment"># We&#39;re going to use a dictionary to keep track of which animals</span>
<a name="l00564"></a>00564             <span class="comment"># need to be written to the new pedigree file from which the merged</span>
<a name="l00565"></a>00565             <span class="comment"># pedigree will be loaded. By default, I assume that all animal</span>
<a name="l00566"></a>00566             <span class="comment"># records are unique, and only change the ped_to_write flag  when a</span>
<a name="l00567"></a>00567             <span class="comment"># duplicate has been detected.</span>
<a name="l00568"></a>00568             <span class="comment">#</span>
<a name="l00569"></a>00569             <span class="comment"># NOTE: It&#39;s nagging at me that there may be a logic error in the</span>
<a name="l00570"></a>00570             <span class="comment"># checking and flagging, so this code needs to be thoroughly tested!</span>
<a name="l00571"></a>00571             animals_to_write = []
<a name="l00572"></a>00572             <span class="keywordflow">for</span> a <span class="keywordflow">in</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a28eed1e3039de3a74d2597d556ac831f">pedigree</a>:
<a name="l00573"></a>00573                 <span class="keywordflow">for</span> b <span class="keywordflow">in</span> other.pedigree:
<a name="l00574"></a>00574                     matches = 0    <span class="comment"># Count places where the animals match</span>
<a name="l00575"></a>00575                      <span class="comment">#print &#39;Comparing animal %s in a and animal %s in b&#39; % \</span>
<a name="l00576"></a>00576                      <span class="comment">#    ( a.animalID, b.animalID )</span>
<a name="l00577"></a>00577                      <span class="keywordflow">for</span> match <span class="keywordflow">in</span> self.kw[<span class="stringliteral">&#39;match_rule&#39;</span>]:
<a name="l00578"></a>00578                          <span class="comment">#print &#39;First match criterion: %s (%s)&#39; % \</span>
<a name="l00579"></a>00579                          <span class="comment">#    ( match, self.new_animal_attr[match] )</span>
<a name="l00580"></a>00580                          <span class="comment"># If we&#39;re comparing animal IDs, make sure that we</span>
<a name="l00581"></a>00581                          <span class="comment"># compare original IDs, not renumbered IDs.</span>
<a name="l00582"></a>00582                          <span class="keywordflow">if</span> match <span class="keywordflow">in</span> [<span class="stringliteral">&#39;a&#39;</span>,<span class="stringliteral">&#39;A&#39;</span>]:
<a name="l00583"></a>00583                              <span class="keywordflow">if</span> a.originalID == b.originalID:
<a name="l00584"></a>00584                                  matches = matches + 1
<a name="l00585"></a>00585                          <span class="keywordflow">elif</span> match <span class="keywordflow">in</span> [<span class="stringliteral">&#39;s&#39;</span>,<span class="stringliteral">&#39;S&#39;</span>]:
<a name="l00586"></a>00586                              <span class="keywordflow">if</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a28eed1e3039de3a74d2597d556ac831f">pedigree</a>[a.sireID-1].originalID == \
<a name="l00587"></a>00587                                  other.pedigree[b.sireID-1].originalID:
<a name="l00588"></a>00588                                  matches = matches + 1
<a name="l00589"></a>00589                          <span class="keywordflow">elif</span> match <span class="keywordflow">in</span> [<span class="stringliteral">&#39;d&#39;</span>,<span class="stringliteral">&#39;D&#39;</span>]:
<a name="l00590"></a>00590                              <span class="keywordflow">if</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a28eed1e3039de3a74d2597d556ac831f">pedigree</a>[a.damID-1].originalID == \
<a name="l00591"></a>00591                                  other.pedigree[b.damID-1].originalID:
<a name="l00592"></a>00592                                  matches = matches + 1
<a name="l00593"></a>00593                          <span class="keywordflow">elif</span> getattr(a, self.new_animal_attr[match]) == \
<a name="l00594"></a>00594                              getattr(b, other.new_animal_attr[match]):
<a name="l00595"></a>00595                              <span class="comment">#print &#39;%s == %s&#39; % ( \</span>
<a name="l00596"></a>00596                              <span class="comment">#    getattr(a, self.new_animal_attr[match]), \</span>
<a name="l00597"></a>00597                              <span class="comment">#    getattr(b, self.new_animal_attr[match]) )</span>
<a name="l00598"></a>00598                              matches = matches + 1
<a name="l00599"></a>00599                          <span class="keywordflow">else</span>:
<a name="l00600"></a>00600                              <span class="comment">#print &#39;%s != %s&#39; % ( \</span>
<a name="l00601"></a>00601                              <span class="comment">#    getattr(a, self.new_animal_attr[match]), \</span>
<a name="l00602"></a>00602                              <span class="comment">#    getattr(b, self.new_animal_attr[match]) )</span>
<a name="l00603"></a>00603                              <span class="keywordflow">pass</span>
<a name="l00604"></a>00604                 <span class="comment"># If there are no mismatches then the two animals are identical</span>
<a name="l00605"></a>00605                 <span class="comment"># based on the match rule and only one of them needs to be written</span>
<a name="l00606"></a>00606                 <span class="comment"># to the merged pedigree.</span>
<a name="l00607"></a>00607                 <span class="keywordflow">if</span> ( matches == len(self.kw[<span class="stringliteral">&#39;match_rule&#39;</span>]) ):
<a name="l00608"></a>00608                     <span class="comment"># Animals are identical</span>
<a name="l00609"></a>00609                     animals_to_write.append(a)
<a name="l00610"></a>00610             <span class="comment"># Once we have matches, we are going to write a new pedigree</span>
<a name="l00611"></a>00611             <span class="comment"># file to disc, and we will load that file to get the new</span>
<a name="l00612"></a>00612             <span class="comment"># pedigree.</span>
<a name="l00613"></a>00613             <span class="comment">#</span>
<a name="l00614"></a>00614             <span class="comment"># First, save the unique animals from the union of pedigrees a and</span>
<a name="l00615"></a>00615             <span class="comment"># b based on the match rule. Note that the pedformat from the first</span>
<a name="l00616"></a>00616             <span class="comment"># pedigree passed to __add__() will be used for both pedigrees. This</span>
<a name="l00617"></a>00617             <span class="comment"># makes sense because you cannot have two different pedformats in</span>
<a name="l00618"></a>00618             <span class="comment"># the same file.</span>
<a name="l00619"></a>00619             <span class="keywordflow">if</span> filename == <span class="keyword">False</span>:
<a name="l00620"></a>00620                 filename = <span class="stringliteral">&#39;%s_%s.ped&#39;</span> % ( self.kw[<span class="stringliteral">&#39;pedname&#39;</span>], other.kw[<span class="stringliteral">&#39;pedname&#39;</span>] )
<a name="l00621"></a>00621         <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;debug_messages&#39;</span>]:
<a name="l00622"></a>00622                     <span class="keywordflow">print</span> <span class="stringliteral">&#39;[INFO]: filename = %s&#39;</span> % ( filename )
<a name="l00623"></a>00623                 pyp_io.save_newanimals_to_file(animals_to_write, filename, self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#aa99c9e5a37e21d8ff3c0f71877aac615">pedformat</a> \
<a name="l00624"></a>00624                     self.kw[<span class="stringliteral">&#39;sepchar&#39;</span>])
<a name="l00625"></a>00625             <span class="comment"># Now we need to load the new pedigree and return it. This should be</span>
<a name="l00626"></a>00626             <span class="comment"># dead easy.</span>
<a name="l00627"></a>00627             <span class="comment">#</span>
<a name="l00628"></a>00628             <span class="comment"># Create the options dictionary</span>
<a name="l00629"></a>00629             intersect_pedname = <span class="stringliteral">&#39;Intersected Pedigree: %s + %s&#39;</span> % \
<a name="l00630"></a>00630                 ( self.kw[<span class="stringliteral">&#39;pedname&#39;</span>], other.kw[<span class="stringliteral">&#39;pedname&#39;</span>] )
<a name="l00631"></a>00631             new_options = {}
<a name="l00632"></a>00632             new_options[<span class="stringliteral">&#39;messages&#39;</span>] = self.kw[<span class="stringliteral">&#39;messages&#39;</span>]
<a name="l00633"></a>00633             new_options[<span class="stringliteral">&#39;pedname&#39;</span>] = intersect_pedname
<a name="l00634"></a>00634             new_options[<span class="stringliteral">&#39;renumber&#39;</span>] = 1
<a name="l00635"></a>00635             new_options[<span class="stringliteral">&#39;pedfile&#39;</span>] = filename
<a name="l00636"></a>00636             new_options[<span class="stringliteral">&#39;pedformat&#39;</span>] = self.kw[<span class="stringliteral">&#39;pedformat&#39;</span>]
<a name="l00637"></a>00637             <span class="comment"># Load the new pedigree and return it.</span>
<a name="l00638"></a>00638             <span class="keywordflow">try</span>:
<a name="l00639"></a>00639                 new_pedigree = loadPedigree(new_options, debugLoad=<span class="keyword">True</span>)
<a name="l00640"></a>00640                 <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span>:
<a name="l00641"></a>00641                     <span class="keywordflow">print</span> <span class="stringliteral">&#39;[INFO]: Loaded merged pedigree %s from file %s!&#39;</span> % \
<a name="l00642"></a>00642                         ( merged_pedname, filename )
<a name="l00643"></a>00643                     logging.info(<span class="stringliteral">&#39;Cannot complete intersection operation because types do not match.&#39;</span>)
<a name="l00644"></a>00644                     <span class="keywordflow">return</span> new_pedigree
<a name="l00645"></a>00645             <span class="keywordflow">except</span>:
<a name="l00646"></a>00646                 <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span>:
<a name="l00647"></a>00647                     <span class="keywordflow">print</span> <span class="stringliteral">&#39;[ERROR]: Could not load merged pedigree %s from file %s!&#39;</span> % \
<a name="l00648"></a>00648                         ( merged_pedname, filename )
<a name="l00649"></a>00649                 logging.error(<span class="stringliteral">&#39;Could not load merged pedigree %s from file %s!&#39;</span>, \
<a name="l00650"></a>00650                     merged_pedname, filename)
<a name="l00651"></a>00651                 <span class="keywordflow">return</span> <span class="keyword">False</span>
<a name="l00652"></a>00652         <span class="keywordflow">else</span>:
<a name="l00653"></a>00653             logging.error(<span class="stringliteral">&#39;Cannot complete intersection operation because types do not match.&#39;</span>)
<a name="l00654"></a>00654             <span class="keywordflow">return</span> NotImplemented
<a name="l00655"></a>00655 
<a name="l00656"></a>00656     <span class="comment">##</span>
<a name="l00657"></a>00657     <span class="comment"># load() wraps several processes useful for loading and preparing a pedigree for</span>
<a name="l00658"></a>00658     <span class="comment"># use in an analysis, including reading the animals into a list of animal objects,</span>
<a name="l00659"></a>00659     <span class="comment"># forming lists of sires and dams, checking for common errors, setting ancestor</span>
<a name="l00660"></a>00660     <span class="comment"># flags, and renumbering the pedigree.</span>
<a name="l00661"></a>00661     <span class="comment"># @param self Reference to current object.</span>
<a name="l00662"></a>00662     <span class="comment"># @param pedsource Source of the pedigree (&#39;file&#39;|&#39;graph&#39;|&#39;graphfile&#39;|&#39;db&#39;).</span>
<a name="l00663"></a>00663     <span class="comment"># @param pedgraph DiGraph from which to load the pedigree.</span>
<a name="l00664"></a>00664     <span class="comment"># @param pedstream Stream of text from which to load the pedigree.</span>
<a name="l00665"></a>00665     <span class="comment"># @param animallist Liost of NewAnimal objects from which to create a pedigree.</span>
<a name="l00666"></a>00666     <span class="comment"># @retval None</span>
<a name="l00667"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a6f00326b1b20146f6c7ac15596a58448">00667</a>     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a6f00326b1b20146f6c7ac15596a58448" title="load() wraps several processes useful for loading and preparing a pedigree for use in an analysis...">load</a>(self, pedsource=&#39;file&#39;, pedgraph=0, pedstream=&#39;&#39;, animallist=False):
<a name="l00668"></a>00668         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00669"></a>00669 <span class="stringliteral">        load() wraps several processes useful for loading and preparing a pedigree for</span>
<a name="l00670"></a>00670 <span class="stringliteral">        use in an analysis, including reading the animals into a list of animal objects,</span>
<a name="l00671"></a>00671 <span class="stringliteral">        forming lists of sires and dams, checking for common errors, setting ancestor</span>
<a name="l00672"></a>00672 <span class="stringliteral">        flags, and renumbering the pedigree.</span>
<a name="l00673"></a>00673 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l00674"></a>00674     <span class="comment"># Check for valid values of pedsource</span>
<a name="l00675"></a>00675     <span class="keywordflow">if</span> pedsource <span class="keywordflow">not</span> <span class="keywordflow">in</span> [<span class="stringliteral">&#39;file&#39;</span>, <span class="stringliteral">&#39;db&#39;</span>, <span class="stringliteral">&#39;graph&#39;</span>, <span class="stringliteral">&#39;graphfile&#39;</span>, <span class="stringliteral">&#39;null&#39;</span>, <span class="stringliteral">&#39;animallist&#39;</span>, <span class="stringliteral">&#39;gedcomfile&#39;</span>, <span class="stringliteral">&#39;genesfile&#39;</span>, <span class="stringliteral">&#39;textstream&#39;</span>]:
<a name="l00676"></a>00676             logging.error(<span class="stringliteral">&#39;Unable to load pedigree because an invalid value of %s was provided for pedsource!&#39;</span>, pedsource)
<a name="l00677"></a>00677             sys.exit(0)
<a name="l00678"></a>00678     <span class="comment"># If the user has included traits in the pedigree file, we need to make sure that the</span>
<a name="l00679"></a>00679     <span class="comment"># names are properly handled.</span>
<a name="l00680"></a>00680     <span class="keywordflow">if</span> len(self.kw[<span class="stringliteral">&#39;trait_names&#39;</span>]) &gt; 0 <span class="keywordflow">and</span> self.kw[<span class="stringliteral">&#39;trait_auto_name&#39;</span>] != 0:
<a name="l00681"></a>00681         <span class="comment"># Use the name list</span>
<a name="l00682"></a>00682         <span class="comment">###logging.warning(&#39;Loading from database %s.%s at %s.&#39;,self.kw[&#39;database_name&#39;], \</span>
<a name="l00683"></a>00683             <span class="comment">###    self.kw[&#39;database_table&#39;], pyp_utils.pyp_nice_time())</span>
<a name="l00684"></a>00684             <span class="comment">###if self.kw[&#39;messages&#39;] == &#39;verbose&#39; and self.kw[&#39;pedigree_summary&#39;]:</span>
<a name="l00685"></a>00685             <span class="comment">###    print &#39;[INFO]: Loading from database %s.%s&#39; % ( self.kw[&#39;database_name&#39;], \</span>
<a name="l00686"></a>00686             <span class="comment">###        self.kw[&#39;database_table&#39;] )        # Create the table</span>
<a name="l00687"></a>00687         <span class="keywordflow">pass</span>
<a name="l00688"></a>00688         <span class="comment"># If the user wants to simulate a pedigree we don&#39;t need to</span>
<a name="l00689"></a>00689         <span class="comment"># call self.preprocess(), which loads pedigrees from files.</span>
<a name="l00690"></a>00690         <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;simulate_pedigree&#39;</span>]:
<a name="l00691"></a>00691             self.simulate()
<a name="l00692"></a>00692         <span class="comment"># Load an ASDx pedigree from an SQLite databases.</span>
<a name="l00693"></a>00693         <span class="keywordflow">elif</span> pedsource == <span class="stringliteral">&#39;db&#39;</span>:
<a name="l00694"></a>00694             self.kw[<span class="stringliteral">&#39;pedformat&#39;</span>] = <span class="stringliteral">&#39;ASDx&#39;</span>
<a name="l00695"></a>00695             self.kw[<span class="stringliteral">&#39;sepchar&#39;</span>] = <span class="stringliteral">&#39;,&#39;</span>
<a name="l00696"></a>00696             logging.info(<span class="stringliteral">&#39;Loading from database %s.%s at %s.&#39;</span>,self.kw[<span class="stringliteral">&#39;database_name&#39;</span>], \
<a name="l00697"></a>00697                 self.kw[<span class="stringliteral">&#39;database_table&#39;</span>], pyp_utils.pyp_nice_time())
<a name="l00698"></a>00698             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span> <span class="keywordflow">and</span> self.kw[<span class="stringliteral">&#39;pedigree_summary&#39;</span>]:
<a name="l00699"></a>00699                 <span class="keywordflow">print</span> <span class="stringliteral">&#39;[INFO]: Loading from database %s.%s&#39;</span> % ( self.kw[<span class="stringliteral">&#39;database_name&#39;</span>], \
<a name="l00700"></a>00700                     self.kw[<span class="stringliteral">&#39;database_table&#39;</span>] )        <span class="comment"># Create the table</span>
<a name="l00701"></a>00701             <span class="keywordflow">try</span>:
<a name="l00702"></a>00702                 <span class="comment"># Connect to the database</span>
<a name="l00703"></a>00703                 <span class="keywordflow">if</span> pyp_db.doesTableExist(self):
<a name="l00704"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a76f7cf65bd46330008eeb3305e77c980">00704</a>                     conn = pyp_db.connectToDatabase(self)
<a name="l00705"></a>00705                     <span class="keywordflow">if</span> conn:
<a name="l00706"></a>00706                         <span class="comment">### Contributed by Matt Kelly -- see also the &#39;database_sql&#39; option</span>
<a name="l00707"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a61f54404c46a5760e36cc23ad40c6fc0">00707</a>                         sql = self.kw[<span class="stringliteral">&#39;database_sql&#39;</span>] % ( self.kw[<span class="stringliteral">&#39;database_table&#39;</span>] )
<a name="l00708"></a>00708                         <span class="comment">#sql = &#39;SELECT * FROM %s&#39; % ( self.kw[&#39;database_table&#39;] )</span>
<a name="l00709"></a>00709                         <span class="comment">#sql = &#39;SELECT animaltattoo,if(siretattoo is NULL ,&quot;&quot;,siretattoo),if(damtattoo is NULL ,&quot;&quot;,damtattoo),if(concat(year(bdate)) is NULL ,&quot;&quot;,concat(year(bdate))) FROM %s&#39; % ( self.kw[&#39;database_table&#39;] )</span>
<a name="l00710"></a>00710                         <span class="comment"># This could fail for VERY large pedigrees or on low-RAM machines.</span>
<a name="l00711"></a>00711                         dbstream = conn.GetAll(sql)
<a name="l00712"></a>00712                         conn.Close()
<a name="l00713"></a>00713                         <span class="comment"># Process the ASDx pedigree file as usual.</span>
<a name="l00714"></a>00714                         self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#aa70701de178f69d9c7a3321448681a03" title="preprocess() processes a pedigree file, which includes reading the animals into a list of animal obje...">preprocess</a>(dbstream=dbstream)
<a name="l00715"></a>00715                     <span class="keywordflow">else</span>:
<a name="l00716"></a>00716                         logging.error(<span class="stringliteral">&#39;Unable to connect to the database %s at %s.&#39;</span>, \
<a name="l00717"></a>00717                             self.kw[<span class="stringliteral">&#39;database_name&#39;</span>], pyp_utils.pyp_nice_time())
<a name="l00718"></a>00718                         <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span>:
<a name="l00719"></a>00719                             <span class="keywordflow">print</span> <span class="stringliteral">&#39;[ERROR]: Unable to connect to the database %s at %s.&#39;</span> % \
<a name="l00720"></a>00720                                 ( self.kw[<span class="stringliteral">&#39;database_name&#39;</span>], pyp_utils.pyp_nice_time() )
<a name="l00721"></a>00721                         sys.exit(0)
<a name="l00722"></a>00722             <span class="keywordflow">except</span>:
<a name="l00723"></a>00723                 logging.error(<span class="stringliteral">&#39;Unable to load pedigree from database %s.%s at %s.&#39;</span>, \
<a name="l00724"></a>00724                     self.kw[<span class="stringliteral">&#39;database_name&#39;</span>], self.kw[<span class="stringliteral">&#39;database_table&#39;</span>], pyp_utils.pyp_nice_time())
<a name="l00725"></a>00725                 <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span>:
<a name="l00726"></a>00726                     <span class="keywordflow">print</span> <span class="stringliteral">&#39;[ERROR]: Unable to load pedigree from database %s.%s&#39;</span> % ( \
<a name="l00727"></a>00727                         self.kw[<span class="stringliteral">&#39;database_name&#39;</span>], \
<a name="l00728"></a>00728                         self.kw[<span class="stringliteral">&#39;database_table&#39;</span>] )
<a name="l00729"></a>00729                 sys.exit(0)
<a name="l00730"></a>00730         <span class="comment"># Load the pedigree from an DiGraph object that already exists.</span>
<a name="l00731"></a>00731         <span class="keywordflow">elif</span> pedsource == <span class="stringliteral">&#39;graph&#39;</span>:
<a name="l00732"></a>00732             <span class="keywordflow">if</span> pedgraph:
<a name="l00733"></a>00733                 self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a9d014c1ead82bb6abe3085058086194a" title="fromgraph() loads the animals to populate the pedigree from a DiGraph object.">fromgraph</a>(pedgraph)
<a name="l00734"></a>00734             <span class="keywordflow">else</span>:
<a name="l00735"></a>00735                 logging.error(<span class="stringliteral">&#39;Unable to load pedigree from a directed graph: no pedgraph provided!&#39;</span>)
<a name="l00736"></a>00736                 sys.exit(0)
<a name="l00737"></a>00737         <span class="comment"># The graphfile pedsource uses the read_adjlist() function</span>
<a name="l00738"></a>00738         <span class="comment"># from the NetworkX module to load a graph stored in a file</span>
<a name="l00739"></a>00739         <span class="comment"># as an adjacency list, and then converts it to a PyPedal</span>
<a name="l00740"></a>00740         <span class="comment"># pedigree using the NewPedigree::fromgraph() method.</span>
<a name="l00741"></a>00741         <span class="keywordflow">elif</span> pedsource == <span class="stringliteral">&#39;graphfile&#39;</span>:
<a name="l00742"></a>00742             <span class="keywordflow">try</span>:
<a name="l00743"></a>00743                 <span class="keyword">import</span> networkx <span class="keyword">as</span> NX
<a name="l00744"></a>00744             <span class="keywordflow">except</span>:
<a name="l00745"></a>00745                 logging.error(<span class="stringliteral">&#39;Unable to load pedigree from a directed graph stored in adjacency list format because the NetworkX module could not be imported!&#39;</span>)
<a name="l00746"></a>00746                 sys.exit(0)
<a name="l00747"></a>00747             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;pedfile&#39;</span>]:
<a name="l00748"></a>00748                 <span class="keywordflow">try</span>:
<a name="l00749"></a>00749                     pedgraph = NX.read_adjlist(self.kw[<span class="stringliteral">&#39;pedfile&#39;</span>])
<a name="l00750"></a>00750                     self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a9d014c1ead82bb6abe3085058086194a" title="fromgraph() loads the animals to populate the pedigree from a DiGraph object.">fromgraph</a>(pedgraph)
<a name="l00751"></a>00751                 <span class="keywordflow">except</span>:
<a name="l00752"></a>00752                     logging.error(<span class="stringliteral">&#39;Unable to load pedigree from a directed graph stored in adjacency list format!&#39;</span>)
<a name="l00753"></a>00753                     sys.exit(0)
<a name="l00754"></a>00754             <span class="keywordflow">else</span>:
<a name="l00755"></a>00755                 logging.error(<span class="stringliteral">&#39;Unable to load pedigree from a directed graph stored in adjacency list format because no filename was provided!&#39;</span>)
<a name="l00756"></a>00756                 sys.exit(0)
<a name="l00757"></a>00757     <span class="comment"># I want a way to create null (empty) pedigrees. Let&#39;s see what we can do...</span>
<a name="l00758"></a>00758     <span class="keywordflow">elif</span> pedsource == <span class="stringliteral">&#39;null&#39;</span>:
<a name="l00759"></a>00759         <span class="keywordflow">try</span>:
<a name="l00760"></a>00760             self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a93805b88a410473cb9dda5457d46a61d" title="fromnull() creates a new pedigree with no animal records in it.">fromnull</a>()
<a name="l00761"></a>00761         <span class="keywordflow">except</span>:
<a name="l00762"></a>00762                 logging.error(<span class="stringliteral">&#39;Unable to create a null (empty) pedigree!&#39;</span>)
<a name="l00763"></a>00763                 sys.exit(0)
<a name="l00764"></a>00764     <span class="comment"># I also want a way to create a pedigree based on a list of NewAnimal instances.</span>
<a name="l00765"></a>00765         <span class="keywordflow">elif</span> pedsource == <span class="stringliteral">&#39;animallist&#39;</span>:
<a name="l00766"></a>00766         <span class="keywordflow">if</span> animallist <span class="keywordflow">and</span> len(animallist) &gt; 0:
<a name="l00767"></a>00767             <span class="keywordflow">try</span>:
<a name="l00768"></a>00768                 self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a707dc2388b0f0e5f740d4e82738c149c" title="fromanimallist() populates a NewPedigree with instances of NewAnimal objects.">fromanimallist</a>()
<a name="l00769"></a>00769             <span class="keywordflow">except</span>:
<a name="l00770"></a>00770                     logging.error(<span class="stringliteral">&#39;Unable to create a pedigree from an animallist!&#39;</span>)
<a name="l00771"></a>00771                     sys.exit(0)
<a name="l00772"></a>00772             <span class="keywordflow">else</span>:
<a name="l00773"></a>00773         <span class="keywordflow">if</span> <span class="keywordflow">not</span> animallist:
<a name="l00774"></a>00774                     logging.error(<span class="stringliteral">&#39;Unable to create a pedigree from an animal list because no list was provided!&#39;</span>)
<a name="l00775"></a>00775         <span class="keywordflow">else</span>:
<a name="l00776"></a>00776             logging.error(<span class="stringliteral">&#39;Unable to create a pedigree from an animal list because an empty list was provided!&#39;</span>) 
<a name="l00777"></a>00777                 sys.exit(0)
<a name="l00778"></a>00778         <span class="comment"># The gedcomfile pedsource reads files that conform to the</span>
<a name="l00779"></a>00779         <span class="comment"># GEDCOM 5.5 standard.</span>
<a name="l00780"></a>00780         <span class="keywordflow">elif</span> pedsource == <span class="stringliteral">&#39;gedcomfile&#39;</span>:
<a name="l00781"></a>00781             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;pedfile&#39;</span>]:
<a name="l00782"></a>00782                 <span class="comment">#try:</span>
<a name="l00783"></a>00783                 <span class="comment"># Load a GEDCOM file</span>
<a name="l00784"></a>00784                 <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span> <span class="keywordflow">and</span> self.kw[<span class="stringliteral">&#39;pedigree_summary&#39;</span>]:
<a name="l00785"></a>00785                     <span class="keywordflow">print</span> <span class="stringliteral">&#39;[INFO]: Loading GEDCOM file %s.&#39;</span> % (self.kw[<span class="stringliteral">&#39;pedfile&#39;</span>])
<a name="l00786"></a>00786                 pedformat = pyp_io.load_from_gedcom(infilename=self.kw[<span class="stringliteral">&#39;pedfile&#39;</span>], \
<a name="l00787"></a>00787                     standalone = 0, \
<a name="l00788"></a>00788                     messages=self.kw[<span class="stringliteral">&#39;messages&#39;</span>], \
<a name="l00789"></a>00789                     missing_sex=self.kw[<span class="stringliteral">&#39;missing_sex&#39;</span>], \
<a name="l00790"></a>00790                     missing_parent=self.kw[<span class="stringliteral">&#39;missing_parent&#39;</span>], \
<a name="l00791"></a>00791                     missing_name=self.kw[<span class="stringliteral">&#39;missing_name&#39;</span>], \
<a name="l00792"></a>00792                     missing_byear=self.kw[<span class="stringliteral">&#39;missing_byear&#39;</span>])
<a name="l00793"></a>00793                 <span class="keywordflow">if</span> pedformat != <span class="stringliteral">&#39;xxxx&#39;</span>:
<a name="l00794"></a>00794                     <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span> <span class="keywordflow">and</span> self.kw[<span class="stringliteral">&#39;pedigree_summary&#39;</span>]:
<a name="l00795"></a>00795                         <span class="keywordflow">print</span> <span class="stringliteral">&#39;[INFO]: Changing pedformat from %s to %s as part of GEDCOM file processing.&#39;</span> % ( self.kw[<span class="stringliteral">&#39;pedformat&#39;</span>], pedformat )
<a name="l00796"></a>00796                     logging.info(<span class="stringliteral">&#39;Changing pedformat from %s to %s.tmp as part of GEDCOM file processing.&#39;</span>, self.kw[<span class="stringliteral">&#39;pedformat&#39;</span>], pedformat)
<a name="l00797"></a>00797                     self.kw[<span class="stringliteral">&#39;pedformat&#39;</span>] = pedformat
<a name="l00798"></a>00798 
<a name="l00799"></a>00799                     logging.info(<span class="stringliteral">&#39;Changing sepchar from \&#39;%s\&#39; to \&#39;,\&#39; as part of GEDCOM file processing.&#39;</span>,self.kw[<span class="stringliteral">&#39;sepchar&#39;</span>])
<a name="l00800"></a>00800                     self.kw[<span class="stringliteral">&#39;sepchar&#39;</span>] = <span class="stringliteral">&#39;,&#39;</span>
<a name="l00801"></a>00801 
<a name="l00802"></a>00802                     <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span> <span class="keywordflow">and</span> self.kw[<span class="stringliteral">&#39;pedigree_summary&#39;</span>]:
<a name="l00803"></a>00803                         <span class="keywordflow">print</span> <span class="stringliteral">&#39;[INFO]: Changing pedfile from %s to %s.tmp as part of GEDCOM file processing.&#39;</span> % ( self.kw[<span class="stringliteral">&#39;pedfile&#39;</span>], self.kw[<span class="stringliteral">&#39;pedfile&#39;</span>] )
<a name="l00804"></a>00804                     logging.info(<span class="stringliteral">&#39;Changing pedfile from %s to %s.tmp as part of GEDCOM file processing.&#39;</span>,self.kw[<span class="stringliteral">&#39;pedfile&#39;</span>],self.kw[<span class="stringliteral">&#39;pedfile&#39;</span>])
<a name="l00805"></a>00805                     self.kw[<span class="stringliteral">&#39;pedfile&#39;</span>] = <span class="stringliteral">&#39;%s.tmp&#39;</span> % ( self.kw[<span class="stringliteral">&#39;pedfile&#39;</span>] )
<a name="l00806"></a>00806                     <span class="comment"># Process the ASD pedigree file as usual.</span>
<a name="l00807"></a>00807                     self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#aa70701de178f69d9c7a3321448681a03" title="preprocess() processes a pedigree file, which includes reading the animals into a list of animal obje...">preprocess</a>()
<a name="l00808"></a>00808                 <span class="keywordflow">else</span>:
<a name="l00809"></a>00809                     <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span>:
<a name="l00810"></a>00810                         <span class="keywordflow">print</span> <span class="stringliteral">&#39;[load] Unable to load pedigree from a GEDCOM file because an invalid pedigree format code, %s, was returned!&#39;</span> % (pedformat)
<a name="l00811"></a>00811                     logging.error(<span class="stringliteral">&#39;Unable to load pedigree from a GEDCOM file because an invalid pedigree format code, %s, was returned!&#39;</span>,pedformat)
<a name="l00812"></a>00812                 <span class="comment">#except:</span>
<a name="l00813"></a>00813                     <span class="comment">#if self.kw[&#39;messages&#39;] == &#39;verbose&#39;:</span>
<a name="l00814"></a>00814                         <span class="comment">#print &#39;[load] Unable to load pedigree from a GEDCOM file because an exception was raised!&#39;</span>
<a name="l00815"></a>00815                     <span class="comment">#logging.error(&#39;Unable to load pedigree from a GEDCOM file because an exception was raised!&#39;)</span>
<a name="l00816"></a>00816                     <span class="comment">#sys.exit(0)</span>
<a name="l00817"></a>00817             <span class="keywordflow">else</span>:
<a name="l00818"></a>00818                 <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span>:
<a name="l00819"></a>00819                     <span class="keywordflow">print</span> <span class="stringliteral">&#39;[load] Unable to load pedigree from a GEDCOM file because no filename was provided!&#39;</span>
<a name="l00820"></a>00820                 logging.error(<span class="stringliteral">&#39;Unable to load pedigree from a GEDCOM file because no filename was provided!&#39;</span>)
<a name="l00821"></a>00821                 sys.exit(0)
<a name="l00822"></a>00822         <span class="comment"># The genesfile pedsource reads files that conform to the dBase III format used by GENES v1.2.</span>
<a name="l00823"></a>00823         <span class="keywordflow">elif</span> pedsource == <span class="stringliteral">&#39;genesfile&#39;</span>:
<a name="l00824"></a>00824             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;pedfile&#39;</span>]:
<a name="l00825"></a>00825                 <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span> <span class="keywordflow">and</span> self.kw[<span class="stringliteral">&#39;pedigree_summary&#39;</span>]:
<a name="l00826"></a>00826                     <span class="keywordflow">print</span> <span class="stringliteral">&#39;[INFO]: Loading GENES v1.20 file %s.&#39;</span> % (self.kw[<span class="stringliteral">&#39;pedfile&#39;</span>])
<a name="l00827"></a>00827                 pedformat = pyp_io.load_from_genes(infilename=self.kw[<span class="stringliteral">&#39;pedfile&#39;</span>], \
<a name="l00828"></a>00828                     standalone = 0, \
<a name="l00829"></a>00829                     messages=self.kw[<span class="stringliteral">&#39;messages&#39;</span>], \
<a name="l00830"></a>00830                     missing_sex=self.kw[<span class="stringliteral">&#39;missing_sex&#39;</span>], \
<a name="l00831"></a>00831                     missing_parent=self.kw[<span class="stringliteral">&#39;missing_parent&#39;</span>], \
<a name="l00832"></a>00832                     missing_name=self.kw[<span class="stringliteral">&#39;missing_name&#39;</span>], \
<a name="l00833"></a>00833                     missing_bdate=self.kw[<span class="stringliteral">&#39;missing_bdate&#39;</span>])
<a name="l00834"></a>00834                 <span class="keywordflow">if</span> pedformat != <span class="stringliteral">&#39;xxxx&#39;</span>:
<a name="l00835"></a>00835                     <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span> <span class="keywordflow">and</span> self.kw[<span class="stringliteral">&#39;pedigree_summary&#39;</span>]:
<a name="l00836"></a>00836                         <span class="keywordflow">print</span> <span class="stringliteral">&#39;[INFO]: Changing pedformat from %s to %s as part of GENES v1.20 file processing.&#39;</span> % ( self.kw[<span class="stringliteral">&#39;pedformat&#39;</span>], pedformat )
<a name="l00837"></a>00837                     logging.info(<span class="stringliteral">&#39;Changing pedformat from %s to %s as part of GENES v1.20 file processing.&#39;</span>, self.kw[<span class="stringliteral">&#39;pedformat&#39;</span>], pedformat)
<a name="l00838"></a>00838                     self.kw[<span class="stringliteral">&#39;pedformat&#39;</span>] = pedformat
<a name="l00839"></a>00839 
<a name="l00840"></a>00840                     logging.info(<span class="stringliteral">&#39;Changing sepchar from \&#39;%s\&#39; to \&#39;,\&#39; as part of GENES v1.20 file processing.&#39;</span>,self.kw[<span class="stringliteral">&#39;sepchar&#39;</span>])
<a name="l00841"></a>00841                     self.kw[<span class="stringliteral">&#39;sepchar&#39;</span>] = <span class="stringliteral">&#39;,&#39;</span>
<a name="l00842"></a>00842 
<a name="l00843"></a>00843                     <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span> <span class="keywordflow">and</span> self.kw[<span class="stringliteral">&#39;pedigree_summary&#39;</span>]:
<a name="l00844"></a>00844                         <span class="keywordflow">print</span> <span class="stringliteral">&#39;[INFO]: Changing pedfile from %s to %s.tmp as part of GENES v1.20 file processing.&#39;</span> % ( self.kw[<span class="stringliteral">&#39;pedfile&#39;</span>], self.kw[<span class="stringliteral">&#39;pedfile&#39;</span>] )
<a name="l00845"></a>00845                     logging.info(<span class="stringliteral">&#39;Changing pedfile from %s to %s.tmp as part of GENES v1.20 file processing.&#39;</span>,self.kw[<span class="stringliteral">&#39;pedfile&#39;</span>],self.kw[<span class="stringliteral">&#39;pedfile&#39;</span>])
<a name="l00846"></a>00846                     self.kw[<span class="stringliteral">&#39;pedfile&#39;</span>] = <span class="stringliteral">&#39;%s.tmp&#39;</span> % ( self.kw[<span class="stringliteral">&#39;pedfile&#39;</span>] )
<a name="l00847"></a>00847                     <span class="comment"># Process the ASD pedigree file as usual.</span>
<a name="l00848"></a>00848                     self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#aa70701de178f69d9c7a3321448681a03" title="preprocess() processes a pedigree file, which includes reading the animals into a list of animal obje...">preprocess</a>()
<a name="l00849"></a>00849                 <span class="keywordflow">else</span>:
<a name="l00850"></a>00850                     <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span>:
<a name="l00851"></a>00851                         <span class="keywordflow">print</span> <span class="stringliteral">&#39;[load] Unable to load pedigree from a GENES v1.20 file because an invalid pedigree format code, %s, was returned!&#39;</span> % (pedformat)
<a name="l00852"></a>00852                     logging.error(<span class="stringliteral">&#39;Unable to load pedigree from a GENES v1.20 file because an invalid pedigree format code, %s, was returned!&#39;</span>,pedformat)
<a name="l00853"></a>00853             <span class="keywordflow">else</span>:
<a name="l00854"></a>00854                 <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span>:
<a name="l00855"></a>00855                     <span class="keywordflow">print</span> <span class="stringliteral">&#39;[load] Unable to load pedigree from a GENES v1.2 file because no filename was provided!&#39;</span>
<a name="l00856"></a>00856                 logging.error(<span class="stringliteral">&#39;Unable to load pedigree from a GENES v1.2 file because no filename was provided!&#39;</span>)
<a name="l00857"></a>00857                 sys.exit(0)
<a name="l00858"></a>00858         <span class="comment"># A user requested this feature so that he can run PyPedal as a web service</span>
<a name="l00859"></a>00859         <span class="comment"># without worrying about Apache and file creation and etc. I&#39;ll see what I</span>
<a name="l00860"></a>00860         <span class="comment"># can do...</span>
<a name="l00861"></a>00861         <span class="keywordflow">elif</span> pedsource == <span class="stringliteral">&#39;textstream&#39;</span>:
<a name="l00862"></a>00862             <span class="comment"># Unpack those tuples...</span>
<a name="l00863"></a>00863             self.kw[<span class="stringliteral">&#39;pedformat&#39;</span>] = <span class="stringliteral">&#39;ASD&#39;</span>
<a name="l00864"></a>00864             self.kw[<span class="stringliteral">&#39;sepchar&#39;</span>] = <span class="stringliteral">&#39;,&#39;</span>
<a name="l00865"></a>00865             logging.info(<span class="stringliteral">&#39;Preprocessing a textstream&#39;</span>)
<a name="l00866"></a>00866             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span> <span class="keywordflow">and</span> self.kw[<span class="stringliteral">&#39;pedigree_summary&#39;</span>]:
<a name="l00867"></a>00867                 <span class="keywordflow">print</span> <span class="stringliteral">&#39;[INFO]: Preprocessing a textstream&#39;</span>
<a name="l00868"></a>00868             self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#aa70701de178f69d9c7a3321448681a03" title="preprocess() processes a pedigree file, which includes reading the animals into a list of animal obje...">preprocess</a>(textstream=pedstream)
<a name="l00869"></a>00869         <span class="keywordflow">else</span>:
<a name="l00870"></a>00870             logging.info(<span class="stringliteral">&#39;Preprocessing %s&#39;</span>,self.kw[<span class="stringliteral">&#39;pedfile&#39;</span>])
<a name="l00871"></a>00871             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span> <span class="keywordflow">and</span> self.kw[<span class="stringliteral">&#39;pedigree_summary&#39;</span>]:
<a name="l00872"></a>00872                 <span class="keywordflow">print</span> <span class="stringliteral">&#39;[INFO]: Preprocessing %s&#39;</span> % (self.kw[<span class="stringliteral">&#39;pedfile&#39;</span>])
<a name="l00873"></a>00873             self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#aa70701de178f69d9c7a3321448681a03" title="preprocess() processes a pedigree file, which includes reading the animals into a list of animal obje...">preprocess</a>()
<a name="l00874"></a>00874         <span class="comment"># Now that we&#39;ve got the animals loaded, take care of the</span>
<a name="l00875"></a>00875         <span class="comment"># renumbering etc.</span>
<a name="l00876"></a>00876         <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;reorder&#39;</span>] == 1 <span class="keywordflow">and</span> <span class="keywordflow">not</span> self.kw[<span class="stringliteral">&#39;renumber&#39;</span>]:
<a name="l00877"></a>00877             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span> <span class="keywordflow">and</span> self.kw[<span class="stringliteral">&#39;pedigree_summary&#39;</span>]:
<a name="l00878"></a>00878                 <span class="keywordflow">print</span> <span class="stringliteral">&#39;\t[INFO]: Reordering pedigree at %s&#39;</span> % ( pyp_utils.pyp_nice_time() )
<a name="l00879"></a>00879             logging.info(<span class="stringliteral">&#39;Reordering pedigree&#39;</span>)
<a name="l00880"></a>00880             <span class="keywordflow">if</span> <span class="keywordflow">not</span> self.kw[<span class="stringliteral">&#39;slow_reorder&#39;</span>]:
<a name="l00881"></a>00881                 self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a28eed1e3039de3a74d2597d556ac831f">pedigree</a> = pyp_utils.fast_reorder(self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a28eed1e3039de3a74d2597d556ac831f">pedigree</a>)
<a name="l00882"></a>00882             <span class="keywordflow">else</span>:
<a name="l00883"></a>00883                 self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a28eed1e3039de3a74d2597d556ac831f">pedigree</a> = pyp_utils.reorder(self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a28eed1e3039de3a74d2597d556ac831f">pedigree</a>,missingparent=self.kw[<span class="stringliteral">&#39;missing_parent&#39;</span>],max_rounds=self.kw[<span class="stringliteral">&#39;reorder_max_rounds&#39;</span>])
<a name="l00884"></a>00884             <span class="comment">#self.pedigree = pyp_utils.reorder(self.pedigree,missingparent=self.kw[&#39;missing_parent&#39;],max_rounds=self.kw[&#39;reorder_max_rounds&#39;])</span>
<a name="l00885"></a>00885         <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;renumber&#39;</span>] == 1:
<a name="l00886"></a>00886             self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#aef198ff1c3c2ac1c666486deb2d2e92a" title="renumber() updates the ID map after a pedigree has been renumbered so that all references are to renu...">renumber</a>()
<a name="l00887"></a>00887         <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;set_generations&#39;</span>]:
<a name="l00888"></a>00888             logging.info(<span class="stringliteral">&#39;Assigning generations&#39;</span>)
<a name="l00889"></a>00889             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span> <span class="keywordflow">and</span> self.kw[<span class="stringliteral">&#39;pedigree_summary&#39;</span>]:
<a name="l00890"></a>00890                 <span class="keywordflow">print</span> <span class="stringliteral">&#39;\t[INFO]: Assigning generations at %s&#39;</span> % ( pyp_utils.pyp_nice_time() )
<a name="l00891"></a>00891             pyp_utils.set_generation(self)
<a name="l00892"></a>00892         <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;set_ancestors&#39;</span>]:
<a name="l00893"></a>00893             logging.info(<span class="stringliteral">&#39;Setting ancestor flags&#39;</span>)
<a name="l00894"></a>00894             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span> <span class="keywordflow">and</span> self.kw[<span class="stringliteral">&#39;pedigree_summary&#39;</span>]:
<a name="l00895"></a>00895                 <span class="keywordflow">print</span> <span class="stringliteral">&#39;\t[INFO]: Setting ancestor flags at %s&#39;</span> % ( pyp_utils.pyp_nice_time() )
<a name="l00896"></a>00896             pyp_utils.set_ancestor_flag(self)
<a name="l00897"></a>00897         <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;set_sexes&#39;</span>]:
<a name="l00898"></a>00898             logging.info(<span class="stringliteral">&#39;Assigning sexes&#39;</span>)
<a name="l00899"></a>00899             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span> <span class="keywordflow">and</span> self.kw[<span class="stringliteral">&#39;pedigree_summary&#39;</span>]:
<a name="l00900"></a>00900                 <span class="keywordflow">print</span> <span class="stringliteral">&#39;\t[INFO]: Assigning sexes at %s&#39;</span> % ( pyp_utils.pyp_nice_time() )
<a name="l00901"></a>00901             pyp_utils.assign_sexes(self)
<a name="l00902"></a>00902         <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;set_alleles&#39;</span>]:
<a name="l00903"></a>00903             logging.info(<span class="stringliteral">&#39;Gene dropping to compute founder genome equivalents&#39;</span>)
<a name="l00904"></a>00904             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span> <span class="keywordflow">and</span> self.kw[<span class="stringliteral">&#39;pedigree_summary&#39;</span>]:
<a name="l00905"></a>00905                 <span class="keywordflow">print</span> <span class="stringliteral">&#39;\t[INFO]: Gene dropping at %s&#39;</span> % ( pyp_utils.pyp_nice_time() )
<a name="l00906"></a>00906             pyp_metrics.effective_founder_genomes(self)
<a name="l00907"></a>00907         <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;form_nrm&#39;</span>]:
<a name="l00908"></a>00908             logging.info(<span class="stringliteral">&#39;Forming numerator relationship matrix&#39;</span>)
<a name="l00909"></a>00909             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span> <span class="keywordflow">and</span> self.kw[<span class="stringliteral">&#39;pedigree_summary&#39;</span>]:
<a name="l00910"></a>00910                 <span class="keywordflow">print</span> <span class="stringliteral">&#39;\t[INFO]: Forming numerator relationship matrix at %s&#39;</span> % ( pyp_utils.pyp_nice_time() )
<a name="l00911"></a>00911             self.nrm = NewAMatrix(self.kw)
<a name="l00912"></a>00912             self.nrm.form_a_matrix(self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a28eed1e3039de3a74d2597d556ac831f">pedigree</a>)
<a name="l00913"></a>00913         <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;set_offspring&#39;</span>] <span class="keywordflow">and</span> <span class="keywordflow">not</span> self.kw[<span class="stringliteral">&#39;renumber&#39;</span>]:
<a name="l00914"></a>00914             logging.info(<span class="stringliteral">&#39;Assigning offspring&#39;</span>)
<a name="l00915"></a>00915             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span> <span class="keywordflow">and</span> self.kw[<span class="stringliteral">&#39;pedigree_summary&#39;</span>]:
<a name="l00916"></a>00916                 <span class="keywordflow">print</span> <span class="stringliteral">&#39;\t[INFO]: Assigning offspring at %s&#39;</span> % ( pyp_utils.pyp_nice_time() )
<a name="l00917"></a>00917             pyp_utils.assign_offspring(self)
<a name="l00918"></a>00918         <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span> <span class="keywordflow">and</span> self.kw[<span class="stringliteral">&#39;pedigree_summary&#39;</span>]:
<a name="l00919"></a>00919             <span class="keywordflow">print</span> <span class="stringliteral">&#39;[INFO]: Creating pedigree metadata object&#39;</span>
<a name="l00920"></a>00920         self.metadata = PedigreeMetadata(self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a28eed1e3039de3a74d2597d556ac831f">pedigree</a>,self.kw)
<a name="l00921"></a>00921         <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] != <span class="stringliteral">&#39;quiet&#39;</span> <span class="keywordflow">and</span> self.kw[<span class="stringliteral">&#39;pedigree_summary&#39;</span>]:
<a name="l00922"></a>00922             self.metadata.printme()
<a name="l00923"></a>00923         <span class="comment"># Calculate pedigree completeness.</span>
<a name="l00924"></a>00924         <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;pedcomp&#39;</span>]:
<a name="l00925"></a>00925             logging.info(<span class="stringliteral">&#39;Calculating %s generation pedigree completeness&#39;</span>, self.kw[<span class="stringliteral">&#39;pedcomp_gens&#39;</span>])
<a name="l00926"></a>00926             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span> <span class="keywordflow">and</span> self.kw[<span class="stringliteral">&#39;pedigree_summary&#39;</span>]:
<a name="l00927"></a>00927                 <span class="keywordflow">print</span> <span class="stringliteral">&#39;[INFO]: Calculating %s generation pedigree completeness&#39;</span> % ( self.kw[<span class="stringliteral">&#39;pedcomp_gens&#39;</span>] )
<a name="l00928"></a>00928             _foo = pyp_metrics.pedigree_completeness(self,self.kw[<span class="stringliteral">&#39;pedcomp_gens&#39;</span>])
<a name="l00929"></a>00929 
<a name="l00930"></a>00930     <span class="comment">##</span>
<a name="l00931"></a>00931     <span class="comment"># oldsave() writes a PyPedal pedigree to a user-specified file.  The saved pedigree includes</span>
<a name="l00932"></a>00932     <span class="comment"># all fields recognized by PyPedal, not just the original fields read from the input pedigree</span>
<a name="l00933"></a>00933     <span class="comment"># file.</span>
<a name="l00934"></a>00934     <span class="comment"># @param self Reference to current object.</span>
<a name="l00935"></a>00935     <span class="comment"># @param filename The file to which the pedigree should be written.</span>
<a name="l00936"></a>00936     <span class="comment"># @param outformat The format in which the pedigree should be written: &#39;o&#39; for original (as read) and &#39;l&#39; for long version (all available variables).</span>
<a name="l00937"></a>00937     <span class="comment"># @param idformat Write &#39;o&#39; (original) or &#39;r&#39; (renumbered) animal, sire, and dam IDs.</span>
<a name="l00938"></a>00938     <span class="comment"># @retval A save status indicator (0: failed, 1: success)</span>
<a name="l00939"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#ab7599a24c35efdfcd2caacae10f59ea2">00939</a>     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#ab7599a24c35efdfcd2caacae10f59ea2" title="oldsave() writes a PyPedal pedigree to a user-specified file.">oldsave</a>(self, filename=&#39;&#39;, outformat=&#39;o&#39;, idformat=&#39;o&#39;):
<a name="l00940"></a>00940         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00941"></a>00941 <span class="stringliteral">        oldsave() writes a PyPedal pedigree to a user-specified file.  The saved pedigree</span>
<a name="l00942"></a>00942 <span class="stringliteral">        includes all fields recognized by PyPedal, not just the original fields read</span>
<a name="l00943"></a>00943 <span class="stringliteral">        from the input pedigree file.</span>
<a name="l00944"></a>00944 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l00945"></a>00945         <span class="comment">#</span>
<a name="l00946"></a>00946         <span class="comment"># This is VERY important: never overwrite the user&#39;s data if it looks like an accidental</span>
<a name="l00947"></a>00947         <span class="comment"># request!  If the user does not pass a filename to save() save the pedigree to a file</span>
<a name="l00948"></a>00948         <span class="comment"># whose name is derived from, but not the same as, the original pedigree file.</span>
<a name="l00949"></a>00949         <span class="comment">#</span>
<a name="l00950"></a>00950         <span class="keywordflow">if</span> filename == <span class="stringliteral">&#39;&#39;</span>:
<a name="l00951"></a>00951             filename = <span class="stringliteral">&#39;%s_saved.ped&#39;</span> % ( self.kw[<span class="stringliteral">&#39;filetag&#39;</span>] )
<a name="l00952"></a>00952             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span>:
<a name="l00953"></a>00953                 <span class="keywordflow">print</span> <span class="stringliteral">&#39;[WARNING]: Saving pedigree to file %s to avoid overwriting %s.&#39;</span> % ( filename, self.kw[<span class="stringliteral">&#39;pedfile&#39;</span>] )
<a name="l00954"></a>00954             logging.warning(<span class="stringliteral">&#39;Saving pedigree to file %s to avoid overwriting %s.&#39;</span>,filename,self.kw[<span class="stringliteral">&#39;pedfile&#39;</span>])
<a name="l00955"></a>00955         <span class="keywordflow">try</span>:
<a name="l00956"></a>00956             ofh = file(filename,<span class="stringliteral">&#39;w&#39;</span>)
<a name="l00957"></a>00957             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span>:
<a name="l00958"></a>00958                 <span class="keywordflow">print</span> <span class="stringliteral">&#39;[INFO]: Opened file %s for pedigree save at %s.&#39;</span> % ( filename, pyp_utils.pyp_nice_time() )
<a name="l00959"></a>00959             logging.info(<span class="stringliteral">&#39;Opened file %s for pedigree save at %s.&#39;</span>,filename, pyp_utils.pyp_nice_time())
<a name="l00960"></a>00960 
<a name="l00961"></a>00961             <span class="keywordflow">if</span> outformat == <span class="stringliteral">&#39;l&#39;</span>:
<a name="l00962"></a>00962                 <span class="comment"># We have to form the new pedformat.</span>
<a name="l00963"></a>00963                 _newpedformat = <span class="stringliteral">&#39;asdgx&#39;</span>
<a name="l00964"></a>00964                 <span class="keywordflow">if</span> <span class="stringliteral">&#39;y&#39;</span> <span class="keywordflow">in</span> self.kw[<span class="stringliteral">&#39;pedformat&#39;</span>]:
<a name="l00965"></a>00965                     _newpedformat = <span class="stringliteral">&#39;%sy&#39;</span> % ( _newpedformat )
<a name="l00966"></a>00966                 <span class="keywordflow">else</span>:
<a name="l00967"></a>00967                     _newpedformat = <span class="stringliteral">&#39;%sb&#39;</span> % ( _newpedformat )
<a name="l00968"></a>00968                 _newpedformat = <span class="stringliteral">&#39;%sfrnleh&#39;</span> % (_newpedformat )
<a name="l00969"></a>00969             <span class="keywordflow">else</span>:
<a name="l00970"></a>00970                 <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;f_computed&#39;</span>]:
<a name="l00971"></a>00971                     _newpedformat = <span class="stringliteral">&#39;%sf&#39;</span> % ( self.kw[<span class="stringliteral">&#39;pedformat&#39;</span>] )
<a name="l00972"></a>00972                 <span class="keywordflow">else</span>:
<a name="l00973"></a>00973                     _newpedformat = self.kw[<span class="stringliteral">&#39;pedformat&#39;</span>]
<a name="l00974"></a>00974 
<a name="l00975"></a>00975             <span class="comment"># Write file header.</span>
<a name="l00976"></a>00976             ofh.write(<span class="stringliteral">&#39;# %s created by PyPedal at %s\n&#39;</span> % ( filename, pyp_utils.pyp_nice_time() ) )
<a name="l00977"></a>00977             ofh.write(<span class="stringliteral">&#39;# Current pedigree metadata:\n&#39;</span>)
<a name="l00978"></a>00978             ofh.write(<span class="stringliteral">&#39;#\tpedigree file: %s\n&#39;</span> % (filename) )
<a name="l00979"></a>00979             ofh.write(<span class="stringliteral">&#39;#\tpedigree name: %s\n&#39;</span> % (self.kw[<span class="stringliteral">&#39;pedname&#39;</span>]) )
<a name="l00980"></a>00980             ofh.write(<span class="stringliteral">&#39;#\tpedigree format: \&#39;%s\&#39;\n&#39;</span> % ( _newpedformat) )
<a name="l00981"></a>00981             <span class="keywordflow">if</span> idformat == <span class="stringliteral">&#39;o&#39;</span>:
<a name="l00982"></a>00982                 ofh.write(<span class="stringliteral">&#39;#\tNOTE: Animal, sire, and dam IDs are RENUMBERED IDs, not original IDs!\n&#39;</span>)
<a name="l00983"></a>00983             ofh.write(<span class="stringliteral">&#39;# Original pedigree metadata:\n&#39;</span>)
<a name="l00984"></a>00984             ofh.write(<span class="stringliteral">&#39;#\tpedigree file: %s\n&#39;</span> % (self.kw[<span class="stringliteral">&#39;pedfile&#39;</span>]) )
<a name="l00985"></a>00985             ofh.write(<span class="stringliteral">&#39;#\tpedigree name: %s\n&#39;</span> % (self.kw[<span class="stringliteral">&#39;pedname&#39;</span>]) )
<a name="l00986"></a>00986             ofh.write(<span class="stringliteral">&#39;#\tpedigree format: %s\n&#39;</span> % (self.kw[<span class="stringliteral">&#39;pedformat&#39;</span>]) )
<a name="l00987"></a>00987             <span class="keywordflow">for</span> _a <span class="keywordflow">in</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a28eed1e3039de3a74d2597d556ac831f">pedigree</a>:
<a name="l00988"></a>00988                 <span class="keywordflow">if</span> idformat == <span class="stringliteral">&#39;o&#39;</span>:
<a name="l00989"></a>00989                     _outstring = <span class="stringliteral">&#39;%s %s %s&#39;</span> % \
<a name="l00990"></a>00990                         (_a.originalID, self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a28eed1e3039de3a74d2597d556ac831f">pedigree</a>[int(_a.sireID)-1].originalID, \
<a name="l00991"></a>00991                         self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a28eed1e3039de3a74d2597d556ac831f">pedigree</a>[int(_a.damID)-1].originalID )
<a name="l00992"></a>00992                 <span class="keywordflow">else</span>:
<a name="l00993"></a>00993                     _outstring = <span class="stringliteral">&#39;%s %s %s&#39;</span> % (_a.animalID, _a.sireID, _a.damID )
<a name="l00994"></a>00994                 <span class="keywordflow">if</span> <span class="stringliteral">&#39;g&#39;</span> <span class="keywordflow">in</span> _newpedformat:
<a name="l00995"></a>00995                     _outstring = <span class="stringliteral">&#39;%s %s&#39;</span> % ( _outstring, _a.gen )
<a name="l00996"></a>00996                 <span class="keywordflow">if</span> <span class="stringliteral">&#39;p&#39;</span> <span class="keywordflow">in</span> _newpedformat:
<a name="l00997"></a>00997                     _outstring = <span class="stringliteral">&#39;%s %s&#39;</span> % ( _outstring, _a.gencoeff )
<a name="l00998"></a>00998                 <span class="keywordflow">if</span> <span class="stringliteral">&#39;x&#39;</span> <span class="keywordflow">in</span> _newpedformat:
<a name="l00999"></a>00999                     _outstring = <span class="stringliteral">&#39;%s %s&#39;</span> % ( _outstring, _a.sex )
<a name="l01000"></a>01000                 <span class="keywordflow">if</span> <span class="stringliteral">&#39;y&#39;</span> <span class="keywordflow">in</span> _newpedformat:
<a name="l01001"></a>01001                     _outstring = <span class="stringliteral">&#39;%s %s&#39;</span> % ( _outstring, _a.bd )
<a name="l01002"></a>01002                 <span class="keywordflow">else</span>:
<a name="l01003"></a>01003                     _outstring = <span class="stringliteral">&#39;%s %s&#39;</span> % ( _outstring, _a.by )
<a name="l01004"></a>01004                 <span class="keywordflow">if</span> <span class="stringliteral">&#39;f&#39;</span> <span class="keywordflow">in</span> _newpedformat:
<a name="l01005"></a>01005                     _outstring = <span class="stringliteral">&#39;%s %s&#39;</span> % ( _outstring, _a.fa )
<a name="l01006"></a>01006                 <span class="keywordflow">if</span> <span class="stringliteral">&#39;</span><span class="stringliteral">r&#39; in _newpedformat:</span>
<a name="l01007"></a>01007 <span class="stringliteral">                    _outstring = </span><span class="stringliteral">&#39;%s %s&#39;</span> % ( _outstring, _a.breed )
<a name="l01008"></a>01008                 <span class="keywordflow">if</span> <span class="stringliteral">&#39;n&#39;</span> <span class="keywordflow">in</span> _newpedformat:
<a name="l01009"></a>01009                     _outstring = <span class="stringliteral">&#39;%s %s&#39;</span> % ( _outstring, _a.name )
<a name="l01010"></a>01010                 <span class="keywordflow">if</span> <span class="stringliteral">&#39;l&#39;</span> <span class="keywordflow">in</span> _newpedformat:
<a name="l01011"></a>01011                     _outstring = <span class="stringliteral">&#39;%s %s&#39;</span> % ( _outstring, _a.alive )
<a name="l01012"></a>01012                 <span class="keywordflow">if</span> <span class="stringliteral">&#39;e&#39;</span> <span class="keywordflow">in</span> _newpedformat:
<a name="l01013"></a>01013                     _outstring = <span class="stringliteral">&#39;%s %s&#39;</span> % ( _outstring, _a.age )
<a name="l01014"></a>01014                 <span class="keywordflow">if</span> <span class="stringliteral">&#39;h&#39;</span> <span class="keywordflow">in</span> _newpedformat <span class="keywordflow">or</span> <span class="stringliteral">&#39;H&#39;</span> <span class="keywordflow">in</span> _newpedformat:
<a name="l01015"></a>01015                     _outstring = <span class="stringliteral">&#39;%s %s&#39;</span> % ( _outstring, _a.herd )
<a name="l01016"></a>01016                     _outstring = <span class="stringliteral">&#39;%s %s&#39;</span> % ( _outstring, _a.originalHerd )
<a name="l01017"></a>01017                 <span class="keywordflow">if</span> <span class="stringliteral">&#39;</span><span class="stringliteral">u&#39; in _newpedformat:</span>
<a name="l01018"></a>01018 <span class="stringliteral">                    _outstring = </span><span class="stringliteral">&#39;%s %s&#39;</span> % ( _outstring, _a.userField )
<a name="l01019"></a>01019                 ofh.write( <span class="stringliteral">&#39;%s\n&#39;</span> % (_outstring) )
<a name="l01020"></a>01020             ofh.close()
<a name="l01021"></a>01021             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span>:
<a name="l01022"></a>01022                 <span class="keywordflow">print</span> <span class="stringliteral">&#39;[INFO]: Closed file %s after pedigree save at %s.&#39;</span> % ( filename, pyp_utils.pyp_nice_time() )
<a name="l01023"></a>01023             logging.info(<span class="stringliteral">&#39;Closed file %s after pedigree save at %s.&#39;</span>,filename, pyp_utils.pyp_nice_time())
<a name="l01024"></a>01024             <span class="keywordflow">return</span> 1
<a name="l01025"></a>01025         <span class="keywordflow">except</span>:
<a name="l01026"></a>01026             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span>:
<a name="l01027"></a>01027                 <span class="keywordflow">print</span> <span class="stringliteral">&#39;[ERROR]: Unable to open file %s for pedigree save!&#39;</span> % ( filename )
<a name="l01028"></a>01028             logging.error(<span class="stringliteral">&#39;Unable to open file %s for pedigree save.&#39;</span>,filename)
<a name="l01029"></a>01029             <span class="keywordflow">return</span> 0
<a name="l01030"></a>01030 
<a name="l01031"></a>01031     <span class="comment">##</span>
<a name="l01032"></a>01032     <span class="comment"># save() writes a PyPedal pedigree to a user-specified file.  The saved pedigree includes</span>
<a name="l01033"></a>01033     <span class="comment"># all fields recognized by PyPedal, not just the original fields read from the input pedigree</span>
<a name="l01034"></a>01034     <span class="comment"># file.</span>
<a name="l01035"></a>01035     <span class="comment"># @param self Reference to current object.</span>
<a name="l01036"></a>01036     <span class="comment"># @param filename The file to which the pedigree should be written.</span>
<a name="l01037"></a>01037     <span class="comment"># @param pedformat Pedigree format string for the pedigree to be written.</span>
<a name="l01038"></a>01038     <span class="comment"># @param sepchar Character used to separate columns in the output pedigree file.</span>
<a name="l01039"></a>01039     <span class="comment"># @param append Append animal records to an existing file instead of creating a new one.</span>
<a name="l01040"></a>01040     <span class="comment"># @param write_list Optional list of animal records to save. The default is to save all animals.</span>
<a name="l01041"></a>01041     <span class="comment"># @param originalID save original IDs or renumbered IDs.</span>
<a name="l01042"></a>01042     <span class="comment"># @retval A save status indicator (0: failed, 1: success)</span>
<a name="l01043"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#ab2c07236058bb89d5318a7453cb6db29">01043</a>     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#ab2c07236058bb89d5318a7453cb6db29" title="save() writes a PyPedal pedigree to a user-specified file.">save</a>(self, filename=&#39;&#39;, pedformat=&#39;asd&#39;, sepchar = &#39; &#39;, append=False, \
<a name="l01044"></a>01044         write_list=<span class="keyword">False</span>, originalID=<span class="keyword">False</span>):
<a name="l01045"></a>01045         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l01046"></a>01046 <span class="stringliteral">        save() writes a PyPedal pedigree to a user-specified file.  The saved pedigree</span>
<a name="l01047"></a>01047 <span class="stringliteral">        includes all fields recognized by PyPedal, not just the original fields read</span>
<a name="l01048"></a>01048 <span class="stringliteral">        from the input pedigree file.</span>
<a name="l01049"></a>01049 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l01050"></a>01050         <span class="comment"># Check the contents of the pedformat to make sure that each entry is valid. Save the pedformat passed in by the user</span>
<a name="l01051"></a>01051         <span class="comment"># and add the valid entries a new version of pedformat which will be used for the remainder of the processing.</span>
<a name="l01052"></a>01052         pedformat_in = str(pedformat)
<a name="l01053"></a>01053         pedformat = <span class="stringliteral">&#39;&#39;</span>
<a name="l01054"></a>01054         <span class="keywordflow">for</span> pf <span class="keywordflow">in</span> pedformat_in:
<a name="l01055"></a>01055             <span class="keywordflow">if</span> pf <span class="keywordflow">in</span> self.pedformat_codes:
<a name="l01056"></a>01056                 pedformat = <span class="stringliteral">&#39;%s%s&#39;</span> % ( pedformat, pf )
<a name="l01057"></a>01057             <span class="keywordflow">else</span>:
<a name="l01058"></a>01058                 <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span>:
<a name="l01059"></a>01059                     <span class="keywordflow">print</span> <span class="stringliteral">&#39;[WARNING]: Invalid pedigree format code, %s, in NewPedigree::save(). Not included in pedformat_ckd.&#39;</span> % ( pf )
<a name="l01060"></a>01060                 logging.warning(<span class="stringliteral">&#39;Invalid pedigree format code, %s, in NewPedigree::save(). Not included in pedformat_ckd.&#39;</span>, pf)
<a name="l01061"></a>01061         <span class="comment"># Warn the user if they are not outputting incomplete information (e.g., animals without sires or dams).</span>
<a name="l01062"></a>01062         <span class="keywordflow">if</span> ( <span class="stringliteral">&#39;ASD&#39;</span> <span class="keywordflow">not</span> <span class="keywordflow">in</span> pedformat ) <span class="keywordflow">and</span> ( <span class="stringliteral">&#39;asd&#39;</span> <span class="keywordflow">not</span> <span class="keywordflow">in</span> pedformat ):
<a name="l01063"></a>01063             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span>:
<a name="l01064"></a>01064                 <span class="keywordflow">print</span> <span class="stringliteral">&#39;[WARNING]: The pedigree format code, %s, does not contain the sequence \&#39;asd\&#39; or \&#39;ASD\&#39;, and the resulting pedigree may have incomplete parentage information.&#39;</span> % ( pedformat )
<a name="l01065"></a>01065             logging.warning(<span class="stringliteral">&#39;The pedigree format code, %s, does not contain the sequence \&#39;asd\&#39; or \&#39;ASD\&#39;, and the resulting pedigree may have incomplete parentage information.&#39;</span>, pedformat)
<a name="l01066"></a>01066         <span class="comment"># Check the sepchar to make sure that the fields aren&#39;t run all together</span>
<a name="l01067"></a>01067         <span class="keywordflow">if</span> sepchar == <span class="stringliteral">&#39;&#39;</span>:
<a name="l01068"></a>01068             sepchar = self.kw[<span class="stringliteral">&#39;sepchar&#39;</span>]
<a name="l01069"></a>01069             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span>:
<a name="l01070"></a>01070                 <span class="keywordflow">print</span> <span class="stringliteral">&#39;[WARNING]: Invalid sepchar \&#39;\&#39; in NewPedigree::save(). Changed to \&#39;%s\&#39; to keep columns from running together.&#39;</span> % ( sepchar )
<a name="l01071"></a>01071             logging.warning(<span class="stringliteral">&#39;Invalid sepchar \&#39;\&#39; in NewPedigree::save(). Changed to \&#39;%s\&#39; to keep columns from running together.&#39;</span>, sepchar)
<a name="l01072"></a>01072         <span class="comment"># This is VERY important: never overwrite the user&#39;s data if it looks like an accidental</span>
<a name="l01073"></a>01073         <span class="comment"># request!  If the user does not pass a filename to save() save the pedigree to a file</span>
<a name="l01074"></a>01074         <span class="comment"># whose name is derived from, but not the same as, the original pedigree file.</span>
<a name="l01075"></a>01075         <span class="keywordflow">if</span> filename == <span class="stringliteral">&#39;&#39;</span>:
<a name="l01076"></a>01076             filename = <span class="stringliteral">&#39;%s_saved.ped&#39;</span> % ( self.kw[<span class="stringliteral">&#39;filetag&#39;</span>] )
<a name="l01077"></a>01077             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span>:
<a name="l01078"></a>01078                 <span class="keywordflow">print</span> <span class="stringliteral">&#39;[WARNING]: Saving pedigree to file %s to avoid overwriting %s.&#39;</span> % ( filename, self.kw[<span class="stringliteral">&#39;pedfile&#39;</span>] )
<a name="l01079"></a>01079             logging.warning(<span class="stringliteral">&#39;Saving pedigree to file %s to avoid overwriting %s.&#39;</span>,filename,self.kw[<span class="stringliteral">&#39;pedfile&#39;</span>])
<a name="l01080"></a>01080         <span class="keywordflow">try</span>:
<a name="l01081"></a>01081             <span class="keywordflow">if</span> append == <span class="keyword">False</span>:
<a name="l01082"></a>01082                 ofh = file(filename,<span class="stringliteral">&#39;w&#39;</span>)
<a name="l01083"></a>01083                 <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span>:
<a name="l01084"></a>01084                     <span class="keywordflow">print</span> <span class="stringliteral">&#39;[INFO]: Opened file %s for pedigree save at %s.&#39;</span> % ( filename, pyp_utils.pyp_nice_time() )
<a name="l01085"></a>01085                 logging.info(<span class="stringliteral">&#39;Opened file %s for pedigree save at %s.&#39;</span>,filename, pyp_utils.pyp_nice_time())
<a name="l01086"></a>01086             <span class="keywordflow">else</span>:
<a name="l01087"></a>01087                 ofh = file(filename,<span class="stringliteral">&#39;a&#39;</span>)
<a name="l01088"></a>01088                 <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span>:
<a name="l01089"></a>01089                     <span class="keywordflow">print</span> <span class="stringliteral">&#39;[INFO]: Opened file %s for pedigree save in append mode at %s.&#39;</span> % ( filename, pyp_utils.pyp_nice_time() )
<a name="l01090"></a>01090                 logging.info(<span class="stringliteral">&#39;Opened file %s for pedigree save in append mode at %s.&#39;</span>,filename, pyp_utils.pyp_nice_time())
<a name="l01091"></a>01091 
<a name="l01092"></a>01092             <span class="comment"># Let the user know which pedigree format code is being used.</span>
<a name="l01093"></a>01093             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span>:
<a name="l01094"></a>01094                 <span class="keywordflow">print</span> <span class="stringliteral">&#39;\t[INFO]: Writing pedigree file with format code %s in NewPedigree::save().&#39;</span> % ( pedformat )
<a name="l01095"></a>01095             logging.info(<span class="stringliteral">&#39;Pedigree format code %s being used to write pedigree file %s in NewPedigree::save().&#39;</span>, pedformat, filename)
<a name="l01096"></a>01096 
<a name="l01097"></a>01097             <span class="comment"># Write file header.</span>
<a name="l01098"></a>01098             <span class="keywordflow">if</span> append == <span class="keyword">True</span>:
<a name="l01099"></a>01099                 ofh.write(<span class="stringliteral">&#39;# %s created by PyPedal at %s\n&#39;</span> % ( filename, pyp_utils.pyp_nice_time() ) )
<a name="l01100"></a>01100                 ofh.write(<span class="stringliteral">&#39;# Current pedigree metadata:\n&#39;</span>)
<a name="l01101"></a>01101                 ofh.write(<span class="stringliteral">&#39;#\tpedigree file: %s\n&#39;</span> % (filename) )
<a name="l01102"></a>01102                 ofh.write(<span class="stringliteral">&#39;#\tpedigree name: %s\n&#39;</span> % (self.kw[<span class="stringliteral">&#39;pedname&#39;</span>]) )
<a name="l01103"></a>01103                 ofh.write(<span class="stringliteral">&#39;#\tpedigree format: %s\n&#39;</span> % (pedformat) )
<a name="l01104"></a>01104                 <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;pedigree_is_renumbered&#39;</span>] == 1:
<a name="l01105"></a>01105                     ofh.write(<span class="stringliteral">&#39;#\tNOTE: Animal, sire, and dam IDs are RENUMBERED IDs, not original IDs!\n&#39;</span>)
<a name="l01106"></a>01106                 ofh.write(<span class="stringliteral">&#39;# Original pedigree metadata:\n&#39;</span>)
<a name="l01107"></a>01107                 ofh.write(<span class="stringliteral">&#39;#\tpedigree file: %s\n&#39;</span> % (self.kw[<span class="stringliteral">&#39;pedfile&#39;</span>]))
<a name="l01108"></a>01108                 ofh.write(<span class="stringliteral">&#39;#\tpedigree name: %s\n&#39;</span> % (self.kw[<span class="stringliteral">&#39;pedname&#39;</span>]))
<a name="l01109"></a>01109                 ofh.write(<span class="stringliteral">&#39;#\tpedigree format: %s\n&#39;</span> % (self.kw[<span class="stringliteral">&#39;pedformat&#39;</span>]))
<a name="l01110"></a>01110             <span class="keywordflow">for</span> _a <span class="keywordflow">in</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a28eed1e3039de3a74d2597d556ac831f">pedigree</a>:
<a name="l01111"></a>01111                 <span class="keywordflow">if</span> write_list == <span class="keyword">False</span> <span class="keywordflow">or</span> write_list[_a.animalID] == <span class="keyword">True</span>:
<a name="l01112"></a>01112                     _outstring = <span class="stringliteral">&#39;&#39;</span>
<a name="l01113"></a>01113                     <span class="keywordflow">for</span> pf <span class="keywordflow">in</span> pedformat:
<a name="l01114"></a>01114                         <span class="keywordflow">if</span> originalID == <span class="keyword">False</span>:
<a name="l01115"></a>01115                             value = getattr(_a, self.new_animal_attr[pf])
<a name="l01116"></a>01116                         <span class="keywordflow">else</span>:
<a name="l01117"></a>01117                             <span class="keywordflow">if</span> pf <span class="keywordflow">in</span>[<span class="stringliteral">&#39;a&#39;</span>,<span class="stringliteral">&#39;A&#39;</span>]:
<a name="l01118"></a>01118                                 value = _a.originalID
<a name="l01119"></a>01119                             <span class="comment"># This cascade may break if the pedigree is not</span>
<a name="l01120"></a>01120                             <span class="comment"># renumbered...</span>
<a name="l01121"></a>01121                             <span class="keywordflow">elif</span> pf <span class="keywordflow">in</span>[<span class="stringliteral">&#39;s&#39;</span>,<span class="stringliteral">&#39;S&#39;</span>]:
<a name="l01122"></a>01122                                 <span class="keywordflow">if</span> _a.sireID != self.kw[<span class="stringliteral">&#39;missing_parent&#39;</span>]:
<a name="l01123"></a>01123                                     value = self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a28eed1e3039de3a74d2597d556ac831f">pedigree</a>[_a.sireID-1].originalID
<a name="l01124"></a>01124                                 <span class="keywordflow">else</span>:
<a name="l01125"></a>01125                                     value = 0
<a name="l01126"></a>01126                             <span class="keywordflow">elif</span> pf <span class="keywordflow">in</span>[<span class="stringliteral">&#39;d&#39;</span>,<span class="stringliteral">&#39;D&#39;</span>]:
<a name="l01127"></a>01127                                 <span class="keywordflow">if</span> _a.damID != self.kw[<span class="stringliteral">&#39;missing_parent&#39;</span>]:
<a name="l01128"></a>01128                                     value = self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a28eed1e3039de3a74d2597d556ac831f">pedigree</a>[_a.damID-1].originalID
<a name="l01129"></a>01129                                 <span class="keywordflow">else</span>:
<a name="l01130"></a>01130                                     value = 0
<a name="l01131"></a>01131                             <span class="keywordflow">else</span>:
<a name="l01132"></a>01132                                 value = getattr(_a, self.new_animal_attr[pf])
<a name="l01133"></a>01133                         <span class="comment"># If we don&#39;t catch the special case of the first entry</span>
<a name="l01134"></a>01134                         <span class="comment"># in an output line the a sepchar always will be the</span>
<a name="l01135"></a>01135                         <span class="comment"># first character in the line.</span>
<a name="l01136"></a>01136                         <span class="keywordflow">if</span> len(_outstring) &gt; 0:
<a name="l01137"></a>01137                             _outstring = <span class="stringliteral">&#39;%s%s%s&#39;</span> % ( _outstring, sepchar, value )
<a name="l01138"></a>01138                         <span class="keywordflow">else</span>:
<a name="l01139"></a>01139                             _outstring = <span class="stringliteral">&#39;%s&#39;</span> % ( value )
<a name="l01140"></a>01140                     ofh.write( <span class="stringliteral">&#39;%s\n&#39;</span> % (_outstring) )
<a name="l01141"></a>01141             ofh.close()
<a name="l01142"></a>01142             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span>:
<a name="l01143"></a>01143                 <span class="keywordflow">print</span> <span class="stringliteral">&#39;\t[INFO]: Closed file %s after pedigree save at %s.&#39;</span> % ( filename, pyp_utils.pyp_nice_time() )
<a name="l01144"></a>01144             logging.info(<span class="stringliteral">&#39;Closed file %s after pedigree save at %s.&#39;</span>,filename, pyp_utils.pyp_nice_time())
<a name="l01145"></a>01145             <span class="keywordflow">return</span> 1
<a name="l01146"></a>01146         <span class="keywordflow">except</span>:
<a name="l01147"></a>01147             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span>:
<a name="l01148"></a>01148                 <span class="keywordflow">print</span> <span class="stringliteral">&#39;[ERROR]: Unable to open file %s for pedigree save!&#39;</span> % ( filename )
<a name="l01149"></a>01149             logging.error(<span class="stringliteral">&#39;Unable to open file %s for pedigree save.&#39;</span>,filename)
<a name="l01150"></a>01150             <span class="keywordflow">return</span> 0
<a name="l01151"></a>01151 
<a name="l01152"></a>01152     <span class="comment">##</span>
<a name="l01153"></a>01153     <span class="comment"># savegraph() save a pedigree to a file as an adjacency list.</span>
<a name="l01154"></a>01154     <span class="comment"># @param self Reference to current object.</span>
<a name="l01155"></a>01155     <span class="comment"># @param pedoutfile Name of the file to which the graph is written.</span>
<a name="l01156"></a>01156     <span class="comment"># @param pedgraph Graph object</span>
<a name="l01157"></a>01157     <span class="comment"># @retval None</span>
<a name="l01158"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a6babcd0407dd75ff3e5351c96da085aa">01158</a>     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a6babcd0407dd75ff3e5351c96da085aa" title="savegraph() save a pedigree to a file as an adjacency list.">savegraph</a>(self, pedoutfile=0, pedgraph=0):
<a name="l01159"></a>01159         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l01160"></a>01160 <span class="stringliteral">        Save a pedigree to a file as an adjacency list.</span>
<a name="l01161"></a>01161 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l01162"></a>01162         <span class="keywordflow">if</span> <span class="keywordflow">not</span> pedoutfile:
<a name="l01163"></a>01163             pedoutfile = <span class="stringliteral">&#39;%s.adjlist&#39;</span> % ( self.kw[<span class="stringliteral">&#39;pedfile&#39;</span>] )
<a name="l01164"></a>01164         <span class="keywordflow">if</span> <span class="keywordflow">not</span> pedgraph:
<a name="l01165"></a>01165             <span class="keywordflow">try</span>:
<a name="l01166"></a>01166                 <span class="keyword">import</span> pyp_network
<a name="l01167"></a>01167                 pedgraph = pyp_network.ped_to_graph(self)
<a name="l01168"></a>01168                 logging.info(<span class="stringliteral">&#39;[savegraph]: Convert pedigree to a directed graph.&#39;</span>)
<a name="l01169"></a>01169             <span class="keywordflow">except</span>:
<a name="l01170"></a>01170                 logging.error(<span class="stringliteral">&#39;[savegraph]: Unable to convert pedigree to a directed graph.&#39;</span>)
<a name="l01171"></a>01171         <span class="keywordflow">try</span>:
<a name="l01172"></a>01172             <span class="keyword">import</span> networkx <span class="keyword">as</span> NX
<a name="l01173"></a>01173             NX.write_adjlist(pedgraph, pedoutfile)
<a name="l01174"></a>01174         <span class="keywordflow">except</span>:
<a name="l01175"></a>01175             logging.error(<span class="stringliteral">&#39;[savegraph]: Unable to save directed graph to a file.&#39;</span>)
<a name="l01176"></a>01176 
<a name="l01177"></a>01177     <span class="comment">##</span>
<a name="l01178"></a>01178     <span class="comment"># savegedcom() save a pedigree to a file in GEDCOM 5.5 format.</span>
<a name="l01179"></a>01179     <span class="comment"># @param self Reference to current object</span>
<a name="l01180"></a>01180     <span class="comment"># @param pedoutfile Name of the file to which the graph is written</span>
<a name="l01181"></a>01181     <span class="comment"># @retval None</span>
<a name="l01182"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a4f3ef3055fd807086da58aac2c6499f7">01182</a>     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a4f3ef3055fd807086da58aac2c6499f7" title="savegedcom() save a pedigree to a file in GEDCOM 5.5 format.">savegedcom</a>(self, pedoutfile=0):
<a name="l01183"></a>01183         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l01184"></a>01184 <span class="stringliteral">        Save a pedigree to a file in GEDCOM 5.5 format.</span>
<a name="l01185"></a>01185 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l01186"></a>01186         <span class="keywordflow">if</span> <span class="keywordflow">not</span> pedoutfile:
<a name="l01187"></a>01187             pedoutfile = <span class="stringliteral">&#39;%s.ged&#39;</span> % ( self.kw[<span class="stringliteral">&#39;pedfile&#39;</span>] )
<a name="l01188"></a>01188         <span class="keywordflow">try</span>:
<a name="l01189"></a>01189             pyp_io.save_to_gedcom(self,pedoutfile)
<a name="l01190"></a>01190             logging.info(<span class="stringliteral">&#39;[savegedcom]: Saved GEDCOM pedigree to the file %s.&#39;</span>, pedoutfile)
<a name="l01191"></a>01191         <span class="keywordflow">except</span>:
<a name="l01192"></a>01192             logging.error(<span class="stringliteral">&#39;[savegedcom]: Unable to save GEDCOM pedigree to the file %s.&#39;</span>, pedoutfile)
<a name="l01193"></a>01193 
<a name="l01194"></a>01194     <span class="comment">##</span>
<a name="l01195"></a>01195     <span class="comment"># savegenes() save a pedigree to a file in GENES 1.20 (dBase III) format.</span>
<a name="l01196"></a>01196     <span class="comment"># @param self Reference to current object</span>
<a name="l01197"></a>01197     <span class="comment"># @param pedoutfile Name of the file to which the graph is written</span>
<a name="l01198"></a>01198     <span class="comment"># @retval None</span>
<a name="l01199"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a41abde8769a72486d5d0e352072338d4">01199</a>     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a41abde8769a72486d5d0e352072338d4" title="savegenes() save a pedigree to a file in GENES 1.20 (dBase III) format.">savegenes</a>(self, pedoutfile=0):
<a name="l01200"></a>01200         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l01201"></a>01201 <span class="stringliteral">        Save a pedigree to a file in GENES 1.20 (dBase III) format.</span>
<a name="l01202"></a>01202 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l01203"></a>01203         <span class="keywordflow">if</span> <span class="keywordflow">not</span> pedoutfile:
<a name="l01204"></a>01204             pedoutfile = <span class="stringliteral">&#39;%s.dbf&#39;</span> % ( self.kw[<span class="stringliteral">&#39;pedfile&#39;</span>] )
<a name="l01205"></a>01205         <span class="keywordflow">try</span>:
<a name="l01206"></a>01206             pyp_io.save_to_genes(self,pedoutfile)
<a name="l01207"></a>01207             logging.info(<span class="stringliteral">&#39;[savegenes]: Saved GENES pedigree to the file %s.&#39;</span>, pedoutfile)
<a name="l01208"></a>01208         <span class="keywordflow">except</span>:
<a name="l01209"></a>01209             logging.error(<span class="stringliteral">&#39;[savegenes]: Unable to save GENES pedigree to the file %s.&#39;</span>, pedoutfile)
<a name="l01210"></a>01210 
<a name="l01211"></a>01211     <span class="comment">##</span>
<a name="l01212"></a>01212     <span class="comment"># savedb() saves a pedigree to a database table in ASDx format</span>
<a name="l01213"></a>01213     <span class="comment"># for NewAnimals and LightAnimals.</span>
<a name="l01214"></a>01214     <span class="comment"># @param self Reference to current object.</span>
<a name="l01215"></a>01215     <span class="comment"># @param drop Boolean indicating if existing data should be kept (False) or deleted (True); the default is False.</span>
<a name="l01216"></a>01216     <span class="comment"># @retval _savedb_status Boolean indicating if the pedigree was successfully saved.</span>
<a name="l01217"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#abe7890df1b04734981aa7e1e1e4054ec">01217</a>     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#abe7890df1b04734981aa7e1e1e4054ec" title="savedb() saves a pedigree to a database table in ASDx format for NewAnimals and LightAnimals.">savedb</a>(self, drop=False):
<a name="l01218"></a>01218         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l01219"></a>01219 <span class="stringliteral">        savedb() saves a pedigree to a database table in ASDx format</span>
<a name="l01220"></a>01220 <span class="stringliteral">        for NewAnimals and LightAnimals.</span>
<a name="l01221"></a>01221 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l01222"></a>01222         _savedb_status = <span class="keyword">False</span>
<a name="l01223"></a>01223         _table_loaded = <span class="keyword">False</span>
<a name="l01224"></a>01224         _table_created = <span class="keyword">False</span>
<a name="l01225"></a>01225         <span class="comment"># Create the database -- this will overwrite an existing DB with the</span>
<a name="l01226"></a>01226         <span class="comment"># same name!</span>
<a name="l01227"></a>01227         <span class="keywordflow">if</span> pyp_db.doesTableExist(self) <span class="keywordflow">and</span> drop == <span class="keyword">True</span>:
<a name="l01228"></a>01228             pyp_db.deleteTable(self)
<a name="l01229"></a>01229         conn = pyp_db.connectToDatabase(self)
<a name="l01230"></a>01230         <span class="keywordflow">if</span> conn:
<a name="l01231"></a>01231             <span class="keywordflow">if</span> <span class="keywordflow">not</span> pyp_db.doesTableExist(self):
<a name="l01232"></a>01232                 <span class="keywordflow">try</span>:
<a name="l01233"></a>01233                     sql = <span class="stringliteral">&#39;create table %s ( \</span>
<a name="l01234"></a>01234 <span class="stringliteral">                        animalName   varchar(128) primary key, \</span>
<a name="l01235"></a>01235 <span class="stringliteral">                        sireName     varchar(128), \</span>
<a name="l01236"></a>01236 <span class="stringliteral">                        damName      varchar(128), \</span>
<a name="l01237"></a>01237 <span class="stringliteral">                        sex          char(1) \</span>
<a name="l01238"></a>01238 <span class="stringliteral">                    );&#39;</span> % ( self.kw[<span class="stringliteral">&#39;database_table&#39;</span>] )
<a name="l01239"></a>01239                     cursor = conn.Execute(sql)
<a name="l01240"></a>01240                     cursor.Close()
<a name="l01241"></a>01241                     _table_created = <span class="keyword">True</span>
<a name="l01242"></a>01242                 <span class="keywordflow">except</span>:
<a name="l01243"></a>01243                     <span class="keywordflow">pass</span>
<a name="l01244"></a>01244             <span class="keywordflow">else</span>:
<a name="l01245"></a>01245                 <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span>:
<a name="l01246"></a>01246                     <span class="keywordflow">print</span> <span class="stringliteral">&#39;[WARNING]: The table %s already exists in database %s and you told me to save the existing data. You may end up with duplicate data or multiple pedigrees stored in the same table!&#39;</span> % ( self.kw[<span class="stringliteral">&#39;database_table&#39;</span>], self.kw[<span class="stringliteral">&#39;database_name&#39;</span>] )
<a name="l01247"></a>01247                 logging.warning(<span class="stringliteral">&#39;The table %s already exists in database %s and you told me to save the existing data. You may end up with duplicate data or multiple pedigrees stored in the same table!&#39;</span>,self.kw[<span class="stringliteral">&#39;database_table&#39;</span>], self.kw[<span class="stringliteral">&#39;database_name&#39;</span>])
<a name="l01248"></a>01248             <span class="comment"># Load the pedigree data into the table.</span>
<a name="l01249"></a>01249             <span class="keywordflow">if</span> pyp_db.doesTableExist(self):
<a name="l01250"></a>01250                 <span class="keywordflow">try</span>:
<a name="l01251"></a>01251                     <span class="keywordflow">for</span> p <span class="keywordflow">in</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a28eed1e3039de3a74d2597d556ac831f">pedigree</a>:
<a name="l01252"></a>01252                         an = p.name
<a name="l01253"></a>01253                         si = p.sireName
<a name="l01254"></a>01254                         da = p.damName
<a name="l01255"></a>01255                         <span class="keywordflow">if</span> si == self.kw[<span class="stringliteral">&#39;missing_name&#39;</span>]:
<a name="l01256"></a>01256                             si = self.kw[<span class="stringliteral">&#39;missing_parent&#39;</span>]
<a name="l01257"></a>01257                         <span class="keywordflow">if</span> da == self.kw[<span class="stringliteral">&#39;missing_name&#39;</span>]:
<a name="l01258"></a>01258                             da = self.kw[<span class="stringliteral">&#39;missing_parent&#39;</span>]
<a name="l01259"></a>01259                         sql = <span class="stringliteral">&quot;INSERT INTO %s ( animalName, sireName, damName, sex ) VALUES (&#39;%s&#39;, &#39;%s&#39;, &#39;%s&#39;, &#39;%s&#39;)&quot;</span> % ( self.kw[<span class="stringliteral">&#39;database_table&#39;</span>], an, si, da, p.sex )
<a name="l01260"></a>01260                         cursor = conn.Execute(sql)
<a name="l01261"></a>01261                         cursor.Close()
<a name="l01262"></a>01262                     _table_loaded = <span class="keyword">True</span>
<a name="l01263"></a>01263                 <span class="keywordflow">except</span>:
<a name="l01264"></a>01264                     <span class="keywordflow">pass</span>
<a name="l01265"></a>01265             conn.Close()
<a name="l01266"></a>01266         <span class="keywordflow">else</span>:
<a name="l01267"></a>01267             <span class="keywordflow">pass</span>
<a name="l01268"></a>01268         <span class="keywordflow">if</span> _table_loaded:
<a name="l01269"></a>01269             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span>:
<a name="l01270"></a>01270                 <span class="keywordflow">print</span> <span class="stringliteral">&#39;[INFO]: Saved pedigree to %s.%s at %s.&#39;</span> % ( self.kw[<span class="stringliteral">&#39;database_name&#39;</span>], \
<a name="l01271"></a>01271                     self.kw[<span class="stringliteral">&#39;database_table&#39;</span>], pyp_utils.pyp_nice_time() )
<a name="l01272"></a>01272             logging.info(<span class="stringliteral">&#39;Saved pedigree to %s.%s at %s.&#39;</span>,self.kw[<span class="stringliteral">&#39;database_name&#39;</span>], \
<a name="l01273"></a>01273                 self.kw[<span class="stringliteral">&#39;database_table&#39;</span>], pyp_utils.pyp_nice_time())
<a name="l01274"></a>01274             _savedb_status = <span class="keyword">True</span>
<a name="l01275"></a>01275         <span class="keywordflow">else</span>:
<a name="l01276"></a>01276             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span>:
<a name="l01277"></a>01277                 <span class="keywordflow">print</span> <span class="stringliteral">&#39;[ERROR]: Could not save pedigree to %s.%s at %s.&#39;</span> % ( \
<a name="l01278"></a>01278                     self.kw[<span class="stringliteral">&#39;database_name&#39;</span>], self.kw[<span class="stringliteral">&#39;database_table&#39;</span>], pyp_utils.pyp_nice_time() )
<a name="l01279"></a>01279             logging.error(<span class="stringliteral">&#39;Could not save pedigree to %s.%s at %s.&#39;</span>,self.kw[<span class="stringliteral">&#39;database_name&#39;</span>], \
<a name="l01280"></a>01280                 self.kw[<span class="stringliteral">&#39;database_table&#39;</span>], pyp_utils.pyp_nice_time())
<a name="l01281"></a>01281         <span class="keywordflow">return</span> _savedb_status
<a name="l01282"></a>01282 
<a name="l01283"></a>01283     <span class="comment">##</span>
<a name="l01284"></a>01284     <span class="comment"># preprocess() processes a pedigree file, which includes reading the animals</span>
<a name="l01285"></a>01285     <span class="comment"># into a list of animal objects, forming lists of sires and dams, and checking for</span>
<a name="l01286"></a>01286     <span class="comment"># common errors.</span>
<a name="l01287"></a>01287     <span class="comment"># @param self Reference to current object</span>
<a name="l01288"></a>01288     <span class="comment"># @param textstream String containing animal records</span>
<a name="l01289"></a>01289     <span class="comment"># @param dbstream List of tuples of animal records</span>
<a name="l01290"></a>01290     <span class="comment"># @retval None</span>
<a name="l01291"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#aa70701de178f69d9c7a3321448681a03">01291</a>     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#aa70701de178f69d9c7a3321448681a03" title="preprocess() processes a pedigree file, which includes reading the animals into a list of animal obje...">preprocess</a>(self, textstream=&#39;&#39;, dbstream=&#39;&#39;):
<a name="l01292"></a>01292         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l01293"></a>01293 <span class="stringliteral">        Preprocess a pedigree file, which includes reading the animals into a list, forming lists of sires and dams, and checking for common errors.</span>
<a name="l01294"></a>01294 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l01295"></a>01295         lineCounter = 0     <span class="comment"># count the number of lines in the pedigree file</span>
<a name="l01296"></a>01296         animalCounter = 0   <span class="comment"># count the number of animal records in the pedigree file</span>
<a name="l01297"></a>01297         <span class="comment">#pedformat_codes = [&#39;a&#39;,&#39;s&#39;,&#39;d&#39;,&#39;g&#39;,&#39;x&#39;,&#39;b&#39;,&#39;f&#39;,&#39;r&#39;,&#39;n&#39;,&#39;y&#39;,&#39;l&#39;,&#39;e&#39;,&#39;p&#39;,&#39;A&#39;,&#39;S&#39;,&#39;D&#39;,&#39;L&#39;,&#39;Z&#39;,&#39;h&#39;,&#39;H&#39;,&#39;u&#39;]</span>
<a name="l01298"></a>01298         critical_count = 0  <span class="comment"># Number of critical errors encountered</span>
<a name="l01299"></a>01299         pedformat_locations = {} <span class="comment"># Stores columns numbers for input data</span>
<a name="l01300"></a>01300         _sires = {}         <span class="comment"># We need to track the sires and dams read from the pedigree</span>
<a name="l01301"></a>01301         _dams = {}          <span class="comment"># file in order to insert records for any parents that do not</span>
<a name="l01302"></a>01302                             <span class="comment"># have their own records in the pedigree file.</span>
<a name="l01303"></a>01303         <span class="comment"># A variable, &#39;pedformat, is passed as a parameter that indicates the format of the</span>
<a name="l01304"></a>01304         <span class="comment"># pedigree in the input file.  Note that A PEDIGREE FORMAT STRING IS NO LONGER</span>
<a name="l01305"></a>01305         <span class="comment"># REQUIRED in the input file, and any found will be ignored.  The index of the single-</span>
<a name="l01306"></a>01306         <span class="comment"># digit code in the format string indicates the column in which the corresponding</span>
<a name="l01307"></a>01307         <span class="comment"># variable is found.  Duplicate values in the pedformat atring are ignored.</span>
<a name="l01308"></a>01308         <span class="comment">#print self.kw[&#39;pedformat&#39;]</span>
<a name="l01309"></a>01309         <span class="keywordflow">if</span> <span class="keywordflow">not</span> self.kw[<span class="stringliteral">&#39;pedformat&#39;</span>]:
<a name="l01310"></a>01310             self.kw[<span class="stringliteral">&#39;pedformat&#39;</span>] = <span class="stringliteral">&#39;asd&#39;</span>
<a name="l01311"></a>01311             logging.error(<span class="stringliteral">&#39;Null pedigree format string assigned a default value of %s.&#39;</span>, self.kw[<span class="stringliteral">&#39;pedformat&#39;</span>])
<a name="l01312"></a>01312             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span>:
<a name="l01313"></a>01313                 <span class="keywordflow">print</span> <span class="stringliteral">&#39;[ERROR]: Null pedigree format string assigned a default value of %s.&#39;</span> % ( self.kw[<span class="stringliteral">&#39;pedformat&#39;</span>] )
<a name="l01314"></a>01314         <span class="comment"># This is where we check the format string to figure out what we have in the input file.</span>
<a name="l01315"></a>01315         <span class="comment"># Check for valid characters...</span>
<a name="l01316"></a>01316         _pedformat = []
<a name="l01317"></a>01317         <span class="keywordflow">for</span> _char <span class="keywordflow">in</span> self.kw[<span class="stringliteral">&#39;pedformat&#39;</span>]:
<a name="l01318"></a>01318             <span class="keywordflow">if</span> _char <span class="keywordflow">in</span> self.pedformat_codes <span class="keywordflow">and</span> _char != <span class="stringliteral">&#39;Z&#39;</span>:
<a name="l01319"></a>01319                 _pedformat.append(_char)
<a name="l01320"></a>01320             <span class="keywordflow">elif</span> _char <span class="keywordflow">in</span> self.pedformat_codes <span class="keywordflow">and</span> _char == <span class="stringliteral">&#39;Z&#39;</span>:
<a name="l01321"></a>01321                 _pedformat.append(<span class="stringliteral">&#39;.&#39;</span>)
<a name="l01322"></a>01322                 <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span>:
<a name="l01323"></a>01323                     <span class="keywordflow">print</span> <span class="stringliteral">&#39;[INFO]: Skipping one or more columns in the input file&#39;</span>
<a name="l01324"></a>01324                 logging.info(<span class="stringliteral">&#39;Skipping one or more columns in the input file as requested by the pedigree format string %s&#39;</span>,self.kw[<span class="stringliteral">&#39;pedformat&#39;</span>])
<a name="l01325"></a>01325             <span class="keywordflow">else</span>:
<a name="l01326"></a>01326                 <span class="comment"># Replace the invalid code with a period, which is ignored when the string is parsed.</span>
<a name="l01327"></a>01327                 _pedformat.append(<span class="stringliteral">&#39;.&#39;</span>)
<a name="l01328"></a>01328                 <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span>:
<a name="l01329"></a>01329                     <span class="keywordflow">print</span> <span class="stringliteral">&#39;[DEBUG]: Invalid format code, %s, encountered!&#39;</span> % (_char)
<a name="l01330"></a>01330                 logging.error(<span class="stringliteral">&#39;Invalid column format code %s found while reading pedigree format string %s&#39;</span>,_char,self.kw[<span class="stringliteral">&#39;pedformat&#39;</span>])
<a name="l01331"></a>01331         <span class="keywordflow">for</span> _char <span class="keywordflow">in</span> _pedformat:
<a name="l01332"></a>01332             <span class="keywordflow">try</span>:
<a name="l01333"></a>01333                 pedformat_locations[<span class="stringliteral">&#39;animal&#39;</span>] = _pedformat.index(<span class="stringliteral">&#39;a&#39;</span>)
<a name="l01334"></a>01334             <span class="keywordflow">except</span> ValueError:
<a name="l01335"></a>01335                 <span class="keywordflow">try</span>:
<a name="l01336"></a>01336                     pedformat_locations[<span class="stringliteral">&#39;animal&#39;</span>] = _pedformat.index(<span class="stringliteral">&#39;A&#39;</span>)
<a name="l01337"></a>01337                 <span class="keywordflow">except</span> ValueError:
<a name="l01338"></a>01338                     <span class="keywordflow">print</span> <span class="stringliteral">&#39;[CRITICAL]: No animal identification code was specified in the pedigree format string %s!  This is a critical error and the program will halt.&#39;</span> % (_pedformat)
<a name="l01339"></a>01339                     critical_count = critical_count + 1
<a name="l01340"></a>01340             <span class="keywordflow">try</span>:
<a name="l01341"></a>01341                 pedformat_locations[<span class="stringliteral">&#39;sire&#39;</span>] = _pedformat.index(<span class="stringliteral">&#39;s&#39;</span>)
<a name="l01342"></a>01342             <span class="keywordflow">except</span> ValueError:
<a name="l01343"></a>01343                 <span class="keywordflow">try</span>:
<a name="l01344"></a>01344                     pedformat_locations[<span class="stringliteral">&#39;sire&#39;</span>] = _pedformat.index(<span class="stringliteral">&#39;S&#39;</span>)
<a name="l01345"></a>01345                 <span class="keywordflow">except</span> ValueError:
<a name="l01346"></a>01346                     <span class="keywordflow">print</span> <span class="stringliteral">&#39;[CRITICAL]: No sire identification code was specified in the pedigree format string %s!  This is a critical error and the program will halt.&#39;</span> % (_pedformat)
<a name="l01347"></a>01347                     critical_count = critical_count + 1
<a name="l01348"></a>01348             <span class="keywordflow">try</span>:
<a name="l01349"></a>01349                 pedformat_locations[<span class="stringliteral">&#39;dam&#39;</span>] = _pedformat.index(<span class="stringliteral">&#39;d&#39;</span>)
<a name="l01350"></a>01350             <span class="keywordflow">except</span> ValueError:
<a name="l01351"></a>01351                 <span class="keywordflow">try</span>:
<a name="l01352"></a>01352                     pedformat_locations[<span class="stringliteral">&#39;dam&#39;</span>] = _pedformat.index(<span class="stringliteral">&#39;D&#39;</span>)
<a name="l01353"></a>01353                 <span class="keywordflow">except</span> ValueError:
<a name="l01354"></a>01354                     <span class="keywordflow">print</span> <span class="stringliteral">&#39;[CRITICAL]: No dam identification code was specified in the pedigree format string %s!  This is a critical error and the program will halt.&#39;</span> % (_pedformat)
<a name="l01355"></a>01355                     critical_count = critical_count + 1
<a name="l01356"></a>01356             <span class="keywordflow">try</span>:
<a name="l01357"></a>01357                 pedformat_locations[<span class="stringliteral">&#39;generation&#39;</span>] = _pedformat.index(<span class="stringliteral">&#39;g&#39;</span>)
<a name="l01358"></a>01358             <span class="keywordflow">except</span> ValueError:
<a name="l01359"></a>01359                 pedformat_locations[<span class="stringliteral">&#39;generation&#39;</span>] = -999
<a name="l01360"></a>01360                 <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;all&#39;</span>:
<a name="l01361"></a>01361                     <span class="keywordflow">print</span> <span class="stringliteral">&#39;[DEBUG]: No generation code was specified in the pedigree format string %s.  This program will continue.&#39;</span> % (self.kw[<span class="stringliteral">&#39;pedformat&#39;</span>])
<a name="l01362"></a>01362             <span class="keywordflow">try</span>:
<a name="l01363"></a>01363                 pedformat_locations[<span class="stringliteral">&#39;gencoeff&#39;</span>] = _pedformat.index(<span class="stringliteral">&#39;p&#39;</span>)
<a name="l01364"></a>01364                 <span class="keywordflow">if</span> <span class="keywordflow">not</span> self.kw[<span class="stringliteral">&#39;gen_coeff&#39;</span>]:
<a name="l01365"></a>01365                     self.kw[<span class="stringliteral">&#39;gen_coeff&#39;</span>] = 1
<a name="l01366"></a>01366             <span class="keywordflow">except</span> ValueError:
<a name="l01367"></a>01367                 pedformat_locations[<span class="stringliteral">&#39;gencoeff&#39;</span>] = -999
<a name="l01368"></a>01368                 <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;gen_coeff&#39;</span>]:
<a name="l01369"></a>01369                     self.kw[<span class="stringliteral">&#39;gen_coeff&#39;</span>] = 0
<a name="l01370"></a>01370                 <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;all&#39;</span>:
<a name="l01371"></a>01371                     <span class="keywordflow">print</span> <span class="stringliteral">&#39;[DEBUG]: No generation coefficient was specified in the pedigree format string %s.  This program will continue.&#39;</span> % (self.kw[<span class="stringliteral">&#39;pedformat&#39;</span>])
<a name="l01372"></a>01372             <span class="keywordflow">try</span>:
<a name="l01373"></a>01373                 pedformat_locations[<span class="stringliteral">&#39;sex&#39;</span>] = _pedformat.index(<span class="stringliteral">&#39;x&#39;</span>)
<a name="l01374"></a>01374             <span class="keywordflow">except</span> ValueError:
<a name="l01375"></a>01375                 pedformat_locations[<span class="stringliteral">&#39;sex&#39;</span>] = -999
<a name="l01376"></a>01376                 <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;all&#39;</span>:
<a name="l01377"></a>01377                     <span class="keywordflow">print</span> <span class="stringliteral">&#39;[DEBUG]: No sex code was specified in the pedigree format string %s.  This program will continue.&#39;</span> % (self.kw[<span class="stringliteral">&#39;pedformat&#39;</span>])
<a name="l01378"></a>01378             <span class="keywordflow">try</span>:
<a name="l01379"></a>01379                 pedformat_locations[<span class="stringliteral">&#39;birthyear&#39;</span>] = _pedformat.index(<span class="stringliteral">&#39;y&#39;</span>)
<a name="l01380"></a>01380             <span class="keywordflow">except</span> ValueError:
<a name="l01381"></a>01381                 pedformat_locations[<span class="stringliteral">&#39;birthyear&#39;</span>] = -999
<a name="l01382"></a>01382                 <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;all&#39;</span>:
<a name="l01383"></a>01383                     <span class="keywordflow">print</span> <span class="stringliteral">&#39;[DEBUG]: No birth date (YYYY) code was specified in the pedigree format string %s.  This program will continue.&#39;</span> % (self.kw[<span class="stringliteral">&#39;pedformat&#39;</span>])
<a name="l01384"></a>01384             <span class="keywordflow">try</span>:
<a name="l01385"></a>01385                 pedformat_locations[<span class="stringliteral">&#39;inbreeding&#39;</span>] = _pedformat.index(<span class="stringliteral">&#39;f&#39;</span>)
<a name="l01386"></a>01386             <span class="keywordflow">except</span> ValueError:
<a name="l01387"></a>01387                 pedformat_locations[<span class="stringliteral">&#39;inbreeding&#39;</span>] = -999
<a name="l01388"></a>01388                 <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;all&#39;</span>:
<a name="l01389"></a>01389                     <span class="keywordflow">print</span> <span class="stringliteral">&#39;[DEBUG]: No coeffcient of inbreeding code was specified in the pedigree format string %s.  This program will continue.&#39;</span> % (self.kw[<span class="stringliteral">&#39;pedformat&#39;</span>])
<a name="l01390"></a>01390             <span class="keywordflow">try</span>:
<a name="l01391"></a>01391                 pedformat_locations[<span class="stringliteral">&#39;breed&#39;</span>] = _pedformat.index(<span class="stringliteral">&#39;</span><span class="stringliteral">r&#39;)</span>
<a name="l01392"></a>01392 <span class="stringliteral">            </span><span class="keywordflow">except</span> ValueError:
<a name="l01393"></a>01393                 pedformat_locations[<span class="stringliteral">&#39;breed&#39;</span>] = -999
<a name="l01394"></a>01394                 <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;all&#39;</span>:
<a name="l01395"></a>01395                     <span class="keywordflow">print</span> <span class="stringliteral">&#39;[DEBUG]: No breed code was specified in the pedigree format string %s.  This program will continue.&#39;</span> % (self.kw[<span class="stringliteral">&#39;pedformat&#39;</span>])
<a name="l01396"></a>01396             <span class="keywordflow">try</span>:
<a name="l01397"></a>01397                 pedformat_locations[<span class="stringliteral">&#39;name&#39;</span>] = _pedformat.index(<span class="stringliteral">&#39;n&#39;</span>)
<a name="l01398"></a>01398             <span class="keywordflow">except</span> ValueError:
<a name="l01399"></a>01399                 pedformat_locations[<span class="stringliteral">&#39;name&#39;</span>] = -999
<a name="l01400"></a>01400                 <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;all&#39;</span>:
<a name="l01401"></a>01401                     <span class="keywordflow">print</span> <span class="stringliteral">&#39;[DEBUG]: No name code was specified in the pedigree format string %s.  This program will continue.&#39;</span> % (self.kw[<span class="stringliteral">&#39;pedformat&#39;</span>])
<a name="l01402"></a>01402             <span class="keywordflow">try</span>:
<a name="l01403"></a>01403                 pedformat_locations[<span class="stringliteral">&#39;birthdate&#39;</span>] = _pedformat.index(<span class="stringliteral">&#39;b&#39;</span>)
<a name="l01404"></a>01404             <span class="keywordflow">except</span> ValueError:
<a name="l01405"></a>01405                 pedformat_locations[<span class="stringliteral">&#39;birthdate&#39;</span>] = -999
<a name="l01406"></a>01406                 <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;all&#39;</span>:
<a name="l01407"></a>01407                     <span class="keywordflow">print</span> <span class="stringliteral">&#39;[DEBUG]: No birth date (MMDDYYYY) code was specified in the pedigree format string %s.  This program will continue.&#39;</span> % ( self.kw[<span class="stringliteral">&#39;pedformat&#39;</span>] )
<a name="l01408"></a>01408             <span class="keywordflow">try</span>:
<a name="l01409"></a>01409                 pedformat_locations[<span class="stringliteral">&#39;alive&#39;</span>] = _pedformat.index(<span class="stringliteral">&#39;l&#39;</span>)
<a name="l01410"></a>01410             <span class="keywordflow">except</span> ValueError:
<a name="l01411"></a>01411                 pedformat_locations[<span class="stringliteral">&#39;alive&#39;</span>] = -999
<a name="l01412"></a>01412                 <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;all&#39;</span>:
<a name="l01413"></a>01413                     <span class="keywordflow">print</span> <span class="stringliteral">&#39;[DEBUG]: No alive/dead code was specified in the pedigree format string %s.  This program will continue.&#39;</span> % ( self.kw[<span class="stringliteral">&#39;pedformat&#39;</span>] )
<a name="l01414"></a>01414             <span class="keywordflow">try</span>:
<a name="l01415"></a>01415                 pedformat_locations[<span class="stringliteral">&#39;age&#39;</span>] = _pedformat.index(<span class="stringliteral">&#39;e&#39;</span>)
<a name="l01416"></a>01416             <span class="keywordflow">except</span> ValueError:
<a name="l01417"></a>01417                 pedformat_locations[<span class="stringliteral">&#39;age&#39;</span>] = -999
<a name="l01418"></a>01418                 <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;all&#39;</span>:
<a name="l01419"></a>01419                     <span class="keywordflow">print</span> <span class="stringliteral">&#39;[DEBUG]: No age code was specified in the pedigree format string %s.  This program will continue.&#39;</span> % (self.kw[<span class="stringliteral">&#39;pedformat&#39;</span>])
<a name="l01420"></a>01420             <span class="keywordflow">try</span>:
<a name="l01421"></a>01421                 pedformat_locations[<span class="stringliteral">&#39;alleles&#39;</span>] = _pedformat.index(<span class="stringliteral">&#39;L&#39;</span>)
<a name="l01422"></a>01422                 <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;alleles_sepchar&#39;</span>] == self.kw[<span class="stringliteral">&#39;sepchar&#39;</span>]:
<a name="l01423"></a>01423                     <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;all&#39;</span>:
<a name="l01424"></a>01424                         <span class="keywordflow">print</span> <span class="stringliteral">&#39;[DEBUG]: The same separating character was specified for both columns of input (option sepchar) and alleles (option alleles_sepchar) in an animal\&#39;s allelotype.  The allelotypes will not be used in this pedigree.&#39;</span>
<a name="l01425"></a>01425                     logging.warning(<span class="stringliteral">&#39;The same separating character was specified for both columns of input (option sepchar) and alleles (option alleles_sepchar) in an animal\&#39;s allelotype.  The allelotypes will not be used in this pedigree.&#39;</span>)
<a name="l01426"></a>01426                     pedformat_locations[<span class="stringliteral">&#39;alleles&#39;</span>] = -999
<a name="l01427"></a>01427             <span class="keywordflow">except</span> ValueError:
<a name="l01428"></a>01428                     pedformat_locations[<span class="stringliteral">&#39;alleles&#39;</span>] = -999
<a name="l01429"></a>01429                     <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;all&#39;</span>:
<a name="l01430"></a>01430                         <span class="keywordflow">print</span> <span class="stringliteral">&#39;[DEBUG]: No alleles code was specified in the pedigree format string %s.  This program will continue.&#39;</span> % (self.kw[<span class="stringliteral">&#39;pedformat&#39;</span>])
<a name="l01431"></a>01431             <span class="keywordflow">try</span>:
<a name="l01432"></a>01432                 pedformat_locations[<span class="stringliteral">&#39;herd&#39;</span>] = _pedformat.index(<span class="stringliteral">&#39;h&#39;</span>)
<a name="l01433"></a>01433             <span class="keywordflow">except</span> ValueError:
<a name="l01434"></a>01434                 pedformat_locations[<span class="stringliteral">&#39;herd&#39;</span>] = -999
<a name="l01435"></a>01435                 <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;all&#39;</span>:
<a name="l01436"></a>01436                     <span class="keywordflow">print</span> <span class="stringliteral">&#39;[DEBUG]: No herd code was specified in the pedigree format string %s.  This program will continue.&#39;</span> % (self.kw[<span class="stringliteral">&#39;pedformat&#39;</span>])
<a name="l01437"></a>01437             <span class="keywordflow">try</span>:
<a name="l01438"></a>01438                 pedformat_locations[<span class="stringliteral">&#39;herd&#39;</span>] = _pedformat.index(<span class="stringliteral">&#39;H&#39;</span>)
<a name="l01439"></a>01439             <span class="keywordflow">except</span> ValueError:
<a name="l01440"></a>01440                 pedformat_locations[<span class="stringliteral">&#39;herd&#39;</span>] = -999
<a name="l01441"></a>01441                 <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;all&#39;</span>:
<a name="l01442"></a>01442                     <span class="keywordflow">print</span> <span class="stringliteral">&#39;[DEBUG]: No herd code was specified in the pedigree format string %s.  This program will continue.&#39;</span> % (self.kw[<span class="stringliteral">&#39;pedformat&#39;</span>])
<a name="l01443"></a>01443             <span class="keywordflow">try</span>:
<a name="l01444"></a>01444                 pedformat_locations[<span class="stringliteral">&#39;userfield&#39;</span>] = _pedformat.index(<span class="stringliteral">&#39;</span><span class="stringliteral">u&#39;)</span>
<a name="l01445"></a>01445 <span class="stringliteral">            </span><span class="keywordflow">except</span> ValueError:
<a name="l01446"></a>01446                 pedformat_locations[<span class="stringliteral">&#39;userfield&#39;</span>] = -999
<a name="l01447"></a>01447                 <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;all&#39;</span>:
<a name="l01448"></a>01448                     <span class="keywordflow">print</span> <span class="stringliteral">&#39;[DEBUG]: No user-defined field was specified in the pedigree format string %s. This program will continue.&#39;</span> % (self.kw[<span class="stringliteral">&#39;pedformat&#39;</span>])
<a name="l01449"></a>01449         <span class="comment">#print self.kw[&#39;pedformat&#39;]</span>
<a name="l01450"></a>01450         <span class="comment">#print _pedformat</span>
<a name="l01451"></a>01451         <span class="comment">#print pedformat_locations</span>
<a name="l01452"></a>01452         <span class="comment"># If the pedigree file includes coefficients of inbreeding flag the</span>
<a name="l01453"></a>01453         <span class="comment"># pedigree.</span>
<a name="l01454"></a>01454         <span class="keywordflow">if</span> <span class="stringliteral">&#39;f&#39;</span> <span class="keywordflow">in</span> self.kw[<span class="stringliteral">&#39;pedformat&#39;</span>]:
<a name="l01455"></a>01455             self.kw[<span class="stringliteral">&#39;f_computed&#39;</span>] = 1
<a name="l01456"></a>01456         <span class="keywordflow">if</span> critical_count &gt; 0:
<a name="l01457"></a>01457             sys.exit(0)
<a name="l01458"></a>01458         <span class="keywordflow">else</span>:
<a name="l01459"></a>01459             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span> <span class="keywordflow">and</span> self.kw[<span class="stringliteral">&#39;pedigree_summary&#39;</span>]:
<a name="l01460"></a>01460                 <span class="keywordflow">print</span> <span class="stringliteral">&#39;[INFO]: Opening pedigree file %s&#39;</span> % ( self.kw[<span class="stringliteral">&#39;pedfile&#39;</span>] )
<a name="l01461"></a>01461             logging.info(<span class="stringliteral">&#39;Opening pedigree file %s&#39;</span>,self.kw[<span class="stringliteral">&#39;pedfile&#39;</span>])
<a name="l01462"></a>01462             <span class="keywordflow">if</span> textstream == <span class="stringliteral">&#39;&#39;</span> <span class="keywordflow">and</span> dbstream == <span class="stringliteral">&#39;&#39;</span>:
<a name="l01463"></a>01463                 infile = open(self.kw[<span class="stringliteral">&#39;pedfile&#39;</span>],<span class="stringliteral">&#39;</span><span class="stringliteral">r&#39;)</span>
<a name="l01464"></a>01464 <span class="stringliteral">            </span><span class="keywordflow">elif</span> dbstream == <span class="stringliteral">&#39;&#39;</span>:
<a name="l01465"></a>01465                 <span class="comment"># Parse the textstream</span>
<a name="l01466"></a>01466                 <span class="comment"># Note that this will cause the loss of the last record in the</span>
<a name="l01467"></a>01467                 <span class="comment"># string if that record DOES NOT have a trailing \n as the</span>
<a name="l01468"></a>01468                 <span class="comment"># documentation says it must.</span>
<a name="l01469"></a>01469                 infile = textstream.split(<span class="stringliteral">&#39;\n&#39;</span>)
<a name="l01470"></a>01470                 infile = infile[:-1]
<a name="l01471"></a>01471             <span class="keywordflow">else</span>:
<a name="l01472"></a>01472                 <span class="comment"># dbstream is a list of tuples from a database</span>
<a name="l01473"></a>01473                 infile = dbstream
<a name="l01474"></a>01474                 counter = 0
<a name="l01475"></a>01475             <span class="keywordflow">while</span> 1:
<a name="l01476"></a>01476                 <span class="keywordflow">if</span> textstream == <span class="stringliteral">&#39;&#39;</span> <span class="keywordflow">and</span> dbstream == <span class="stringliteral">&#39;&#39;</span>:
<a name="l01477"></a>01477                     line = infile.readline()                                    <span class="comment">#print line</span>
<a name="l01478"></a>01478                 <span class="keywordflow">elif</span> dbstream == <span class="stringliteral">&#39;&#39;</span>:
<a name="l01479"></a>01479                     <span class="keywordflow">try</span>:
<a name="l01480"></a>01480                         line = infile.pop()
<a name="l01481"></a>01481                         <span class="comment">#print &#39;line: %s&#39; % ( line )</span>
<a name="l01482"></a>01482                     <span class="keywordflow">except</span> IndexError:
<a name="l01483"></a>01483                         logging.warning(<span class="stringliteral">&#39;Reached the end of the textstream after reading %s records.&#39;</span>, lineCounter)
<a name="l01484"></a>01484                         line = <span class="keyword">False</span>
<a name="l01485"></a>01485                 <span class="keywordflow">else</span>:
<a name="l01486"></a>01486                     <span class="comment"># Do tuple unpacking on database records</span>
<a name="l01487"></a>01487                     <span class="keywordflow">try</span>:
<a name="l01488"></a>01488                         <span class="comment">#dbline = dbstream.pop()</span>
<a name="l01489"></a>01489                         <span class="comment"># Code from Matt Kelly -- dbstream.pop() didn&#39;t wprl for him on OS/X 1.0.4</span>
<a name="l01490"></a>01490                         dbline = dbstream[counter]
<a name="l01491"></a>01491                         line = <span class="stringliteral">&#39;,&#39;</span>.join(dbline)
<a name="l01492"></a>01492                         counter = counter + 1
<a name="l01493"></a>01493                     <span class="keywordflow">except</span> IndexError:
<a name="l01494"></a>01494                         logging.info(<span class="stringliteral">&#39;Reached the end of the dbstream after reading %s records.&#39;</span>, lineCounter)
<a name="l01495"></a>01495                         line = <span class="keyword">False</span>
<a name="l01496"></a>01496                 <span class="keywordflow">if</span> <span class="keywordflow">not</span> line:
<a name="l01497"></a>01497                     logging.info(<span class="stringliteral">&#39;Reached end-of-line in %s after reading %s lines.&#39;</span>, self.kw[<span class="stringliteral">&#39;pedfile&#39;</span>],lineCounter)
<a name="l01498"></a>01498                     <span class="keywordflow">break</span>
<a name="l01499"></a>01499                 <span class="keywordflow">else</span>:
<a name="l01500"></a>01500                     <span class="comment"># 29 March 2005</span>
<a name="l01501"></a>01501                     <span class="comment"># This causes problems b/c it eats the last column of the last record in a pedigree</span>
<a name="l01502"></a>01502                     <span class="comment"># file.  I think I added it way back when to deal with some EOL-character annoyance,</span>
<a name="l01503"></a>01503                     <span class="comment"># but I am not sure.  So...I am turning it off (for now).</span>
<a name="l01504"></a>01504                     <span class="comment">#line = string.strip(line[:-1])</span>
<a name="l01505"></a>01505                     lineCounter = lineCounter + 1
<a name="l01506"></a>01506                     <span class="keywordflow">if</span> lineCounter &lt;= self.kw[<span class="stringliteral">&#39;log_ped_lines&#39;</span>]:
<a name="l01507"></a>01507                         logging.info(<span class="stringliteral">&#39;Pedigree (line %s): %s&#39;</span>,lineCounter,string.strip(line))
<a name="l01508"></a>01508                     <span class="comment"># This code prepends a comment character the first line of inpuit if the has_header</span>
<a name="l01509"></a>01509                     <span class="comment"># option is set to 1.</span>
<a name="l01510"></a>01510                     <span class="keywordflow">if</span> lineCounter == 1 <span class="keywordflow">and</span> self.kw[<span class="stringliteral">&#39;has_header&#39;</span>] == 1:
<a name="l01511"></a>01511                         logging.info(<span class="stringliteral">&#39;Converted the first line in the input file into a comment because the pedigree file has a header row.&#39;</span>)
<a name="l01512"></a>01512                         <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span> <span class="keywordflow">and</span> self.kw[<span class="stringliteral">&#39;pedigree_summary&#39;</span>]:
<a name="l01513"></a>01513                             <span class="keywordflow">print</span> <span class="stringliteral">&#39;[INFO]: Converted the first line in the input file into a comment because the pedigree file has a header row.&#39;</span>
<a name="l01514"></a>01514             line = <span class="stringliteral">&#39;# %s&#39;</span> % ( line )
<a name="l01515"></a>01515                     <span class="comment"># Handle comment lines.</span>
<a name="l01516"></a>01516                     <span class="keywordflow">if</span> line[0] == <span class="stringliteral">&#39;#&#39;</span>:
<a name="l01517"></a>01517                         logging.info(<span class="stringliteral">&#39;Pedigree comment (line %s): %s&#39;</span>,lineCounter,string.strip(line))
<a name="l01518"></a>01518                         <span class="keywordflow">pass</span>
<a name="l01519"></a>01519                     <span class="comment"># Raise a warning if somebody is still using an old file with an embedded pedigree</span>
<a name="l01520"></a>01520                     <span class="comment"># format code.</span>
<a name="l01521"></a>01521                     <span class="keywordflow">elif</span> line[0] == <span class="stringliteral">&#39;%&#39;</span>:
<a name="l01522"></a>01522                         self.kw[<span class="stringliteral">&#39;old_pedformat&#39;</span>] = string.strip(line[1:]) <span class="comment"># this lets us specify the format of the pedigree file</span>
<a name="l01523"></a>01523                         logging.warning(<span class="stringliteral">&#39;Encountered deprecated pedigree format string (%s) on line %s of the pedigree file.&#39;</span>,line,lineCounter)
<a name="l01524"></a>01524                     <span class="comment"># Thomas von Hassel sent me a pedigree whose last line was blank but for a tab.  In</span>
<a name="l01525"></a>01525                     <span class="comment"># debugging that problem I realized that there was no check for null lines.  This &#39;elif&#39;</span>
<a name="l01526"></a>01526                     <span class="comment"># catches blank lines so that they are not treated as actuall records and logs them.</span>
<a name="l01527"></a>01527                     <span class="keywordflow">elif</span> len(string.strip(line)) == 0:
<a name="l01528"></a>01528                         logging.warning(<span class="stringliteral">&#39;Encountered an empty (blank) record on line %s of the pedigree file.&#39;</span>,lineCounter)
<a name="l01529"></a>01529                     <span class="keywordflow">else</span>:
<a name="l01530"></a>01530                         animalCounter = animalCounter + 1
<a name="l01531"></a>01531                         <span class="keywordflow">if</span> numpy.fmod(animalCounter,self.kw[<span class="stringliteral">&#39;counter&#39;</span>]) == 0:
<a name="l01532"></a>01532                             logging.info(<span class="stringliteral">&#39;Records read: %s &#39;</span>,animalCounter)
<a name="l01533"></a>01533                         <span class="comment"># string.strip()-ing line deals with problems from trailing sepchars,</span>
<a name="l01534"></a>01534                         <span class="comment"># most notably spaces. Is there a nice way to deal with the situation</span>
<a name="l01535"></a>01535                         <span class="comment"># of multiple sepchars with no data between them?</span>
<a name="l01536"></a>01536                         l = string.split(string.strip(line),self.kw[<span class="stringliteral">&#39;sepchar&#39;</span>])
<a name="l01537"></a>01537                         <span class="comment">#print l</span>
<a name="l01538"></a>01538                         <span class="comment"># I am adding in a check here to make sure that the number of fields</span>
<a name="l01539"></a>01539                         <span class="comment"># expected from the pedigree format string and the number of fields in</span>
<a name="l01540"></a>01540                         <span class="comment"># the datalines of the pedigree are the same.  If they are not, there is</span>
<a name="l01541"></a>01541                         <span class="comment"># a problem that the user needs to handle.</span>
<a name="l01542"></a>01542                         <span class="keywordflow">if</span> len(self.kw[<span class="stringliteral">&#39;pedformat&#39;</span>]) == len(l):
<a name="l01543"></a>01543                             self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#aab4ab96d9bbce43c2d7c09977bd82d9a">namemap</a> = {}
<a name="l01544"></a>01544                             self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#adb79d76cbccbc5c03edc64c116f3f43a">namebackmap</a> = {}
<a name="l01545"></a>01545                             <span class="comment">#print line</span>
<a name="l01546"></a>01546                             <span class="comment">#print l</span>
<a name="l01547"></a>01547                             <span class="comment"># Some people *cough* Brad Heins *cough* insist on sending me pedigree</span>
<a name="l01548"></a>01548                             <span class="comment"># files vomited out by Excel, which pads cells in a column with spaces</span>
<a name="l01549"></a>01549                             <span class="comment"># to right-align them...</span>
<a name="l01550"></a>01550                             <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(len(l)):
<a name="l01551"></a>01551                                 l[i] = string.strip(l[i])
<a name="l01552"></a>01552                             <span class="keywordflow">if</span> len(l) &lt; 3:
<a name="l01553"></a>01553                                 errorString = <span class="stringliteral">&#39;The record on line %s of file %s is too short - all records must contain animal, sire, and dam ID numbers (%s fields detected).\n&#39;</span> % (lineCounter,self.kw[<span class="stringliteral">&#39;pedfile&#39;</span>],len(l))
<a name="l01554"></a>01554                                 <span class="keywordflow">print</span> <span class="stringliteral">&#39;[ERROR]: %s&#39;</span> % (errorString)
<a name="l01555"></a>01555                                 <span class="keywordflow">print</span> <span class="stringliteral">&#39;[ERROR]: %s&#39;</span> % (line)
<a name="l01556"></a>01556                                 sys.exit(0)
<a name="l01557"></a>01557                             <span class="keywordflow">else</span>:
<a name="l01558"></a>01558                                 <span class="keywordflow">if</span> l[0] != self.kw[<span class="stringliteral">&#39;missing_parent&#39;</span>]:
<a name="l01559"></a>01559                                     <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;animal_type&#39;</span>] == <span class="stringliteral">&#39;light&#39;</span>:
<a name="l01560"></a>01560                                         an = LightAnimal(pedformat_locations,l,self.kw)
<a name="l01561"></a>01561                                     <span class="keywordflow">else</span>:
<a name="l01562"></a>01562                                         an = NewAnimal(pedformat_locations,l,self.kw)
<a name="l01563"></a>01563                                     <span class="comment">#print an.animalID,&#39; &#39;,an.sireID,&#39; &#39;,an.damID</span>
<a name="l01564"></a>01564                                     <span class="comment">#an.printme()</span>
<a name="l01565"></a>01565                                 <span class="keywordflow">else</span>:
<a name="l01566"></a>01566                                     errorString = <span class="stringliteral">&#39;The record on line %s of file %s has an animal ID that is the same as the missing value code specified for the pedigree. This animal is being skipped and will not have an entry in the pedigree.\n&#39;</span> % ( lineCounter, self.kw[<span class="stringliteral">&#39;pedfile&#39;</span>] )
<a name="l01567"></a>01567                                     <span class="keywordflow">print</span> <span class="stringliteral">&#39;[ERROR]: %s&#39;</span> % (errorString)
<a name="l01568"></a>01568                                     logging.error(errorString)
<a name="l01569"></a>01569                                 <span class="comment">#print &#39;Animal Name: &#39;, an.name</span>
<a name="l01570"></a>01570                                 <span class="comment"># If strings are used for sire and dam IDs we need</span>
<a name="l01571"></a>01571                                 <span class="comment"># to put the names in the _sires or _dams dictionary</span>
<a name="l01572"></a>01572                                 <span class="comment"># rather than the ID.  If we put in the IDs the</span>
<a name="l01573"></a>01573                                 <span class="comment"># missing sire and dam catcher code will not work</span>
<a name="l01574"></a>01574                                 <span class="comment"># correctly.</span>
<a name="l01575"></a>01575                                 <span class="comment">#print &#39;Animal ID: &#39;, an.animalID</span>
<a name="l01576"></a>01576                                 <span class="keywordflow">if</span> <span class="stringliteral">&#39;S&#39;</span> <span class="keywordflow">in</span> self.kw[<span class="stringliteral">&#39;pedformat&#39;</span>]:
<a name="l01577"></a>01577                                     <span class="keywordflow">if</span> an.sireName != self.kw[<span class="stringliteral">&#39;missing_name&#39;</span>]:
<a name="l01578"></a>01578                                         _sires[an.sireName] = an.sireName
<a name="l01579"></a>01579                                     <span class="keywordflow">else</span>:
<a name="l01580"></a>01580                                         <span class="comment">#print &#39;\tAnimal %s has sire %s&#39; % ( an.animalID, an.sireID )</span>
<a name="l01581"></a>01581                                         <span class="keywordflow">pass</span>
<a name="l01582"></a>01582                                 <span class="keywordflow">else</span>:
<a name="l01583"></a>01583                                     <span class="comment">#if str(an.sireID) != str(self.kw[&#39;missing_parent&#39;]):</span>
<a name="l01584"></a>01584                                     <span class="keywordflow">if</span> str(an.sireID) != str(self.kw[<span class="stringliteral">&#39;missing_parent&#39;</span>]):
<a name="l01585"></a>01585                                         _sires[an.sireID] = an.sireID
<a name="l01586"></a>01586                                 <span class="keywordflow">if</span> <span class="stringliteral">&#39;D&#39;</span> <span class="keywordflow">in</span> self.kw[<span class="stringliteral">&#39;pedformat&#39;</span>]:
<a name="l01587"></a>01587                                     <span class="keywordflow">if</span> an.damName != self.kw[<span class="stringliteral">&#39;missing_name&#39;</span>]:
<a name="l01588"></a>01588                                         _dams[an.damName] = an.damName
<a name="l01589"></a>01589                                     <span class="keywordflow">else</span>:
<a name="l01590"></a>01590                                         <span class="comment">#print &#39;\tAnimal %s has dam %s&#39; % ( an.animalID, an.damID )</span>
<a name="l01591"></a>01591                                         <span class="keywordflow">pass</span>
<a name="l01592"></a>01592                                 <span class="keywordflow">else</span>:
<a name="l01593"></a>01593                                     <span class="keywordflow">if</span> str(an.damID) != str(self.kw[<span class="stringliteral">&#39;missing_parent&#39;</span>]):
<a name="l01594"></a>01594                                         _dams[an.damID] = an.damID
<a name="l01595"></a>01595                                 <span class="comment">#print an.sireID</span>
<a name="l01596"></a>01596                                 <span class="comment">#print an.damID</span>
<a name="l01597"></a>01597                                 self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a28eed1e3039de3a74d2597d556ac831f">pedigree</a>.append(an)
<a name="l01598"></a>01598                                 <span class="comment"># If strings are used for animals names we need</span>
<a name="l01599"></a>01599                                 <span class="comment"># to put those names in idmap and backmap so that</span>
<a name="l01600"></a>01600                                 <span class="comment"># the missing sire and dam assignment code will</span>
<a name="l01601"></a>01601                                 <span class="comment"># work correctly.</span>
<a name="l01602"></a>01602                                 <span class="comment"># !!! Note that this is broken if you renumber</span>
<a name="l01603"></a>01603                                 <span class="comment"># the pedigree. In that case, use the namemap</span>
<a name="l01604"></a>01604                                 <span class="comment"># to map from name to original ID, and the</span>
<a name="l01605"></a>01605                                 <span class="comment"># backmap to go from the original ID to the</span>
<a name="l01606"></a>01606                                 <span class="comment"># renumbered ID.</span>
<a name="l01607"></a>01607                                 <span class="keywordflow">if</span> <span class="stringliteral">&#39;A&#39;</span> <span class="keywordflow">in</span> self.kw[<span class="stringliteral">&#39;pedformat&#39;</span>]:
<a name="l01608"></a>01608                                     self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#ae1358ecde62705c1e68fef7a1d943d7e">idmap</a>[an.name] = an.name
<a name="l01609"></a>01609                                     self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a6b8ebfe1128f217497e0604e450066db">backmap</a>[an.name] = an.name
<a name="l01610"></a>01610                                     <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;animal_type&#39;</span>] == <span class="stringliteral">&#39;new&#39;</span>:
<a name="l01611"></a>01611                                         self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#aab4ab96d9bbce43c2d7c09977bd82d9a">namemap</a>[an.name] = an.name
<a name="l01612"></a>01612                                         self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#adb79d76cbccbc5c03edc64c116f3f43a">namebackmap</a>[an.name] = an.name
<a name="l01613"></a>01613                                 <span class="keywordflow">else</span>:
<a name="l01614"></a>01614                                     self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#ae1358ecde62705c1e68fef7a1d943d7e">idmap</a>[an.animalID] = an.animalID
<a name="l01615"></a>01615                                     self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a6b8ebfe1128f217497e0604e450066db">backmap</a>[an.animalID] = an.animalID
<a name="l01616"></a>01616                                     <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;animal_type&#39;</span>] == <span class="stringliteral">&#39;new&#39;</span>:
<a name="l01617"></a>01617                                         self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#aab4ab96d9bbce43c2d7c09977bd82d9a">namemap</a>[an.name] = an.animalID
<a name="l01618"></a>01618                                         self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#adb79d76cbccbc5c03edc64c116f3f43a">namebackmap</a>[an.animalID] = an.name
<a name="l01619"></a>01619                         <span class="keywordflow">else</span>:
<a name="l01620"></a>01620                             errorString = <span class="stringliteral">&#39;The record on line %s of file %s has %s columns, but the pedigree format string (%s) says that it should have %s columns. Please check your pedigree file and the pedigree format string for errors.\n&#39;</span> % ( lineCounter, self.kw[<span class="stringliteral">&#39;pedfile&#39;</span>], len(l), \
<a name="l01621"></a>01621                             self.kw[<span class="stringliteral">&#39;pedformat&#39;</span>], len(self.kw[<span class="stringliteral">&#39;pedformat&#39;</span>]) )
<a name="l01622"></a>01622                             <span class="keywordflow">print</span> <span class="stringliteral">&#39;[ERROR]: %s&#39;</span> % (errorString)
<a name="l01623"></a>01623                             logging.error(errorString)
<a name="l01624"></a>01624                             sys.exit(0)
<a name="l01625"></a>01625             <span class="comment">#</span>
<a name="l01626"></a>01626             <span class="comment"># This is where we deal with parents with no pedigree file entry.</span>
<a name="l01627"></a>01627             <span class="comment"># Things are kind of tricky when we are working with the S and D</span>
<a name="l01628"></a>01628             <span class="comment"># codes.</span>
<a name="l01629"></a>01629             <span class="comment">#</span>
<a name="l01630"></a>01630             _null_locations = pedformat_locations
<a name="l01631"></a>01631             <span class="keywordflow">for</span> _n <span class="keywordflow">in</span> _null_locations.keys():
<a name="l01632"></a>01632                 _null_locations[_n] = -999
<a name="l01633"></a>01633             _null_locations[<span class="stringliteral">&#39;animal&#39;</span>] = 0
<a name="l01634"></a>01634             _null_locations[<span class="stringliteral">&#39;sire&#39;</span>] = 1
<a name="l01635"></a>01635             _null_locations[<span class="stringliteral">&#39;dam&#39;</span>] = 2
<a name="l01636"></a>01636             <span class="comment">#print _null_locations</span>
<a name="l01637"></a>01637             <span class="comment">#print &#39;INFO: idmap = %s&#39; % (self.idmap)</span>
<a name="l01638"></a>01638             <span class="comment">#print &#39;INFO: _sires = %s&#39; % (_sires)</span>
<a name="l01639"></a>01639             <span class="comment">#print &#39;INFO: _dams = %s&#39; % (_dams)</span>
<a name="l01640"></a>01640             <span class="keywordflow">for</span> _s <span class="keywordflow">in</span> _sires.keys():
<a name="l01641"></a>01641                 <span class="keywordflow">try</span>:
<a name="l01642"></a>01642                     _i = self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#ae1358ecde62705c1e68fef7a1d943d7e">idmap</a>[_s]
<a name="l01643"></a>01643                 <span class="keywordflow">except</span> KeyError:
<a name="l01644"></a>01644                     <span class="keywordflow">if</span> ( <span class="stringliteral">&#39;S&#39;</span> <span class="keywordflow">in</span> self.kw[<span class="stringliteral">&#39;pedformat&#39;</span>] <span class="keywordflow">and</span> str(_s) != str(self.kw[<span class="stringliteral">&#39;missing_name&#39;</span>]) ) <span class="keywordflow">or</span> ( <span class="stringliteral">&#39;s&#39;</span> <span class="keywordflow">in</span> self.kw[<span class="stringliteral">&#39;pedformat&#39;</span>] <span class="keywordflow">and</span> str(_s) != str(self.kw[<span class="stringliteral">&#39;missing_parent&#39;</span>]) ):
<a name="l01645"></a>01645                         <span class="keywordflow">print</span> <span class="stringliteral">&#39;[NOTE]: Adding sire %s to the pedigree&#39;</span> % ( _s )
<a name="l01646"></a>01646                         an = NewAnimal(_null_locations,[_s,self.kw[<span class="stringliteral">&#39;missing_parent&#39;</span>],self.kw[<span class="stringliteral">&#39;missing_parent&#39;</span>]],self.kw)
<a name="l01647"></a>01647                         <span class="comment">#an.printme()</span>
<a name="l01648"></a>01648                         self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a28eed1e3039de3a74d2597d556ac831f">pedigree</a>.append(an)
<a name="l01649"></a>01649                         self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#ae1358ecde62705c1e68fef7a1d943d7e">idmap</a>[an.animalID] = an.animalID
<a name="l01650"></a>01650                         self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a6b8ebfe1128f217497e0604e450066db">backmap</a>[an.animalID] = an.animalID
<a name="l01651"></a>01651                         self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#aab4ab96d9bbce43c2d7c09977bd82d9a">namemap</a>[an.name] = an.animalID
<a name="l01652"></a>01652                         self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#adb79d76cbccbc5c03edc64c116f3f43a">namebackmap</a>[an.animalID] = an.name
<a name="l01653"></a>01653                         logging.info(<span class="stringliteral">&#39;Added pedigree entry for sire %s&#39;</span> % (_s))
<a name="l01654"></a>01654                         <span class="keywordflow">print</span> <span class="stringliteral">&#39;[NOTE]: Added pedigree entry for sire %s&#39;</span> % (_s)
<a name="l01655"></a>01655             <span class="keywordflow">for</span> _d <span class="keywordflow">in</span> _dams.keys():
<a name="l01656"></a>01656                 <span class="keywordflow">try</span>:
<a name="l01657"></a>01657                     _i = self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#ae1358ecde62705c1e68fef7a1d943d7e">idmap</a>[_d]
<a name="l01658"></a>01658                 <span class="keywordflow">except</span> KeyError:
<a name="l01659"></a>01659                     <span class="keywordflow">if</span> ( <span class="stringliteral">&#39;D&#39;</span> <span class="keywordflow">in</span> self.kw[<span class="stringliteral">&#39;pedformat&#39;</span>] <span class="keywordflow">and</span> str(_d) != str(self.kw[<span class="stringliteral">&#39;missing_name&#39;</span>]) ) <span class="keywordflow">or</span> ( <span class="stringliteral">&#39;d&#39;</span> <span class="keywordflow">in</span> self.kw[<span class="stringliteral">&#39;pedformat&#39;</span>] <span class="keywordflow">and</span> str(_d) != str(self.kw[<span class="stringliteral">&#39;missing_parent&#39;</span>]) ):
<a name="l01660"></a>01660                         an = NewAnimal(_null_locations,[_d,self.kw[<span class="stringliteral">&#39;missing_parent&#39;</span>],self.kw[<span class="stringliteral">&#39;missing_parent&#39;</span>]],self.kw)
<a name="l01661"></a>01661     <span class="comment">#                    an.printme()</span>
<a name="l01662"></a>01662                         self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a28eed1e3039de3a74d2597d556ac831f">pedigree</a>.append(an)
<a name="l01663"></a>01663                         self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#ae1358ecde62705c1e68fef7a1d943d7e">idmap</a>[an.animalID] = an.animalID
<a name="l01664"></a>01664                         self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a6b8ebfe1128f217497e0604e450066db">backmap</a>[an.animalID] = an.animalID
<a name="l01665"></a>01665                         self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#aab4ab96d9bbce43c2d7c09977bd82d9a">namemap</a>[an.name] = an.animalID
<a name="l01666"></a>01666                         self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#adb79d76cbccbc5c03edc64c116f3f43a">namebackmap</a>[an.animalID] = an.name
<a name="l01667"></a>01667                         logging.info(<span class="stringliteral">&#39;Added pedigree entry for dam %s&#39;</span> % (_d))
<a name="l01668"></a>01668                         <span class="keywordflow">print</span> <span class="stringliteral">&#39;[NOTE]: Added pedigree entry for dam %s&#39;</span> % (_d)
<a name="l01669"></a>01669             <span class="comment">#</span>
<a name="l01670"></a>01670             <span class="comment"># Finish up.</span>
<a name="l01671"></a>01671             <span class="comment">#</span>
<a name="l01672"></a>01672             logging.info(<span class="stringliteral">&#39;Closing pedigree file&#39;</span>)
<a name="l01673"></a>01673             <span class="keywordflow">if</span> textstream == <span class="stringliteral">&#39;&#39;</span> <span class="keywordflow">and</span> dbstream == <span class="stringliteral">&#39;&#39;</span>:
<a name="l01674"></a>01674                 infile.close()
<a name="l01675"></a>01675             <span class="keywordflow">elif</span> textstream == <span class="stringliteral">&#39;&#39;</span>:
<a name="l01676"></a>01676                 del dbstream
<a name="l01677"></a>01677                 del infile
<a name="l01678"></a>01678             <span class="keywordflow">else</span>:
<a name="l01679"></a>01679                 del textstream
<a name="l01680"></a>01680                 del infile
<a name="l01681"></a>01681 
<a name="l01682"></a>01682     <span class="comment">##</span>
<a name="l01683"></a>01683     <span class="comment"># fromgraph() loads the animals to populate the pedigree from a</span>
<a name="l01684"></a>01684     <span class="comment"># DiGraph object.</span>
<a name="l01685"></a>01685     <span class="comment"># @param self Reference to current object.</span>
<a name="l01686"></a>01686     <span class="comment"># @param pedgraph DiGraph object containing a pedigree.</span>
<a name="l01687"></a>01687     <span class="comment"># @retval None</span>
<a name="l01688"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a9d014c1ead82bb6abe3085058086194a">01688</a>     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a9d014c1ead82bb6abe3085058086194a" title="fromgraph() loads the animals to populate the pedigree from a DiGraph object.">fromgraph</a>(self, pedgraph):
<a name="l01689"></a>01689         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l01690"></a>01690 <span class="stringliteral">        fromgraph() loads the animals to populate the pedigree from an</span>
<a name="l01691"></a>01691 <span class="stringliteral">        DiGraph object.</span>
<a name="l01692"></a>01692 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l01693"></a>01693         missing = [<span class="stringliteral">&#39;sex&#39;</span>,<span class="stringliteral">&#39;generation&#39;</span>,<span class="stringliteral">&#39;gencoeff&#39;</span>,<span class="stringliteral">&#39;birthyear&#39;</span>,    \
<a name="l01694"></a>01694             <span class="stringliteral">&#39;inbreeding&#39;</span>,<span class="stringliteral">&#39;breed&#39;</span>,<span class="stringliteral">&#39;name&#39;</span>,<span class="stringliteral">&#39;birthdate&#39;</span>,<span class="stringliteral">&#39;alive&#39;</span>,<span class="stringliteral">&#39;age&#39;</span>, \
<a name="l01695"></a>01695             <span class="stringliteral">&#39;alleles&#39;</span>,<span class="stringliteral">&#39;herd&#39;</span>,<span class="stringliteral">&#39;userfield&#39;</span>]
<a name="l01696"></a>01696         pedformat_locations = {}
<a name="l01697"></a>01697         pedformat_locations[<span class="stringliteral">&#39;animal&#39;</span>] = 0
<a name="l01698"></a>01698         pedformat_locations[<span class="stringliteral">&#39;sire&#39;</span>] = 1
<a name="l01699"></a>01699         pedformat_locations[<span class="stringliteral">&#39;dam&#39;</span>] = 2
<a name="l01700"></a>01700         <span class="keywordflow">for</span> _m <span class="keywordflow">in</span> missing:
<a name="l01701"></a>01701             pedformat_locations[_m] = -999
<a name="l01702"></a>01702         <span class="keywordflow">for</span> _n <span class="keywordflow">in</span> pedgraph.nodes():
<a name="l01703"></a>01703         <span class="comment"># print pedgraph.node[_n]</span>
<a name="l01704"></a>01704         <span class="comment"># print &#39;sire: &#39;, pedgraph.node[_n][&#39;sire&#39;]</span>
<a name="l01705"></a>01705         <span class="comment"># print &#39;dam:  &#39;, pedgraph.node[_n][&#39;dam&#39;]</span>
<a name="l01706"></a>01706         _s =  pedgraph.node[_n][<span class="stringliteral">&#39;sire&#39;</span>]
<a name="l01707"></a>01707             _d =  pedgraph.node[_n][<span class="stringliteral">&#39;dam&#39;</span>]
<a name="l01708"></a>01708             an = NewAnimal(pedformat_locations,[_n,_s,_d],self.kw)
<a name="l01709"></a>01709             self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a28eed1e3039de3a74d2597d556ac831f">pedigree</a>.append(an)
<a name="l01710"></a>01710             self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#ae1358ecde62705c1e68fef7a1d943d7e">idmap</a>[an.animalID] = an.animalID
<a name="l01711"></a>01711             self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a6b8ebfe1128f217497e0604e450066db">backmap</a>[an.animalID] = an.animalID
<a name="l01712"></a>01712             self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#aab4ab96d9bbce43c2d7c09977bd82d9a">namemap</a>[an.name] = an.animalID
<a name="l01713"></a>01713             self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#adb79d76cbccbc5c03edc64c116f3f43a">namebackmap</a>[an.animalID] = an.name
<a name="l01714"></a>01714             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;debug_messages&#39;</span>] &gt; 0:
<a name="l01715"></a>01715                 logging.info(<span class="stringliteral">&#39;Added pedigree entry for animal %s&#39;</span> % (_n))
<a name="l01716"></a>01716 
<a name="l01717"></a>01717     <span class="comment">##</span>
<a name="l01718"></a>01718     <span class="comment"># fromnull() creates a new pedigree with no animal records in it.</span>
<a name="l01719"></a>01719     <span class="comment"># @param self Reference to current object</span>
<a name="l01720"></a>01720     <span class="comment"># @retval None</span>
<a name="l01721"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a93805b88a410473cb9dda5457d46a61d">01721</a>     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a93805b88a410473cb9dda5457d46a61d" title="fromnull() creates a new pedigree with no animal records in it.">fromnull</a>(self):
<a name="l01722"></a>01722         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l01723"></a>01723 <span class="stringliteral">         fromnull() creates a new pedigree with no animal records in it.</span>
<a name="l01724"></a>01724 <span class="stringliteral">    &quot;&quot;&quot;</span>
<a name="l01725"></a>01725     <span class="comment"># Let&#39;s see if it&#39;s this easy!</span>
<a name="l01726"></a>01726         logging.info(<span class="stringliteral">&#39;Created a null (empty) pedigree.&#39;</span>)
<a name="l01727"></a>01727     <span class="keywordflow">return</span> <span class="keyword">True</span>
<a name="l01728"></a>01728 
<a name="l01729"></a>01729 
<a name="l01730"></a>01730     <span class="comment">##</span>
<a name="l01731"></a>01731     <span class="comment"># fromanimallist() populates a NewPedigree with instances of NewAnimal objects.</span>
<a name="l01732"></a>01732     <span class="comment"># @param self Reference to current object.</span>
<a name="l01733"></a>01733     <span class="comment"># @param animallist A list of instances of NewAnimals.</span>
<a name="l01734"></a>01734     <span class="comment"># @retval None</span>
<a name="l01735"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a707dc2388b0f0e5f740d4e82738c149c">01735</a>     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a707dc2388b0f0e5f740d4e82738c149c" title="fromanimallist() populates a NewPedigree with instances of NewAnimal objects.">fromanimallist</a>(self, animallist):
<a name="l01736"></a>01736         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l01737"></a>01737 <span class="stringliteral">        fromanimallist() populates a NewPedigree with instances of NewAnimal objects.</span>
<a name="l01738"></a>01738 <span class="stringliteral">    &quot;&quot;&quot;</span>
<a name="l01739"></a>01739     <span class="keywordflow">if</span> len(animallist) &gt; 0:
<a name="l01740"></a>01740             <span class="comment"># There is a lingering issue here with the pedformat. For now, we&#39;re</span>
<a name="l01741"></a>01741         <span class="comment"># going to use my terribly clever pedformat guesser to figure it out.</span>
<a name="l01742"></a>01742             self.kw[<span class="stringliteral">&#39;pedformat&#39;</span>] = pyp_utils.guess_pedformat(animallist[0], self.kw)
<a name="l01743"></a>01743             <span class="keywordflow">for</span> an <span class="keywordflow">in</span> animallist:
<a name="l01744"></a>01744                 <span class="keywordflow">if</span> an.__class__.__name__ == <span class="stringliteral">&#39;NewAnimal&#39;</span>:
<a name="l01745"></a>01745                     self.pedigree.append(an)
<a name="l01746"></a>01746                     self.idmap[an.animalID] = an.animalID
<a name="l01747"></a>01747                     self.backmap[an.animalID] = an.animalID
<a name="l01748"></a>01748                     self.namemap[an.name] = an.animalID
<a name="l01749"></a>01749                     self.namebackmap[an.animalID] = an.name
<a name="l01750"></a>01750         <span class="keywordflow">else</span>:
<a name="l01751"></a>01751                     logging.error(<span class="stringliteral">&#39;An entry in the animallist was not a NewAnimal object, skipping!&#39;</span>)
<a name="l01752"></a>01752                 <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;debug_messages&#39;</span>] &gt; 0:
<a name="l01753"></a>01753                     logging.info(<span class="stringliteral">&#39;Added pedigree entry for animal %s&#39;</span> % (animal.originalID))
<a name="l01754"></a>01754         <span class="keywordflow">else</span>:
<a name="l01755"></a>01755             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>]:
<a name="l01756"></a>01756                 <span class="keywordflow">print</span> <span class="stringliteral">&#39;[ERROR]: Could not create a pedigree from an empty animal list!&#39;</span>
<a name="l01757"></a>01757             logging.error(<span class="stringliteral">&#39;Could not create a pedigree from an empty animal list!&#39;</span>)
<a name="l01758"></a>01758             <span class="keywordflow">return</span> <span class="keyword">False</span>
<a name="l01759"></a>01759 
<a name="l01760"></a>01760 
<a name="l01761"></a>01761     <span class="comment">##</span>
<a name="l01762"></a>01762     <span class="comment"># tostream() creates a text stream from a pedigree.</span>
<a name="l01763"></a>01763     <span class="comment"># @param self Reference to current object.</span>
<a name="l01764"></a>01764     <span class="comment"># @retval None</span>
<a name="l01765"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a7b8f4dca3f231f6d487fee90e38e21c7">01765</a>     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a7b8f4dca3f231f6d487fee90e38e21c7" title="tostream() creates a text stream from a pedigree.">tostream</a>(self):
<a name="l01766"></a>01766         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l01767"></a>01767 <span class="stringliteral">        tostream() creates a text stream from a pedigree.</span>
<a name="l01768"></a>01768 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l01769"></a>01769         streamout = <span class="stringliteral">&#39;&#39;</span>
<a name="l01770"></a>01770         <span class="keywordflow">try</span>:
<a name="l01771"></a>01771             <span class="keywordflow">for</span> p <span class="keywordflow">in</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a28eed1e3039de3a74d2597d556ac831f">pedigree</a>:
<a name="l01772"></a>01772                 an = p.name
<a name="l01773"></a>01773                 si = p.sireName
<a name="l01774"></a>01774                 da = p.damName
<a name="l01775"></a>01775                 <span class="keywordflow">if</span> si == self.kw[<span class="stringliteral">&#39;missing_name&#39;</span>]:
<a name="l01776"></a>01776                     si = self.kw[<span class="stringliteral">&#39;missing_parent&#39;</span>]
<a name="l01777"></a>01777                 <span class="keywordflow">if</span> da == self.kw[<span class="stringliteral">&#39;missing_name&#39;</span>]:
<a name="l01778"></a>01778                     da = self.kw[<span class="stringliteral">&#39;missing_parent&#39;</span>]
<a name="l01779"></a>01779                 streamout = <span class="stringliteral">&#39;%s%s,%s,%s\\n&#39;</span> % ( streamout, an, si, da )
<a name="l01780"></a>01780             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span>:
<a name="l01781"></a>01781                 <span class="keywordflow">print</span> <span class="stringliteral">&#39;[INFO]: Created text stream from pedigree.&#39;</span>
<a name="l01782"></a>01782             logging.info(<span class="stringliteral">&#39;Created text stream from pedigree.&#39;</span>)
<a name="l01783"></a>01783         <span class="keywordflow">except</span>:
<a name="l01784"></a>01784             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span>:
<a name="l01785"></a>01785                 <span class="keywordflow">print</span> <span class="stringliteral">&#39;[ERROR]: Could not create text stream from pedigree!&#39;</span>
<a name="l01786"></a>01786             logging.error(<span class="stringliteral">&#39;Could not create text stream from pedigree!&#39;</span>)
<a name="l01787"></a>01787         <span class="keywordflow">return</span> streamout
<a name="l01788"></a>01788 
<a name="l01789"></a>01789     <span class="comment">##</span>
<a name="l01790"></a>01790     <span class="comment"># renumber() updates the ID map after a pedigree has been renumbered so that all references</span>
<a name="l01791"></a>01791     <span class="comment"># are to renumbered rather than original IDs.</span>
<a name="l01792"></a>01792     <span class="comment"># @param self Reference to current object</span>
<a name="l01793"></a>01793     <span class="comment"># @retval None</span>
<a name="l01794"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#aef198ff1c3c2ac1c666486deb2d2e92a">01794</a>     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#aef198ff1c3c2ac1c666486deb2d2e92a" title="renumber() updates the ID map after a pedigree has been renumbered so that all references are to renu...">renumber</a>(self):
<a name="l01795"></a>01795         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l01796"></a>01796 <span class="stringliteral">        renumber() updates the ID map after a pedigree has been renumbered so that all</span>
<a name="l01797"></a>01797 <span class="stringliteral">        references are to renumbered rather than original IDs.</span>
<a name="l01798"></a>01798 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l01799"></a>01799         <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span> <span class="keywordflow">and</span> self.kw[<span class="stringliteral">&#39;pedigree_summary&#39;</span>]:
<a name="l01800"></a>01800             <span class="keywordflow">print</span> <span class="stringliteral">&#39;\t[INFO]: Renumbering pedigree at %s&#39;</span> % ( pyp_utils.pyp_nice_time() )
<a name="l01801"></a>01801             <span class="keywordflow">print</span> <span class="stringliteral">&#39;\t\t[INFO]: Reordering pedigree at %s&#39;</span> % ( pyp_utils.pyp_nice_time() )
<a name="l01802"></a>01802         logging.info(<span class="stringliteral">&#39;Reordering pedigree&#39;</span>)
<a name="l01803"></a>01803         <span class="keywordflow">if</span> ( <span class="stringliteral">&#39;b&#39;</span> <span class="keywordflow">in</span> self.kw[<span class="stringliteral">&#39;pedformat&#39;</span>] <span class="keywordflow">or</span> <span class="stringliteral">&#39;y&#39;</span> <span class="keywordflow">in</span> self.kw[<span class="stringliteral">&#39;pedformat&#39;</span>] ) <span class="keywordflow">and</span> <span class="keywordflow">not</span> self.kw[<span class="stringliteral">&#39;slow_reorder&#39;</span>]:
<a name="l01804"></a>01804             self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a28eed1e3039de3a74d2597d556ac831f">pedigree</a> = pyp_utils.fast_reorder(self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a28eed1e3039de3a74d2597d556ac831f">pedigree</a>)
<a name="l01805"></a>01805         <span class="keywordflow">else</span>:
<a name="l01806"></a>01806             self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a28eed1e3039de3a74d2597d556ac831f">pedigree</a> = pyp_utils.reorder(self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a28eed1e3039de3a74d2597d556ac831f">pedigree</a>,missingparent=self.kw[<span class="stringliteral">&#39;missing_parent&#39;</span>],max_rounds=self.kw[<span class="stringliteral">&#39;reorder_max_rounds&#39;</span>])
<a name="l01807"></a>01807         <span class="comment">#self.pedigree = pyp_utils.reorder(self.pedigree,missingparent=self.kw[&#39;missing_parent&#39;],max_rounds=self.kw[&#39;reorder_max_rounds&#39;])</span>
<a name="l01808"></a>01808         <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span> <span class="keywordflow">and</span> self.kw[<span class="stringliteral">&#39;pedigree_summary&#39;</span>]:
<a name="l01809"></a>01809             <span class="keywordflow">print</span> <span class="stringliteral">&#39;\t\t[INFO]: Renumbering at %s&#39;</span> % ( pyp_utils.pyp_nice_time() )
<a name="l01810"></a>01810         logging.info(<span class="stringliteral">&#39;Renumbering pedigree&#39;</span>)
<a name="l01811"></a>01811         self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a28eed1e3039de3a74d2597d556ac831f">pedigree</a> = pyp_utils.renumber(self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a28eed1e3039de3a74d2597d556ac831f">pedigree</a>,missingparent=self.kw[<span class="stringliteral">&#39;missing_parent&#39;</span>],animaltype=self.kw[<span class="stringliteral">&#39;animal_type&#39;</span>])
<a name="l01812"></a>01812         <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span> <span class="keywordflow">and</span> self.kw[<span class="stringliteral">&#39;pedigree_summary&#39;</span>]:
<a name="l01813"></a>01813             <span class="keywordflow">print</span> <span class="stringliteral">&#39;\t\t[INFO]: Updating ID map at %s&#39;</span> % ( pyp_utils.pyp_nice_time() )
<a name="l01814"></a>01814         logging.info(<span class="stringliteral">&#39;Updating ID map&#39;</span>)
<a name="l01815"></a>01815         self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a5f2e95dd43e8bf2b4bfa2907eebd62a1" title="updateidmap() updates the ID map after a pedigree has been renumbered so that all references are to r...">updateidmap</a>()
<a name="l01816"></a>01816 
<a name="l01817"></a>01817         <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span> <span class="keywordflow">and</span> self.kw[<span class="stringliteral">&#39;pedigree_summary&#39;</span>]:
<a name="l01818"></a>01818             <span class="keywordflow">print</span> <span class="stringliteral">&#39;\t[INFO]: Assigning offspring at %s&#39;</span> % ( pyp_utils.pyp_nice_time() )
<a name="l01819"></a>01819         logging.info(<span class="stringliteral">&#39;Assigning offspring&#39;</span>)
<a name="l01820"></a>01820         pyp_utils.assign_offspring(self)
<a name="l01821"></a>01821         self.kw[<span class="stringliteral">&#39;pedigree_is_renumbered&#39;</span>] = 1
<a name="l01822"></a>01822         self.kw[<span class="stringliteral">&#39;assign_offspring&#39;</span>] = 1
<a name="l01823"></a>01823 
<a name="l01824"></a>01824     <span class="comment">##</span>
<a name="l01825"></a>01825     <span class="comment"># addanimal() adds a new animal of class NewAnimal to the pedigree.</span>
<a name="l01826"></a>01826     <span class="comment"># @param self Reference to current object.</span>
<a name="l01827"></a>01827     <span class="comment"># @param animalID ID of the new animal to be added to the pedigree.</span>
<a name="l01828"></a>01828     <span class="comment"># @param sireID Sire ID of the new animal to be added to the pedigree.</span>
<a name="l01829"></a>01829     <span class="comment"># @param damID Dam ID of the new animal to be added to the pedigree.</span>
<a name="l01830"></a>01830     <span class="comment"># @retval 1 on success, 0 on failure</span>
<a name="l01831"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a6537e2f0a419e0736b500c560b9f6194">01831</a>     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a6537e2f0a419e0736b500c560b9f6194" title="addanimal() adds a new animal of class NewAnimal to the pedigree.">addanimal</a>(self, animalID, sireID, damID):
<a name="l01832"></a>01832         <span class="comment">#print &#39;animalID: &#39;, animalID</span>
<a name="l01833"></a>01833         <span class="comment">#print &#39;sireID: &#39;, sireID</span>
<a name="l01834"></a>01834         <span class="comment">#print &#39;damID: &#39;, damID</span>
<a name="l01835"></a>01835         _added = 0
<a name="l01836"></a>01836         <span class="keywordflow">if</span> <span class="keywordflow">not</span> self.kw[<span class="stringliteral">&#39;pedigree_is_renumbered&#39;</span>]:
<a name="l01837"></a>01837             logging.warning(<span class="stringliteral">&#39;Adding an animal to an unrenumbered pedigree using NewPedigree::addanimal() is unsafe!&#39;</span>)
<a name="l01838"></a>01838         <span class="keywordflow">try</span>:
<a name="l01839"></a>01839             missing = [<span class="stringliteral">&#39;sex&#39;</span>,<span class="stringliteral">&#39;generation&#39;</span>,<span class="stringliteral">&#39;gencoeff&#39;</span>,<span class="stringliteral">&#39;birthyear&#39;</span>,    \
<a name="l01840"></a>01840                 <span class="stringliteral">&#39;inbreeding&#39;</span>,<span class="stringliteral">&#39;breed&#39;</span>,<span class="stringliteral">&#39;name&#39;</span>,<span class="stringliteral">&#39;birthdate&#39;</span>,<span class="stringliteral">&#39;alive&#39;</span>,<span class="stringliteral">&#39;age&#39;</span>, \
<a name="l01841"></a>01841                 <span class="stringliteral">&#39;alleles&#39;</span>,<span class="stringliteral">&#39;herd&#39;</span>,<span class="stringliteral">&#39;userfield&#39;</span>]
<a name="l01842"></a>01842             pedformat_locations = {}
<a name="l01843"></a>01843             pedformat_locations[<span class="stringliteral">&#39;animal&#39;</span>] = 0
<a name="l01844"></a>01844             pedformat_locations[<span class="stringliteral">&#39;sire&#39;</span>] = 1
<a name="l01845"></a>01845             pedformat_locations[<span class="stringliteral">&#39;dam&#39;</span>] = 2
<a name="l01846"></a>01846             <span class="keywordflow">for</span> _m <span class="keywordflow">in</span> missing:
<a name="l01847"></a>01847                 pedformat_locations[_m] = -999
<a name="l01848"></a>01848             l = []
<a name="l01849"></a>01849             l.append(animalID)
<a name="l01850"></a>01850             <span class="keywordflow">if</span> sireID == 0:
<a name="l01851"></a>01851                 l.append(self.kw[<span class="stringliteral">&#39;missing_parent&#39;</span>])
<a name="l01852"></a>01852             <span class="keywordflow">elif</span> <span class="stringliteral">&#39;S&#39;</span> <span class="keywordflow">in</span> self.kw[<span class="stringliteral">&#39;pedformat&#39;</span>]:
<a name="l01853"></a>01853                 <span class="comment">#l.append(self.namebackmap[sireID])</span>
<a name="l01854"></a>01854                 l.append(self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#adb79d76cbccbc5c03edc64c116f3f43a">namebackmap</a>[self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a6b8ebfe1128f217497e0604e450066db">backmap</a>[sireID]])
<a name="l01855"></a>01855             <span class="keywordflow">else</span>:
<a name="l01856"></a>01856                 l.append(str(sireID))
<a name="l01857"></a>01857             <span class="keywordflow">if</span> damID == 0:
<a name="l01858"></a>01858                 l.append(self.kw[<span class="stringliteral">&#39;missing_parent&#39;</span>])
<a name="l01859"></a>01859             <span class="keywordflow">elif</span> <span class="stringliteral">&#39;D&#39;</span> <span class="keywordflow">in</span> self.kw[<span class="stringliteral">&#39;pedformat&#39;</span>]:
<a name="l01860"></a>01860                 <span class="comment">#l.append(self.namebackmap[damID])</span>
<a name="l01861"></a>01861                 l.append(self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#adb79d76cbccbc5c03edc64c116f3f43a">namebackmap</a>[self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a6b8ebfe1128f217497e0604e450066db">backmap</a>[damID]])
<a name="l01862"></a>01862             <span class="keywordflow">else</span>:
<a name="l01863"></a>01863                 l.append(str(damID))
<a name="l01864"></a>01864             <span class="comment"># This is a hack. When the ASD format is used,</span>
<a name="l01865"></a>01865             <span class="comment"># NewAnimal::__init__() will hash the animal</span>
<a name="l01866"></a>01866             <span class="comment"># ID we pass it unless we have some way of</span>
<a name="l01867"></a>01867             <span class="comment"># telling it that this particular animal</span>
<a name="l01868"></a>01868             <span class="comment"># should be handled in a way that is different</span>
<a name="l01869"></a>01869             <span class="comment"># from that specified in the pedformat.</span>
<a name="l01870"></a>01870             self.kw[<span class="stringliteral">&#39;newanimal_caller&#39;</span>] = <span class="stringliteral">&#39;addanimal&#39;</span>
<a name="l01871"></a>01871             an = NewAnimal(pedformat_locations,l,self.kw)
<a name="l01872"></a>01872             self.kw[<span class="stringliteral">&#39;newanimal_caller&#39;</span>] = <span class="stringliteral">&#39;loader&#39;</span>
<a name="l01873"></a>01873             self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a28eed1e3039de3a74d2597d556ac831f">pedigree</a>.append(an)
<a name="l01874"></a>01874 
<a name="l01875"></a>01875             <span class="comment"># If the pedigree is renumbered, we need to</span>
<a name="l01876"></a>01876             <span class="comment"># renumber the new animal or we&#39;ll get index</span>
<a name="l01877"></a>01877             <span class="comment"># out of range errors.</span>
<a name="l01878"></a>01878             <span class="comment">#print &#39;animalID: &#39;, an.animalID</span>
<a name="l01879"></a>01879             an.animalID = max(self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#ae1358ecde62705c1e68fef7a1d943d7e">idmap</a>.values()) + 1
<a name="l01880"></a>01880             an.renumberedID = an.animalID
<a name="l01881"></a>01881             <span class="keywordflow">if</span> <span class="stringliteral">&#39;n&#39;</span> <span class="keywordflow">in</span> self.kw[<span class="stringliteral">&#39;pedformat&#39;</span>]:
<a name="l01882"></a>01882                 an.name = self.kw[<span class="stringliteral">&#39;missing_name&#39;</span>]
<a name="l01883"></a>01883             <span class="keywordflow">if</span> an.name == an.originalID:
<a name="l01884"></a>01884                 an.name = an.renumberedID
<a name="l01885"></a>01885             an.sireID = self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#ae1358ecde62705c1e68fef7a1d943d7e">idmap</a>[an.sireID]
<a name="l01886"></a>01886             an.damID = self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#ae1358ecde62705c1e68fef7a1d943d7e">idmap</a>[an.damID]
<a name="l01887"></a>01887             <span class="comment"># Now update the various ID and name maps</span>
<a name="l01888"></a>01888             self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#ae1358ecde62705c1e68fef7a1d943d7e">idmap</a>[an.originalID] = an.animalID
<a name="l01889"></a>01889             self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a6b8ebfe1128f217497e0604e450066db">backmap</a>[an.animalID] = an.originalID
<a name="l01890"></a>01890             self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#aab4ab96d9bbce43c2d7c09977bd82d9a">namemap</a>[an.name] = an.originalID
<a name="l01891"></a>01891             self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#adb79d76cbccbc5c03edc64c116f3f43a">namebackmap</a>[an.originalID] = an.name
<a name="l01892"></a>01892             <span class="comment">#print self.idmap</span>
<a name="l01893"></a>01893             _added = 1
<a name="l01894"></a>01894         <span class="keywordflow">except</span>:
<a name="l01895"></a>01895             _added = 0
<a name="l01896"></a>01896         <span class="keywordflow">return</span> _added
<a name="l01897"></a>01897 
<a name="l01898"></a>01898     <span class="comment">##</span>
<a name="l01899"></a>01899     <span class="comment"># delanimal() deletes an animal from the pedigree. Note that this</span>
<a name="l01900"></a>01900     <span class="comment"># method DOES not update the metadata attached to the pedigree</span>
<a name="l01901"></a>01901     <span class="comment"># and should only be used if that is not important. As of 04/10/2006</span>
<a name="l01902"></a>01902     <span class="comment"># delanimal() is intended for use by pyp_metrics/mating_coi() rather</span>
<a name="l01903"></a>01903     <span class="comment"># than directly by users.</span>
<a name="l01904"></a>01904     <span class="comment"># @param self Reference to current object</span>
<a name="l01905"></a>01905     <span class="comment"># @param animalID ID of the animal to be deleted</span>
<a name="l01906"></a>01906     <span class="comment"># @retval 1 on success, 0 on failure</span>
<a name="l01907"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a646940eb2010d378c761e3c8c0e584e6">01907</a>     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a646940eb2010d378c761e3c8c0e584e6" title="delanimal() deletes an animal from the pedigree.">delanimal</a>(self, animalID):
<a name="l01908"></a>01908         _deleted = 0
<a name="l01909"></a>01909         <span class="keywordflow">if</span> <span class="keywordflow">not</span> self.kw[<span class="stringliteral">&#39;pedigree_is_renumbered&#39;</span>]:
<a name="l01910"></a>01910             logging.warning(<span class="stringliteral">&#39;Deleting an animal from an unrenumbered pedigree using NewPedigree::delanimal() is unsafe!&#39;</span>)
<a name="l01911"></a>01911         <span class="keywordflow">try</span>:
<a name="l01912"></a>01912             anidx = self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#ae1358ecde62705c1e68fef7a1d943d7e">idmap</a>[animalID]-1
<a name="l01913"></a>01913             del(self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#adb79d76cbccbc5c03edc64c116f3f43a">namebackmap</a>[self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a28eed1e3039de3a74d2597d556ac831f">pedigree</a>[anidx].originalID])
<a name="l01914"></a>01914             del(self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#aab4ab96d9bbce43c2d7c09977bd82d9a">namemap</a>[self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a28eed1e3039de3a74d2597d556ac831f">pedigree</a>[anidx].name])
<a name="l01915"></a>01915             del(self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a6b8ebfe1128f217497e0604e450066db">backmap</a>[self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a28eed1e3039de3a74d2597d556ac831f">pedigree</a>[anidx].renumberedID])
<a name="l01916"></a>01916             del(self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#ae1358ecde62705c1e68fef7a1d943d7e">idmap</a>[animalID])
<a name="l01917"></a>01917             del(self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a28eed1e3039de3a74d2597d556ac831f">pedigree</a>[anidx])
<a name="l01918"></a>01918             _deleted = 1
<a name="l01919"></a>01919         <span class="keywordflow">except</span>:
<a name="l01920"></a>01920             _deleted
<a name="l01921"></a>01921         <span class="keywordflow">return</span> _deleted
<a name="l01922"></a>01922 
<a name="l01923"></a>01923     <span class="comment">##</span>
<a name="l01924"></a>01924     <span class="comment"># updateidmap() updates the ID map after a pedigree has been renumbered so that all references</span>
<a name="l01925"></a>01925     <span class="comment"># are to renumbered rather than original IDs.</span>
<a name="l01926"></a>01926     <span class="comment"># @param self Reference to current object</span>
<a name="l01927"></a>01927     <span class="comment"># @retval None</span>
<a name="l01928"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a5f2e95dd43e8bf2b4bfa2907eebd62a1">01928</a>     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a5f2e95dd43e8bf2b4bfa2907eebd62a1" title="updateidmap() updates the ID map after a pedigree has been renumbered so that all references are to r...">updateidmap</a>(self):
<a name="l01929"></a>01929         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l01930"></a>01930 <span class="stringliteral">        updateidmap() updates the ID map after a pedigree has been renumbered so that</span>
<a name="l01931"></a>01931 <span class="stringliteral">        all references are to renumbered rather than original IDs.</span>
<a name="l01932"></a>01932 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l01933"></a>01933         <span class="comment">#print &#39;[updateidmap]: Entered...&#39;</span>
<a name="l01934"></a>01934         self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#ae1358ecde62705c1e68fef7a1d943d7e">idmap</a> = {}
<a name="l01935"></a>01935         self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a6b8ebfe1128f217497e0604e450066db">backmap</a> = {}
<a name="l01936"></a>01936         self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#aab4ab96d9bbce43c2d7c09977bd82d9a">namemap</a> = {}
<a name="l01937"></a>01937         self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#adb79d76cbccbc5c03edc64c116f3f43a">namebackmap</a> = {}
<a name="l01938"></a>01938         <span class="keywordflow">for</span> _a <span class="keywordflow">in</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a28eed1e3039de3a74d2597d556ac831f">pedigree</a>:
<a name="l01939"></a>01939             <span class="keywordflow">try</span>:
<a name="l01940"></a>01940                 <span class="comment">#if str(_a.originalID) == &#39;43859378&#39;:</span>
<a name="l01941"></a>01941                 <span class="comment">#    print &#39;[updateidmap]: originalID = 43859378&#39;</span>
<a name="l01942"></a>01942                 <span class="comment">#    print &#39;[updateidmap]: animalID = &#39;, _a.animalID</span>
<a name="l01943"></a>01943                 <span class="comment">#    print &#39;[updateidmap]: sireID = &#39;, _a.sireID</span>
<a name="l01944"></a>01944                 <span class="comment">#    print &#39;[updateidmap]: damID = &#39;, _a.damID</span>
<a name="l01945"></a>01945                 self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#ae1358ecde62705c1e68fef7a1d943d7e">idmap</a>[_a.originalID] = _a.animalID
<a name="l01946"></a>01946                 self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a6b8ebfe1128f217497e0604e450066db">backmap</a>[_a.renumberedID] = _a.originalID
<a name="l01947"></a>01947                 <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;animal_type&#39;</span>] == <span class="stringliteral">&#39;new&#39;</span>:
<a name="l01948"></a>01948                     self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#aab4ab96d9bbce43c2d7c09977bd82d9a">namemap</a>[_a.name] = _a.originalID
<a name="l01949"></a>01949                     self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#adb79d76cbccbc5c03edc64c116f3f43a">namebackmap</a>[_a.originalID] = _a.name
<a name="l01950"></a>01950                 <span class="comment">#print &#39;%s =&gt; %s&#39; % ( _a.renumberedID, self.backmap[_a.renumberedID] )</span>
<a name="l01951"></a>01951             <span class="keywordflow">except</span> KeyError:
<a name="l01952"></a>01952                  <span class="keywordflow">pass</span>
<a name="l01953"></a>01953 <span class="comment">#         print self.idmap</span>
<a name="l01954"></a>01954 <span class="comment">#         print self.backmap</span>
<a name="l01955"></a>01955 
<a name="l01956"></a>01956     <span class="comment">##</span>
<a name="l01957"></a>01957     <span class="comment"># printoptions() prints the contents of the options dictionary.</span>
<a name="l01958"></a>01958     <span class="comment"># @param self Reference to current object</span>
<a name="l01959"></a>01959     <span class="comment"># @retval None</span>
<a name="l01960"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#ade3f012ba187d2a311e8e85b82167a3f">01960</a>     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#ade3f012ba187d2a311e8e85b82167a3f" title="printoptions() prints the contents of the options dictionary.">printoptions</a>(self):
<a name="l01961"></a>01961         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l01962"></a>01962 <span class="stringliteral">        printoptions() prints the contents of the options dictionary.</span>
<a name="l01963"></a>01963 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l01964"></a>01964         <span class="keywordflow">print</span> <span class="stringliteral">&#39;%s OPTIONS&#39;</span> % (self.kw[<span class="stringliteral">&#39;pedname&#39;</span>])
<a name="l01965"></a>01965         <span class="keywordflow">for</span> _k, _v <span class="keywordflow">in</span> self.kw.iteritems():
<a name="l01966"></a>01966             <span class="keywordflow">if</span> len(_k) &lt;= 14:
<a name="l01967"></a>01967                 <span class="keywordflow">print</span> <span class="stringliteral">&#39;\t%s:\t\t%s&#39;</span> % ( _k, _v )
<a name="l01968"></a>01968             <span class="keywordflow">else</span>:
<a name="l01969"></a>01969                 <span class="keywordflow">print</span> <span class="stringliteral">&#39;\t%s:\t%s&#39;</span> % ( _k, _v )
<a name="l01970"></a>01970 
<a name="l01971"></a>01971     <span class="comment">##</span>
<a name="l01972"></a>01972     <span class="comment"># simulate() simulates an arbitrary pedigree of size n with g generations</span>
<a name="l01973"></a>01973     <span class="comment"># starting from n_s base sires and n_d base dams.  This method is based on</span>
<a name="l01974"></a>01974     <span class="comment"># the concepts and algorithms in the Pedigree::sample method from Matvec</span>
<a name="l01975"></a>01975     <span class="comment"># 1.1a.  The arguments are read from the pedigree object&#39;s options</span>
<a name="l01976"></a>01976     <span class="comment"># dictionary.</span>
<a name="l01977"></a>01977     <span class="comment"># @param self Reference to current object</span>
<a name="l01978"></a>01978     <span class="comment"># @retval None</span>
<a name="l01979"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a1d239866c3dacb51ad925bbdf9337001">01979</a>     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a1d239866c3dacb51ad925bbdf9337001" title="simulate() simulates an arbitrary pedigree of size n with g generations starting from n_s base sires ...">simulate</a>(self):
<a name="l01980"></a>01980         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l01981"></a>01981 <span class="stringliteral">        Simulate simulates an arbitrary pedigree of size n with g generations</span>
<a name="l01982"></a>01982 <span class="stringliteral">        starting from n_s base sires and n_d base dams.  This method is based</span>
<a name="l01983"></a>01983 <span class="stringliteral">        on the concepts and algorithms in the Pedigree::sample method from</span>
<a name="l01984"></a>01984 <span class="stringliteral">        Matvec 1.1a (src/classes/pedigree.cpp), although all of the code in</span>
<a name="l01985"></a>01985 <span class="stringliteral">        this implementation was written from scratch.</span>
<a name="l01986"></a>01986 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l01987"></a>01987         <span class="comment">#import random</span>
<a name="l01988"></a>01988         <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span>:
<a name="l01989"></a>01989             <span class="keywordflow">print</span> <span class="stringliteral">&#39;[SIMULATE]: Preparing to simulate a pedigree&#39;</span>
<a name="l01990"></a>01990             logging.info(<span class="stringliteral">&#39;Preparing to simulate a pedigree&#39;</span>)
<a name="l01991"></a>01991         <span class="comment"># If the current pedigree object has already been populated with</span>
<a name="l01992"></a>01992         <span class="comment"># animals simulate() will not overwrite those entries.</span>
<a name="l01993"></a>01993         <span class="keywordflow">if</span> len(self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a28eed1e3039de3a74d2597d556ac831f">pedigree</a>) &gt; 0:
<a name="l01994"></a>01994             logging.error(<span class="stringliteral">&#39;The simulate() method did not create a new randomly-generated pedigree because the pedigree %s has already been populated with animals.&#39;</span>, self.kw[<span class="stringliteral">&#39;pedname&#39;</span>])
<a name="l01995"></a>01995             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span>:
<a name="l01996"></a>01996                 <span class="keywordflow">print</span> <span class="stringliteral">&#39;[ERROR]: The simulate() method did not create a new randomly-generated pedigree because the pedigree %s has already been populated with animals.&#39;</span> % ( self.kw[<span class="stringliteral">&#39;pedname&#39;</span>] )
<a name="l01997"></a>01997         <span class="comment"># Check arguments and assign defaults when invalid values are</span>
<a name="l01998"></a>01998         <span class="comment"># provided by the user.  Write messages to the log and console</span>
<a name="l01999"></a>01999         <span class="comment"># whenever user-specified values are overridden.</span>
<a name="l02000"></a>02000         self.kw[<span class="stringliteral">&#39;simulate_n&#39;</span>] = int(self.kw[<span class="stringliteral">&#39;simulate_n&#39;</span>])
<a name="l02001"></a>02001         self.kw[<span class="stringliteral">&#39;simulate_g&#39;</span>] = int(self.kw[<span class="stringliteral">&#39;simulate_g&#39;</span>])
<a name="l02002"></a>02002         self.kw[<span class="stringliteral">&#39;simulate_ns&#39;</span>] = int(self.kw[<span class="stringliteral">&#39;simulate_ns&#39;</span>])
<a name="l02003"></a>02003         self.kw[<span class="stringliteral">&#39;simulate_nd&#39;</span>] = int(self.kw[<span class="stringliteral">&#39;simulate_nd&#39;</span>])
<a name="l02004"></a>02004         self.kw[<span class="stringliteral">&#39;simulate_sr&#39;</span>] = float(self.kw[<span class="stringliteral">&#39;simulate_sr&#39;</span>])
<a name="l02005"></a>02005         self.kw[<span class="stringliteral">&#39;simulate_ir&#39;</span>] = float(self.kw[<span class="stringliteral">&#39;simulate_ir&#39;</span>])
<a name="l02006"></a>02006         self.kw[<span class="stringliteral">&#39;simulate_pmd&#39;</span>] = int(self.kw[<span class="stringliteral">&#39;simulate_pmd&#39;</span>])
<a name="l02007"></a>02007         <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;simulate_n&#39;</span>] &lt; 1:
<a name="l02008"></a>02008             logging.warning(<span class="stringliteral">&#39;You asked that a pedigree containing an invalid number of animals, %s, be simulated. The default number of animals, 15, is being used.&#39;</span>, self.kw[<span class="stringliteral">&#39;simulate_n&#39;</span>])
<a name="l02009"></a>02009             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span>:
<a name="l02010"></a>02010                 <span class="keywordflow">print</span> <span class="stringliteral">&#39;\t[SIMULATE]: You asked that a pedigree containing an invalid number of animals, %s, be simulated. The default number of animals, 15, is being used.&#39;</span> % ( self.kw[<span class="stringliteral">&#39;simulate_n&#39;</span>] )
<a name="l02011"></a>02011             self.kw[<span class="stringliteral">&#39;simulate_n&#39;</span>] = 15
<a name="l02012"></a>02012         <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;simulate_g&#39;</span>] &lt; 1:
<a name="l02013"></a>02013             logging.warning(<span class="stringliteral">&#39;You asked that a pedigree containing an invalid number of generations, %s, be simulated. The default number of generations, 3, is being used.&#39;</span>, self.kw[<span class="stringliteral">&#39;simulate_g&#39;</span>])
<a name="l02014"></a>02014             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span>:
<a name="l02015"></a>02015                 <span class="keywordflow">print</span> <span class="stringliteral">&#39;\t[SIMULATE]: You asked that a pedigree containing an invalid number of generations, %s, be simulated. The default number of generations, 3, is being used.&#39;</span> % ( self.kw[<span class="stringliteral">&#39;simulate_g&#39;</span>] )
<a name="l02016"></a>02016             kw[<span class="stringliteral">&#39;simulate_g&#39;</span>] = 3
<a name="l02017"></a>02017         <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;simulate_ns&#39;</span>] &lt; 1:
<a name="l02018"></a>02018             logging.warning(<span class="stringliteral">&#39;You asked that a pedigree containing an invalid number of sires, %s, be simulated. The default number of sires, 4, is being used.&#39;</span>, self.kw[<span class="stringliteral">&#39;simulate_ns&#39;</span>])
<a name="l02019"></a>02019             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span>:
<a name="l02020"></a>02020                 <span class="keywordflow">print</span> <span class="stringliteral">&#39;\t[SIMULATE]: You asked that a pedigree containing an invalid number of sires, %s, be simulated. The default number of sires, 4, is being used.&#39;</span> % ( self.kw[<span class="stringliteral">&#39;simulate_ns&#39;</span>] )
<a name="l02021"></a>02021             self.kw[<span class="stringliteral">&#39;simulate_ns&#39;</span>] = 4
<a name="l02022"></a>02022         <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;simulate_nd&#39;</span>] &lt; 1:
<a name="l02023"></a>02023             logging.warning(<span class="stringliteral">&#39;You asked that a pedigree containing an invalid number of dams, %s, be simulated. The default number of dams, 4, is being used.&#39;</span>, self.kw[<span class="stringliteral">&#39;simulate_nd&#39;</span>])
<a name="l02024"></a>02024             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span>:
<a name="l02025"></a>02025                 <span class="keywordflow">print</span> <span class="stringliteral">&#39;\t[SIMULATE]: You asked that a pedigree containing an invalid number of dams, %s, be simulated. The default number of dams, 4, is being used.&#39;</span> % ( self.kw[<span class="stringliteral">&#39;simulate_nd&#39;</span>] )
<a name="l02026"></a>02026             self.kw[<span class="stringliteral">&#39;simulate_nd&#39;</span>] = 4
<a name="l02027"></a>02027         <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;simulate_sr&#39;</span>] &lt; 0. <span class="keywordflow">or</span> self.kw[<span class="stringliteral">&#39;simulate_sr&#39;</span>] &gt; 1.:
<a name="l02028"></a>02028             logging.warning(<span class="stringliteral">&#39;You asked that a pedigree with an invalid sex ratio, %s, be simulated. The default sex ratio, 0.5, is being used.&#39;</span>, self.kw[<span class="stringliteral">&#39;simulate_sr&#39;</span>])
<a name="l02029"></a>02029             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span>:
<a name="l02030"></a>02030                 <span class="keywordflow">print</span> <span class="stringliteral">&#39;\t[SIMULATE]: You asked that a pedigree containing an invalid sex ratio, %s, be simulated. The default sex ratio, 0.5, is being used.&#39;</span> % ( self.kw[<span class="stringliteral">&#39;simulate_sr&#39;</span>] )
<a name="l02031"></a>02031             self.kw[<span class="stringliteral">&#39;simulate_sr&#39;</span>] = 0.5
<a name="l02032"></a>02032         <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;simulate_ir&#39;</span>] &lt; 0. <span class="keywordflow">or</span> self.kw[<span class="stringliteral">&#39;simulate_ir&#39;</span>] &gt; 1.:
<a name="l02033"></a>02033             logging.warning(<span class="stringliteral">&#39;You asked that a pedigree with an invalid immigration rate, %s, be simulated. The default rate, 0.5, is being used.&#39;</span>, self.kw[<span class="stringliteral">&#39;simulate_ir&#39;</span>])
<a name="l02034"></a>02034             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span>:
<a name="l02035"></a>02035                 <span class="keywordflow">print</span> <span class="stringliteral">&#39;\t[SIMULATE]: You asked that a pedigree containing an invalid immigration rate, %s, be simulated. The default rate, 0.5, is being used.&#39;</span> % ( self.kw[<span class="stringliteral">&#39;simulate_ir&#39;</span>] )
<a name="l02036"></a>02036             self.kw[<span class="stringliteral">&#39;simulate_ir&#39;</span>] = 0.5
<a name="l02037"></a>02037         <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;simulate_ns&#39;</span>] &gt;= self.kw[<span class="stringliteral">&#39;simulate_n&#39;</span>]:
<a name="l02038"></a>02038             logging.error(<span class="stringliteral">&#39;You asked that a pedigree with more founder sires than total animals be simulated.  This is a fatal error!&#39;</span>)
<a name="l02039"></a>02039             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span>:
<a name="l02040"></a>02040                 <span class="keywordflow">print</span> <span class="stringliteral">&#39;\t[SIMULATE]: You asked that a pedigree with more founder sires than total animals be simulated.  This is a fatal error!&#39;</span>
<a name="l02041"></a>02041             sys.exit(0)
<a name="l02042"></a>02042         <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;simulate_nd&#39;</span>] &gt;= self.kw[<span class="stringliteral">&#39;simulate_n&#39;</span>]:
<a name="l02043"></a>02043             logging.error(<span class="stringliteral">&#39;You asked that a pedigree with more founder dams than total animals be simulated.  This is a fatal error!&#39;</span>)
<a name="l02044"></a>02044             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span>:
<a name="l02045"></a>02045                 <span class="keywordflow">print</span> <span class="stringliteral">&#39;\t[SIMULATE]: You asked that a pedigree with more founder dams than total animals be simulated.  This is a fatal error!&#39;</span>
<a name="l02046"></a>02046             sys.exit(0)
<a name="l02047"></a>02047         <span class="keywordflow">if</span> ( self.kw[<span class="stringliteral">&#39;simulate_ns&#39;</span>] + self.kw[<span class="stringliteral">&#39;simulate_ns&#39;</span>] ) &gt; self.kw[<span class="stringliteral">&#39;simulate_n&#39;</span>]:
<a name="l02048"></a>02048             logging.error(<span class="stringliteral">&#39;You asked that a pedigree with more founder parents than total animals be simulated.  This is a fatal error!&#39;</span>)
<a name="l02049"></a>02049             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span>:
<a name="l02050"></a>02050                 <span class="keywordflow">print</span> <span class="stringliteral">&#39;\t[SIMULATE]: You asked that a pedigree with more founder parents than total animals be simulated.  This is a fatal error!&#39;</span>
<a name="l02051"></a>02051             sys.exit(0)
<a name="l02052"></a>02052         <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;simulate_pmd&#39;</span>] &lt; 1:
<a name="l02053"></a>02053             logging.warning(<span class="stringliteral">&#39;You specified an invalid number of maximum parent draws, %s. The default number of maximum draws, 100, is being used.&#39;</span>, self.kw[<span class="stringliteral">&#39;simulate_pmd&#39;</span>])
<a name="l02054"></a>02054             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span>:
<a name="l02055"></a>02055                 <span class="keywordflow">print</span> <span class="stringliteral">&#39;\t[SIMULATE]: You specified an invalid number of maximum parent draws, %s. The default number of maximum draws, 100, is being used.&#39;</span> % ( self.kw[<span class="stringliteral">&#39;simulate_pmd&#39;</span>] )
<a name="l02056"></a>02056             kw[<span class="stringliteral">&#39;simulate_pmd&#39;</span>] = 100
<a name="l02057"></a>02057         <span class="comment"># Seed the RNG</span>
<a name="l02058"></a>02058         seed = 5048665
<a name="l02059"></a>02059         numpy.random.seed(seed)
<a name="l02060"></a>02060         <span class="comment"># Now that we&#39;ve checked the input, go ahead and setup some</span>
<a name="l02061"></a>02061         <span class="comment"># structures that we&#39;re going to need.</span>
<a name="l02062"></a>02062         <span class="comment"># Make local copies of the simulation defaults to save lots of typing.</span>
<a name="l02063"></a>02063         <span class="comment">#</span>
<a name="l02064"></a>02064         <span class="comment"># We add two to the requested number of animals because</span>
<a name="l02065"></a>02065         <span class="comment"># one of the initial sires and dams is an unknown parent.</span>
<a name="l02066"></a>02066         <span class="comment"># We give back simulate_n-2 animals, so the bump is needed.</span>
<a name="l02067"></a>02067         _snt = self.kw[<span class="stringliteral">&#39;simulate_n&#39;</span>] + 2
<a name="l02068"></a>02068         _sng = self.kw[<span class="stringliteral">&#39;simulate_g&#39;</span>]
<a name="l02069"></a>02069         _sns = self.kw[<span class="stringliteral">&#39;simulate_ns&#39;</span>]
<a name="l02070"></a>02070         _snd = self.kw[<span class="stringliteral">&#39;simulate_nd&#39;</span>]
<a name="l02071"></a>02071         _ssr = self.kw[<span class="stringliteral">&#39;simulate_sr&#39;</span>]
<a name="l02072"></a>02072         _smp = self.kw[<span class="stringliteral">&#39;simulate_mp&#39;</span>]
<a name="l02073"></a>02073         _sir = self.kw[<span class="stringliteral">&#39;simulate_ir&#39;</span>]
<a name="l02074"></a>02074         _spo = self.kw[<span class="stringliteral">&#39;simulate_po&#39;</span>]
<a name="l02075"></a>02075         _sfs = self.kw[<span class="stringliteral">&#39;simulate_fs&#39;</span>]
<a name="l02076"></a>02076         _spmd = self.kw[<span class="stringliteral">&#39;simulate_pmd&#39;</span>]
<a name="l02077"></a>02077         _sff = int( round( _snt * 0.1 ) )
<a name="l02078"></a>02078         <span class="comment"># _smd is the maximum number of daughters allowed, and is a</span>
<a name="l02079"></a>02079         <span class="comment"># function of the number of the total number of animals in</span>
<a name="l02080"></a>02080         <span class="comment"># the pedigree, the number of foundation sires and dams in</span>
<a name="l02081"></a>02081         <span class="comment"># the pedigree, and the sex ratio.</span>
<a name="l02082"></a>02082         _smd = int( round( ( _snt - _sns - _snd ) * ( 1 - _ssr ) ) )
<a name="l02083"></a>02083         <span class="comment"># _sms is the maximum number of sons allowed</span>
<a name="l02084"></a>02084         _sms = int ( round( ( _snt - _sns - _snd ) * ( _ssr ) ) )
<a name="l02085"></a>02085         <span class="comment"># _smf is the maximum number of females allowed in the</span>
<a name="l02086"></a>02086         <span class="comment"># pedigree, and is a function of the total number of dams,</span>
<a name="l02087"></a>02087         <span class="comment"># total sons, total daughters, and a &quot;fudge factor&quot; of 10%</span>
<a name="l02088"></a>02088         <span class="comment"># of the total pedigree size (arbitrary) that allows the</span>
<a name="l02089"></a>02089         <span class="comment"># number of females to vary from pedigree to pedigree.  _smm</span>
<a name="l02090"></a>02090         <span class="comment"># is the max number of males allowed in the pedigree, computed</span>
<a name="l02091"></a>02091         <span class="comment"># similarly to _smf.</span>
<a name="l02092"></a>02092         _smf = _snd + _smd + _sff
<a name="l02093"></a>02093         _smm = _sns + _sms + _sff
<a name="l02094"></a>02094         <span class="comment"># Total number of generated sires and dams? These values are</span>
<a name="l02095"></a>02095         <span class="comment"># incremented &quot;down below&quot;, but there are no helpful comments</span>
<a name="l02096"></a>02096         <span class="comment"># in the Matvec source to guide me here.</span>
<a name="l02097"></a>02097         _tgdam = _snd
<a name="l02098"></a>02098         _tdam = _snd
<a name="l02099"></a>02099         _tgsire = _sns
<a name="l02100"></a>02100         _tsire = _sns
<a name="l02101"></a>02101         <span class="comment"># These dicts will store ???</span>
<a name="l02102"></a>02102         females = []
<a name="l02103"></a>02103         males = []
<a name="l02104"></a>02104         <span class="comment"># Initialize the females and males lists</span>
<a name="l02105"></a>02105         <span class="comment">#for i in range(_smf):</span>
<a name="l02106"></a>02106             <span class="comment">#females.append(None)</span>
<a name="l02107"></a>02107         <span class="comment">#for i in range(_smm):</span>
<a name="l02108"></a>02108             <span class="comment">#males.append(None)</span>
<a name="l02109"></a>02109         <span class="comment"># Assign IDs to the sires and dams. Dam IDs range from</span>
<a name="l02110"></a>02110         <span class="comment"># 0 .. _snd-1 and sire IDs range from _snd .. _sns-1.</span>
<a name="l02111"></a>02111         <span class="comment"># Note that there is always a sire and a dam with ID 0.</span>
<a name="l02112"></a>02112         <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(_snd):
<a name="l02113"></a>02113             <span class="comment">#females[i] = i</span>
<a name="l02114"></a>02114             females.append(i)
<a name="l02115"></a>02115         <span class="comment">#print &#39;females:\t%s&#39; % ( females )</span>
<a name="l02116"></a>02116         <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(_sns):
<a name="l02117"></a>02117             <span class="keywordflow">if</span> i == 0:
<a name="l02118"></a>02118                 <span class="comment">#males[i] = 0</span>
<a name="l02119"></a>02119                 males.append(0)
<a name="l02120"></a>02120             <span class="keywordflow">else</span>:
<a name="l02121"></a>02121                 <span class="comment">#males[i] = _snd + i</span>
<a name="l02122"></a>02122                 males.append(_snd + i)
<a name="l02123"></a>02123         <span class="comment">#print &#39;males:\t\t%s&#39; % ( males )</span>
<a name="l02124"></a>02124         <span class="comment"># Number of slots unavailable b/c they are used by sires</span>
<a name="l02125"></a>02125         <span class="comment"># and dams.</span>
<a name="l02126"></a>02126         _totalna = _snd + _sns
<a name="l02127"></a>02127         <span class="comment"># Number of animals per generation. Each generation will</span>
<a name="l02128"></a>02128         <span class="comment"># contain at least 1 animal. We take out the sires and</span>
<a name="l02129"></a>02129         <span class="comment"># dams because those spots are already taken.</span>
<a name="l02130"></a>02130         _npg = ( ( _snt - _snd - _sns ) / _sng ) + 1
<a name="l02131"></a>02131         <span class="comment"># _pedholder is a temporary structure for storing</span>
<a name="l02132"></a>02132         <span class="comment"># animal, sire, and dam IDs and sex codes.</span>
<a name="l02133"></a>02133         _pedholder = []
<a name="l02134"></a>02134         <span class="comment"># So we loop to add entries to _pedholder for the</span>
<a name="l02135"></a>02135         <span class="comment"># sires and dams in the males and females lists.</span>
<a name="l02136"></a>02136         <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(_snt+1):
<a name="l02137"></a>02137             _pedholder.append(<span class="keywordtype">None</span>)
<a name="l02138"></a>02138         <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(_snd):
<a name="l02139"></a>02139             _pedholder[i] = SimAnimal(females[i],0,0,<span class="stringliteral">&#39;f&#39;</span>,0)
<a name="l02140"></a>02140         <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(_snd,_totalna):
<a name="l02141"></a>02141             _pedholder[i] = SimAnimal(males[i-_snd],0,0,<span class="stringliteral">&#39;m&#39;</span>,0)
<a name="l02142"></a>02142 
<a name="l02143"></a>02143         <span class="comment">###</span>
<a name="l02144"></a>02144         <span class="comment">### Start of big. long generate animal loop.</span>
<a name="l02145"></a>02145         <span class="comment">###</span>
<a name="l02146"></a>02146         <span class="comment"># Loop over number of generations:</span>
<a name="l02147"></a>02147         <span class="keywordflow">for</span> g <span class="keywordflow">in</span> range(_sng):
<a name="l02148"></a>02148             _tgdam = _tdam
<a name="l02149"></a>02149             _tgsire = _tsire
<a name="l02150"></a>02150             <span class="keywordflow">if</span> _totalna &gt;= _snt:
<a name="l02151"></a>02151                 <span class="keywordflow">break</span>
<a name="l02152"></a>02152             <span class="keywordflow">for</span> _j <span class="keywordflow">in</span> range(_npg):
<a name="l02153"></a>02153                 <span class="keywordflow">if</span> _totalna &gt;= _snt:
<a name="l02154"></a>02154                   <span class="keywordflow">break</span>
<a name="l02155"></a>02155                 <span class="comment"># If a random uniform variate is greater than the</span>
<a name="l02156"></a>02156                 <span class="comment"># immigration rate, we need to create a new animal</span>
<a name="l02157"></a>02157                 <span class="comment"># with a sire and a dam chosen at random from the</span>
<a name="l02158"></a>02158                 <span class="comment"># males and females dictionaries, respectively.</span>
<a name="l02159"></a>02159                 <span class="comment">#if random.random() &gt; _sir:</span>
<a name="l02160"></a>02160                 <span class="keywordflow">if</span> numpy.random.ranf() &gt; _sir:
<a name="l02161"></a>02161                     <span class="comment"># The number-of-tries counter is used to</span>
<a name="l02162"></a>02162                     <span class="comment"># track the number of draws needed to get</span>
<a name="l02163"></a>02163                     <span class="comment"># a set of parents which meets all of the</span>
<a name="l02164"></a>02164                     <span class="comment"># MP, OP, and FS restrictions.</span>
<a name="l02165"></a>02165                     _ntry = 0
<a name="l02166"></a>02166                     <span class="keywordflow">while</span> 1:
<a name="l02167"></a>02167                         <span class="comment">#print &#39;females:\t%s&#39; % ( females )</span>
<a name="l02168"></a>02168                         <span class="comment">#print &#39;males:\t\t%s&#39; % ( males )</span>
<a name="l02169"></a>02169                         <span class="comment"># Select a random sire and dam</span>
<a name="l02170"></a>02170                         <span class="comment">#_selsire = random.randint(0,len(males)-1)</span>
<a name="l02171"></a>02171                         _selsire = numpy.random.randint(0,len(males)-1)
<a name="l02172"></a>02172                         <span class="comment">#_seldam = random.randint(0,len(females)-1)</span>
<a name="l02173"></a>02173                         _seldam = numpy.random.randint(0,len(females)-1)
<a name="l02174"></a>02174                         <span class="comment"># In the Matvec code, when an unknown sire or</span>
<a name="l02175"></a>02175                         <span class="comment"># dam is selected their sire (dam) is set the</span>
<a name="l02176"></a>02176                         <span class="comment"># same ID as the &quot;missing parent&quot; flag. This</span>
<a name="l02177"></a>02177                         <span class="comment"># results in a slight bias in favor of the</span>
<a name="l02178"></a>02178                         <span class="comment"># first non-missing sire (dam) ID. It also</span>
<a name="l02179"></a>02179                         <span class="comment"># means that the definition of the missing</span>
<a name="l02180"></a>02180                         <span class="comment"># parent flag as described on p. 12 of the</span>
<a name="l02181"></a>02181                         <span class="comment"># manual is counterintuitive -- 0 indicates</span>
<a name="l02182"></a>02182                         <span class="comment"># that missing parents are allowed, not 1. I&#39;ve</span>
<a name="l02183"></a>02183                         <span class="comment"># fixed that here in PyPedal: an MP flag of</span>
<a name="l02184"></a>02184                         <span class="comment"># 1 indicates that MP are allowed. That&#39;s the</span>
<a name="l02185"></a>02185                         <span class="comment"># reason for the &quot;1 - _smp&quot; below.</span>
<a name="l02186"></a>02186                         <span class="keywordflow">if</span> _selsire == 0:
<a name="l02187"></a>02187                             _selsire = 1 - _smp
<a name="l02188"></a>02188                         <span class="comment">#print &#39;_selsire:\t%s&#39; % ( _selsire )</span>
<a name="l02189"></a>02189                         <span class="keywordflow">if</span> _seldam == 0:
<a name="l02190"></a>02190                             _seldam = 1 - _smp
<a name="l02191"></a>02191                         <span class="comment">#print &#39;_seldam:\t%s&#39; % ( _seldam )</span>
<a name="l02192"></a>02192                         <span class="comment"># Now we&#39;re going to store the sire and dam IDs,</span>
<a name="l02193"></a>02193                         <span class="comment"># as well as their parents&#39; IDs, for use in</span>
<a name="l02194"></a>02194                         <span class="comment"># detecting parent-offspring and full-sib matings.</span>
<a name="l02195"></a>02195                         _d = females[_seldam]
<a name="l02196"></a>02196                         _s = males[_selsire]
<a name="l02197"></a>02197                         _dd = _pedholder[_d].damID
<a name="l02198"></a>02198                         _ds = _pedholder[_d].sireID
<a name="l02199"></a>02199                         _sd = _pedholder[_s].damID
<a name="l02200"></a>02200                         _ss = _pedholder[_s].sireID
<a name="l02201"></a>02201                         _tryagain = 0
<a name="l02202"></a>02202                         <span class="comment">#print &#39;Animal: %s&#39; % ( _totalna )</span>
<a name="l02203"></a>02203                         <span class="comment">#print &#39;Sire: %s&#39; % ( _s )</span>
<a name="l02204"></a>02204                         <span class="comment">#print &#39;Dam: %s&#39; % ( _d )</span>
<a name="l02205"></a>02205                         <span class="comment">#print &#39;Dam-Dam: %s&#39; % ( _dd )</span>
<a name="l02206"></a>02206                         <span class="comment">#print &#39;Dam-Sire: %s&#39; % ( _ds )</span>
<a name="l02207"></a>02207                         <span class="comment">#print &#39;Sire-Dam: %s&#39; % ( _sd )</span>
<a name="l02208"></a>02208                         <span class="comment">#print &#39;Sire-Sire: %s&#39; % ( _ss )</span>
<a name="l02209"></a>02209                         <span class="comment"># If offspring-parent matings are not allowed,</span>
<a name="l02210"></a>02210                         <span class="comment"># check to see if both parents are known. If one</span>
<a name="l02211"></a>02211                         <span class="comment"># or both is unknown, draw new samples until they</span>
<a name="l02212"></a>02212                         <span class="comment"># are either (i) known or (ii) simulate_pmd</span>
<a name="l02213"></a>02213                         <span class="comment"># (simulate parent max draws) is reached. If _smpd</span>
<a name="l02214"></a>02214                         <span class="comment"># is reached, set the parents to unknown even if</span>
<a name="l02215"></a>02215                         <span class="comment"># _smp == 0.</span>
<a name="l02216"></a>02216                         <span class="keywordflow">if</span> <span class="keywordflow">not</span> _spo:
<a name="l02217"></a>02217                             <span class="keywordflow">if</span> _d &gt; 0 <span class="keywordflow">and</span> _sd == _d:
<a name="l02218"></a>02218                                 <span class="comment"># Draw a new dam</span>
<a name="l02219"></a>02219                                 _tryagain = 1
<a name="l02220"></a>02220                             <span class="keywordflow">if</span> _s &gt; 0 <span class="keywordflow">and</span> _ss == _s:
<a name="l02221"></a>02221                                 <span class="comment"># Draw a new sire</span>
<a name="l02222"></a>02222                                 _tryagain = 1
<a name="l02223"></a>02223                         <span class="comment"># If no full-sib matings are allowed, make sure</span>
<a name="l02224"></a>02224                         <span class="comment"># that the parents aren&#39;t brother and sister.</span>
<a name="l02225"></a>02225                         <span class="keywordflow">if</span> <span class="keywordflow">not</span> _sfs:
<a name="l02226"></a>02226                             <span class="keywordflow">if</span> _ss &gt; 0 <span class="keywordflow">and</span> _sd == 0:
<a name="l02227"></a>02227                                 <span class="keywordflow">if</span> _ss == _ds <span class="keywordflow">and</span> _sd == _dd:
<a name="l02228"></a>02228                                     _tryagain = 1
<a name="l02229"></a>02229                         <span class="keywordflow">if</span> _tryagain:
<a name="l02230"></a>02230                             _ntry = _ntry + 1
<a name="l02231"></a>02231                         <span class="keywordflow">if</span> _ntry &gt; _spmd:
<a name="l02232"></a>02232                             <span class="comment">#print &#39;&gt; %d draws required to meet all parental restrictions. Parents set to missing.&#39; % ( _spmd )</span>
<a name="l02233"></a>02233                             _tryagain = 0
<a name="l02234"></a>02234                             _seldam = 0
<a name="l02235"></a>02235                             _selsire = 0
<a name="l02236"></a>02236                         <span class="comment"># If we met the MP, PO, and FS conditions</span>
<a name="l02237"></a>02237                         <span class="comment"># we&#39;re done and can exit the loop.</span>
<a name="l02238"></a>02238                         <span class="keywordflow">if</span> <span class="keywordflow">not</span> _tryagain:
<a name="l02239"></a>02239                             <span class="keywordflow">break</span>
<a name="l02240"></a>02240                     <span class="comment">#print &#39;%d draws required to meet all parental restrictions.&#39; % ( _ntry+1 )</span>
<a name="l02241"></a>02241                 <span class="keywordflow">else</span>:
<a name="l02242"></a>02242                     <span class="comment"># The new animal is an immigrant with unknown</span>
<a name="l02243"></a>02243                     <span class="comment"># parents.</span>
<a name="l02244"></a>02244                     _selsire = 0
<a name="l02245"></a>02245                     _seldam = 0
<a name="l02246"></a>02246                 <span class="comment"># We&#39;ve added an animal to the pedigree.</span>
<a name="l02247"></a>02247                 _totalna = _totalna + 1
<a name="l02248"></a>02248 
<a name="l02249"></a>02249                 <span class="comment">#if random.random() &lt; _ssr and _tgdam &lt; _smf:</span>
<a name="l02250"></a>02250                 <span class="keywordflow">if</span> numpy.random.ranf() &lt; _ssr <span class="keywordflow">and</span> _tgdam &lt; _smf:
<a name="l02251"></a>02251                     _tgdam = _tgdam + 1
<a name="l02252"></a>02252                     <span class="comment">#females[_tgdam] = _totalna</span>
<a name="l02253"></a>02253                     females.append(_totalna)
<a name="l02254"></a>02254                     _pedholder[_totalna] = SimAnimal(_totalna,males[_selsire],females[_seldam],<span class="stringliteral">&#39;f&#39;</span>,g+1)
<a name="l02255"></a>02255                 <span class="keywordflow">else</span>:
<a name="l02256"></a>02256                     <span class="keywordflow">if</span> _tgsire &lt; _smm:
<a name="l02257"></a>02257                         _tgsire = _tgsire + 1
<a name="l02258"></a>02258                         <span class="comment">#males[_tgsire] = _totalna</span>
<a name="l02259"></a>02259                         males.append(_totalna)
<a name="l02260"></a>02260                         _pedholder[_totalna] = SimAnimal(_totalna,males[_selsire],females[_seldam],<span class="stringliteral">&#39;m&#39;</span>,g+1)
<a name="l02261"></a>02261                     <span class="keywordflow">else</span>:
<a name="l02262"></a>02262                         _tgdam = _tgdam + 1
<a name="l02263"></a>02263                         <span class="comment">#females[_tgdam] = _totalna</span>
<a name="l02264"></a>02264                         females.append(_totalna)
<a name="l02265"></a>02265                         _pedholder[_totalna] = SimAnimal(_totalna,males[_selsire],females[_seldam],<span class="stringliteral">&#39;f&#39;</span>,g+1)
<a name="l02266"></a>02266                 _tdam = _tgdam
<a name="l02267"></a>02267                 _tsire = _tgsire
<a name="l02268"></a>02268         <span class="comment">###</span>
<a name="l02269"></a>02269         <span class="comment">### End of big. long generate animal loop.</span>
<a name="l02270"></a>02270         <span class="comment">###</span>
<a name="l02271"></a>02271 
<a name="l02272"></a>02272         <span class="comment">#print &#39;_pedholder:&#39;</span>
<a name="l02273"></a>02273         <span class="comment">#print &#39;\tAnimal\tSire\tDam\tSex&#39;</span>
<a name="l02274"></a>02274         <span class="comment">#for _ip in range(len(_pedholder)):</span>
<a name="l02275"></a>02275             <span class="comment">#if _pedholder[_ip]:</span>
<a name="l02276"></a>02276                 <span class="comment">#_pedholder[_ip].printme()</span>
<a name="l02277"></a>02277 
<a name="l02278"></a>02278         <span class="comment">###</span>
<a name="l02279"></a>02279         <span class="comment">### Now we have to put the animals into an actual pedigree object.</span>
<a name="l02280"></a>02280         <span class="comment">###</span>
<a name="l02281"></a>02281 
<a name="l02282"></a>02282         <span class="comment"># First, process the pedigree format code. This is easy</span>
<a name="l02283"></a>02283         <span class="comment"># b/c we are using SimAnimal() objects.</span>
<a name="l02284"></a>02284         self.kw[<span class="stringliteral">&#39;pedformat&#39;</span>] = <span class="stringliteral">&#39;asdxg&#39;</span>
<a name="l02285"></a>02285         pedformat_locations = {}
<a name="l02286"></a>02286         pedformat_locations[<span class="stringliteral">&#39;animal&#39;</span>] = 0
<a name="l02287"></a>02287         pedformat_locations[<span class="stringliteral">&#39;sire&#39;</span>] = 1
<a name="l02288"></a>02288         pedformat_locations[<span class="stringliteral">&#39;dam&#39;</span>] = 2
<a name="l02289"></a>02289         pedformat_locations[<span class="stringliteral">&#39;sex&#39;</span>] = 3
<a name="l02290"></a>02290         pedformat_locations[<span class="stringliteral">&#39;generation&#39;</span>] = 4
<a name="l02291"></a>02291         pedformat_locations[<span class="stringliteral">&#39;gencoeff&#39;</span>] = -999
<a name="l02292"></a>02292         pedformat_locations[<span class="stringliteral">&#39;birthyear&#39;</span>] = -999
<a name="l02293"></a>02293         pedformat_locations[<span class="stringliteral">&#39;inbreeding&#39;</span>] = -999
<a name="l02294"></a>02294         pedformat_locations[<span class="stringliteral">&#39;breed&#39;</span>] = -999
<a name="l02295"></a>02295         pedformat_locations[<span class="stringliteral">&#39;name&#39;</span>] = -999
<a name="l02296"></a>02296         pedformat_locations[<span class="stringliteral">&#39;birthdate&#39;</span>] = -999
<a name="l02297"></a>02297         pedformat_locations[<span class="stringliteral">&#39;alive&#39;</span>] = -999
<a name="l02298"></a>02298         pedformat_locations[<span class="stringliteral">&#39;age&#39;</span>] = -999
<a name="l02299"></a>02299         pedformat_locations[<span class="stringliteral">&#39;alleles&#39;</span>] = -999
<a name="l02300"></a>02300         pedformat_locations[<span class="stringliteral">&#39;herd&#39;</span>] = -999
<a name="l02301"></a>02301         pedformat_locations[<span class="stringliteral">&#39;userfield&#39;</span>] = -999
<a name="l02302"></a>02302         <span class="comment">#print pedformat_locations</span>
<a name="l02303"></a>02303 
<a name="l02304"></a>02304         <span class="keywordflow">for</span> _ip <span class="keywordflow">in</span> _pedholder:
<a name="l02305"></a>02305             <span class="keywordflow">if</span> _ip:
<a name="l02306"></a>02306                 <span class="comment"># We don&#39;t want to include our missing</span>
<a name="l02307"></a>02307                 <span class="comment"># parents in the final pedigree.</span>
<a name="l02308"></a>02308                 <span class="keywordflow">if</span> _ip.animalID &lt;&gt; 0:
<a name="l02309"></a>02309                     <span class="comment">#_ip.printme()</span>
<a name="l02310"></a>02310                     l = []
<a name="l02311"></a>02311                     l.append(str(_ip.animalID))
<a name="l02312"></a>02312                     <span class="comment"># 0 is used in the simulate routine to</span>
<a name="l02313"></a>02313                     <span class="comment"># indicate a missing parent, but the user</span>
<a name="l02314"></a>02314                     <span class="comment"># may have specified a different MP</span>
<a name="l02315"></a>02315                     <span class="comment"># indicator.</span>
<a name="l02316"></a>02316                     <span class="keywordflow">if</span> _ip.sireID == 0:
<a name="l02317"></a>02317                         l.append(self.kw[<span class="stringliteral">&#39;missing_parent&#39;</span>])
<a name="l02318"></a>02318                     <span class="keywordflow">else</span>:
<a name="l02319"></a>02319                         l.append(str(_ip.sireID))
<a name="l02320"></a>02320                     <span class="keywordflow">if</span> _ip.damID == 0:
<a name="l02321"></a>02321                         l.append(self.kw[<span class="stringliteral">&#39;missing_parent&#39;</span>])
<a name="l02322"></a>02322                     <span class="keywordflow">else</span>:
<a name="l02323"></a>02323                         l.append(str(_ip.damID))
<a name="l02324"></a>02324                     l.append(_ip.sex)
<a name="l02325"></a>02325                     l.append(_ip.gen)
<a name="l02326"></a>02326                     <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;animal_type&#39;</span>] == <span class="stringliteral">&#39;light&#39;</span>:
<a name="l02327"></a>02327                         an = LightAnimal(pedformat_locations,l,self.kw)
<a name="l02328"></a>02328                         <span class="comment">#an.printme()</span>
<a name="l02329"></a>02329                         self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a28eed1e3039de3a74d2597d556ac831f">pedigree</a>.append(an)
<a name="l02330"></a>02330                         self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#ae1358ecde62705c1e68fef7a1d943d7e">idmap</a>[an.animalID] = an.animalID
<a name="l02331"></a>02331                         self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a6b8ebfe1128f217497e0604e450066db">backmap</a>[an.animalID] = an.animalID
<a name="l02332"></a>02332                         self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#aab4ab96d9bbce43c2d7c09977bd82d9a">namemap</a>[an.name] = an.animalID
<a name="l02333"></a>02333                         self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#adb79d76cbccbc5c03edc64c116f3f43a">namebackmap</a>[an.animalID] = an.name
<a name="l02334"></a>02334                     <span class="keywordflow">else</span>:
<a name="l02335"></a>02335                         an = NewAnimal(pedformat_locations,l,self.kw)
<a name="l02336"></a>02336                         <span class="comment">#an.printme()</span>
<a name="l02337"></a>02337                         self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a28eed1e3039de3a74d2597d556ac831f">pedigree</a>.append(an)
<a name="l02338"></a>02338                         self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#ae1358ecde62705c1e68fef7a1d943d7e">idmap</a>[an.animalID] = an.animalID
<a name="l02339"></a>02339                         self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a6b8ebfe1128f217497e0604e450066db">backmap</a>[an.animalID] = an.animalID
<a name="l02340"></a>02340                         self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#aab4ab96d9bbce43c2d7c09977bd82d9a">namemap</a>[an.name] = an.animalID
<a name="l02341"></a>02341                         self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#adb79d76cbccbc5c03edc64c116f3f43a">namebackmap</a>[an.animalID] = an.name
<a name="l02342"></a>02342 
<a name="l02343"></a>02343         <span class="keywordflow">if</span> self.kw[<span class="stringliteral">&#39;pedigree_save&#39;</span>]:
<a name="l02344"></a>02344             <span class="keywordflow">try</span>:
<a name="l02345"></a>02345                 _sfn = <span class="stringliteral">&#39;%s.ped&#39;</span> % ( self.kw[<span class="stringliteral">&#39;filetag&#39;</span>] )
<a name="l02346"></a>02346                 of = file(_sfn,<span class="stringliteral">&#39;w&#39;</span>)
<a name="l02347"></a>02347                 <span class="keywordflow">for</span> _ip <span class="keywordflow">in</span> _pedholder:
<a name="l02348"></a>02348                     <span class="keywordflow">if</span> _ip <span class="keywordflow">and</span> _ip.animalID &lt;&gt; 0:
<a name="l02349"></a>02349                         _ofl = <span class="stringliteral">&#39;%s\n&#39;</span> % ( _ip.stringme() )
<a name="l02350"></a>02350                         of.write(_ofl)
<a name="l02351"></a>02351                 of.close()
<a name="l02352"></a>02352             <span class="keywordflow">except</span>:
<a name="l02353"></a>02353                 <span class="keywordflow">pass</span>
<a name="l02354"></a>02354 
<a name="l02355"></a>02355         <span class="comment"># Cleanup</span>
<a name="l02356"></a>02356         del(males)
<a name="l02357"></a>02357         del(females)
<a name="l02358"></a>02358         del(_pedholder)
<a name="l02359"></a>02359 <span class="comment">##</span>
<a name="l02360"></a>02360 <span class="comment"># The SimAnimal() class is a placeholder used for simulating animals.</span>
<a name="l02361"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1SimAnimal.html">02361</a> <span class="keyword">class </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1SimAnimal.html" title="The SimAnimal() class is a placeholder used for simulating animals.">SimAnimal</a>:
<a name="l02362"></a>02362     <span class="stringliteral">&quot;&quot;&quot;The simple class is a placeholder used for simulating animals.&quot;&quot;&quot;</span>
<a name="l02363"></a>02363     <span class="comment">##</span>
<a name="l02364"></a>02364     <span class="comment"># __init__() initializes a SimAnimal() object.</span>
<a name="l02365"></a>02365     <span class="comment"># @param self Reference to current object.</span>
<a name="l02366"></a>02366     <span class="comment"># @param animalID Animal&#39;s ID.</span>
<a name="l02367"></a>02367     <span class="comment"># @param sireID Sire&#39;s ID.</span>
<a name="l02368"></a>02368     <span class="comment"># @param damID Dam&#39;s ID.</span>
<a name="l02369"></a>02369     <span class="comment"># @param sex Sex of animal.</span>
<a name="l02370"></a>02370     <span class="comment"># @param gen Generation to which an animal belongs.</span>
<a name="l02371"></a>02371     <span class="comment"># @retval An instance of a SimAnimal() object populated with data</span>
<a name="l02372"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1SimAnimal.html#a58e20d33884ff39a527a16ddaa2b2942">02372</a>     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1SimAnimal.html#a58e20d33884ff39a527a16ddaa2b2942" title="__init__() initializes a SimAnimal() object.">__init__</a>(self, animalID, sireID=0, damID=0, sex=&#39;u&#39;, gen=0):
<a name="l02373"></a>02373         self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1SimAnimal.html#a1ea4b52632b8f7196959a33050b70f91">animalID</a> = animalID
<a name="l02374"></a>02374         self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1SimAnimal.html#a14098db938e4814fe6b8cba3d145eb89">sireID</a> = sireID
<a name="l02375"></a>02375         self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1SimAnimal.html#a1d58d1a93972aafa0755f746343e68b6">damID</a> = damID
<a name="l02376"></a>02376         self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1SimAnimal.html#ab8da5a60230b354cf39f3d543355582c">sex</a> = sex
<a name="l02377"></a>02377         self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1SimAnimal.html#aa5c6d5d0976acd1cf7dbd50663d9ca00">gen</a> = gen
<a name="l02378"></a>02378 
<a name="l02379"></a>02379     <span class="comment">##</span>
<a name="l02380"></a>02380     <span class="comment"># printme() prints a summary of the data stored in a SimAnimal() object.</span>
<a name="l02381"></a>02381     <span class="comment"># @param self Reference to current object</span>
<a name="l02382"></a>02382     <span class="comment"># @retval None</span>
<a name="l02383"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1SimAnimal.html#aa8fd08d0ea72c11691a96b3476c6499d">02383</a>     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1SimAnimal.html#aa8fd08d0ea72c11691a96b3476c6499d" title="printme() prints a summary of the data stored in a SimAnimal() object.">printme</a>(self):
<a name="l02384"></a>02384         <span class="keywordflow">try</span>:
<a name="l02385"></a>02385             <span class="keywordflow">print</span> <span class="stringliteral">&#39;\t%s\t%s\t%s\t%s\t%s&#39;</span> % (self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1SimAnimal.html#a1ea4b52632b8f7196959a33050b70f91">animalID</a>, self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1SimAnimal.html#a14098db938e4814fe6b8cba3d145eb89">sireID</a>, \
<a name="l02386"></a>02386                 self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1SimAnimal.html#a1d58d1a93972aafa0755f746343e68b6">damID</a>, self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1SimAnimal.html#ab8da5a60230b354cf39f3d543355582c">sex</a>, self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1SimAnimal.html#aa5c6d5d0976acd1cf7dbd50663d9ca00">gen</a>)
<a name="l02387"></a>02387         <span class="keywordflow">except</span>:
<a name="l02388"></a>02388             <span class="keywordflow">pass</span>
<a name="l02389"></a>02389 
<a name="l02390"></a>02390     <span class="comment">##</span>
<a name="l02391"></a>02391     <span class="comment"># stringme() returns the data stored in a SimAnimal() object as a string.</span>
<a name="l02392"></a>02392     <span class="comment"># @param self Reference to current object</span>
<a name="l02393"></a>02393     <span class="comment"># @retval None</span>
<a name="l02394"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1SimAnimal.html#a7be8292fd4f0713e344461670ca6c47b">02394</a>     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1SimAnimal.html#a7be8292fd4f0713e344461670ca6c47b" title="stringme() returns the data stored in a SimAnimal() object as a string.">stringme</a>(self):
<a name="l02395"></a>02395         <span class="keywordflow">try</span>:
<a name="l02396"></a>02396             mystring =  <span class="stringliteral">&#39;%s %s %s %s %s&#39;</span> % (self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1SimAnimal.html#a1ea4b52632b8f7196959a33050b70f91">animalID</a>, self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1SimAnimal.html#a14098db938e4814fe6b8cba3d145eb89">sireID</a>, \
<a name="l02397"></a>02397                 self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1SimAnimal.html#a1d58d1a93972aafa0755f746343e68b6">damID</a>, self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1SimAnimal.html#ab8da5a60230b354cf39f3d543355582c">sex</a>, self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1SimAnimal.html#aa5c6d5d0976acd1cf7dbd50663d9ca00">gen</a>)
<a name="l02398"></a>02398             <span class="keywordflow">return</span> mystring
<a name="l02399"></a>02399         <span class="keywordflow">except</span>:
<a name="l02400"></a>02400             <span class="keywordflow">return</span> 0
<a name="l02401"></a>02401 
<a name="l02402"></a>02402 <span class="comment">##</span>
<a name="l02403"></a>02403 <span class="comment"># The NewAnimal() class is holds animals records read from a pedigree file.</span>
<a name="l02404"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html">02404</a> <span class="keyword">class </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html" title="The NewAnimal() class is holds animals records read from a pedigree file.">NewAnimal</a>:
<a name="l02405"></a>02405     <span class="stringliteral">&quot;&quot;&quot;A simple class to hold animapyp_utils/union(), and pyp_utils/intersection() ls records read from a pedigree file.&quot;&quot;&quot;</span>
<a name="l02406"></a>02406     <span class="comment">##</span>
<a name="l02407"></a>02407     <span class="comment"># __init__() initializes a NewAnimal() object.</span>
<a name="l02408"></a>02408     <span class="comment"># @param self Reference to current object.</span>
<a name="l02409"></a>02409     <span class="comment"># @param locations A dictionary containing the locations of variables in the input line.</span>
<a name="l02410"></a>02410     <span class="comment"># @param data The line of input read from the pedigree file.</span>
<a name="l02411"></a>02411     <span class="comment"># @param mykw A dictionary of keyword arguments.</span>
<a name="l02412"></a>02412     <span class="comment"># @retval An instance of a NewAnimal() object populated with data</span>
<a name="l02413"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#ab0d4dd46ff0e2683c670c36a270aba48">02413</a>     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#ab0d4dd46ff0e2683c670c36a270aba48" title="__init__() initializes a NewAnimal() object.">__init__</a>(self, locations, data, mykw):
<a name="l02414"></a>02414         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l02415"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a6964ed8c90747ba4c9aa4faa4c4ac70b">02415</a> <span class="stringliteral">        __init__() initializes a NewAnimal() object.</span>
<a name="l02416"></a>02416 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l02417"></a>02417         <span class="comment">#print locations</span>
<a name="l02418"></a>02418         <span class="comment">#print data</span>
<a name="l02419"></a>02419         <span class="keywordflow">if</span> locations[<span class="stringliteral">&#39;animal&#39;</span>] != -999:
<a name="l02420"></a>02420             <span class="comment"># If the animal&#39;s ID is actually a string, we need to be clever.</span>
<a name="l02421"></a>02421             <span class="comment"># Put a copy of the string in the &#39;Name&#39; field.  Then use the</span>
<a name="l02422"></a>02422             <span class="comment"># hash function to convert the ID to an integer.</span>
<a name="l02423"></a>02423             <span class="keywordflow">if</span> <span class="stringliteral">&#39;A&#39;</span> <span class="keywordflow">in</span> mykw[<span class="stringliteral">&#39;pedformat&#39;</span>]:
<a name="l02424"></a>02424                 <span class="keywordflow">if</span> mykw[<span class="stringliteral">&#39;newanimal_caller&#39;</span>] == <span class="stringliteral">&#39;addanimal&#39;</span>:
<a name="l02425"></a>02425                     self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a6964ed8c90747ba4c9aa4faa4c4ac70b">name</a> = str(data[locations[<span class="stringliteral">&#39;animal&#39;</span>]])
<a name="l02426"></a>02426                     self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a9179c1150f6a9ec9f1dafe1e2230b27c">animalID</a> = data[locations[<span class="stringliteral">&#39;animal&#39;</span>]]
<a name="l02427"></a>02427                     self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#ae6de83bb5180e95703c75a23fbbb778e">originalID</a> = data[locations[<span class="stringliteral">&#39;animal&#39;</span>]]
<a name="l02428"></a>02428                 <span class="keywordflow">else</span>:
<a name="l02429"></a>02429                     <span class="comment"># If the animal ID is not a string, we have to cast it</span>
<a name="l02430"></a>02430                     <span class="comment"># before we can strip it. At any rate, the animalName</span>
<a name="l02431"></a>02431                     <span class="comment"># needs to be a string.</span>
<a name="l02432"></a>02432                     self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a9179c1150f6a9ec9f1dafe1e2230b27c">animalID</a> = self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a1ca64b46fb81306492bf8a93a46f3ace" title="string_to_int() takes an Animal/Sire/Dam ID as a string and returns a hash.">string_to_int</a>(data[locations[<span class="stringliteral">&#39;animal&#39;</span>]])
<a name="l02433"></a>02433                     self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#ae6de83bb5180e95703c75a23fbbb778e">originalID</a> = self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a1ca64b46fb81306492bf8a93a46f3ace" title="string_to_int() takes an Animal/Sire/Dam ID as a string and returns a hash.">string_to_int</a>(data[locations[<span class="stringliteral">&#39;animal&#39;</span>]])
<a name="l02434"></a>02434                     self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a6964ed8c90747ba4c9aa4faa4c4ac70b">name</a> = string.strip(str(data[locations[<span class="stringliteral">&#39;animal&#39;</span>]]))
<a name="l02435"></a>02435             <span class="keywordflow">else</span>:
<a name="l02436"></a>02436                 <span class="keywordflow">if</span> locations[<span class="stringliteral">&#39;name&#39;</span>] != -999:
<a name="l02437"></a>02437                     self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a6964ed8c90747ba4c9aa4faa4c4ac70b">name</a> = string.strip(str(data[locations[<span class="stringliteral">&#39;name&#39;</span>]]))
<a name="l02438"></a>02438                 <span class="keywordflow">else</span>:
<a name="l02439"></a>02439                     self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a6964ed8c90747ba4c9aa4faa4c4ac70b">name</a> = string.strip(str(data[locations[<span class="stringliteral">&#39;animal&#39;</span>]]))
<a name="l02440"></a>02440                 self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a9179c1150f6a9ec9f1dafe1e2230b27c">animalID</a> = int(string.strip(str(data[locations[<span class="stringliteral">&#39;animal&#39;</span>]])))
<a name="l02441"></a>02441                 self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#ae6de83bb5180e95703c75a23fbbb778e">originalID</a> = int(string.strip(str(data[locations[<span class="stringliteral">&#39;animal&#39;</span>]])))
<a name="l02442"></a>02442         <span class="keywordflow">if</span> locations[<span class="stringliteral">&#39;sire&#39;</span>] != -999 <span class="keywordflow">and</span> str(data[locations[<span class="stringliteral">&#39;sire&#39;</span>]]) != str(mykw[<span class="stringliteral">&#39;missing_parent&#39;</span>]):
<a name="l02443"></a>02443             <span class="keywordflow">if</span> <span class="stringliteral">&#39;S&#39;</span> <span class="keywordflow">in</span> mykw[<span class="stringliteral">&#39;pedformat&#39;</span>]:
<a name="l02444"></a>02444                 self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a3914b4369807d228d8d772e924b6fca7">sireID</a> = self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a1ca64b46fb81306492bf8a93a46f3ace" title="string_to_int() takes an Animal/Sire/Dam ID as a string and returns a hash.">string_to_int</a>(data[locations[<span class="stringliteral">&#39;sire&#39;</span>]])
<a name="l02445"></a>02445             <span class="keywordflow">else</span>:
<a name="l02446"></a>02446                 <span class="comment"># We need to check types before trying to strip IDs. If the</span>
<a name="l02447"></a>02447                 <span class="comment"># ID is an integer, we&#39;re going to let the int() function</span>
<a name="l02448"></a>02448                 <span class="comment"># eat any leading or trailing whitespace.</span>
<a name="l02449"></a>02449                 <span class="keywordflow">if</span> type(data[locations[<span class="stringliteral">&#39;sire&#39;</span>]]) == <span class="stringliteral">&#39;str&#39;</span>:
<a name="l02450"></a>02450                     self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a3914b4369807d228d8d772e924b6fca7">sireID</a> = int(string.strip(data[locations[<span class="stringliteral">&#39;sire&#39;</span>]]))
<a name="l02451"></a>02451                 <span class="keywordflow">else</span>:
<a name="l02452"></a>02452                     self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a3914b4369807d228d8d772e924b6fca7">sireID</a> = int(data[locations[<span class="stringliteral">&#39;sire&#39;</span>]])
<a name="l02453"></a>02453             <span class="comment"># If the sire ID is not a string, we have to cast it before we</span>
<a name="l02454"></a>02454             <span class="comment"># can strip it. At any rate, the sireName needs to be a string.</span>
<a name="l02455"></a>02455             <span class="keywordflow">if</span> type(data[locations[<span class="stringliteral">&#39;sire&#39;</span>]]) == <span class="stringliteral">&#39;str&#39;</span>:
<a name="l02456"></a>02456                 self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#ad586dce8a670b43fbc993e5f85d14fd1">sireName</a> = string.strip(data[locations[<span class="stringliteral">&#39;sire&#39;</span>]])
<a name="l02457"></a>02457             <span class="keywordflow">else</span>:
<a name="l02458"></a>02458                 self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#ad586dce8a670b43fbc993e5f85d14fd1">sireName</a> = string.strip(str(data[locations[<span class="stringliteral">&#39;sire&#39;</span>]]))
<a name="l02459"></a>02459         <span class="keywordflow">else</span>:
<a name="l02460"></a>02460             self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a3914b4369807d228d8d772e924b6fca7">sireID</a> = mykw[<span class="stringliteral">&#39;missing_parent&#39;</span>]
<a name="l02461"></a>02461             self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#ad586dce8a670b43fbc993e5f85d14fd1">sireName</a> = mykw[<span class="stringliteral">&#39;missing_name&#39;</span>]
<a name="l02462"></a>02462         <span class="keywordflow">if</span> locations[<span class="stringliteral">&#39;dam&#39;</span>] != -999 <span class="keywordflow">and</span> str(data[locations[<span class="stringliteral">&#39;dam&#39;</span>]]) != str(mykw[<span class="stringliteral">&#39;missing_parent&#39;</span>]):
<a name="l02463"></a>02463             <span class="keywordflow">if</span> <span class="stringliteral">&#39;D&#39;</span> <span class="keywordflow">in</span> mykw[<span class="stringliteral">&#39;pedformat&#39;</span>]:
<a name="l02464"></a>02464                 self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#ae4cf86fd6caee3633a16305e5429db7f">damID</a> = self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a1ca64b46fb81306492bf8a93a46f3ace" title="string_to_int() takes an Animal/Sire/Dam ID as a string and returns a hash.">string_to_int</a>(str(data[locations[<span class="stringliteral">&#39;dam&#39;</span>]]))
<a name="l02465"></a>02465             <span class="keywordflow">else</span>:
<a name="l02466"></a>02466                 <span class="keywordflow">if</span> type(data[locations[<span class="stringliteral">&#39;dam&#39;</span>]]) == <span class="stringliteral">&#39;str&#39;</span>:
<a name="l02467"></a>02467                     self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#ae4cf86fd6caee3633a16305e5429db7f">damID</a> = int(string.strip(data[locations[<span class="stringliteral">&#39;dam&#39;</span>]]))
<a name="l02468"></a>02468                 <span class="keywordflow">else</span>:
<a name="l02469"></a>02469                     self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#ae4cf86fd6caee3633a16305e5429db7f">damID</a> = int(data[locations[<span class="stringliteral">&#39;dam&#39;</span>]])
<a name="l02470"></a>02470             <span class="keywordflow">if</span> type(data[locations[<span class="stringliteral">&#39;dam&#39;</span>]]) == <span class="stringliteral">&#39;str&#39;</span>:
<a name="l02471"></a>02471                 self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a110ad18404ec1b71aabb9747032964f5">damName</a> = string.strip(data[locations[<span class="stringliteral">&#39;dam&#39;</span>]])
<a name="l02472"></a>02472             <span class="keywordflow">else</span>:
<a name="l02473"></a>02473                 self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a110ad18404ec1b71aabb9747032964f5">damName</a> = string.strip(str(data[locations[<span class="stringliteral">&#39;dam&#39;</span>]]))
<a name="l02474"></a>02474         <span class="keywordflow">else</span>:
<a name="l02475"></a>02475             self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#ae4cf86fd6caee3633a16305e5429db7f">damID</a> = mykw[<span class="stringliteral">&#39;missing_parent&#39;</span>]
<a name="l02476"></a>02476             self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a110ad18404ec1b71aabb9747032964f5">damName</a> = mykw[<span class="stringliteral">&#39;missing_name&#39;</span>]
<a name="l02477"></a>02477         <span class="keywordflow">if</span> locations[<span class="stringliteral">&#39;generation&#39;</span>] != -999:
<a name="l02478"></a>02478             self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a136b52f107c16536bb66d48f9a647c3c">gen</a> = data[locations[<span class="stringliteral">&#39;generation&#39;</span>]]
<a name="l02479"></a>02479         <span class="keywordflow">else</span>:
<a name="l02480"></a>02480             <span class="comment">#self.gen = -999</span>
<a name="l02481"></a>02481         self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a136b52f107c16536bb66d48f9a647c3c">gen</a> =  mykw[<span class="stringliteral">&#39;missing_gen&#39;</span>]
<a name="l02482"></a>02482         <span class="keywordflow">if</span> locations[<span class="stringliteral">&#39;gencoeff&#39;</span>] != -999.:
<a name="l02483"></a>02483             self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#adf6c7752abd53174358499e842bb427c">gencoeff</a> = data[locations[<span class="stringliteral">&#39;gencoeff&#39;</span>]]
<a name="l02484"></a>02484         <span class="keywordflow">else</span>:
<a name="l02485"></a>02485             <span class="comment">#self.gencoeff = -999.</span>
<a name="l02486"></a>02486             self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#adf6c7752abd53174358499e842bb427c">gencoeff</a> =  mykw[<span class="stringliteral">&#39;missing_gencoeff&#39;</span>]
<a name="l02487"></a>02487         <span class="keywordflow">if</span> locations[<span class="stringliteral">&#39;sex&#39;</span>] != -999:
<a name="l02488"></a>02488             self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#aacab1d998ef864773b9b7afcefc6de62">sex</a> = string.strip(data[locations[<span class="stringliteral">&#39;sex&#39;</span>]]).lower()
<a name="l02489"></a>02489         <span class="keywordflow">else</span>:
<a name="l02490"></a>02490             self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#aacab1d998ef864773b9b7afcefc6de62">sex</a> = mykw[<span class="stringliteral">&#39;missing_sex&#39;</span>]
<a name="l02491"></a>02491         <span class="keywordflow">if</span> locations[<span class="stringliteral">&#39;birthdate&#39;</span>] != -999:
<a name="l02492"></a>02492             self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a3412431974527258914afaa5b4ba3612">bd</a> = string.strip(data[locations[<span class="stringliteral">&#39;birthdate&#39;</span>]])
<a name="l02493"></a>02493         <span class="keywordflow">else</span>:
<a name="l02494"></a>02494             self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a3412431974527258914afaa5b4ba3612">bd</a> = mykw[<span class="stringliteral">&#39;missing_bdate&#39;</span>]
<a name="l02495"></a>02495         <span class="keywordflow">if</span> locations[<span class="stringliteral">&#39;birthyear&#39;</span>] != -999:
<a name="l02496"></a>02496             self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a29265a16cb664dd695c22b234d460d28">by</a> = int(string.strip(data[locations[<span class="stringliteral">&#39;birthyear&#39;</span>]]))
<a name="l02497"></a>02497             <span class="keywordflow">if</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a29265a16cb664dd695c22b234d460d28">by</a> == 0:
<a name="l02498"></a>02498                 self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a29265a16cb664dd695c22b234d460d28">by</a> = mykw[<span class="stringliteral">&#39;missing_byear&#39;</span>]
<a name="l02499"></a>02499         <span class="keywordflow">elif</span> locations[<span class="stringliteral">&#39;birthyear&#39;</span>] == -999 <span class="keywordflow">and</span> locations[<span class="stringliteral">&#39;birthdate&#39;</span>] != -999:
<a name="l02500"></a>02500             self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a29265a16cb664dd695c22b234d460d28">by</a> = int(string.strip(data[locations[<span class="stringliteral">&#39;birthdate&#39;</span>]])[:4])
<a name="l02501"></a>02501         <span class="keywordflow">else</span>:
<a name="l02502"></a>02502             self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a29265a16cb664dd695c22b234d460d28">by</a> = mykw[<span class="stringliteral">&#39;missing_byear&#39;</span>]
<a name="l02503"></a>02503         <span class="keywordflow">if</span> locations[<span class="stringliteral">&#39;inbreeding&#39;</span>] != -999:
<a name="l02504"></a>02504             self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#ab85d6ac4ac9ee6b165aacb3e199b2ef8">fa</a> = float(string.strip(data[locations[<span class="stringliteral">&#39;inbreeding&#39;</span>]]))
<a name="l02505"></a>02505         <span class="keywordflow">else</span>:
<a name="l02506"></a>02506             <span class="comment">#self.fa = 0.</span>
<a name="l02507"></a>02507         self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#ab85d6ac4ac9ee6b165aacb3e199b2ef8">fa</a> =  mykw[<span class="stringliteral">&#39;missing_inbreeding&#39;</span>]
<a name="l02508"></a>02508         <span class="keywordflow">if</span> locations[<span class="stringliteral">&#39;breed&#39;</span>] != -999:
<a name="l02509"></a>02509             self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#afe9c0abd39d1baf4abe86b807afe11eb">breed</a> = string.strip(data[locations[<span class="stringliteral">&#39;breed&#39;</span>]])
<a name="l02510"></a>02510         <span class="keywordflow">else</span>:
<a name="l02511"></a>02511             self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#afe9c0abd39d1baf4abe86b807afe11eb">breed</a> = mykw[<span class="stringliteral">&#39;missing_breed&#39;</span>]
<a name="l02512"></a>02512         <span class="keywordflow">if</span> locations[<span class="stringliteral">&#39;age&#39;</span>] != -999:
<a name="l02513"></a>02513             self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a2b02edb3ee5871f71316d19312c97540">age</a> = int(string.strip(data[locations[<span class="stringliteral">&#39;age&#39;</span>]]))
<a name="l02514"></a>02514         <span class="keywordflow">else</span>:
<a name="l02515"></a>02515             <span class="comment">#self.age = -999</span>
<a name="l02516"></a>02516         self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a2b02edb3ee5871f71316d19312c97540">age</a> =  mykw[<span class="stringliteral">&#39;missing_age&#39;</span>]
<a name="l02517"></a>02517         <span class="keywordflow">if</span> locations[<span class="stringliteral">&#39;alive&#39;</span>] != -999:
<a name="l02518"></a>02518             self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a2a9a8477b11ae3f96b534bd08d191af1">alive</a> = int(string.strip(data[locations[<span class="stringliteral">&#39;alive&#39;</span>]]))
<a name="l02519"></a>02519         <span class="keywordflow">else</span>:
<a name="l02520"></a>02520             <span class="comment">#self.alive = 0</span>
<a name="l02521"></a>02521         self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a2a9a8477b11ae3f96b534bd08d191af1">alive</a> =  mykw[<span class="stringliteral">&#39;missing_alive&#39;</span>]
<a name="l02522"></a>02522         <span class="keywordflow">if</span> locations[<span class="stringliteral">&#39;herd&#39;</span>] != -999:
<a name="l02523"></a>02523             <span class="keywordflow">if</span> <span class="stringliteral">&#39;H&#39;</span> <span class="keywordflow">in</span> mykw[<span class="stringliteral">&#39;pedformat&#39;</span>]:
<a name="l02524"></a>02524                 self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#af9857f90de22168f81adecfdf6fb2aad">herd</a> = self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a1ca64b46fb81306492bf8a93a46f3ace" title="string_to_int() takes an Animal/Sire/Dam ID as a string and returns a hash.">string_to_int</a>(data[locations[<span class="stringliteral">&#39;herd&#39;</span>]])
<a name="l02525"></a>02525             <span class="keywordflow">else</span>:
<a name="l02526"></a>02526                 self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#af9857f90de22168f81adecfdf6fb2aad">herd</a> = int(string.strip(data[locations[<span class="stringliteral">&#39;herd&#39;</span>]]))
<a name="l02527"></a>02527             self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a35feef6204d73457274670ae73f0b8f4">originalHerd</a> = string.strip(data[locations[<span class="stringliteral">&#39;herd&#39;</span>]])
<a name="l02528"></a>02528         <span class="keywordflow">else</span>:
<a name="l02529"></a>02529             self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#af9857f90de22168f81adecfdf6fb2aad">herd</a> = self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a1ca64b46fb81306492bf8a93a46f3ace" title="string_to_int() takes an Animal/Sire/Dam ID as a string and returns a hash.">string_to_int</a>(mykw[<span class="stringliteral">&#39;missing_herd&#39;</span>])
<a name="l02530"></a>02530             self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a35feef6204d73457274670ae73f0b8f4">originalHerd</a> = mykw[<span class="stringliteral">&#39;missing_herd&#39;</span>]
<a name="l02531"></a>02531         self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a7e07e36ddf72e013261b248e242b0240">renumberedID</a> = -999
<a name="l02532"></a>02532     self.igen =  mykw[<span class="stringliteral">&#39;missing_igen&#39;</span>]
<a name="l02533"></a>02533         <span class="keywordflow">if</span> str(self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a3914b4369807d228d8d772e924b6fca7">sireID</a>) == str(mykw[<span class="stringliteral">&#39;missing_parent&#39;</span>]) <span class="keywordflow">and</span> str(self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#ae4cf86fd6caee3633a16305e5429db7f">damID</a>) == str(mykw[<span class="stringliteral">&#39;missing_parent&#39;</span>]):
<a name="l02534"></a>02534             self.founder = <span class="stringliteral">&#39;y&#39;</span>
<a name="l02535"></a>02535         <span class="keywordflow">else</span>:
<a name="l02536"></a>02536             self.founder = <span class="stringliteral">&#39;n&#39;</span>
<a name="l02537"></a>02537         self.paddedID = self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#afc05804f6dd528ab5bf0b8a39e543ce9" title="pad_id() takes an Animal ID, pads it to fifteen digits, and prepends the birthyear (or 1950 if the bi...">pad_id</a>()
<a name="l02538"></a>02538         self.ancestor = 0
<a name="l02539"></a>02539         self.sons = {}
<a name="l02540"></a>02540         self.daus = {}
<a name="l02541"></a>02541         self.unks = {}
<a name="l02542"></a>02542         <span class="comment"># Assign alleles for use in gene-dropping runs.  Automatically assign two</span>
<a name="l02543"></a>02543         <span class="comment"># distinct alleles to founders.</span>
<a name="l02544"></a>02544         <span class="keywordflow">if</span> locations[<span class="stringliteral">&#39;alleles&#39;</span>] != -999:
<a name="l02545"></a>02545             self.alleles = [string.split(data[locations[<span class="stringliteral">&#39;alleles&#39;</span>]], self.kw[<span class="stringliteral">&#39;alleles_sepchar&#39;</span>])[0], \
<a name="l02546"></a>02546                 string.split(data[locations[<span class="stringliteral">&#39;alleles&#39;</span>]],self.kw[<span class="stringliteral">&#39;alleles_sepchar&#39;</span>])[1]]
<a name="l02547"></a>02547         <span class="keywordflow">else</span>:
<a name="l02548"></a>02548             <span class="comment"># Founders contribute two novel alleles</span>
<a name="l02549"></a>02549             <span class="keywordflow">if</span> self.founder == <span class="stringliteral">&#39;y&#39;</span>:
<a name="l02550"></a>02550                 _allele_1 = <span class="stringliteral">&#39;%s%s&#39;</span> % (self.paddedID,<span class="stringliteral">&#39;__1&#39;</span>)
<a name="l02551"></a>02551                 _allele_2 = <span class="stringliteral">&#39;%s%s&#39;</span> % (self.paddedID,<span class="stringliteral">&#39;__2&#39;</span>)
<a name="l02552"></a>02552                 self.alleles = [_allele_1,_allele_2]
<a name="l02553"></a>02553             <span class="comment"># Half-founders contribute one novel allele</span>
<a name="l02554"></a>02554             <span class="keywordflow">elif</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a3914b4369807d228d8d772e924b6fca7">sireID</a> == mykw[<span class="stringliteral">&#39;missing_parent&#39;</span>]:
<a name="l02555"></a>02555                 _allele_1 = <span class="stringliteral">&#39;%s%s&#39;</span> % (self.paddedID,<span class="stringliteral">&#39;__1&#39;</span>)
<a name="l02556"></a>02556                 _allele_2 = <span class="stringliteral">&#39;&#39;</span>
<a name="l02557"></a>02557                 self.alleles = [_allele_1,_allele_2]
<a name="l02558"></a>02558             <span class="keywordflow">elif</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#ae4cf86fd6caee3633a16305e5429db7f">damID</a> == mykw[<span class="stringliteral">&#39;missing_parent&#39;</span>]:
<a name="l02559"></a>02559                 _allele_1 = <span class="stringliteral">&#39;&#39;</span>
<a name="l02560"></a>02560                 _allele_2 = <span class="stringliteral">&#39;%s%s&#39;</span> % (self.paddedID,<span class="stringliteral">&#39;__2&#39;</span>)
<a name="l02561"></a>02561                 self.alleles = [_allele_1,_allele_2]
<a name="l02562"></a>02562             <span class="keywordflow">else</span>:
<a name="l02563"></a>02563                 <span class="comment">#self.alleles = [&#39;&#39;,&#39;&#39;]</span>
<a name="l02564"></a>02564         self.alleles = mkyw[<span class="stringliteral">&#39;missing_alleles&#39;</span>]
<a name="l02565"></a>02565         <span class="comment">#self.pedcomp = -999.9</span>
<a name="l02566"></a>02566     self.pedcomp =  mykw[<span class="stringliteral">&#39;missing_pedcomp&#39;</span>]
<a name="l02567"></a>02567         <span class="keywordflow">if</span> locations[<span class="stringliteral">&#39;userfield&#39;</span>] != -999:
<a name="l02568"></a>02568             self.userField = string.strip(data[locations[<span class="stringliteral">&#39;userfield&#39;</span>]])
<a name="l02569"></a>02569         <span class="keywordflow">else</span>:
<a name="l02570"></a>02570             <span class="comment">#self.userField = &#39;&#39;</span>
<a name="l02571"></a>02571         self.userField = mykw[<span class="stringliteral">&#39;missing_userfield&#39;</span>]
<a name="l02572"></a>02572         <span class="comment"># print &#39;%s\t%s\t%s&#39; % (self.animalID, self.sireID, self.damID)</span>
<a name="l02573"></a>02573 
<a name="l02574"></a>02574     <span class="comment">##</span>
<a name="l02575"></a>02575     <span class="comment"># The NewAnimal class is not iterable, so raise an exception if anyonw tries it.</span>
<a name="l02576"></a>02576     <span class="comment"># @param self Reference to current object</span>
<a name="l02577"></a>02577     <span class="comment"># @retval None</span>
<a name="l02578"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a1fcb3af402b8a9a0f8779d8c466300c2">02578</a>     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a1fcb3af402b8a9a0f8779d8c466300c2" title="The NewAnimal class is not iterable, so raise an exception if anyonw tries it.">__iter__</a>(self):
<a name="l02579"></a>02579         <span class="keywordflow">raise</span> Exception(<span class="stringliteral">&quot;The NewAnimal class is not iterable&quot;</span>)
<a name="l02580"></a>02580 
<a name="l02581"></a>02581     <span class="comment">##</span>
<a name="l02582"></a>02582     <span class="comment"># printme() prints a summary of the data stored in the NewAnimal() object.</span>
<a name="l02583"></a>02583     <span class="comment"># @param self Reference to current object</span>
<a name="l02584"></a>02584     <span class="comment"># @retval None</span>
<a name="l02585"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#aa3dbef8ded04c8e33c2d4f45fb98773a">02585</a>     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#aa3dbef8ded04c8e33c2d4f45fb98773a" title="printme() prints a summary of the data stored in the NewAnimal() object.">printme</a>(self):
<a name="l02586"></a>02586         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l02587"></a>02587 <span class="stringliteral">        Print the contents of an animal record - used for debugging.</span>
<a name="l02588"></a>02588 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l02589"></a>02589         <span class="keywordflow">print</span> <span class="stringliteral">&#39;ANIMAL %s RECORD&#39;</span> % (self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a9179c1150f6a9ec9f1dafe1e2230b27c">animalID</a>)
<a name="l02590"></a>02590         <span class="keywordflow">print</span> <span class="stringliteral">&#39;\tAnimal ID:\t%s&#39;</span> % (self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a9179c1150f6a9ec9f1dafe1e2230b27c">animalID</a>)
<a name="l02591"></a>02591         <span class="keywordflow">print</span> <span class="stringliteral">&#39;\tAnimal name:\t%s&#39;</span> % (self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a6964ed8c90747ba4c9aa4faa4c4ac70b">name</a>)
<a name="l02592"></a>02592         <span class="keywordflow">print</span> <span class="stringliteral">&#39;\tSire ID:\t%s&#39;</span> % (self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a3914b4369807d228d8d772e924b6fca7">sireID</a>)
<a name="l02593"></a>02593         <span class="keywordflow">print</span> <span class="stringliteral">&#39;\tSire name:\t%s&#39;</span> % (self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#ad586dce8a670b43fbc993e5f85d14fd1">sireName</a>)
<a name="l02594"></a>02594         <span class="keywordflow">print</span> <span class="stringliteral">&#39;\tDam ID:\t\t%s&#39;</span> % (self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#ae4cf86fd6caee3633a16305e5429db7f">damID</a>)
<a name="l02595"></a>02595         <span class="keywordflow">print</span> <span class="stringliteral">&#39;\tDam name:\t%s&#39;</span> % (self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a110ad18404ec1b71aabb9747032964f5">damName</a>)
<a name="l02596"></a>02596         <span class="keywordflow">print</span> <span class="stringliteral">&#39;\tGeneration:\t%s&#39;</span> % (self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a136b52f107c16536bb66d48f9a647c3c">gen</a>)
<a name="l02597"></a>02597         <span class="keywordflow">print</span> <span class="stringliteral">&#39;\tGen coeff:\t%s&#39;</span> % (self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#adf6c7752abd53174358499e842bb427c">gencoeff</a>)
<a name="l02598"></a>02598         <span class="keywordflow">print</span> <span class="stringliteral">&#39;\tInferred gen.:\t%s&#39;</span> % (self.igen)
<a name="l02599"></a>02599         <span class="keywordflow">print</span> <span class="stringliteral">&#39;\tBirth Year:\t%s&#39;</span> % (self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a29265a16cb664dd695c22b234d460d28">by</a>)
<a name="l02600"></a>02600         <span class="keywordflow">print</span> <span class="stringliteral">&#39;\tBirth Date:\t%s&#39;</span> % (self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a3412431974527258914afaa5b4ba3612">bd</a>)
<a name="l02601"></a>02601         <span class="keywordflow">print</span> <span class="stringliteral">&#39;\tSex:\t\t%s&#39;</span> % (self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#aacab1d998ef864773b9b7afcefc6de62">sex</a>)
<a name="l02602"></a>02602         <span class="keywordflow">print</span> <span class="stringliteral">&#39;\tCoI (f_a):\t%s&#39;</span> % (self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#ab85d6ac4ac9ee6b165aacb3e199b2ef8">fa</a>)
<a name="l02603"></a>02603         <span class="keywordflow">print</span> <span class="stringliteral">&#39;\tFounder:\t%s&#39;</span> % (self.founder)
<a name="l02604"></a>02604         <span class="keywordflow">print</span> <span class="stringliteral">&#39;\tSons:\t\t%s&#39;</span> % (self.sons)
<a name="l02605"></a>02605         <span class="keywordflow">print</span> <span class="stringliteral">&#39;\tDaughters:\t%s&#39;</span> % (self.daus)
<a name="l02606"></a>02606         <span class="keywordflow">print</span> <span class="stringliteral">&#39;\tUnknowns:\t%s&#39;</span> % (self.unks)
<a name="l02607"></a>02607         <span class="keywordflow">print</span> <span class="stringliteral">&#39;\tAncestor:\t%s&#39;</span> % (self.ancestor)
<a name="l02608"></a>02608         <span class="keywordflow">print</span> <span class="stringliteral">&#39;\tAlleles:\t%s&#39;</span> % (self.alleles)
<a name="l02609"></a>02609         <span class="keywordflow">print</span> <span class="stringliteral">&#39;\tOriginal ID:\t%s&#39;</span> % (self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#ae6de83bb5180e95703c75a23fbbb778e">originalID</a>)
<a name="l02610"></a>02610         <span class="keywordflow">print</span> <span class="stringliteral">&#39;\tRenumbered ID:\t%s&#39;</span> % (self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a7e07e36ddf72e013261b248e242b0240">renumberedID</a>)
<a name="l02611"></a>02611         <span class="keywordflow">print</span> <span class="stringliteral">&#39;\tPedigree Comp.:\t%s&#39;</span> % (self.pedcomp)
<a name="l02612"></a>02612         <span class="keywordflow">print</span> <span class="stringliteral">&#39;\tBreed:\t%s&#39;</span> % (self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#afe9c0abd39d1baf4abe86b807afe11eb">breed</a>)
<a name="l02613"></a>02613         <span class="keywordflow">print</span> <span class="stringliteral">&#39;\tAge:\t%s&#39;</span> % (self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a2b02edb3ee5871f71316d19312c97540">age</a>)
<a name="l02614"></a>02614         <span class="keywordflow">print</span> <span class="stringliteral">&#39;\tAlive:\t%s&#39;</span> % (self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a2a9a8477b11ae3f96b534bd08d191af1">alive</a>)
<a name="l02615"></a>02615         <span class="keywordflow">print</span> <span class="stringliteral">&#39;\tHerd:\t%s&#39;</span> % (self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#af9857f90de22168f81adecfdf6fb2aad">herd</a>)
<a name="l02616"></a>02616         <span class="keywordflow">print</span> <span class="stringliteral">&#39;\tHerd name:\t%s&#39;</span> % (self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a35feef6204d73457274670ae73f0b8f4">originalHerd</a>)
<a name="l02617"></a>02617         <span class="keywordflow">if</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a35feef6204d73457274670ae73f0b8f4">originalHerd</a> != <span class="stringliteral">&#39;&#39;</span>:
<a name="l02618"></a>02618             <span class="keywordflow">print</span> <span class="stringliteral">&#39;\tUser field:\t%s&#39;</span> % (self.userField)
<a name="l02619"></a>02619     <span class="comment">##</span>
<a name="l02620"></a>02620     <span class="comment"># stringme() returns a summary of the data stored in the NewAnimal() object</span>
<a name="l02621"></a>02621     <span class="comment"># as a string.</span>
<a name="l02622"></a>02622     <span class="comment"># @param self Reference to current object</span>
<a name="l02623"></a>02623     <span class="comment"># @retval None</span>
<a name="l02624"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#ab2618a6a1bf2fac243a19799e60b5195">02624</a>     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#ab2618a6a1bf2fac243a19799e60b5195" title="stringme() returns a summary of the data stored in the NewAnimal() object as a string.">stringme</a>(self):
<a name="l02625"></a>02625         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l02626"></a>02626 <span class="stringliteral">        Return the contents of an animal record as a string.</span>
<a name="l02627"></a>02627 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l02628"></a>02628         _me = <span class="stringliteral">&#39;&#39;</span>
<a name="l02629"></a>02629         _me = <span class="stringliteral">&#39;%s%s&#39;</span> % ( _me, <span class="stringliteral">&#39;ANIMAL %s RECORD\n&#39;</span> % (int(self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a9179c1150f6a9ec9f1dafe1e2230b27c">animalID</a>)) )
<a name="l02630"></a>02630         _me = <span class="stringliteral">&#39;%s%s&#39;</span> % ( _me, <span class="stringliteral">&#39;\tAnimal ID:\t%s\n&#39;</span> % (int(self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a9179c1150f6a9ec9f1dafe1e2230b27c">animalID</a>)) )
<a name="l02631"></a>02631         _me = <span class="stringliteral">&#39;%s%s&#39;</span> % ( _me, <span class="stringliteral">&#39;\tAnimal name:\t%s\n&#39;</span> % (self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a6964ed8c90747ba4c9aa4faa4c4ac70b">name</a>) )
<a name="l02632"></a>02632         _me = <span class="stringliteral">&#39;%s%s&#39;</span> % ( _me, <span class="stringliteral">&#39;\tSire ID:\t%s\n&#39;</span> % (int(self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a3914b4369807d228d8d772e924b6fca7">sireID</a>)) )
<a name="l02633"></a>02633         _me = <span class="stringliteral">&#39;%s%s&#39;</span> % ( _me, <span class="stringliteral">&#39;\tSire name:\t%s\n&#39;</span> % (self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#ad586dce8a670b43fbc993e5f85d14fd1">sireName</a>) )
<a name="l02634"></a>02634         _me = <span class="stringliteral">&#39;%s%s&#39;</span> % ( _me, <span class="stringliteral">&#39;\tDam ID:\t\t%s\n&#39;</span> % (int(self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#ae4cf86fd6caee3633a16305e5429db7f">damID</a>)) )
<a name="l02635"></a>02635         _me = <span class="stringliteral">&#39;%s%s&#39;</span> % ( _me, <span class="stringliteral">&#39;\tDam name:\t%s\n&#39;</span> % (self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a110ad18404ec1b71aabb9747032964f5">damName</a>) )
<a name="l02636"></a>02636         _me = <span class="stringliteral">&#39;%s%s&#39;</span> % ( _me, <span class="stringliteral">&#39;\tGeneration:\t%s\n&#39;</span> % (self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a136b52f107c16536bb66d48f9a647c3c">gen</a>) )
<a name="l02637"></a>02637         _me = <span class="stringliteral">&#39;%s%s&#39;</span> % ( _me, <span class="stringliteral">&#39;\tGen coeff:\t%s\n&#39;</span> % (self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#adf6c7752abd53174358499e842bb427c">gencoeff</a>) )
<a name="l02638"></a>02638         _me = <span class="stringliteral">&#39;%s%s&#39;</span> % ( _me, <span class="stringliteral">&#39;\tInferred gen.:\t%s\n&#39;</span> % (self.igen) )
<a name="l02639"></a>02639         _me = <span class="stringliteral">&#39;%s%s&#39;</span> % ( _me, <span class="stringliteral">&#39;\tBirth Year:\t%s\n&#39;</span> % (int(self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a29265a16cb664dd695c22b234d460d28">by</a>)) )
<a name="l02640"></a>02640         _me = <span class="stringliteral">&#39;%s%s&#39;</span> % ( _me, <span class="stringliteral">&#39;\tBirth Date:\t%s\n&#39;</span> % (int(self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a3412431974527258914afaa5b4ba3612">bd</a>)) )
<a name="l02641"></a>02641         _me = <span class="stringliteral">&#39;%s%s&#39;</span> % ( _me, <span class="stringliteral">&#39;\tSex:\t\t%s\n&#39;</span> % (self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#aacab1d998ef864773b9b7afcefc6de62">sex</a>) )
<a name="l02642"></a>02642         _me = <span class="stringliteral">&#39;%s%s&#39;</span> % ( _me, <span class="stringliteral">&#39;\tCoI (f_a):\t%s\n&#39;</span> % (self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#ab85d6ac4ac9ee6b165aacb3e199b2ef8">fa</a>) )
<a name="l02643"></a>02643         _me = <span class="stringliteral">&#39;%s%s&#39;</span> % ( _me, <span class="stringliteral">&#39;\tFounder:\t%s\n&#39;</span> % (self.founder) )
<a name="l02644"></a>02644         _me = <span class="stringliteral">&#39;%s%s&#39;</span> % ( _me, <span class="stringliteral">&#39;\tSons:\t\t%s\n&#39;</span> % (self.sons) )
<a name="l02645"></a>02645         _me = <span class="stringliteral">&#39;%s%s&#39;</span> % ( _me, <span class="stringliteral">&#39;\tDaughters:\t%s\n&#39;</span> % (self.daus) )
<a name="l02646"></a>02646         _me = <span class="stringliteral">&#39;%s%s&#39;</span> % ( _me, <span class="stringliteral">&#39;\tUnknowns:\t%s\n&#39;</span> % (self.unks) )
<a name="l02647"></a>02647         _me = <span class="stringliteral">&#39;%s%s&#39;</span> % ( _me, <span class="stringliteral">&#39;\tAncestor:\t%s\n&#39;</span> % (self.ancestor) )
<a name="l02648"></a>02648         _me = <span class="stringliteral">&#39;%s%s&#39;</span> % ( _me, <span class="stringliteral">&#39;\tAlleles:\t%s\n&#39;</span> % (self.alleles) )
<a name="l02649"></a>02649         _me = <span class="stringliteral">&#39;%s%s&#39;</span> % ( _me, <span class="stringliteral">&#39;\tOriginal ID:\t%s\n&#39;</span> % (self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#ae6de83bb5180e95703c75a23fbbb778e">originalID</a>) )
<a name="l02650"></a>02650         _me = <span class="stringliteral">&#39;%s%s&#39;</span> % ( _me, <span class="stringliteral">&#39;\tRenumbered ID:\t%s\n&#39;</span> % (self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a7e07e36ddf72e013261b248e242b0240">renumberedID</a>) )
<a name="l02651"></a>02651         _me = <span class="stringliteral">&#39;%s%s&#39;</span> % ( _me, <span class="stringliteral">&#39;\tPedigree Comp.:\t%s\n&#39;</span> % (self.pedcomp) )
<a name="l02652"></a>02652         _me = <span class="stringliteral">&#39;%s%s&#39;</span> % ( _me, <span class="stringliteral">&#39;\tBreed:\t%s&#39;</span> % (self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#afe9c0abd39d1baf4abe86b807afe11eb">breed</a>) )
<a name="l02653"></a>02653         _me = <span class="stringliteral">&#39;%s%s&#39;</span> % ( _me, <span class="stringliteral">&#39;\tAge:\t%s&#39;</span> % (self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a2b02edb3ee5871f71316d19312c97540">age</a>) )
<a name="l02654"></a>02654         _me = <span class="stringliteral">&#39;%s%s&#39;</span> % ( _me, <span class="stringliteral">&#39;\tAlive:\t%s&#39;</span> % (self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a2a9a8477b11ae3f96b534bd08d191af1">alive</a>) )
<a name="l02655"></a>02655         _me = <span class="stringliteral">&#39;%s%s&#39;</span> % ( _me, <span class="stringliteral">&#39;\tHerd:\t%s\n&#39;</span> % (self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#af9857f90de22168f81adecfdf6fb2aad">herd</a>) )
<a name="l02656"></a>02656         _me = <span class="stringliteral">&#39;%s%s&#39;</span> % ( _me, <span class="stringliteral">&#39;\tHerd name:\t%s\n&#39;</span> % (self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a35feef6204d73457274670ae73f0b8f4">originalHerd</a>) )
<a name="l02657"></a>02657         <span class="keywordflow">if</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a35feef6204d73457274670ae73f0b8f4">originalHerd</a> != <span class="stringliteral">&#39;&#39;</span>:
<a name="l02658"></a>02658             _me = <span class="stringliteral">&#39;%s%s&#39;</span> % ( _me, <span class="stringliteral">&#39;\tUser field:\t%s\n&#39;</span> % (self.userField) )
<a name="l02659"></a>02659         <span class="keywordflow">return</span> _me
<a name="l02660"></a>02660 
<a name="l02661"></a>02661     <span class="comment">##</span>
<a name="l02662"></a>02662     <span class="comment"># dictme() returns a summary of the data stored in the NewAnimal() object</span>
<a name="l02663"></a>02663     <span class="comment"># as a dictionary.</span>
<a name="l02664"></a>02664     <span class="comment"># @param self Reference to current object</span>
<a name="l02665"></a>02665     <span class="comment"># @retval None</span>
<a name="l02666"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#af44ae249e4d1bada4a80357328f2b66d">02666</a>     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#af44ae249e4d1bada4a80357328f2b66d" title="dictme() returns a summary of the data stored in the NewAnimal() object as a dictionary.">dictme</a>(self):
<a name="l02667"></a>02667         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l02668"></a>02668 <span class="stringliteral">        Return the contents of an animal record in a dictionary.</span>
<a name="l02669"></a>02669 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l02670"></a>02670         <span class="keywordflow">try</span>:
<a name="l02671"></a>02671             _dict = {}
<a name="l02672"></a>02672             _dict[animalID] = self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a9179c1150f6a9ec9f1dafe1e2230b27c">animalID</a>
<a name="l02673"></a>02673             _dict[name] = self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a6964ed8c90747ba4c9aa4faa4c4ac70b">name</a>
<a name="l02674"></a>02674             _dict[sireID] = self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a3914b4369807d228d8d772e924b6fca7">sireID</a>
<a name="l02675"></a>02675             _dict[sireName] = self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#ad586dce8a670b43fbc993e5f85d14fd1">sireName</a>
<a name="l02676"></a>02676             _dict[damID] = self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#ae4cf86fd6caee3633a16305e5429db7f">damID</a>
<a name="l02677"></a>02677             _dict[damName] = self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a110ad18404ec1b71aabb9747032964f5">damName</a>
<a name="l02678"></a>02678             _dict[gen] = self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a136b52f107c16536bb66d48f9a647c3c">gen</a>
<a name="l02679"></a>02679             _dict[gencoeff] = self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#adf6c7752abd53174358499e842bb427c">gencoeff</a>
<a name="l02680"></a>02680             _dict[igen] = self.igen
<a name="l02681"></a>02681             _dict[by] = self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a29265a16cb664dd695c22b234d460d28">by</a>
<a name="l02682"></a>02682             _dict[bd] = self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a3412431974527258914afaa5b4ba3612">bd</a>
<a name="l02683"></a>02683             _dict[sex] = self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#aacab1d998ef864773b9b7afcefc6de62">sex</a>
<a name="l02684"></a>02684             _dict[fa] = self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#ab85d6ac4ac9ee6b165aacb3e199b2ef8">fa</a>
<a name="l02685"></a>02685             _dict[founder] = self.founder
<a name="l02686"></a>02686             _dict[sons] = self.sons
<a name="l02687"></a>02687             _dict[daus] = self.daus
<a name="l02688"></a>02688             _dict[unks] = self.unks
<a name="l02689"></a>02689             _dict[ancestor] = self.ancestor
<a name="l02690"></a>02690             _dict[alleles] = self.alleles
<a name="l02691"></a>02691             _dict[originalID] = self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#ae6de83bb5180e95703c75a23fbbb778e">originalID</a>
<a name="l02692"></a>02692             _dict[renumberedID] = self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a7e07e36ddf72e013261b248e242b0240">renumberedID</a>
<a name="l02693"></a>02693             _dict[pedcomp] = self.pedcomp
<a name="l02694"></a>02694             _dict[breed] = self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#afe9c0abd39d1baf4abe86b807afe11eb">breed</a>
<a name="l02695"></a>02695             _dict[age] = self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a2b02edb3ee5871f71316d19312c97540">age</a>
<a name="l02696"></a>02696             _dict[alive] = self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a2a9a8477b11ae3f96b534bd08d191af1">alive</a>
<a name="l02697"></a>02697             _dict[herd] = self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#af9857f90de22168f81adecfdf6fb2aad">herd</a>
<a name="l02698"></a>02698             _dict[originalHerd] = self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a35feef6204d73457274670ae73f0b8f4">originalHerd</a>
<a name="l02699"></a>02699             <span class="keywordflow">return</span> _dict
<a name="l02700"></a>02700         <span class="keywordflow">except</span>:
<a name="l02701"></a>02701             <span class="keywordflow">return</span> {}
<a name="l02702"></a>02702 
<a name="l02703"></a>02703     <span class="comment">##</span>
<a name="l02704"></a>02704     <span class="comment"># trap() checks for common errors in NewAnimal() objects</span>
<a name="l02705"></a>02705     <span class="comment"># @param self Reference to current object</span>
<a name="l02706"></a>02706     <span class="comment"># @retval None</span>
<a name="l02707"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a7e0f99289cd0d36e391d3f0655bbd694">02707</a>     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a7e0f99289cd0d36e391d3f0655bbd694" title="trap() checks for common errors in NewAnimal() objects">trap</a>(self):
<a name="l02708"></a>02708         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l02709"></a>02709 <span class="stringliteral">        Trap common errors in pedigree file entries.</span>
<a name="l02710"></a>02710 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l02711"></a>02711         <span class="keywordflow">if</span> int(self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a9179c1150f6a9ec9f1dafe1e2230b27c">animalID</a>) == int(self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a3914b4369807d228d8d772e924b6fca7">sireID</a>):
<a name="l02712"></a>02712             <span class="keywordflow">print</span> <span class="stringliteral">&#39;[ERROR]: Animal %s has an ID number equal to its sire\&#39;s ID (sire ID %s).\n&#39;</span> % (self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a9179c1150f6a9ec9f1dafe1e2230b27c">animalID</a>,self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a3914b4369807d228d8d772e924b6fca7">sireID</a>)
<a name="l02713"></a>02713         <span class="keywordflow">if</span> int(self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a9179c1150f6a9ec9f1dafe1e2230b27c">animalID</a>) == int(self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#ae4cf86fd6caee3633a16305e5429db7f">damID</a>):
<a name="l02714"></a>02714             <span class="keywordflow">print</span> <span class="stringliteral">&#39;[ERROR]: Animal %s has an ID number equal to its dam\&#39;s ID (dam ID %s).\n&#39;</span> % (self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a9179c1150f6a9ec9f1dafe1e2230b27c">animalID</a>,self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#ae4cf86fd6caee3633a16305e5429db7f">damID</a>)
<a name="l02715"></a>02715         <span class="keywordflow">if</span> int(self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a9179c1150f6a9ec9f1dafe1e2230b27c">animalID</a>) &lt; int(self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a3914b4369807d228d8d772e924b6fca7">sireID</a>):
<a name="l02716"></a>02716             <span class="keywordflow">print</span> <span class="stringliteral">&#39;[ERROR]: Animal %s is older than its sire (sire ID %s).\n&#39;</span> % (self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a9179c1150f6a9ec9f1dafe1e2230b27c">animalID</a>,self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a3914b4369807d228d8d772e924b6fca7">sireID</a>)
<a name="l02717"></a>02717         <span class="keywordflow">if</span> int(self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a9179c1150f6a9ec9f1dafe1e2230b27c">animalID</a>) &lt; int(self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#ae4cf86fd6caee3633a16305e5429db7f">damID</a>):
<a name="l02718"></a>02718             <span class="keywordflow">print</span> <span class="stringliteral">&#39;[ERROR]: Animal %s is older than its dam (dam ID %s).\n&#39;</span> % (self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a9179c1150f6a9ec9f1dafe1e2230b27c">animalID</a>,self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#ae4cf86fd6caee3633a16305e5429db7f">damID</a>)
<a name="l02719"></a>02719     <span class="comment">##</span>
<a name="l02720"></a>02720     <span class="comment"># pad_id() takes an Animal ID, pads it to fifteen digits, and prepends the birthyear</span>
<a name="l02721"></a>02721     <span class="comment"># (or 1950 if the birth year is unknown).  The order of elements is: birthyear, animalID,</span>
<a name="l02722"></a>02722     <span class="comment"># count of zeros, zeros.</span>
<a name="l02723"></a>02723     <span class="comment"># @param self Reference to current object</span>
<a name="l02724"></a>02724     <span class="comment"># @retval A padded ID number that is supposed to be unique across animals</span>
<a name="l02725"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#afc05804f6dd528ab5bf0b8a39e543ce9">02725</a>     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#afc05804f6dd528ab5bf0b8a39e543ce9" title="pad_id() takes an Animal ID, pads it to fifteen digits, and prepends the birthyear (or 1950 if the bi...">pad_id</a>(self):
<a name="l02726"></a>02726         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l02727"></a>02727 <span class="stringliteral">        Take an Animal ID, pad it to fifteen digits, and prepend the birthyear (or 1900</span>
<a name="l02728"></a>02728 <span class="stringliteral">        if the birth year is unknown).  The order of elements is: birthyear, animalID,</span>
<a name="l02729"></a>02729 <span class="stringliteral">        count of zeros, zeros.</span>
<a name="l02730"></a>02730 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l02731"></a>02731         <span class="comment">#print &#39;Animal ID: &#39;, self.animalID</span>
<a name="l02732"></a>02732         l = len(str(self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a9179c1150f6a9ec9f1dafe1e2230b27c">animalID</a>))
<a name="l02733"></a>02733         pl = 15 - l - 1
<a name="l02734"></a>02734         <span class="keywordflow">if</span> pl &gt; 0:
<a name="l02735"></a>02735             zs = <span class="stringliteral">&#39;0&#39;</span>*pl
<a name="l02736"></a>02736             pid = <span class="stringliteral">&#39;%s%s%s%s&#39;</span> % (self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a29265a16cb664dd695c22b234d460d28">by</a>,zs,self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a9179c1150f6a9ec9f1dafe1e2230b27c">animalID</a>,l)
<a name="l02737"></a>02737         <span class="keywordflow">else</span>:
<a name="l02738"></a>02738             pid = <span class="stringliteral">&#39;%s%s%s&#39;</span> % (self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a29265a16cb664dd695c22b234d460d28">by</a>,self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a9179c1150f6a9ec9f1dafe1e2230b27c">animalID</a>,l)
<a name="l02739"></a>02739         <span class="keywordflow">return</span> pid
<a name="l02740"></a>02740 
<a name="l02741"></a>02741     <span class="comment">##</span>
<a name="l02742"></a>02742     <span class="comment"># string_to_int() takes an Animal/Sire/Dam ID as a string and returns a</span>
<a name="l02743"></a>02743     <span class="comment"># hash.</span>
<a name="l02744"></a>02744     <span class="comment"># @param self Reference to current object.</span>
<a name="l02745"></a>02745     <span class="comment"># @param idstring String to be hashed using the Python hashlib MD5 implementation.</span>
<a name="l02746"></a>02746     <span class="comment"># @param mymaxint Constant used by earlier iterations of this function.</span>
<a name="l02747"></a>02747     <span class="comment"># @retval A hashed value representing the input string.</span>
<a name="l02748"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a1ca64b46fb81306492bf8a93a46f3ace">02748</a>     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a1ca64b46fb81306492bf8a93a46f3ace" title="string_to_int() takes an Animal/Sire/Dam ID as a string and returns a hash.">string_to_int</a>(self, idstring, mymaxint=9223372036854775807):
<a name="l02749"></a>02749         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l02750"></a>02750 <span class="stringliteral">        Convert a string to an integer.</span>
<a name="l02751"></a>02751 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l02752"></a>02752         <span class="comment"># This algorithm is taken from &quot;Character String Keys&quot; in &quot;Data</span>
<a name="l02753"></a>02753         <span class="comment"># Structures and Algorithms with Object-Oriented Design Patterns</span>
<a name="l02754"></a>02754         <span class="comment"># in Python&quot; by Bruno R. Preiss:</span>
<a name="l02755"></a>02755         <span class="comment"># http://www.brpreiss.com/books/opus7/html/page220.html#progstrnga</span>
<a name="l02756"></a>02756         <span class="comment">#shift = 6</span>
<a name="l02757"></a>02757         <span class="comment">#mask = ~0 &lt;&lt; ( 31 - shift )</span>
<a name="l02758"></a>02758         <span class="comment">#result = 0</span>
<a name="l02759"></a>02759         <span class="comment">#for c in idstring:</span>
<a name="l02760"></a>02760         <span class="comment">#    result = ( ( result &amp; mask ) ^ result &lt;&lt; shift ^ ord(c) ) &amp; sys.maxint</span>
<a name="l02761"></a>02761 
<a name="l02762"></a>02762         <span class="comment"># This is a test to try and fix the problems on Mac OS/X and Windows.</span>
<a name="l02763"></a>02763         <span class="comment">#import md5</span>
<a name="l02764"></a>02764     <span class="keyword">import</span> hashlib
<a name="l02765"></a>02765         <span class="keywordflow">try</span>:
<a name="l02766"></a>02766             <span class="comment"># If we can, let&#39;s use the Python MD5 implementation</span>
<a name="l02767"></a>02767             <span class="comment">#md5hash = md5.md5(idstring)</span>
<a name="l02768"></a>02768             result = hashlib.md5(idstring).hexdigest()
<a name="l02769"></a>02769             <span class="comment">#result = string.atoi(md5hash.hexdigest(),16)</span>
<a name="l02770"></a>02770         <span class="keywordflow">except</span>:
<a name="l02771"></a>02771             <span class="comment"># If we have some sort of problem with the MD5 hash then try this.</span>
<a name="l02772"></a>02772             <span class="comment"># WARNING -- This algorithm was broken on Mac OS/X and Windows,</span>
<a name="l02773"></a>02773             <span class="comment"># but not on (some) Linuxes. The problem may have been related to</span>
<a name="l02774"></a>02774             <span class="comment"># platform-specific values of sys.maxint, so I&#39;ve hard-coded that</span>
<a name="l02775"></a>02775             <span class="comment"># as sys.maxint from a 64-bit system. It gets cast to a long on 32-</span>
<a name="l02776"></a>02776             <span class="comment"># bit platforms, but I haven&#39;t found that to be a problem -- yet.</span>
<a name="l02777"></a>02777             <span class="comment">#</span>
<a name="l02778"></a>02778             <span class="comment"># This algorithm is taken from &quot;Character String Keys&quot; in &quot;Data</span>
<a name="l02779"></a>02779             <span class="comment"># Structures and Algorithms with Object-Oriented Design Patterns</span>
<a name="l02780"></a>02780             <span class="comment"># in Python&quot; by Bruno R. Preiss:</span>
<a name="l02781"></a>02781             <span class="comment"># http://www.brpreiss.com/books/opus7/html/page220.html#progstrnga</span>
<a name="l02782"></a>02782             shift = 6
<a name="l02783"></a>02783             mask = ~0 &lt;&lt; ( 31 - shift )
<a name="l02784"></a>02784             result = 0
<a name="l02785"></a>02785             <span class="keywordflow">for</span> c <span class="keywordflow">in</span> idstring:
<a name="l02786"></a>02786                 result = ( ( result &amp; mask ) ^ result &lt;&lt; shift ^ ord(c) ) &amp; mymaxint
<a name="l02787"></a>02787         <span class="keywordflow">return</span> result
<a name="l02788"></a>02788 
<a name="l02789"></a>02789 <span class="comment">##</span>
<a name="l02790"></a>02790 <span class="comment"># The LightAnimal() class holds animals records read from a pedigree file. It</span>
<a name="l02791"></a>02791 <span class="comment"># is a much simpler object than the NewAnimal() object and is intended for use</span>
<a name="l02792"></a>02792 <span class="comment"># with the graph theoretic routines in pyp_network. The only attributes of these</span>
<a name="l02793"></a>02793 <span class="comment"># objects are: animal ID, sire ID, dam ID, original ID, birth year, and sex.</span>
<a name="l02794"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html">02794</a> <span class="keyword">class </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html" title="The LightAnimal() class holds animals records read from a pedigree file.">LightAnimal</a>:
<a name="l02795"></a>02795     <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l02796"></a>02796 <span class="stringliteral">    The LightAnimal() class holds animals records read from a pedigree file. It</span>
<a name="l02797"></a>02797 <span class="stringliteral">    is a much simpler object than the NewAnimal() object and is intended for use</span>
<a name="l02798"></a>02798 <span class="stringliteral">    with the graph theoretic routines in pyp_network. The only attributes of these</span>
<a name="l02799"></a>02799 <span class="stringliteral">    objects are: animal ID, sire ID, dam ID, original ID, birth year, and sex.A simple class to</span>
<a name="l02800"></a>02800 <span class="stringliteral">    hold animals records read from a pedigree file.</span>
<a name="l02801"></a>02801 <span class="stringliteral">    &quot;&quot;&quot;</span>
<a name="l02802"></a>02802     <span class="comment">##</span>
<a name="l02803"></a>02803     <span class="comment"># __init__() initializes a LightAnimal() object.</span>
<a name="l02804"></a>02804     <span class="comment"># @param self Reference to current object.</span>
<a name="l02805"></a>02805     <span class="comment"># @param locations A dictionary containing the locations of variables in the input line.</span>
<a name="l02806"></a>02806     <span class="comment"># @param data The line of input read from the pedigree file.</span>
<a name="l02807"></a>02807     <span class="comment"># @param mykw A dictionary of keyword arguments.</span>
<a name="l02808"></a>02808     <span class="comment"># @retval An instance of a LightAnimal() object populated with data</span>
<a name="l02809"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#aa410001c85ab942a73f9d4be4148ccc2">02809</a>     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#aa410001c85ab942a73f9d4be4148ccc2" title="__init__() initializes a LightAnimal() object.">__init__</a>(self, locations, data, mykw):
<a name="l02810"></a>02810         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l02811"></a>02811 <span class="stringliteral">        __init__() initializes a LightAnimal() object.</span>
<a name="l02812"></a>02812 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l02813"></a>02813         <span class="keywordflow">if</span> locations[<span class="stringliteral">&#39;animal&#39;</span>] != -999:
<a name="l02814"></a>02814             <span class="comment"># If the animal&#39;s ID is actually a string, we need to be clever.  Put a copy of</span>
<a name="l02815"></a>02815             <span class="comment"># the string in the &#39;Name&#39; field.  Then use the hash function to convert the ID</span>
<a name="l02816"></a>02816             <span class="comment"># to an integer.</span>
<a name="l02817"></a>02817             <span class="keywordflow">if</span> <span class="stringliteral">&#39;A&#39;</span> <span class="keywordflow">in</span> mykw[<span class="stringliteral">&#39;pedformat&#39;</span>]:
<a name="l02818"></a>02818                 self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#ac7252021cdf147762d17572797a2b5bf">animalID</a> = self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#aa45130d80a969ddccf4ce5ccc68a4932" title="string_to_int() takes an Animal/Sire/Dam ID as a string and returns a hash.">string_to_int</a>(data[locations[<span class="stringliteral">&#39;animal&#39;</span>]])
<a name="l02819"></a>02819                 self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#aa47f85c83443cdf72d9a036168bd40c3">originalID</a> = self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#aa45130d80a969ddccf4ce5ccc68a4932" title="string_to_int() takes an Animal/Sire/Dam ID as a string and returns a hash.">string_to_int</a>(data[locations[<span class="stringliteral">&#39;animal&#39;</span>]])
<a name="l02820"></a>02820             <span class="keywordflow">else</span>:
<a name="l02821"></a>02821                 self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#ac7252021cdf147762d17572797a2b5bf">animalID</a> = string.strip(data[locations[<span class="stringliteral">&#39;animal&#39;</span>]])
<a name="l02822"></a>02822                 self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#aa47f85c83443cdf72d9a036168bd40c3">originalID</a> = string.strip(data[locations[<span class="stringliteral">&#39;animal&#39;</span>]])
<a name="l02823"></a>02823         <span class="keywordflow">if</span> locations[<span class="stringliteral">&#39;sire&#39;</span>] != -999 <span class="keywordflow">and</span> string.strip(data[locations[<span class="stringliteral">&#39;sire&#39;</span>]]) != mykw[<span class="stringliteral">&#39;missing_parent&#39;</span>]:
<a name="l02824"></a>02824             <span class="keywordflow">if</span> <span class="stringliteral">&#39;S&#39;</span> <span class="keywordflow">in</span> mykw[<span class="stringliteral">&#39;pedformat&#39;</span>]:
<a name="l02825"></a>02825                 <span class="keywordflow">if</span> data[locations[<span class="stringliteral">&#39;sire&#39;</span>]] == mykw[<span class="stringliteral">&#39;missing_parent&#39;</span>]:
<a name="l02826"></a>02826                     self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#a6ebb45411e7cedae72bf6a127a43402f">sireID</a> = data[locations[<span class="stringliteral">&#39;sire&#39;</span>]]
<a name="l02827"></a>02827                 <span class="keywordflow">else</span>:
<a name="l02828"></a>02828                     self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#a6ebb45411e7cedae72bf6a127a43402f">sireID</a> = self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#aa45130d80a969ddccf4ce5ccc68a4932" title="string_to_int() takes an Animal/Sire/Dam ID as a string and returns a hash.">string_to_int</a>(data[locations[<span class="stringliteral">&#39;sire&#39;</span>]])
<a name="l02829"></a>02829             <span class="keywordflow">else</span>:
<a name="l02830"></a>02830                 self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#a6ebb45411e7cedae72bf6a127a43402f">sireID</a> = string.strip(data[locations[<span class="stringliteral">&#39;sire&#39;</span>]])
<a name="l02831"></a>02831         <span class="keywordflow">else</span>:
<a name="l02832"></a>02832             <span class="comment">#self.sireID = &#39;0&#39;</span>
<a name="l02833"></a>02833             self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#a6ebb45411e7cedae72bf6a127a43402f">sireID</a> = mykw[<span class="stringliteral">&#39;missing_parent&#39;</span>]
<a name="l02834"></a>02834         <span class="keywordflow">if</span> locations[<span class="stringliteral">&#39;dam&#39;</span>] != -999 <span class="keywordflow">and</span> string.strip(data[locations[<span class="stringliteral">&#39;dam&#39;</span>]]) != mykw[<span class="stringliteral">&#39;missing_parent&#39;</span>]:
<a name="l02835"></a>02835             <span class="keywordflow">if</span> <span class="stringliteral">&#39;D&#39;</span> <span class="keywordflow">in</span> mykw[<span class="stringliteral">&#39;pedformat&#39;</span>]:
<a name="l02836"></a>02836                 <span class="keywordflow">if</span> data[locations[<span class="stringliteral">&#39;dam&#39;</span>]] == mykw[<span class="stringliteral">&#39;missing_parent&#39;</span>]:
<a name="l02837"></a>02837                     self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#a1ac2bcd5c8dddbacf7ffb61e63b88f68">damID</a> = data[locations[<span class="stringliteral">&#39;dam&#39;</span>]]
<a name="l02838"></a>02838                 <span class="keywordflow">else</span>:
<a name="l02839"></a>02839                     self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#a1ac2bcd5c8dddbacf7ffb61e63b88f68">damID</a> = self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#aa45130d80a969ddccf4ce5ccc68a4932" title="string_to_int() takes an Animal/Sire/Dam ID as a string and returns a hash.">string_to_int</a>(data[locations[<span class="stringliteral">&#39;dam&#39;</span>]])
<a name="l02840"></a>02840             <span class="keywordflow">else</span>:
<a name="l02841"></a>02841                 self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#a1ac2bcd5c8dddbacf7ffb61e63b88f68">damID</a> = string.strip(data[locations[<span class="stringliteral">&#39;dam&#39;</span>]])
<a name="l02842"></a>02842         <span class="keywordflow">else</span>:
<a name="l02843"></a>02843             <span class="comment">#self.damID = &#39;0&#39;</span>
<a name="l02844"></a>02844             self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#a1ac2bcd5c8dddbacf7ffb61e63b88f68">damID</a> = mykw[<span class="stringliteral">&#39;missing_parent&#39;</span>]
<a name="l02845"></a>02845         <span class="keywordflow">if</span> locations[<span class="stringliteral">&#39;sex&#39;</span>] != -999:
<a name="l02846"></a>02846             self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#a32ff34221d6b6b1033706e4a5d01a496">sex</a> = string.strip(data[locations[<span class="stringliteral">&#39;sex&#39;</span>]])
<a name="l02847"></a>02847         <span class="keywordflow">else</span>:
<a name="l02848"></a>02848             self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#a32ff34221d6b6b1033706e4a5d01a496">sex</a> = <span class="stringliteral">&#39;</span><span class="stringliteral">u&#39;</span>
<a name="l02849"></a>02849 <span class="stringliteral">        </span><span class="keywordflow">if</span> locations[<span class="stringliteral">&#39;birthyear&#39;</span>] != -999:
<a name="l02850"></a>02850             self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#ab1e4345cde35a5012b119396abba4df4">by</a> = int(string.strip(data[locations[<span class="stringliteral">&#39;birthyear&#39;</span>]]))
<a name="l02851"></a>02851             <span class="keywordflow">if</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#ab1e4345cde35a5012b119396abba4df4">by</a> == 0:
<a name="l02852"></a>02852                 self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#ab1e4345cde35a5012b119396abba4df4">by</a> = mykw[<span class="stringliteral">&#39;missing_byear&#39;</span>]
<a name="l02853"></a>02853         <span class="keywordflow">elif</span> locations[<span class="stringliteral">&#39;birthyear&#39;</span>] == -999 <span class="keywordflow">and</span> locations[<span class="stringliteral">&#39;birthdate&#39;</span>] != -999:
<a name="l02854"></a>02854             self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#ab1e4345cde35a5012b119396abba4df4">by</a> = int(string.strip(data[locations[<span class="stringliteral">&#39;birthdate&#39;</span>]]))
<a name="l02855"></a>02855             self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#ab1e4345cde35a5012b119396abba4df4">by</a> = self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#ab1e4345cde35a5012b119396abba4df4">by</a>[:4]
<a name="l02856"></a>02856         <span class="keywordflow">else</span>:
<a name="l02857"></a>02857             self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#ab1e4345cde35a5012b119396abba4df4">by</a> = mykw[<span class="stringliteral">&#39;missing_byear&#39;</span>]
<a name="l02858"></a>02858         self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#ae64f455e9df40a235a8c09f5fdf13dc0">paddedID</a> = self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#ae7811b64c92921123f64ae6cac0568da" title="pad_id() takes an Animal ID, pads it to fifteen digits, and prepends the birthyear (or 1950 if the bi...">pad_id</a>()
<a name="l02859"></a>02859 
<a name="l02860"></a>02860     <span class="comment">##</span>
<a name="l02861"></a>02861     <span class="comment"># printme() prints a summary of the data stored in the LightAnimal() object.</span>
<a name="l02862"></a>02862     <span class="comment"># @param self Reference to current object</span>
<a name="l02863"></a>02863     <span class="comment"># @retval None</span>
<a name="l02864"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#aced172e326bbcc039d74541f3736b7af">02864</a>     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#aced172e326bbcc039d74541f3736b7af" title="printme() prints a summary of the data stored in the LightAnimal() object.">printme</a>(self):
<a name="l02865"></a>02865         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l02866"></a>02866 <span class="stringliteral">        Print the contents of an animal record - used for debugging.</span>
<a name="l02867"></a>02867 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l02868"></a>02868         <span class="keywordflow">print</span> <span class="stringliteral">&#39;ANIMAL %s RECORD&#39;</span> % (int(self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#ac7252021cdf147762d17572797a2b5bf">animalID</a>))
<a name="l02869"></a>02869         <span class="keywordflow">print</span> <span class="stringliteral">&#39;\tAnimal ID:\t%s&#39;</span> % (int(self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#ac7252021cdf147762d17572797a2b5bf">animalID</a>))
<a name="l02870"></a>02870         <span class="keywordflow">print</span> <span class="stringliteral">&#39;\tSire ID:\t%s&#39;</span> % (int(self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#a6ebb45411e7cedae72bf6a127a43402f">sireID</a>))
<a name="l02871"></a>02871         <span class="keywordflow">print</span> <span class="stringliteral">&#39;\tDam ID:\t\t%s&#39;</span> % (int(self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#a1ac2bcd5c8dddbacf7ffb61e63b88f68">damID</a>))
<a name="l02872"></a>02872         <span class="keywordflow">print</span> <span class="stringliteral">&#39;\tBirth Year:\t%s&#39;</span> % (int(self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#ab1e4345cde35a5012b119396abba4df4">by</a>))
<a name="l02873"></a>02873         <span class="keywordflow">print</span> <span class="stringliteral">&#39;\tSex:\t\t%s&#39;</span> % (self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#a32ff34221d6b6b1033706e4a5d01a496">sex</a>)
<a name="l02874"></a>02874         <span class="keywordflow">print</span> <span class="stringliteral">&#39;\tOriginal ID:\t%s&#39;</span> % (self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#aa47f85c83443cdf72d9a036168bd40c3">originalID</a>)
<a name="l02875"></a>02875         <span class="keywordflow">print</span> <span class="stringliteral">&#39;\tRenumbered ID:\t%s&#39;</span> % (self.renumberedID)
<a name="l02876"></a>02876     <span class="comment">##</span>
<a name="l02877"></a>02877     <span class="comment"># stringme() returns a summary of the data stored in the LightAnimal() object</span>
<a name="l02878"></a>02878     <span class="comment"># as a string.</span>
<a name="l02879"></a>02879     <span class="comment"># @param self Reference to current object.</span>
<a name="l02880"></a>02880     <span class="comment"># @retval A string containing the contents of a LightAnimal object.</span>
<a name="l02881"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#a609e38ea9b8033460b7adf96dad95e17">02881</a>     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#a609e38ea9b8033460b7adf96dad95e17" title="stringme() returns a summary of the data stored in the LightAnimal() object as a string.">stringme</a>(self):
<a name="l02882"></a>02882         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l02883"></a>02883 <span class="stringliteral">        Return the contents of an animal record as a string.</span>
<a name="l02884"></a>02884 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l02885"></a>02885         _me = <span class="stringliteral">&#39;&#39;</span>
<a name="l02886"></a>02886         _me = <span class="stringliteral">&#39;%s%s&#39;</span> % ( _me, <span class="stringliteral">&#39;ANIMAL %s RECORD\n&#39;</span> % (int(self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#ac7252021cdf147762d17572797a2b5bf">animalID</a>)) )
<a name="l02887"></a>02887         _me = <span class="stringliteral">&#39;%s%s&#39;</span> % ( _me, <span class="stringliteral">&#39;\tAnimal ID:\t%s\n&#39;</span> % (int(self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#ac7252021cdf147762d17572797a2b5bf">animalID</a>)) )
<a name="l02888"></a>02888         _me = <span class="stringliteral">&#39;%s%s&#39;</span> % ( _me, <span class="stringliteral">&#39;\tSire ID:\t%s\n&#39;</span> % (int(self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#a6ebb45411e7cedae72bf6a127a43402f">sireID</a>)) )
<a name="l02889"></a>02889         _me = <span class="stringliteral">&#39;%s%s&#39;</span> % ( _me, <span class="stringliteral">&#39;\tDam ID:\t\t%s\n&#39;</span> % (int(self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#a1ac2bcd5c8dddbacf7ffb61e63b88f68">damID</a>)) )
<a name="l02890"></a>02890         _me = <span class="stringliteral">&#39;%s%s&#39;</span> % ( _me, <span class="stringliteral">&#39;\tBirth Year:\t%s\n&#39;</span> % (int(self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#ab1e4345cde35a5012b119396abba4df4">by</a>)) )
<a name="l02891"></a>02891         _me = <span class="stringliteral">&#39;%s%s&#39;</span> % ( _me, <span class="stringliteral">&#39;\tSex:\t\t%s\n&#39;</span> % (self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#a32ff34221d6b6b1033706e4a5d01a496">sex</a>) )
<a name="l02892"></a>02892         _me = <span class="stringliteral">&#39;%s%s&#39;</span> % ( _me, <span class="stringliteral">&#39;\tOriginal ID:\t%s\n&#39;</span> % (self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#aa47f85c83443cdf72d9a036168bd40c3">originalID</a>) )
<a name="l02893"></a>02893         _me = <span class="stringliteral">&#39;%s%s&#39;</span> % ( _me, <span class="stringliteral">&#39;\tRenumbered ID:\t%s\n&#39;</span> % (self.renumberedID) )
<a name="l02894"></a>02894         <span class="keywordflow">return</span> _me
<a name="l02895"></a>02895 
<a name="l02896"></a>02896     <span class="comment">##</span>
<a name="l02897"></a>02897     <span class="comment"># dictme() returns a summary of the data stored in the NewAnimal() object</span>
<a name="l02898"></a>02898     <span class="comment"># as a dictionary.</span>
<a name="l02899"></a>02899     <span class="comment"># @param self Reference to current object</span>
<a name="l02900"></a>02900     <span class="comment"># @retval A dictionary containing the contents of a LightAnimal object.</span>
<a name="l02901"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#a8016e0f0ce7359a441f944668ec312be">02901</a>     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#a8016e0f0ce7359a441f944668ec312be" title="dictme() returns a summary of the data stored in the NewAnimal() object as a dictionary.">dictme</a>(self):
<a name="l02902"></a>02902         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l02903"></a>02903 <span class="stringliteral">        Return the contents of an animal record in a dictionary.</span>
<a name="l02904"></a>02904 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l02905"></a>02905         <span class="keywordflow">try</span>:
<a name="l02906"></a>02906             _dict = {}
<a name="l02907"></a>02907             _dict[animalID] = self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#ac7252021cdf147762d17572797a2b5bf">animalID</a>
<a name="l02908"></a>02908             _dict[sireID] = self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#a6ebb45411e7cedae72bf6a127a43402f">sireID</a>
<a name="l02909"></a>02909             _dict[damID] = self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#a1ac2bcd5c8dddbacf7ffb61e63b88f68">damID</a>
<a name="l02910"></a>02910             _dict[by] = self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#ab1e4345cde35a5012b119396abba4df4">by</a>
<a name="l02911"></a>02911             _dict[sex] = self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#a32ff34221d6b6b1033706e4a5d01a496">sex</a>
<a name="l02912"></a>02912             _dict[originalID] = self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#aa47f85c83443cdf72d9a036168bd40c3">originalID</a>
<a name="l02913"></a>02913             _dict[renumberedID] = self.renumberedID
<a name="l02914"></a>02914             <span class="keywordflow">return</span> _dict
<a name="l02915"></a>02915         <span class="keywordflow">except</span>:
<a name="l02916"></a>02916             <span class="keywordflow">return</span> {}
<a name="l02917"></a>02917 
<a name="l02918"></a>02918     <span class="comment">##</span>
<a name="l02919"></a>02919     <span class="comment"># trap() checks for common errors in LightAnimal() objects</span>
<a name="l02920"></a>02920     <span class="comment"># @param self Reference to current object</span>
<a name="l02921"></a>02921     <span class="comment"># @retval None</span>
<a name="l02922"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#aaa37d1871c1611ed2eb0a20c89886339">02922</a>     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#aaa37d1871c1611ed2eb0a20c89886339" title="trap() checks for common errors in LightAnimal() objects">trap</a>(self):
<a name="l02923"></a>02923         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l02924"></a>02924 <span class="stringliteral">        Trap common errors in pedigree file entries.</span>
<a name="l02925"></a>02925 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l02926"></a>02926         <span class="keywordflow">if</span> int(self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#ac7252021cdf147762d17572797a2b5bf">animalID</a>) == int(self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#a6ebb45411e7cedae72bf6a127a43402f">sireID</a>):
<a name="l02927"></a>02927             <span class="keywordflow">print</span> <span class="stringliteral">&#39;[ERROR]: Animal %s has an ID number equal to its sire\&#39;s ID (sire ID %s).\n&#39;</span> % (self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#ac7252021cdf147762d17572797a2b5bf">animalID</a>,self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#a6ebb45411e7cedae72bf6a127a43402f">sireID</a>)
<a name="l02928"></a>02928         <span class="keywordflow">if</span> int(self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#ac7252021cdf147762d17572797a2b5bf">animalID</a>) == int(self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#a1ac2bcd5c8dddbacf7ffb61e63b88f68">damID</a>):
<a name="l02929"></a>02929             <span class="keywordflow">print</span> <span class="stringliteral">&#39;[ERROR]: Animal %s has an ID number equal to its dam\&#39;s ID (dam ID %s).\n&#39;</span> % (self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#ac7252021cdf147762d17572797a2b5bf">animalID</a>,self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#a1ac2bcd5c8dddbacf7ffb61e63b88f68">damID</a>)
<a name="l02930"></a>02930         <span class="keywordflow">if</span> int(self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#ac7252021cdf147762d17572797a2b5bf">animalID</a>) &lt; int(self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#a6ebb45411e7cedae72bf6a127a43402f">sireID</a>):
<a name="l02931"></a>02931             <span class="keywordflow">print</span> <span class="stringliteral">&#39;[ERROR]: Animal %s is older than its sire (sire ID %s).\n&#39;</span> % (self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#ac7252021cdf147762d17572797a2b5bf">animalID</a>,self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#a6ebb45411e7cedae72bf6a127a43402f">sireID</a>)
<a name="l02932"></a>02932         <span class="keywordflow">if</span> int(self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#ac7252021cdf147762d17572797a2b5bf">animalID</a>) &lt; int(self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#a1ac2bcd5c8dddbacf7ffb61e63b88f68">damID</a>):
<a name="l02933"></a>02933             <span class="keywordflow">print</span> <span class="stringliteral">&#39;[ERROR]: Animal %s is older than its dam (dam ID %s).\n&#39;</span> % (self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#ac7252021cdf147762d17572797a2b5bf">animalID</a>,self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#a1ac2bcd5c8dddbacf7ffb61e63b88f68">damID</a>)
<a name="l02934"></a>02934 
<a name="l02935"></a>02935     <span class="comment">##</span>
<a name="l02936"></a>02936     <span class="comment"># pad_id() takes an Animal ID, pads it to fifteen digits, and prepends the birthyear</span>
<a name="l02937"></a>02937     <span class="comment"># (or 1950 if the birth year is unknown).  The order of elements is: birthyear, animalID,</span>
<a name="l02938"></a>02938     <span class="comment"># count of zeros, zeros.</span>
<a name="l02939"></a>02939     <span class="comment"># @param self Reference to current object</span>
<a name="l02940"></a>02940     <span class="comment"># @retval A padded ID number that is supposed to be unique across animals</span>
<a name="l02941"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#ae7811b64c92921123f64ae6cac0568da">02941</a>     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#ae7811b64c92921123f64ae6cac0568da" title="pad_id() takes an Animal ID, pads it to fifteen digits, and prepends the birthyear (or 1950 if the bi...">pad_id</a>(self):
<a name="l02942"></a>02942         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l02943"></a>02943 <span class="stringliteral">        Take an Animal ID, pad it to fifteen digits, and prepend the birthyear (or 1900</span>
<a name="l02944"></a>02944 <span class="stringliteral">        if the birth year is unknown).  The order of elements is: birthyear, animalID,</span>
<a name="l02945"></a>02945 <span class="stringliteral">        count of zeros, zeros.</span>
<a name="l02946"></a>02946 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l02947"></a>02947         <span class="comment">#print self.animalID</span>
<a name="l02948"></a>02948         l = len(self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#ac7252021cdf147762d17572797a2b5bf">animalID</a>)
<a name="l02949"></a>02949         pl = 15 - l - 1
<a name="l02950"></a>02950         <span class="keywordflow">if</span> pl &gt; 0:
<a name="l02951"></a>02951             zs = <span class="stringliteral">&#39;0&#39;</span>*pl
<a name="l02952"></a>02952             pid = <span class="stringliteral">&#39;%s%s%s%s&#39;</span> % (self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#ab1e4345cde35a5012b119396abba4df4">by</a>,zs,self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#ac7252021cdf147762d17572797a2b5bf">animalID</a>,l)
<a name="l02953"></a>02953         <span class="keywordflow">else</span>:
<a name="l02954"></a>02954             pid = <span class="stringliteral">&#39;%s%s%s&#39;</span> % (self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#ab1e4345cde35a5012b119396abba4df4">by</a>,self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#ac7252021cdf147762d17572797a2b5bf">animalID</a>,l)
<a name="l02955"></a>02955         <span class="keywordflow">return</span> pid
<a name="l02956"></a>02956 
<a name="l02957"></a>02957     <span class="comment">##</span>
<a name="l02958"></a>02958     <span class="comment"># string_to_int() takes an Animal/Sire/Dam ID as a string and returns a</span>
<a name="l02959"></a>02959     <span class="comment"># hash.</span>
<a name="l02960"></a>02960     <span class="comment"># @param self Reference to current object.</span>
<a name="l02961"></a>02961     <span class="comment"># @param idstring String to be hashed using the Python hashlib MD5 implementation.</span>
<a name="l02962"></a>02962     <span class="comment"># @param mymaxint Constant used by earlier iterations of this function.</span>
<a name="l02963"></a>02963     <span class="comment"># @retval A hashed value representing the input string.</span>
<a name="l02964"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#aa45130d80a969ddccf4ce5ccc68a4932">02964</a>     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#aa45130d80a969ddccf4ce5ccc68a4932" title="string_to_int() takes an Animal/Sire/Dam ID as a string and returns a hash.">string_to_int</a>(self, idstring, mymaxint=9223372036854775807):
<a name="l02965"></a>02965         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l02966"></a>02966 <span class="stringliteral">        Convert a string to an integer.</span>
<a name="l02967"></a>02967 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l02968"></a>02968         <span class="comment"># This algorithm is taken from &quot;Character String Keys&quot; in &quot;Data</span>
<a name="l02969"></a>02969         <span class="comment"># Structures and Algorithms with Object-Oriented Design Patterns</span>
<a name="l02970"></a>02970         <span class="comment"># in Python&quot; by Bruno R. Preiss:</span>
<a name="l02971"></a>02971         <span class="comment"># http://www.brpreiss.com/books/opus7/html/page220.html#progstrnga</span>
<a name="l02972"></a>02972         <span class="comment">#shift = 6</span>
<a name="l02973"></a>02973         <span class="comment">#mask = ~0 &lt;&lt; ( 31 - shift )</span>
<a name="l02974"></a>02974         <span class="comment">#result = 0</span>
<a name="l02975"></a>02975         <span class="comment">#for c in idstring:</span>
<a name="l02976"></a>02976         <span class="comment">#    result = ( ( result &amp; mask ) ^ result &lt;&lt; shift ^ ord(c) ) &amp; sys.maxint</span>
<a name="l02977"></a>02977 
<a name="l02978"></a>02978         <span class="comment"># This is a test to try and fix the problems on Mac OS/X and Windows.</span>
<a name="l02979"></a>02979         <span class="comment">#import md5</span>
<a name="l02980"></a>02980         <span class="keyword">import</span> hashlib
<a name="l02981"></a>02981         <span class="keywordflow">try</span>:
<a name="l02982"></a>02982             <span class="comment"># If we can, let&#39;s use the Python MD5 implementation</span>
<a name="l02983"></a>02983             <span class="comment">#md5hash = md5.md5(idstring)</span>
<a name="l02984"></a>02984             result = hashlib.md5(idstring).hexdigest()
<a name="l02985"></a>02985             <span class="comment">#result = string.atoi(md5hash.hexdigest(),16)</span>
<a name="l02986"></a>02986         <span class="keywordflow">except</span>:
<a name="l02987"></a>02987             <span class="comment"># If we have some sort of problem with the MD5 hash then try this.</span>
<a name="l02988"></a>02988             <span class="comment"># WARNING -- This algorithm was broken on Mac OS/X and Windows,</span>
<a name="l02989"></a>02989             <span class="comment"># but not on 9some) Linuxes. The problem may have been related to</span>
<a name="l02990"></a>02990             <span class="comment"># platform-specific values of sys.maxint, so I&#39;ve hard-coded that</span>
<a name="l02991"></a>02991             <span class="comment"># as sys.maxint from a 64-bit system. It gets cast to a long on 32-</span>
<a name="l02992"></a>02992             <span class="comment"># bit platforms, but I haven&#39;t found that to be a problem -- yet.</span>
<a name="l02993"></a>02993             <span class="comment">#</span>
<a name="l02994"></a>02994             <span class="comment"># This algorithm is taken from &quot;Character String Keys&quot; in &quot;Data</span>
<a name="l02995"></a>02995             <span class="comment"># Structures and Algorithms with Object-Oriented Design Patterns</span>
<a name="l02996"></a>02996             <span class="comment"># in Python&quot; by Bruno R. Preiss:</span>
<a name="l02997"></a>02997             <span class="comment"># http://www.brpreiss.com/books/opus7/html/page220.html#progstrnga</span>
<a name="l02998"></a>02998             shift = 6
<a name="l02999"></a>02999             mask = ~0 &lt;&lt; ( 31 - shift )
<a name="l03000"></a>03000             result = 0
<a name="l03001"></a>03001             <span class="keywordflow">for</span> c <span class="keywordflow">in</span> idstring:
<a name="l03002"></a>03002                 result = ( ( result &amp; mask ) ^ result &lt;&lt; shift ^ ord(c) ) &amp; mymaxint
<a name="l03003"></a>03003         <span class="keywordflow">return</span> result
<a name="l03004"></a>03004 
<a name="l03005"></a>03005 <span class="comment">##</span>
<a name="l03006"></a>03006 <span class="comment"># The PedigreeMetadata() class stores metadata about pedigrees.  Hopefully this will help improve performance in some procedures,</span>
<a name="l03007"></a>03007 <span class="comment"># as well as provide some useful summary data.</span>
<a name="l03008"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html">03008</a> <span class="keyword">class </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html" title="The PedigreeMetadata() class stores metadata about pedigrees.">PedigreeMetadata</a>:
<a name="l03009"></a>03009     <span class="stringliteral">&quot;&quot;&quot;A class to hold metadata about pedigrees.  Hopefully this will help improve performance in some procedures, as well as</span>
<a name="l03010"></a>03010 <span class="stringliteral">    provide some useful summary data.&quot;&quot;&quot;</span>
<a name="l03011"></a>03011     <span class="comment">##</span>
<a name="l03012"></a>03012     <span class="comment"># __init__() initializes a PedigreeMetadata object.</span>
<a name="l03013"></a>03013     <span class="comment"># @param self Reference to current object.</span>
<a name="l03014"></a>03014     <span class="comment"># @param myped A PyPedal pedigree.</span>
<a name="l03015"></a>03015     <span class="comment"># @param kw A dictionary of options.</span>
<a name="l03016"></a>03016     <span class="comment"># @retval An instance of a Pedigree() object populated with data.</span>
<a name="l03017"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#a105725f2e02e846685c702105d9c75a4">03017</a>     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#a105725f2e02e846685c702105d9c75a4" title="__init__() initializes a PedigreeMetadata object.">__init__</a>(self, myped, kw):
<a name="l03018"></a>03018         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l03019"></a>03019 <span class="stringliteral">        Initialize a pedigree record.</span>
<a name="l03020"></a>03020 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l03021"></a>03021         self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#ae383484ded6e38b17cc9ebaf62b6e0fb">kw</a> = kw
<a name="l03022"></a>03022         <span class="keywordflow">if</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#ae383484ded6e38b17cc9ebaf62b6e0fb">kw</a>[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span> <span class="keywordflow">and</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#ae383484ded6e38b17cc9ebaf62b6e0fb">kw</a>[<span class="stringliteral">&#39;pedigree_summary&#39;</span>]:
<a name="l03023"></a>03023             <span class="keywordflow">print</span> <span class="stringliteral">&#39;\t[INFO]:  Instantiating a new PedigreeMetadata() object...&#39;</span>
<a name="l03024"></a>03024         <span class="keywordflow">if</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#ae383484ded6e38b17cc9ebaf62b6e0fb">kw</a>[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span> <span class="keywordflow">and</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#ae383484ded6e38b17cc9ebaf62b6e0fb">kw</a>[<span class="stringliteral">&#39;pedigree_summary&#39;</span>]:
<a name="l03025"></a>03025             <span class="keywordflow">print</span> <span class="stringliteral">&#39;\t[INFO]:  Naming the Pedigree()...&#39;</span>
<a name="l03026"></a>03026         self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#abd1252a89353833fa8710ed40c2e09a3">name</a> = kw[<span class="stringliteral">&#39;pedname&#39;</span>]
<a name="l03027"></a>03027         <span class="keywordflow">if</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#ae383484ded6e38b17cc9ebaf62b6e0fb">kw</a>[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span> <span class="keywordflow">and</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#ae383484ded6e38b17cc9ebaf62b6e0fb">kw</a>[<span class="stringliteral">&#39;pedigree_summary&#39;</span>]:
<a name="l03028"></a>03028             <span class="keywordflow">print</span> <span class="stringliteral">&#39;\t[INFO]:  Assigning a filename...&#39;</span>
<a name="l03029"></a>03029         self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#a68aa37b361055119a7becea3fc91fc29">filename</a> = kw[<span class="stringliteral">&#39;pedfile&#39;</span>]
<a name="l03030"></a>03030         <span class="keywordflow">if</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#ae383484ded6e38b17cc9ebaf62b6e0fb">kw</a>[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span> <span class="keywordflow">and</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#ae383484ded6e38b17cc9ebaf62b6e0fb">kw</a>[<span class="stringliteral">&#39;pedigree_summary&#39;</span>]:
<a name="l03031"></a>03031             <span class="keywordflow">print</span> <span class="stringliteral">&#39;\t[INFO]:  Attaching a pedigree...&#39;</span>
<a name="l03032"></a>03032         self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#aeb73a030c12f21e472db7e8446a14f5d">myped</a> = myped
<a name="l03033"></a>03033         <span class="keywordflow">if</span> kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span> <span class="keywordflow">and</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#ae383484ded6e38b17cc9ebaf62b6e0fb">kw</a>[<span class="stringliteral">&#39;pedigree_summary&#39;</span>]:
<a name="l03034"></a>03034             <span class="keywordflow">print</span> <span class="stringliteral">&#39;\t[INFO]:  Setting the pedcode...&#39;</span>
<a name="l03035"></a>03035         self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#af8a418ed1c7cda5ff682e610f20ba687">pedcode</a> = kw[<span class="stringliteral">&#39;pedformat&#39;</span>]
<a name="l03036"></a>03036         <span class="keywordflow">if</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#ae383484ded6e38b17cc9ebaf62b6e0fb">kw</a>[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span> <span class="keywordflow">and</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#ae383484ded6e38b17cc9ebaf62b6e0fb">kw</a>[<span class="stringliteral">&#39;pedigree_summary&#39;</span>]:
<a name="l03037"></a>03037             <span class="keywordflow">print</span> <span class="stringliteral">&#39;\t[INFO]:  Counting the number of animals in the pedigree...&#39;</span>
<a name="l03038"></a>03038         self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#a4479053d48852d7251b1ee2117aa64f1">num_records</a> = len(self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#aeb73a030c12f21e472db7e8446a14f5d">myped</a>)
<a name="l03039"></a>03039         <span class="keywordflow">if</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#ae383484ded6e38b17cc9ebaf62b6e0fb">kw</a>[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span> <span class="keywordflow">and</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#ae383484ded6e38b17cc9ebaf62b6e0fb">kw</a>[<span class="stringliteral">&#39;pedigree_summary&#39;</span>]:
<a name="l03040"></a>03040             <span class="keywordflow">print</span> <span class="stringliteral">&#39;\t[INFO]:  Counting and finding unique sires...&#39;</span>
<a name="l03041"></a>03041         self.num_unique_sires, self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#a1a2ec2114f1c920a804bae04ef3503eb">unique_sire_list</a> = self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#aab430a7cc66838ce6f75a80fa8fd2884" title="nus() returns the number of unique sires in the pedigree along with a list of the sires...">nus</a>()
<a name="l03042"></a>03042         <span class="keywordflow">if</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#ae383484ded6e38b17cc9ebaf62b6e0fb">kw</a>[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span> <span class="keywordflow">and</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#ae383484ded6e38b17cc9ebaf62b6e0fb">kw</a>[<span class="stringliteral">&#39;pedigree_summary&#39;</span>]:
<a name="l03043"></a>03043             <span class="keywordflow">print</span> <span class="stringliteral">&#39;\t[INFO]:  Counting and finding unique dams...&#39;</span>
<a name="l03044"></a>03044         self.num_unique_dams, self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#a04a892ce48016e30fdafd7676c6c6712">unique_dam_list</a> = self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#a9330d9f4d5d9ce616a57db3b8fae95b1" title="nud() returns the number of unique dams in the pedigree along with a list of the dams">nud</a>()
<a name="l03045"></a>03045         <span class="keywordflow">if</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#ae383484ded6e38b17cc9ebaf62b6e0fb">kw</a>[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span> <span class="keywordflow">and</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#ae383484ded6e38b17cc9ebaf62b6e0fb">kw</a>[<span class="stringliteral">&#39;pedigree_summary&#39;</span>]:
<a name="l03046"></a>03046             <span class="keywordflow">print</span> <span class="stringliteral">&#39;\t[INFO]:  Setting renumbered flag...&#39;</span>
<a name="l03047"></a>03047         self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#a438e394237da437693a667f01bf17500">renumbered</a> = kw[<span class="stringliteral">&#39;renumber&#39;</span>]
<a name="l03048"></a>03048         <span class="keywordflow">if</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#ae383484ded6e38b17cc9ebaf62b6e0fb">kw</a>[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span> <span class="keywordflow">and</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#ae383484ded6e38b17cc9ebaf62b6e0fb">kw</a>[<span class="stringliteral">&#39;pedigree_summary&#39;</span>]:
<a name="l03049"></a>03049             <span class="keywordflow">print</span> <span class="stringliteral">&#39;\t[INFO]:  Counting and finding unique generations...&#39;</span>
<a name="l03050"></a>03050         self.num_unique_gens, self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#a12189226c48c79f6256be356927595b6">unique_gen_list</a> = self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#a41af77f90422ded81869fd3f2a8a80f9" title="nug() returns the number of unique generations in the pedigree along with a list of the generations...">nug</a>()
<a name="l03051"></a>03051         <span class="keywordflow">if</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#ae383484ded6e38b17cc9ebaf62b6e0fb">kw</a>[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span> <span class="keywordflow">and</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#ae383484ded6e38b17cc9ebaf62b6e0fb">kw</a>[<span class="stringliteral">&#39;pedigree_summary&#39;</span>]:
<a name="l03052"></a>03052             <span class="keywordflow">print</span> <span class="stringliteral">&#39;\t[INFO]:  Counting and finding unique birthyears...&#39;</span>
<a name="l03053"></a>03053         self.num_unique_years, self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#a9006f241d87025dc5035be307d2173ab">unique_year_list</a> = self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#a7f51c5a6914509ec324afde82f245253" title="nuy() returns the number of unique birthyears in the pedigree along with a list of the birthyears...">nuy</a>()
<a name="l03054"></a>03054         <span class="keywordflow">if</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#ae383484ded6e38b17cc9ebaf62b6e0fb">kw</a>[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span> <span class="keywordflow">and</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#ae383484ded6e38b17cc9ebaf62b6e0fb">kw</a>[<span class="stringliteral">&#39;pedigree_summary&#39;</span>]:
<a name="l03055"></a>03055             <span class="keywordflow">print</span> <span class="stringliteral">&#39;\t[INFO]:  Counting and finding unique founders...&#39;</span>
<a name="l03056"></a>03056         self.num_unique_founders, self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#a8d1484c36529a6a2dc85e1562540d4dc">unique_founder_list</a> = self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#a2fa68d278b69bda83c344c5f0615e25c" title="nuf() returns the number of unique founders in the pedigree along with a list of the founders...">nuf</a>()
<a name="l03057"></a>03057         <span class="keywordflow">if</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#ae383484ded6e38b17cc9ebaf62b6e0fb">kw</a>[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span> <span class="keywordflow">and</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#ae383484ded6e38b17cc9ebaf62b6e0fb">kw</a>[<span class="stringliteral">&#39;pedigree_summary&#39;</span>]:
<a name="l03058"></a>03058             <span class="keywordflow">print</span> <span class="stringliteral">&#39;\t[INFO]:  Counting and finding unique herds...&#39;</span>
<a name="l03059"></a>03059         self.num_unique_herds, self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#a91b610d629df6c79f8adc7605af72541">unique_herd_list</a> = self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#ae408f6ef90563175d0069238dfd55f1b" title="nuherds() returns the number of unique herds in the pedigree along with a list of the herds...">nuherds</a>()
<a name="l03060"></a>03060         <span class="keywordflow">if</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#ae383484ded6e38b17cc9ebaf62b6e0fb">kw</a>[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span> <span class="keywordflow">and</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#ae383484ded6e38b17cc9ebaf62b6e0fb">kw</a>[<span class="stringliteral">&#39;pedigree_summary&#39;</span>]:
<a name="l03061"></a>03061             <span class="keywordflow">print</span> <span class="stringliteral">&#39;\t[INFO]:  Detaching pedigree...&#39;</span>
<a name="l03062"></a>03062         self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#aeb73a030c12f21e472db7e8446a14f5d">myped</a> = []
<a name="l03063"></a>03063     <span class="comment">##</span>
<a name="l03064"></a>03064     <span class="comment"># printme() prints a summary of the metadata stored in the Pedigree() object.</span>
<a name="l03065"></a>03065     <span class="comment"># @param self Reference to current object</span>
<a name="l03066"></a>03066     <span class="comment"># @retval None</span>
<a name="l03067"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#a7f23e64e27bd497a11e64aee955654d9">03067</a>     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#a7f23e64e27bd497a11e64aee955654d9" title="printme() prints a summary of the metadata stored in the Pedigree() object.">printme</a>(self):
<a name="l03068"></a>03068         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l03069"></a>03069 <span class="stringliteral">        Print the pedigree metadata.</span>
<a name="l03070"></a>03070 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l03071"></a>03071         <span class="keywordflow">print</span> <span class="stringliteral">&#39;Metadata for %s (%s)&#39;</span> % (self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#abd1252a89353833fa8710ed40c2e09a3">name</a>,self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#a68aa37b361055119a7becea3fc91fc29">filename</a>)
<a name="l03072"></a>03072         <span class="keywordflow">print</span> <span class="stringliteral">&#39;\tRecords:\t\t%s&#39;</span> % (self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#a4479053d48852d7251b1ee2117aa64f1">num_records</a>)
<a name="l03073"></a>03073         <span class="keywordflow">print</span> <span class="stringliteral">&#39;\tUnique Sires:\t\t%s&#39;</span> % (self.num_unique_sires)
<a name="l03074"></a>03074         <span class="keywordflow">if</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#ae383484ded6e38b17cc9ebaf62b6e0fb">kw</a>[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span> <span class="keywordflow">and</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#ae383484ded6e38b17cc9ebaf62b6e0fb">kw</a>[<span class="stringliteral">&#39;pedigree_summary&#39;</span>] &gt; 1:
<a name="l03075"></a>03075             <span class="keywordflow">print</span> <span class="stringliteral">&#39;\tSires:\t\t%s&#39;</span> % (self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#a1a2ec2114f1c920a804bae04ef3503eb">unique_sire_list</a>)
<a name="l03076"></a>03076         <span class="keywordflow">print</span> <span class="stringliteral">&#39;\tUnique Dams:\t\t%s&#39;</span> % (self.num_unique_dams)
<a name="l03077"></a>03077         <span class="keywordflow">if</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#ae383484ded6e38b17cc9ebaf62b6e0fb">kw</a>[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span> <span class="keywordflow">and</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#ae383484ded6e38b17cc9ebaf62b6e0fb">kw</a>[<span class="stringliteral">&#39;pedigree_summary&#39;</span>] &gt; 1:
<a name="l03078"></a>03078             <span class="keywordflow">print</span> <span class="stringliteral">&#39;\tDams:\t\t%s&#39;</span> % (self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#a04a892ce48016e30fdafd7676c6c6712">unique_dam_list</a>)
<a name="l03079"></a>03079         <span class="keywordflow">print</span> <span class="stringliteral">&#39;\tUnique Gens:\t\t%s&#39;</span> % (self.num_unique_gens)
<a name="l03080"></a>03080         <span class="keywordflow">if</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#ae383484ded6e38b17cc9ebaf62b6e0fb">kw</a>[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span> <span class="keywordflow">and</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#ae383484ded6e38b17cc9ebaf62b6e0fb">kw</a>[<span class="stringliteral">&#39;pedigree_summary&#39;</span>] &gt; 1:
<a name="l03081"></a>03081             <span class="keywordflow">print</span> <span class="stringliteral">&#39;\tGenerations:\t\t%s&#39;</span> % (self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#a12189226c48c79f6256be356927595b6">unique_gen_list</a>)
<a name="l03082"></a>03082         <span class="keywordflow">print</span> <span class="stringliteral">&#39;\tUnique Years:\t\t%s&#39;</span> % (self.num_unique_years)
<a name="l03083"></a>03083         <span class="keywordflow">if</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#ae383484ded6e38b17cc9ebaf62b6e0fb">kw</a>[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span> <span class="keywordflow">and</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#ae383484ded6e38b17cc9ebaf62b6e0fb">kw</a>[<span class="stringliteral">&#39;pedigree_summary&#39;</span>] &gt; 1:
<a name="l03084"></a>03084             <span class="keywordflow">print</span> <span class="stringliteral">&#39;\tYear:\t\t%s&#39;</span> % (self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#a9006f241d87025dc5035be307d2173ab">unique_year_list</a>)
<a name="l03085"></a>03085         <span class="keywordflow">print</span> <span class="stringliteral">&#39;\tUnique Founders:\t%s&#39;</span> % (self.num_unique_founders)
<a name="l03086"></a>03086         <span class="keywordflow">if</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#ae383484ded6e38b17cc9ebaf62b6e0fb">kw</a>[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span> <span class="keywordflow">and</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#ae383484ded6e38b17cc9ebaf62b6e0fb">kw</a>[<span class="stringliteral">&#39;pedigree_summary&#39;</span>] &gt; 1:
<a name="l03087"></a>03087             <span class="keywordflow">print</span> <span class="stringliteral">&#39;\tFounders:\t\t%s&#39;</span> % (self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#a8d1484c36529a6a2dc85e1562540d4dc">unique_founder_list</a>)
<a name="l03088"></a>03088         <span class="keywordflow">print</span> <span class="stringliteral">&#39;\tUnique Herds:\t\t%s&#39;</span> % (self.num_unique_herds)
<a name="l03089"></a>03089         <span class="keywordflow">if</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#ae383484ded6e38b17cc9ebaf62b6e0fb">kw</a>[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span> <span class="keywordflow">and</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#ae383484ded6e38b17cc9ebaf62b6e0fb">kw</a>[<span class="stringliteral">&#39;pedigree_summary&#39;</span>] &gt; 1:
<a name="l03090"></a>03090             <span class="keywordflow">print</span> <span class="stringliteral">&#39;\tHerds:\t\t%s&#39;</span> % (self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#a91b610d629df6c79f8adc7605af72541">unique_herd_list</a>)
<a name="l03091"></a>03091         <span class="keywordflow">print</span> <span class="stringliteral">&#39;\tPedigree Code:\t\t%s&#39;</span> % (self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#af8a418ed1c7cda5ff682e610f20ba687">pedcode</a>)
<a name="l03092"></a>03092 
<a name="l03093"></a>03093     <span class="comment">##</span>
<a name="l03094"></a>03094     <span class="comment"># stringme() returns a summary of the metadata stored in the pedigree as</span>
<a name="l03095"></a>03095     <span class="comment"># a string.</span>
<a name="l03096"></a>03096     <span class="comment"># @param self Reference to current object.</span>
<a name="l03097"></a>03097     <span class="comment"># @retval A summary of the metadata stored in the pedigree as a string.</span>
<a name="l03098"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#a4f6249ec84966de2733ec856b4763e2a">03098</a>     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#a4f6249ec84966de2733ec856b4763e2a" title="stringme() returns a summary of the metadata stored in the pedigree as a string.">stringme</a>(self):
<a name="l03099"></a>03099         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l03100"></a>03100 <span class="stringliteral">        Build a string from the pedigree metadata.</span>
<a name="l03101"></a>03101 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l03102"></a>03102         _me = <span class="stringliteral">&#39;&#39;</span>
<a name="l03103"></a>03103         _me = <span class="stringliteral">&#39;%s%s&#39;</span> % ( _me, <span class="stringliteral">&#39;PEDIGREE %s (%s)\n&#39;</span> % (self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#abd1252a89353833fa8710ed40c2e09a3">name</a>,self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#a68aa37b361055119a7becea3fc91fc29">filename</a>) )
<a name="l03104"></a>03104         _me = <span class="stringliteral">&#39;%s%s&#39;</span> % ( _me, <span class="stringliteral">&#39;\tRecords:\t\t\t%s\n&#39;</span> % (self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#a4479053d48852d7251b1ee2117aa64f1">num_records</a>) )
<a name="l03105"></a>03105         _me = <span class="stringliteral">&#39;%s%s&#39;</span> % ( _me, <span class="stringliteral">&#39;\tUnique Sires:\t\t%s\n&#39;</span> % (self.num_unique_sires) )
<a name="l03106"></a>03106         _me = <span class="stringliteral">&#39;%s%s&#39;</span> % ( _me, <span class="stringliteral">&#39;\tUnique Dams:\t\t%s\n&#39;</span> % (self.num_unique_dams) )
<a name="l03107"></a>03107         _me = <span class="stringliteral">&#39;%s%s&#39;</span> % ( _me, <span class="stringliteral">&#39;\tUnique Gens:\t\t%s\n&#39;</span> % (self.num_unique_gens) )
<a name="l03108"></a>03108         _me = <span class="stringliteral">&#39;%s%s&#39;</span> % ( _me, <span class="stringliteral">&#39;\tUnique Years:\t\t%s\n&#39;</span> % (self.num_unique_years) )
<a name="l03109"></a>03109         _me = <span class="stringliteral">&#39;%s%s&#39;</span> % ( _me, <span class="stringliteral">&#39;\tUnique Founders:\t%s\n&#39;</span> % (self.num_unique_founders) )
<a name="l03110"></a>03110         _me = <span class="stringliteral">&#39;%s%s&#39;</span> % ( _me, <span class="stringliteral">&#39;\tUnique Herds:\t%s\n&#39;</span> % (self.num_unique_herds) )
<a name="l03111"></a>03111         _me = <span class="stringliteral">&#39;%s%s&#39;</span> % ( _me, <span class="stringliteral">&#39;\tPedigree Code:\t\t%s\n&#39;</span> % (self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#af8a418ed1c7cda5ff682e610f20ba687">pedcode</a>) )
<a name="l03112"></a>03112         <span class="keywordflow">return</span> _me
<a name="l03113"></a>03113     <span class="comment">##</span>
<a name="l03114"></a>03114     <span class="comment"># fileme() writes the metada stored in the Pedigree() object to disc.</span>
<a name="l03115"></a>03115     <span class="comment"># @param self Reference to current object</span>
<a name="l03116"></a>03116     <span class="comment"># @retval None</span>
<a name="l03117"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#a8af37f0f55bc77dca77228986185fbe7">03117</a>     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#a8af37f0f55bc77dca77228986185fbe7" title="fileme() writes the metada stored in the Pedigree() object to disc.">fileme</a>(self):
<a name="l03118"></a>03118         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l03119"></a>03119 <span class="stringliteral">        Save the pedigree metadata to a file.</span>
<a name="l03120"></a>03120 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l03121"></a>03121         outputfile = <span class="stringliteral">&#39;%s%s%s&#39;</span> % (self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#abd1252a89353833fa8710ed40c2e09a3">name</a>,<span class="stringliteral">&#39;_ped_metadata_&#39;</span>,<span class="stringliteral">&#39;.dat&#39;</span>)
<a name="l03122"></a>03122         aout = open(outputfile,<span class="stringliteral">&#39;w&#39;</span>)
<a name="l03123"></a>03123         line = <span class="stringliteral">&#39;=&#39;</span>*60+<span class="stringliteral">&#39;\n&#39;</span>
<a name="l03124"></a>03124         aout.write(<span class="stringliteral">&#39;%s\n&#39;</span> % line)
<a name="l03125"></a>03125         aout.write(<span class="stringliteral">&#39;PEDIGREE %s (%s)\n&#39;</span> % self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#abd1252a89353833fa8710ed40c2e09a3">name</a>,self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#a68aa37b361055119a7becea3fc91fc29">filename</a>)
<a name="l03126"></a>03126         aout.write(<span class="stringliteral">&#39;\tPedigree Code:\t%s\n&#39;</span> % self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#af8a418ed1c7cda5ff682e610f20ba687">pedcode</a>)
<a name="l03127"></a>03127         aout.write(<span class="stringliteral">&#39;\tRecords:\t%s\n&#39;</span> % self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#a4479053d48852d7251b1ee2117aa64f1">num_records</a>)
<a name="l03128"></a>03128         aout.write(<span class="stringliteral">&#39;\tUnique Sires:\t%s\n&#39;</span> % self.num_unique_sires)
<a name="l03129"></a>03129         aout.write(<span class="stringliteral">&#39;\tUnique Dams:\t%s\n&#39;</span> % self.num_unique_dams)
<a name="l03130"></a>03130         aout.write(<span class="stringliteral">&#39;\tUnique Founders:\t%s\n&#39;</span> % self.num_unique_founders)
<a name="l03131"></a>03131         aout.write(<span class="stringliteral">&#39;\tUnique Gens:\t%s\n&#39;</span> % self.num_unique_gens)
<a name="l03132"></a>03132         aout.write(<span class="stringliteral">&#39;\tUnique Years:\t%s\n&#39;</span> % self.num_unique_years)
<a name="l03133"></a>03133         aout.write(<span class="stringliteral">&#39;\tUnique Herds:\t%s\n&#39;</span> % self.num_unique_herds)
<a name="l03134"></a>03134         aout.write(<span class="stringliteral">&#39;%s\n&#39;</span> % line)
<a name="l03135"></a>03135         aout.write(<span class="stringliteral">&#39;\tUnique Sire List:\t%s\n&#39;</span> % self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#a1a2ec2114f1c920a804bae04ef3503eb">unique_sire_list</a>)
<a name="l03136"></a>03136         aout.write(<span class="stringliteral">&#39;\tUnique Dam List:\t%s\n&#39;</span> % self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#a04a892ce48016e30fdafd7676c6c6712">unique_dam_list</a>)
<a name="l03137"></a>03137         aout.write(<span class="stringliteral">&#39;\tUnique Founder List:\t%s\n&#39;</span> % self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#a8d1484c36529a6a2dc85e1562540d4dc">unique_founder_list</a>)
<a name="l03138"></a>03138         aout.write(<span class="stringliteral">&#39;\tUnique Gen List:\t%s\n&#39;</span> % self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#a12189226c48c79f6256be356927595b6">unique_gen_list</a>)
<a name="l03139"></a>03139         aout.write(<span class="stringliteral">&#39;\tUnique Year List:\t%s\n&#39;</span> % self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#a9006f241d87025dc5035be307d2173ab">unique_year_list</a>)
<a name="l03140"></a>03140         aout.write(<span class="stringliteral">&#39;\tUnique Herd List:\t%s\n&#39;</span> % self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#a91b610d629df6c79f8adc7605af72541">unique_herd_list</a>)
<a name="l03141"></a>03141         aout.write(<span class="stringliteral">&#39;%s\n&#39;</span> % line)
<a name="l03142"></a>03142         aout.close()
<a name="l03143"></a>03143 
<a name="l03144"></a>03144     <span class="comment">##</span>
<a name="l03145"></a>03145     <span class="comment"># nus() returns the number of unique sires in the pedigree along with a list of the sires</span>
<a name="l03146"></a>03146     <span class="comment"># @param self Reference to current object</span>
<a name="l03147"></a>03147     <span class="comment"># @retval The number of unique sires in the pedigree and a list of those sires</span>
<a name="l03148"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#aab430a7cc66838ce6f75a80fa8fd2884">03148</a>     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#aab430a7cc66838ce6f75a80fa8fd2884" title="nus() returns the number of unique sires in the pedigree along with a list of the sires...">nus</a>(self):
<a name="l03149"></a>03149         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l03150"></a>03150 <span class="stringliteral">        Count the number of unique sire IDs in the pedigree.  Returns an integer count</span>
<a name="l03151"></a>03151 <span class="stringliteral">        and a Python list of the unique sire IDs.</span>
<a name="l03152"></a>03152 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l03153"></a>03153         sirelist = set([x.sireID <span class="keywordflow">for</span> x <span class="keywordflow">in</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#aeb73a030c12f21e472db7e8446a14f5d">myped</a> <span class="keywordflow">if</span> x.sireID != self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#ae383484ded6e38b17cc9ebaf62b6e0fb">kw</a>[<span class="stringliteral">&#39;missing_parent&#39;</span>]])
<a name="l03154"></a>03154         <span class="keywordflow">return</span> len(sirelist), sirelist
<a name="l03155"></a>03155 
<a name="l03156"></a>03156     <span class="comment">##</span>
<a name="l03157"></a>03157     <span class="comment"># nud() returns the number of unique dams in the pedigree along with a list of the dams</span>
<a name="l03158"></a>03158     <span class="comment"># @param self Reference to current object</span>
<a name="l03159"></a>03159     <span class="comment"># @retval The number of unique dams in the pedigree and a list of those dams</span>
<a name="l03160"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#a9330d9f4d5d9ce616a57db3b8fae95b1">03160</a>     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#a9330d9f4d5d9ce616a57db3b8fae95b1" title="nud() returns the number of unique dams in the pedigree along with a list of the dams">nud</a>(self):
<a name="l03161"></a>03161         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l03162"></a>03162 <span class="stringliteral">        Count the number of unique dam IDs in the pedigree.  Returns an integer count</span>
<a name="l03163"></a>03163 <span class="stringliteral">        and a Python list of the unique dam IDs.</span>
<a name="l03164"></a>03164 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l03165"></a>03165         damlist = set([x.damID <span class="keywordflow">for</span> x <span class="keywordflow">in</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#aeb73a030c12f21e472db7e8446a14f5d">myped</a> <span class="keywordflow">if</span> x.damID != self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#ae383484ded6e38b17cc9ebaf62b6e0fb">kw</a>[<span class="stringliteral">&#39;missing_parent&#39;</span>]])
<a name="l03166"></a>03166         <span class="keywordflow">return</span> len(damlist), damlist
<a name="l03167"></a>03167 
<a name="l03168"></a>03168     <span class="comment">##</span>
<a name="l03169"></a>03169     <span class="comment"># nug() returns the number of unique generations in the pedigree along with a list of the generations</span>
<a name="l03170"></a>03170     <span class="comment"># @param self Reference to current object</span>
<a name="l03171"></a>03171     <span class="comment"># @retval The number of unique generations in the pedigree and a list of those generations</span>
<a name="l03172"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#a41af77f90422ded81869fd3f2a8a80f9">03172</a>     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#a41af77f90422ded81869fd3f2a8a80f9" title="nug() returns the number of unique generations in the pedigree along with a list of the generations...">nug</a>(self):
<a name="l03173"></a>03173         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l03174"></a>03174 <span class="stringliteral">        Count the number of unique generations in the pedigree.  Returns an integer</span>
<a name="l03175"></a>03175 <span class="stringliteral">        count and a Python list of the unique generations.</span>
<a name="l03176"></a>03176 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l03177"></a>03177         <span class="keywordflow">if</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#ae383484ded6e38b17cc9ebaf62b6e0fb">kw</a>[<span class="stringliteral">&#39;animal_type&#39;</span>] == <span class="stringliteral">&#39;light&#39;</span>:
<a name="l03178"></a>03178             genlist = []
<a name="l03179"></a>03179         <span class="keywordflow">else</span>:
<a name="l03180"></a>03180             genlist = set([x.gen <span class="keywordflow">for</span> x <span class="keywordflow">in</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#aeb73a030c12f21e472db7e8446a14f5d">myped</a>])
<a name="l03181"></a>03181         <span class="keywordflow">return</span> len(genlist), genlist
<a name="l03182"></a>03182 
<a name="l03183"></a>03183     <span class="comment">##</span>
<a name="l03184"></a>03184     <span class="comment"># nuy() returns the number of unique birthyears in the pedigree along with a list of the birthyears</span>
<a name="l03185"></a>03185     <span class="comment"># @param self Reference to current object</span>
<a name="l03186"></a>03186     <span class="comment"># @retval The number of unique birthyears in the pedigree and a list of those birthyears</span>
<a name="l03187"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#a7f51c5a6914509ec324afde82f245253">03187</a>     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#a7f51c5a6914509ec324afde82f245253" title="nuy() returns the number of unique birthyears in the pedigree along with a list of the birthyears...">nuy</a>(self):
<a name="l03188"></a>03188         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l03189"></a>03189 <span class="stringliteral">        Count the number of unique birth years in the pedigree.  Returns an integer</span>
<a name="l03190"></a>03190 <span class="stringliteral">        count and a Python list of the unique birth years.</span>
<a name="l03191"></a>03191 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l03192"></a>03192         bylist = set([x.by <span class="keywordflow">for</span> x <span class="keywordflow">in</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#aeb73a030c12f21e472db7e8446a14f5d">myped</a>])
<a name="l03193"></a>03193         <span class="keywordflow">return</span> len(bylist), bylist
<a name="l03194"></a>03194 
<a name="l03195"></a>03195     <span class="comment">##</span>
<a name="l03196"></a>03196     <span class="comment"># nuf() returns the number of unique founders in the pedigree along with a list of the founders</span>
<a name="l03197"></a>03197     <span class="comment"># @param self Reference to current object</span>
<a name="l03198"></a>03198     <span class="comment"># @retval The number of unique founders in the pedigree and a list of those founders</span>
<a name="l03199"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#a2fa68d278b69bda83c344c5f0615e25c">03199</a>     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#a2fa68d278b69bda83c344c5f0615e25c" title="nuf() returns the number of unique founders in the pedigree along with a list of the founders...">nuf</a>(self):
<a name="l03200"></a>03200         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l03201"></a>03201 <span class="stringliteral">        Count the number of unique founders in the pedigree.</span>
<a name="l03202"></a>03202 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l03203"></a>03203         <span class="keywordflow">if</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#ae383484ded6e38b17cc9ebaf62b6e0fb">kw</a>[<span class="stringliteral">&#39;animal_type&#39;</span>] == <span class="stringliteral">&#39;light&#39;</span>:
<a name="l03204"></a>03204             <span class="comment"># There is no &#39;founder&#39; flag on LightAnimal records, so we need to</span>
<a name="l03205"></a>03205             <span class="comment"># check for unknown parents in order to identify founders.</span>
<a name="l03206"></a>03206             flist = set([x.animalID <span class="keywordflow">for</span> x <span class="keywordflow">in</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#aeb73a030c12f21e472db7e8446a14f5d">myped</a> <span class="keywordflow">if</span> x.sireID == self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#ae383484ded6e38b17cc9ebaf62b6e0fb">kw</a>[<span class="stringliteral">&#39;missing_parent&#39;</span>] <span class="keywordflow">and</span> x.damID == self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#ae383484ded6e38b17cc9ebaf62b6e0fb">kw</a>[<span class="stringliteral">&#39;missing_parent&#39;</span>]])
<a name="l03207"></a>03207         <span class="keywordflow">else</span>:
<a name="l03208"></a>03208             flist = set([x.animalID <span class="keywordflow">for</span> x <span class="keywordflow">in</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#aeb73a030c12f21e472db7e8446a14f5d">myped</a> <span class="keywordflow">if</span> x.founder == <span class="stringliteral">&#39;y&#39;</span>])
<a name="l03209"></a>03209         <span class="keywordflow">return</span> len(flist), flist
<a name="l03210"></a>03210 
<a name="l03211"></a>03211     <span class="comment">##</span>
<a name="l03212"></a>03212     <span class="comment"># nuherds() returns the number of unique herds in the pedigree along with a list of the herds.</span>
<a name="l03213"></a>03213     <span class="comment"># @param self Reference to the current Pedigree() object</span>
<a name="l03214"></a>03214     <span class="comment"># @retval The number of unique herds in the pedigree and a list of those herds</span>
<a name="l03215"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#ae408f6ef90563175d0069238dfd55f1b">03215</a>     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#ae408f6ef90563175d0069238dfd55f1b" title="nuherds() returns the number of unique herds in the pedigree along with a list of the herds...">nuherds</a>(self):
<a name="l03216"></a>03216         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l03217"></a>03217 <span class="stringliteral">        Count the number of unique herds in the pedigree.</span>
<a name="l03218"></a>03218 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l03219"></a>03219         <span class="keywordflow">if</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#ae383484ded6e38b17cc9ebaf62b6e0fb">kw</a>[<span class="stringliteral">&#39;animal_type&#39;</span>] == <span class="stringliteral">&#39;light&#39;</span>:
<a name="l03220"></a>03220             herdlist = []
<a name="l03221"></a>03221         <span class="keywordflow">else</span>:
<a name="l03222"></a>03222             herdlist = set([x.originalHerd <span class="keywordflow">for</span> x <span class="keywordflow">in</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#aeb73a030c12f21e472db7e8446a14f5d">myped</a>])
<a name="l03223"></a>03223         <span class="keywordflow">return</span> len(herdlist), herdlist
<a name="l03224"></a>03224 
<a name="l03225"></a>03225 <span class="comment">##</span>
<a name="l03226"></a>03226 <span class="comment"># NewAMatrix provides an instance of a numerator relationship matrix as a Numarray array of</span>
<a name="l03227"></a>03227 <span class="comment"># floats with some convenience methods.  The idea here is to provide a wrapper around a NRM</span>
<a name="l03228"></a>03228 <span class="comment"># so that it is easier to work with.  For large pedigrees it can take a long time to compute</span>
<a name="l03229"></a>03229 <span class="comment"># the elements of A, so there is real value in providing an easy way to save and retrieve a</span>
<a name="l03230"></a>03230 <span class="comment"># NRM once it has been formed.</span>
<a name="l03231"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html">03231</a> <span class="keyword">class </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html" title="NewAMatrix provides an instance of a numerator relationship matrix as a Numarray array of floats with...">NewAMatrix</a>:
<a name="l03232"></a>03232     <span class="comment">##</span>
<a name="l03233"></a>03233     <span class="comment"># __init__() initializes a NewAMatrix object.</span>
<a name="l03234"></a>03234     <span class="comment"># @param self Reference to current object.</span>
<a name="l03235"></a>03235     <span class="comment"># @param kw A dictionary of options.</span>
<a name="l03236"></a>03236     <span class="comment"># @retval An instance of a NewAMatrix() object</span>
<a name="l03237"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html#a38f78e043e7bee1cac6237a09d912d93">03237</a>     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html#a38f78e043e7bee1cac6237a09d912d93" title="__init__() initializes a NewAMatrix object.">__init__</a>(self, kw):
<a name="l03238"></a>03238         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l03239"></a>03239 <span class="stringliteral">        Initialize a new numerator relationship matrix.</span>
<a name="l03240"></a>03240 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l03241"></a>03241         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">&#39;messages&#39;</span>): kw[<span class="stringliteral">&#39;messages&#39;</span>] = <span class="stringliteral">&#39;verbose&#39;</span>
<a name="l03242"></a>03242         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">&#39;nrm_method&#39;</span>): kw[<span class="stringliteral">&#39;nrm_method&#39;</span>] = <span class="stringliteral">&#39;nrm&#39;</span>
<a name="l03243"></a>03243         <span class="comment"># nrm_format can take the values &#39;text&#39; or &#39;binary&#39;.</span>
<a name="l03244"></a>03244         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">&#39;nrm_format&#39;</span>): kw[<span class="stringliteral">&#39;nrm_format&#39;</span>] = <span class="stringliteral">&#39;text&#39;</span>
<a name="l03245"></a>03245         self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html#a02232733e98758d8619ad3dcaa4d7b09">kw</a> = kw
<a name="l03246"></a>03246         self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html#ac5731b07c2cf8375b484921937807327">nrm</a> = <span class="keyword">False</span>
<a name="l03247"></a>03247 
<a name="l03248"></a>03248     <span class="comment">##</span>
<a name="l03249"></a>03249     <span class="comment"># form_a_matrix() calls pyp_nrm/fast_a_matrix() or pyp_nrm/fast_a_matrix_r()</span>
<a name="l03250"></a>03250     <span class="comment"># to form a NRM from a pedigree.</span>
<a name="l03251"></a>03251     <span class="comment"># @param self Reference to current object.</span>
<a name="l03252"></a>03252     <span class="comment"># @param pedigree The pedigree used to form the NRM.</span>
<a name="l03253"></a>03253     <span class="comment"># @retval A NRM on success, 0 on failure.</span>
<a name="l03254"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html#aab22e9d4b42f4207692435849e15a551">03254</a>     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html#aab22e9d4b42f4207692435849e15a551" title="form_a_matrix() calls pyp_nrm/fast_a_matrix() or pyp_nrm/fast_a_matrix_r() to form a NRM from a pedig...">form_a_matrix</a>(self, pedigree):
<a name="l03255"></a>03255         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l03256"></a>03256 <span class="stringliteral">        form_a_matrix() calls pyp_nrm/fast_a_matrix() or pyp_nrm/fast_a_matrix_r()</span>
<a name="l03257"></a>03257 <span class="stringliteral">        to form a NRM from a pedigree.</span>
<a name="l03258"></a>03258 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l03259"></a>03259         <span class="keywordflow">if</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html#a02232733e98758d8619ad3dcaa4d7b09">kw</a>[<span class="stringliteral">&#39;nrm_method&#39;</span>] <span class="keywordflow">not</span> <span class="keywordflow">in</span> [<span class="stringliteral">&#39;nrm&#39;</span>,<span class="stringliteral">&#39;frm&#39;</span>]:
<a name="l03260"></a>03260             self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html#a02232733e98758d8619ad3dcaa4d7b09">kw</a>[<span class="stringliteral">&#39;nrm_method&#39;</span>] = <span class="stringliteral">&#39;nrm&#39;</span>
<a name="l03261"></a>03261         <span class="keywordflow">if</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html#a02232733e98758d8619ad3dcaa4d7b09">kw</a>[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span>:
<a name="l03262"></a>03262             <span class="keywordflow">print</span> <span class="stringliteral">&#39;[INFO]: Forming A-matrix from pedigree at %s.&#39;</span> % ( pyp_utils.pyp_nice_time() )
<a name="l03263"></a>03263         logging.info(<span class="stringliteral">&#39;Forming A-matrix from pedigree&#39;</span>)
<a name="l03264"></a>03264         <span class="comment"># Try and form the NRM where COI are not adjusted for the inbreeding</span>
<a name="l03265"></a>03265         <span class="comment"># of parents.</span>
<a name="l03266"></a>03266         <span class="keywordflow">if</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html#a02232733e98758d8619ad3dcaa4d7b09">kw</a>[<span class="stringliteral">&#39;nrm_method&#39;</span>] == <span class="stringliteral">&#39;nrm&#39;</span>:
<a name="l03267"></a>03267             <span class="keywordflow">try</span>:
<a name="l03268"></a>03268                 self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html#ac5731b07c2cf8375b484921937807327">nrm</a> = pyp_nrm.fast_a_matrix(pedigree,self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html#a02232733e98758d8619ad3dcaa4d7b09">kw</a>)
<a name="l03269"></a>03269                 <span class="keywordflow">if</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html#a02232733e98758d8619ad3dcaa4d7b09">kw</a>[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span>:
<a name="l03270"></a>03270                     <span class="keywordflow">print</span> <span class="stringliteral">&#39;[INFO]: Formed A-matrix from pedigree using pyp_nrm.fast_a_matrix() at %s.&#39;</span> % ( pyp_utils.pyp_nice_time() )
<a name="l03271"></a>03271                 logging.info(<span class="stringliteral">&#39;Formed A-matrix from pedigree using pyp_nrm.fast_a_matrix()&#39;</span>)
<a name="l03272"></a>03272             <span class="keywordflow">except</span>:
<a name="l03273"></a>03273                 <span class="keywordflow">if</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html#a02232733e98758d8619ad3dcaa4d7b09">kw</a>[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span>:
<a name="l03274"></a>03274                     <span class="keywordflow">print</span> <span class="stringliteral">&#39;[ERROR]: Unable to form A-matrix from pedigree using pyp_nrm.fast_a_matrix() at %s.&#39;</span> % ( pyp_utils.pyp_nice_time() )
<a name="l03275"></a>03275                 logging.error(<span class="stringliteral">&#39;Unable to form A-matrix from pedigree using pyp_nrm.fast_a_matrix()&#39;</span>)
<a name="l03276"></a>03276                 <span class="keywordflow">return</span> 0
<a name="l03277"></a>03277         <span class="comment"># Otherwise try and form the NRM where COI are adjusted for the inbreeding</span>
<a name="l03278"></a>03278         <span class="comment"># of parents.</span>
<a name="l03279"></a>03279         <span class="keywordflow">else</span>:
<a name="l03280"></a>03280             <span class="keywordflow">try</span>:
<a name="l03281"></a>03281                 self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html#ac5731b07c2cf8375b484921937807327">nrm</a> = pyp_nrm.fast_a_matrix_r(pedigree,self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html#a02232733e98758d8619ad3dcaa4d7b09">kw</a>)
<a name="l03282"></a>03282                 <span class="keywordflow">if</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html#a02232733e98758d8619ad3dcaa4d7b09">kw</a>[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span>:
<a name="l03283"></a>03283                     <span class="keywordflow">print</span> <span class="stringliteral">&#39;[INFO]: Formed A-matrix from pedigree using pyp_nrm.fast_a_matrix_r() at %s.&#39;</span> % ( pyp_utils.pyp_nice_time() )
<a name="l03284"></a>03284                 logging.info(<span class="stringliteral">&#39;Formed A-matrix from pedigree using pyp_nrm.fast_a_matrix_r()&#39;</span>)
<a name="l03285"></a>03285             <span class="keywordflow">except</span>:
<a name="l03286"></a>03286                 <span class="keywordflow">if</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html#a02232733e98758d8619ad3dcaa4d7b09">kw</a>[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span>:
<a name="l03287"></a>03287                     <span class="keywordflow">print</span> <span class="stringliteral">&#39;[ERROR]: Unable to form A-matrix from pedigree using pyp_nrm.fast_a_matrix_r() at %s.&#39;</span> % ( pyp_utils.pyp_nice_time() )
<a name="l03288"></a>03288                 logging.error(<span class="stringliteral">&#39;Unable to form A-matrix from pedigree using pyp_nrm.fast_a_matrix_r()&#39;</span>)
<a name="l03289"></a>03289                 <span class="keywordflow">return</span> 0
<a name="l03290"></a>03290 
<a name="l03291"></a>03291     <span class="comment">##</span>
<a name="l03292"></a>03292     <span class="comment"># load() uses the Numarray Array Function &quot;fromfile()&quot; to load an array from a</span>
<a name="l03293"></a>03293     <span class="comment"># binary file.  If the load is successful, self.nrm contains the matrix.</span>
<a name="l03294"></a>03294     <span class="comment"># @param self Reference to current object.</span>
<a name="l03295"></a>03295     <span class="comment"># @param nrm_filename The file from which the matrix should be read.</span>
<a name="l03296"></a>03296     <span class="comment"># @retval A load status indicator (0: failed, 1: success).</span>
<a name="l03297"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html#a1d5ee9920957680eb210fe4b1b81adb3">03297</a>     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html#a1d5ee9920957680eb210fe4b1b81adb3" title="load() uses the Numarray Array Function &quot;fromfile()&quot; to load an array from a binary file...">load</a>(self, nrm_filename):
<a name="l03298"></a>03298         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l03299"></a>03299 <span class="stringliteral">        load() uses the Numarray Array Function &quot;fromfile()&quot; to load an array from a</span>
<a name="l03300"></a>03300 <span class="stringliteral">        binary file.  If the load is successful, self.nrm contains the matrix.</span>
<a name="l03301"></a>03301 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l03302"></a>03302         <span class="keyword">import</span> math
<a name="l03303"></a>03303         <span class="keywordflow">if</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html#a02232733e98758d8619ad3dcaa4d7b09">kw</a>[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span>:
<a name="l03304"></a>03304             <span class="keywordflow">print</span> <span class="stringliteral">&#39;[INFO]: Loading A-matrix from file %s at %s.&#39;</span> % ( nrm_filename, pyp_utils.pyp_nice_time() )
<a name="l03305"></a>03305         logging.info(<span class="stringliteral">&#39;Loading A-matrix from file %s&#39;</span>, nrm_filename)
<a name="l03306"></a>03306         <span class="keywordflow">try</span>:
<a name="l03307"></a>03307             self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html#ac5731b07c2cf8375b484921937807327">nrm</a> = numpy.fromfile(nrm_filename,dtype=<span class="stringliteral">&#39;Float64&#39;</span>,sep=self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html#a02232733e98758d8619ad3dcaa4d7b09">kw</a>[<span class="stringliteral">&#39;sepchar&#39;</span>])
<a name="l03308"></a>03308             self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html#ac5731b07c2cf8375b484921937807327">nrm</a> = numpy.reshape( self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html#ac5731b07c2cf8375b484921937807327">nrm</a>, ( int(math.sqrt(self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html#ac5731b07c2cf8375b484921937807327">nrm</a>.shape[0])), int(math.sqrt(self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html#ac5731b07c2cf8375b484921937807327">nrm</a>.shape[0])) ) )
<a name="l03309"></a>03309             <span class="keywordflow">if</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html#a02232733e98758d8619ad3dcaa4d7b09">kw</a>[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span>:
<a name="l03310"></a>03310                 <span class="keywordflow">print</span> <span class="stringliteral">&#39;[INFO]: A-matrix successfully loaded from file %s at %s.&#39;</span> % ( nrm_filename, pyp_utils.pyp_nice_time() )
<a name="l03311"></a>03311             logging.info(<span class="stringliteral">&#39;A-matrix successfully loaded from file %s&#39;</span>, nrm_filename)
<a name="l03312"></a>03312             <span class="keywordflow">return</span> 1
<a name="l03313"></a>03313         <span class="keywordflow">except</span>:
<a name="l03314"></a>03314             <span class="keywordflow">if</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html#a02232733e98758d8619ad3dcaa4d7b09">kw</a>[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span>:
<a name="l03315"></a>03315                 <span class="keywordflow">print</span> <span class="stringliteral">&#39;[ERROR]: Unable to load A-matrix from file %s at %s.&#39;</span> % ( nrm_filename, pyp_utils.pyp_nice_time() )
<a name="l03316"></a>03316             logging.error(<span class="stringliteral">&#39;Unable to load A-matrix from file %s&#39;</span>, nrm_filename)
<a name="l03317"></a>03317             <span class="keywordflow">return</span> 0
<a name="l03318"></a>03318 
<a name="l03319"></a>03319     <span class="comment">##</span>
<a name="l03320"></a>03320     <span class="comment"># save() uses the Numarray method &quot;tofile()&quot; to save an array to a binary file.</span>
<a name="l03321"></a>03321     <span class="comment"># @param self Reference to current object.</span>
<a name="l03322"></a>03322     <span class="comment"># @param nrm_filename The file to which the matrix should be written.</span>
<a name="l03323"></a>03323     <span class="comment"># @param nrm_format String indicating the format to use when writing the NRM to a file (binary|string).</span>
<a name="l03324"></a>03324     <span class="comment"># @retval A save status indicator (0: failed, 1: success).</span>
<a name="l03325"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html#ac2ee373f5e250c7ae637dc983f1b1651">03325</a>     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html#ac2ee373f5e250c7ae637dc983f1b1651" title="save() uses the Numarray method &quot;tofile()&quot; to save an array to a binary file.">save</a>(self, nrm_filename, nrm_format=&#39;&#39;):
<a name="l03326"></a>03326         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l03327"></a>03327 <span class="stringliteral">        save() uses the NumPy method &quot;tofile()&quot; to save an array to a binary file.</span>
<a name="l03328"></a>03328 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l03329"></a>03329         <span class="keywordflow">if</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html#a02232733e98758d8619ad3dcaa4d7b09">kw</a>[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span>:
<a name="l03330"></a>03330             <span class="keywordflow">print</span> <span class="stringliteral">&#39;[INFO]: Saving A-matrix to file %s at %s.&#39;</span> % ( nrm_filename, pyp_utils.pyp_nice_time() )
<a name="l03331"></a>03331         logging.info(<span class="stringliteral">&#39;Saving A-matrix to file %s&#39;</span>, nrm_filename)
<a name="l03332"></a>03332         <span class="keywordflow">try</span>:
<a name="l03333"></a>03333             <span class="comment"># If the user passes in an nrm_format keyword it overrides the</span>
<a name="l03334"></a>03334             <span class="comment"># option in the keywords dictionary.</span>
<a name="l03335"></a>03335             <span class="keywordflow">if</span> nrm_format == <span class="stringliteral">&#39;&#39;</span>:
<a name="l03336"></a>03336                 nrm_format = self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html#a02232733e98758d8619ad3dcaa4d7b09">kw</a>[<span class="stringliteral">&#39;nrm_format&#39;</span>]
<a name="l03337"></a>03337             <span class="comment"># If the nrm_format is not binary the matrix is written as a text file.</span>
<a name="l03338"></a>03338             <span class="keywordflow">if</span> nrm_format == <span class="stringliteral">&#39;binary&#39;</span>:
<a name="l03339"></a>03339                 self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html#ac5731b07c2cf8375b484921937807327">nrm</a>.tofile(nrm_filename)
<a name="l03340"></a>03340             <span class="keywordflow">else</span>:
<a name="l03341"></a>03341                 self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html#ac5731b07c2cf8375b484921937807327">nrm</a>.tofile(nrm_filename, sep=self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html#a02232733e98758d8619ad3dcaa4d7b09">kw</a>[<span class="stringliteral">&#39;sepchar&#39;</span>])
<a name="l03342"></a>03342             <span class="keywordflow">if</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html#a02232733e98758d8619ad3dcaa4d7b09">kw</a>[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span>:
<a name="l03343"></a>03343                 <span class="keywordflow">print</span> <span class="stringliteral">&#39;[INFO]: A-matrix successfully saved to file %s at %s.&#39;</span> % ( nrm_filename, pyp_utils.pyp_nice_time() )
<a name="l03344"></a>03344             logging.info(<span class="stringliteral">&#39;A-matrix successfully saved to file %s&#39;</span>, nrm_filename)
<a name="l03345"></a>03345             <span class="keywordflow">return</span> 1
<a name="l03346"></a>03346         <span class="keywordflow">except</span>:
<a name="l03347"></a>03347             <span class="keywordflow">if</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html#a02232733e98758d8619ad3dcaa4d7b09">kw</a>[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span>:
<a name="l03348"></a>03348                 <span class="keywordflow">print</span> <span class="stringliteral">&#39;[ERROR]: Unable to save A-matrix to file %s at %s.&#39;</span> % ( nrm_filename, pyp_utils.pyp_nice_time() )
<a name="l03349"></a>03349             logging.error(<span class="stringliteral">&#39;Unable to save A-matrix to file %s&#39;</span>, nrm_filename)
<a name="l03350"></a>03350             <span class="keywordflow">return</span> 0
<a name="l03351"></a>03351 
<a name="l03352"></a>03352     <span class="comment">##</span>
<a name="l03353"></a>03353     <span class="comment"># printme() prints the NRM to the screen.</span>
<a name="l03354"></a>03354     <span class="comment"># @param self Reference to current object.</span>
<a name="l03355"></a>03355     <span class="comment"># @retval None</span>
<a name="l03356"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html#a65c238459dd58cb32ec19cb7c93164ba">03356</a>     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html#a65c238459dd58cb32ec19cb7c93164ba" title="printme() prints the NRM to the screen.">printme</a>(self):
<a name="l03357"></a>03357         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l03358"></a>03358 <span class="stringliteral">        printme() prints the NRM to the screen.</span>
<a name="l03359"></a>03359 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l03360"></a>03360         <span class="keywordflow">try</span>:
<a name="l03361"></a>03361             <span class="keywordflow">print</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html#ac5731b07c2cf8375b484921937807327">nrm</a>
<a name="l03362"></a>03362         <span class="keywordflow">except</span>:
<a name="l03363"></a>03363             <span class="keywordflow">pass</span>
<a name="l03364"></a>03364 
<a name="l03365"></a>03365 <span class="comment">##</span>
<a name="l03366"></a>03366 <span class="comment"># loadPedigree() wraps pedigree creation and loading into a one-step</span>
<a name="l03367"></a>03367 <span class="comment"># process.  If the user passes both a dictionary and a filename, the</span>
<a name="l03368"></a>03368 <span class="comment"># dictionary will be used instead of the filename unless the dictionary</span>
<a name="l03369"></a>03369 <span class="comment"># is empty.</span>
<a name="l03370"></a>03370 <span class="comment"># @param options Dictionary of pedigree options.</span>
<a name="l03371"></a>03371 <span class="comment"># @param optionsfile File from which pedigree options should be read.</span>
<a name="l03372"></a>03372 <span class="comment"># @param pedsource Source of the pedigree (&#39;file&#39;|&#39;graph&#39;|&#39;graphfile&#39;|&#39;db&#39;|&#39;gedcomfile&#39;|&#39;genesfile&#39;|&#39;textstream&#39;).</span>
<a name="l03373"></a>03373 <span class="comment"># @param pedgraph DiGraph from which to load the pedigree.</span>
<a name="l03374"></a>03374 <span class="comment"># @param pedstream String of tuples to unpack into a pedigree.</span>
<a name="l03375"></a>03375 <span class="comment"># @param debugLoad When True, print debugging messages while loading (True|False).</span>
<a name="l03376"></a>03376 <span class="comment"># @retval An instance of a NewPedigree object on success, a 0 on failure.</span>
<a name="l03377"></a>03377 <span class="keyword">def </span>loadPedigree(options=&#39;&#39;, optionsfile=&#39;pypedal.ini&#39;, pedsource=&#39;file&#39;, pedgraph=0, pedstream=&#39;&#39;, debugLoad=False):
<a name="l03378"></a>03378     <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l03379"></a>03379 <span class="stringliteral">    loadPedigree() wraps pedigree creation and loading into a one-step</span>
<a name="l03380"></a>03380 <span class="stringliteral">    process.  If the user passes both a dictionary and a filename, the</span>
<a name="l03381"></a>03381 <span class="stringliteral">    dictionary will be used instead of the filename unless the dictionary</span>
<a name="l03382"></a>03382 <span class="stringliteral">    is empty.</span>
<a name="l03383"></a>03383 <span class="stringliteral">    &quot;&quot;&quot;</span>
<a name="l03384"></a>03384     <span class="keywordflow">if</span> debugLoad == <span class="keyword">True</span>:
<a name="l03385"></a>03385         <span class="keywordflow">print</span> <span class="stringliteral">&#39;[DEBUG]: Debugging pyp_newclasses/loadPedigree()...&#39;</span>
<a name="l03386"></a>03386         _pedigree = NewPedigree(kw=options,kwfile=optionsfile)
<a name="l03387"></a>03387         _pedigree.load(pedsource=pedsource,pedgraph=pedgraph,pedstream=pedstream)
<a name="l03388"></a>03388         <span class="keywordflow">return</span> _pedigree
<a name="l03389"></a>03389     <span class="keywordflow">else</span>:
<a name="l03390"></a>03390         <span class="keywordflow">try</span>:
<a name="l03391"></a>03391             _pedigree = NewPedigree(kw=options,kwfile=optionsfile)
<a name="l03392"></a>03392             _pedigree.load(pedsource=pedsource,pedgraph=pedgraph,pedstream=pedstream)
<a name="l03393"></a>03393             <span class="keywordflow">return</span> _pedigree
<a name="l03394"></a>03394         <span class="keywordflow">except</span>:
<a name="l03395"></a>03395             <span class="keywordflow">print</span> <span class="stringliteral">&#39;[ERROR]: pyp_newclasses.loadPedigree() was unable to instantiate and load the pedigree.&#39;</span>
<a name="l03396"></a>03396         <span class="keywordflow">return</span> 0
<a name="l03397"></a>03397 
<a name="l03398"></a>03398 <span class="comment">##</span>
<a name="l03399"></a>03399 <span class="comment"># PyPedalError is the base class for exceptions in PyPedal. The exceptions</span>
<a name="l03400"></a>03400 <span class="comment"># are based on the examples from &quot;An Introduction to Python&quot; by Guido van</span>
<a name="l03401"></a>03401 <span class="comment"># Rossum and Fred L. Drake,Jr.</span>
<a name="l03402"></a>03402 <span class="comment"># (http://www.network-theory.co.uk/docs/pytut/tut_64.html).</span>
<a name="l03403"></a>03403 <span class="comment"># @param None</span>
<a name="l03404"></a>03404 <span class="comment"># @retval None</span>
<a name="l03405"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PyPedalError.html">03405</a> <span class="keyword">class </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PyPedalError.html" title="PyPedalError is the base class for exceptions in PyPedal.">PyPedalError</a>(Exception):
<a name="l03406"></a>03406     <span class="stringliteral">&quot;&quot;&quot;PyPedalError is the base class for exceptions in PyPedal.&quot;&quot;&quot;</span>
<a name="l03407"></a>03407     <span class="keywordflow">pass</span>
<a name="l03408"></a>03408 
<a name="l03409"></a>03409 <span class="comment">##</span>
<a name="l03410"></a>03410 <span class="comment"># PyPedalPedigreeInputFileNameError is raised when a simulated pedigree</span>
<a name="l03411"></a>03411 <span class="comment"># is not requested and a pedigree file name is not provided.</span>
<a name="l03412"></a>03412 <span class="comment"># @param None</span>
<a name="l03413"></a>03413 <span class="comment"># @retval None</span>
<a name="l03414"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PyPedalPedigreeInputFileNameError.html">03414</a> <span class="keyword">class </span>PyPedalPedigreeInputFileNameError(PyPedalError):
<a name="l03415"></a>03415     <span class="stringliteral">&quot;&quot;&quot;PyPedalPedigreeInputFileNameError is raised when a simulated pedigree</span>
<a name="l03416"></a>03416 <span class="stringliteral">    is not requested and a pedigree file name is not provided.</span>
<a name="l03417"></a>03417 <span class="stringliteral">    &quot;&quot;&quot;</span>
<a name="l03418"></a>03418     <span class="comment">##</span>
<a name="l03419"></a>03419     <span class="comment"># __init__() returns a new instance of a PyPedalPedigreeInputFileNameError object</span>
<a name="l03420"></a>03420     <span class="comment"># @param self Reference to current object</span>
<a name="l03421"></a>03421     <span class="comment"># @retval A new PyPedalPedigreeInputFileNameError object</span>
<a name="l03422"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PyPedalPedigreeInputFileNameError.html#a7b690886b81fead4dd46c9d2c77cc45f">03422</a>     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PyPedalPedigreeInputFileNameError.html#a7b690886b81fead4dd46c9d2c77cc45f" title="__init__() returns a new instance of a PyPedalPedigreeInputFileNameError object">__init__</a>(self):
<a name="l03423"></a>03423         self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PyPedalPedigreeInputFileNameError.html#a11a7c0d3a1ee1e2d8f28dcb5cf33c2e8">message</a> = <span class="stringliteral">&#39;You did not request that a pedigree be simulated, and you did not provide the name of a pedigree file to be read.&#39;</span>
<a name="l03424"></a>03424     <span class="comment">##</span>
<a name="l03425"></a>03425     <span class="comment"># __str__() returns an instance of a PyPedalPedigreeInputFileNameError object represented as a string</span>
<a name="l03426"></a>03426     <span class="comment"># @param self Reference to current object</span>
<a name="l03427"></a>03427     <span class="comment"># @retval A string representation of a  PyPedalPedigreeInputFileNameError object</span>
<a name="l03428"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PyPedalPedigreeInputFileNameError.html#a36211de08dd7051cb0dafec75bfb5a2c">03428</a>     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PyPedalPedigreeInputFileNameError.html#a36211de08dd7051cb0dafec75bfb5a2c" title="__str__() returns an instance of a PyPedalPedigreeInputFileNameError object represented as a string...">__str__</a>(self):
<a name="l03429"></a>03429         <span class="keywordflow">return</span> repr(self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PyPedalPedigreeInputFileNameError.html#a11a7c0d3a1ee1e2d8f28dcb5cf33c2e8">message</a>)
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Fri Jul 6 2012 17:02:57 for PyPedal by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </small></address>
</body>
</html>
