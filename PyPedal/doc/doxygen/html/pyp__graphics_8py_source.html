<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>PyPedal: PyPedal/pyp_graphics.py Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">PyPedal&#160;<span id="projectnumber">2.0.0</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">PyPedal/pyp_graphics.py</div>  </div>
</div>
<div class="contents">
<div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">#!/usr/bin/python</span>
<a name="l00002"></a>00002 <span class="comment"># -*- coding: utf-8 -*-</span>
<a name="l00003"></a>00003 
<a name="l00004"></a>00004 <span class="comment">###############################################################################</span>
<a name="l00005"></a>00005 <span class="comment"># NAME: pyp_graphics.py</span>
<a name="l00006"></a>00006 <span class="comment"># VERSION: 2.0.0 (29SEPTEMBER2010)</span>
<a name="l00007"></a>00007 <span class="comment"># AUTHOR: John B. Cole, PhD (john.cole@ars.usda.gov)</span>
<a name="l00008"></a>00008 <span class="comment"># LICENSE: LGPL</span>
<a name="l00009"></a>00009 <span class="comment">###############################################################################</span>
<a name="l00010"></a>00010 <span class="comment"># FUNCTIONS:</span>
<a name="l00011"></a>00011 <span class="comment">#   rmuller_spy_matrix_pil() [1]</span>
<a name="l00012"></a>00012 <span class="comment">#   rmuller_pcolor_matrix_pil() [1]</span>
<a name="l00013"></a>00013 <span class="comment">#   rmuller_get_color() [1]</span>
<a name="l00014"></a>00014 <span class="comment">#   draw_pedigree()</span>
<a name="l00015"></a>00015 <span class="comment">#   plot_founders_by_year()</span>
<a name="l00016"></a>00016 <span class="comment">#   plot_founders_pct_by_year()</span>
<a name="l00017"></a>00017 <span class="comment">#   plot_line_xy()</span>
<a name="l00018"></a>00018 <span class="comment">#   pcolor_matrix_pylab()</span>
<a name="l00019"></a>00019 <span class="comment">#   spy_matrix_pylab()</span>
<a name="l00020"></a>00020 <span class="comment">#   new_draw_pedigree()</span>
<a name="l00021"></a>00021 <span class="comment">###############################################################################</span>
<a name="l00022"></a>00022 <span class="comment"># [1] These routines were taken from the ASPN Python Cookbook</span>
<a name="l00023"></a>00023 <span class="comment">#     (http://aspn.activestate.com/ASPN/Cookbook/Python/) and are used under</span>
<a name="l00024"></a>00024 <span class="comment">#     terms of the license, &quot;Python Cookbook code is freely available for use</span>
<a name="l00025"></a>00025 <span class="comment">#     and review&quot; as I understand it.  I did not write them; Rick Muller</span>
<a name="l00026"></a>00026 <span class="comment">#     properly deserves credit for that.  I THINK Rick&#39;s homepage&#39;s is:</span>
<a name="l00027"></a>00027 <span class="comment">#     http://www.cs.sandia.gov/~rmuller/.</span>
<a name="l00028"></a>00028 <span class="comment"># Python Cookbook notes:</span>
<a name="l00029"></a>00029 <span class="comment">#     Title: Matlab-like &#39;spy&#39; and &#39;pcolor&#39; functions</span>
<a name="l00030"></a>00030 <span class="comment">#     Submitter: Rick Muller (other recipes)</span>
<a name="l00031"></a>00031 <span class="comment">#     Last Updated: 2005/03/02</span>
<a name="l00032"></a>00032 <span class="comment">#     Version no: 1.0</span>
<a name="l00033"></a>00033 <span class="comment">#     Category: Image</span>
<a name="l00034"></a>00034 <span class="comment">#     Description:</span>
<a name="l00035"></a>00035 <span class="comment">#         I really like the &#39;spy&#39; and &#39;pcolor&#39; functions, which are useful in viewing</span>
<a name="l00036"></a>00036 <span class="comment">#         matrices. &#39;spy&#39; prints colored blocks for values that are above a threshold,</span>
<a name="l00037"></a>00037 <span class="comment">#         and &#39;pcolor&#39; prints out each element in a continuous range of colors.  The</span>
<a name="l00038"></a>00038 <span class="comment">#         attached is a little Python/PIL script that does these functions for Numpy</span>
<a name="l00039"></a>00039 <span class="comment">#         arrays.</span>
<a name="l00040"></a>00040 <span class="comment">#     URL: http://aspn.activestate.com/ASPN/Cookbook/Python/Recipe/390208</span>
<a name="l00041"></a>00041 <span class="comment">###############################################################################</span>
<a name="l00042"></a>00042 
<a name="l00043"></a>00043 <span class="comment">## @package pyp_graphics</span>
<a name="l00044"></a>00044 <span class="comment"># pyp_graphics contains routines for working with graphics in PyPedal, such as</span>
<a name="l00045"></a>00045 <span class="comment"># creating directed graphs from pedigrees using PyDot and visualizing relationship</span>
<a name="l00046"></a>00046 <span class="comment"># matrices using Rick Muller&#39;s spy and pcolor routines</span>
<a name="l00047"></a>00047 <span class="comment"># (http://aspn.activestate.com/ASPN/Cookbook/Python/).</span>
<a name="l00048"></a>00048 <span class="comment">#</span>
<a name="l00049"></a>00049 <span class="comment"># The Python Imaging Library (http://www.pythonware.com/products/pil/),</span>
<a name="l00050"></a>00050 <span class="comment"># matplotlib (http://matplotlib.sourceforge.net/), Graphviz (http://www.graphviz.org/),</span>
<a name="l00051"></a>00051 <span class="comment"># and pydot (http://dkbza.org/pydot.html) are required by one or more routines in this</span>
<a name="l00052"></a>00052 <span class="comment"># module.  They ARE NOT distributed with PyPedal and must be installed by the end-user!</span>
<a name="l00053"></a>00053 <span class="comment"># Note that the matplotlib functionality in PyPedal requires only the Agg backend, which</span>
<a name="l00054"></a>00054 <span class="comment"># means that you do not have to install GTK/PyGTK or WxWidgets/PyWxWidgets just to use</span>
<a name="l00055"></a>00055 <span class="comment"># PyPedal. Please consult the sites above for licensing and installation information.</span>
<a name="l00056"></a>00056 
<a name="l00057"></a>00057 <span class="keyword">import</span> logging
<a name="l00058"></a>00058 <span class="keyword">import</span> math, string
<a name="l00059"></a>00059 <span class="keyword">from</span> PyPedal <span class="keyword">import</span> pyp_demog
<a name="l00060"></a>00060 
<a name="l00061"></a>00061 <span class="keywordflow">try</span>:
<a name="l00062"></a>00062     <span class="keyword">import</span> psyco
<a name="l00063"></a>00063     psyco.full()
<a name="l00064"></a>00064 <span class="keywordflow">except</span> ImportError:
<a name="l00065"></a>00065     <span class="keywordflow">print</span> <span class="stringliteral">&#39;[INFO]: The psyco module could not be imported in pyp_graphics. Psyco speed optimizations are not available.&#39;</span>
<a name="l00066"></a>00066 
<a name="l00067"></a>00067 <span class="comment">##import matplotlib</span>
<a name="l00068"></a>00068 <span class="comment">##matplotlib.use(&#39;Agg&#39;)</span>
<a name="l00069"></a>00069 <span class="comment">##import pylab</span>
<a name="l00070"></a>00070 
<a name="l00071"></a>00071 <span class="comment">##</span>
<a name="l00072"></a>00072 <span class="comment"># rmuller_spy_matrix_pil() implements a matlab-like &#39;spy&#39; function to display the</span>
<a name="l00073"></a>00073 <span class="comment"># sparsity of a matrix using the Python Imaging Library.</span>
<a name="l00074"></a>00074 <span class="comment"># @param A Input Numpy matrix (such as a numerator relationship matrix).</span>
<a name="l00075"></a>00075 <span class="comment"># @param fname Output filename to which to dump the graphics (default &#39;tmp.png&#39;)</span>
<a name="l00076"></a>00076 <span class="comment"># @param cutoff Threshold value for printing an element (default 0.1)</span>
<a name="l00077"></a>00077 <span class="comment"># @param do_outline Whether or not to print an outline around the block (default 0)</span>
<a name="l00078"></a>00078 <span class="comment"># @param height The height of the image (default 300)</span>
<a name="l00079"></a>00079 <span class="comment"># @param width The width of the image (default 300)</span>
<a name="l00080"></a>00080 <span class="comment"># @retval None</span>
<a name="l00081"></a>00081 <span class="keyword">def </span>rmuller_spy_matrix_pil(A,fname=&#39;tmp.png&#39;,cutoff=0.1,do_outline=0, height=300, width=300):
<a name="l00082"></a>00082     <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00083"></a>00083 <span class="stringliteral">    rmuller_spy_matrix_pil() implements a matlab-like &#39;spy&#39; function to display the</span>
<a name="l00084"></a>00084 <span class="stringliteral">    sparsity of a matrix using the Python Imaging Library.</span>
<a name="l00085"></a>00085 <span class="stringliteral">    &quot;&quot;&quot;</span>
<a name="l00086"></a>00086     <span class="keywordflow">try</span>:
<a name="l00087"></a>00087         <span class="keyword">import</span> Image, ImageDraw
<a name="l00088"></a>00088     <span class="keywordflow">except</span>:
<a name="l00089"></a>00089         <span class="keywordflow">return</span> 0
<a name="l00090"></a>00090     img = Image.new(<span class="stringliteral">&quot;RGB&quot;</span>,(width,height),(255,255,255))
<a name="l00091"></a>00091     draw = ImageDraw.Draw(img)
<a name="l00092"></a>00092     n,m = A.shape
<a name="l00093"></a>00093     <span class="keywordflow">if</span> n &gt; width <span class="keywordflow">or</span> m &gt; height:
<a name="l00094"></a>00094         <span class="keywordflow">raise</span> <span class="stringliteral">&quot;Rectangle too big %d %d %d %d&quot;</span> % (n,m,width,height)
<a name="l00095"></a>00095     <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(n):
<a name="l00096"></a>00096         xmin = width*i/float(n)
<a name="l00097"></a>00097         xmax = width*(i+1)/float(n)
<a name="l00098"></a>00098         <span class="comment"># If the matrix is square, we can save a few cycles by only</span>
<a name="l00099"></a>00099         <span class="comment"># doing the calculations for the upper triangle and reflecting</span>
<a name="l00100"></a>00100         <span class="comment"># around the diagonal.</span>
<a name="l00101"></a>00101         <span class="keywordflow">if</span> n == m:
<a name="l00102"></a>00102             <span class="keywordflow">for</span> j <span class="keywordflow">in</span> range(i,n-1):
<a name="l00103"></a>00103 <span class="comment">#                 print &#39;i: %s, j: %s&#39; % ( i, j )</span>
<a name="l00104"></a>00104                 ymin = height*j/float(m)
<a name="l00105"></a>00105                 ymax = height*(j+1)/float(m)
<a name="l00106"></a>00106                 <span class="keywordflow">if</span> abs(A[i,j]) &gt; cutoff:
<a name="l00107"></a>00107                     <span class="keywordflow">if</span> do_outline:
<a name="l00108"></a>00108                         draw.rectangle((xmin,ymin,xmax,ymax),fill=(0,0,255),
<a name="l00109"></a>00109                             outline=(0,0,0))
<a name="l00110"></a>00110                         draw.rectangle((ymin,xmin,ymax,xmax),fill=(0,0,255),
<a name="l00111"></a>00111                             outline=(0,0,0))
<a name="l00112"></a>00112                     <span class="keywordflow">else</span>:
<a name="l00113"></a>00113                         draw.rectangle((xmin,ymin,xmax,ymax),fill=(0,0,255))
<a name="l00114"></a>00114                         draw.rectangle((ymin,xmin,ymax,xmax),fill=(0,0,255))
<a name="l00115"></a>00115         <span class="comment"># If the matrix is not square, we can&#39;t shave a bit</span>
<a name="l00116"></a>00116         <span class="keywordflow">else</span>:
<a name="l00117"></a>00117             <span class="keywordflow">for</span> j <span class="keywordflow">in</span> range(m):
<a name="l00118"></a>00118                 ymin = height*j/float(m)
<a name="l00119"></a>00119                 ymax = height*(j+1)/float(m)
<a name="l00120"></a>00120                 <span class="keywordflow">if</span> abs(A[i,j]) &gt; cutoff:
<a name="l00121"></a>00121                     <span class="keywordflow">if</span> do_outline:
<a name="l00122"></a>00122                         draw.rectangle((xmin,ymin,xmax,ymax),fill=(0,0,255),
<a name="l00123"></a>00123                             outline=(0,0,0))
<a name="l00124"></a>00124                     <span class="keywordflow">else</span>:
<a name="l00125"></a>00125                         draw.rectangle((xmin,ymin,xmax,ymax),fill=(0,0,255))
<a name="l00126"></a>00126     img.save(fname)
<a name="l00127"></a>00127     <span class="keywordflow">return</span>
<a name="l00128"></a>00128 
<a name="l00129"></a>00129 <span class="comment">##</span>
<a name="l00130"></a>00130 <span class="comment"># rmuller_pcolor_matrix_pil() implements a matlab-like &#39;pcolor&#39; function to</span>
<a name="l00131"></a>00131 <span class="comment"># display the large elements of a matrix in pseudocolor using the Python Imaging</span>
<a name="l00132"></a>00132 <span class="comment"># Library.</span>
<a name="l00133"></a>00133 <span class="comment"># @param A Input Numpy matrix (such as a numerator relationship matrix).</span>
<a name="l00134"></a>00134 <span class="comment"># @param fname Output filename to which to dump the graphics (default &#39;tmp.png&#39;)</span>
<a name="l00135"></a>00135 <span class="comment"># @param do_outline Whether or not to print an outline around the block (default 0)</span>
<a name="l00136"></a>00136 <span class="comment"># @param height The height of the image (default 300)</span>
<a name="l00137"></a>00137 <span class="comment"># @param width The width of the image (default 300)</span>
<a name="l00138"></a>00138 <span class="comment"># @retval A list of Animal() objects; a pedigree metadata object.</span>
<a name="l00139"></a>00139 <span class="keyword">def </span>rmuller_pcolor_matrix_pil(A, fname=&#39;tmp.png&#39;, do_outline=0, height=300, width=300):
<a name="l00140"></a>00140     <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00141"></a>00141 <span class="stringliteral">    rmuller_pcolor_matrix_pil() implements a matlab-like &#39;pcolor&#39; function to</span>
<a name="l00142"></a>00142 <span class="stringliteral">    display the large elements of a matrix in pseudocolor using the Python Imaging</span>
<a name="l00143"></a>00143 <span class="stringliteral">    Library.</span>
<a name="l00144"></a>00144 <span class="stringliteral">    &quot;&quot;&quot;</span>
<a name="l00145"></a>00145     <span class="keywordflow">try</span>:
<a name="l00146"></a>00146         <span class="keyword">import</span> Image, ImageDraw
<a name="l00147"></a>00147     <span class="keywordflow">except</span>:
<a name="l00148"></a>00148         <span class="keywordflow">return</span> 0
<a name="l00149"></a>00149     key_dict = {}
<a name="l00150"></a>00150     color_cache = {}
<a name="l00151"></a>00151 
<a name="l00152"></a>00152     img = Image.new(<span class="stringliteral">&quot;RGB&quot;</span>,(width,height),(255,255,255))
<a name="l00153"></a>00153     draw = ImageDraw.Draw(img)
<a name="l00154"></a>00154 
<a name="l00155"></a>00155     <span class="comment"># For Numeric</span>
<a name="l00156"></a>00156     <span class="comment">#mina = min(min(A))</span>
<a name="l00157"></a>00157     <span class="comment">#maxa = max(max(A))</span>
<a name="l00158"></a>00158 
<a name="l00159"></a>00159     <span class="comment"># For NumPy</span>
<a name="l00160"></a>00160     mina = A.min()
<a name="l00161"></a>00161     maxa = A.max()
<a name="l00162"></a>00162 
<a name="l00163"></a>00163     n,m = A.shape
<a name="l00164"></a>00164     <span class="keywordflow">if</span> n &gt; width <span class="keywordflow">or</span> m &gt; height:
<a name="l00165"></a>00165         <span class="keywordflow">raise</span> <span class="stringliteral">&quot;Rectangle too big %d %d %d %d&quot;</span> % (n,m,width,height)
<a name="l00166"></a>00166     <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(n):
<a name="l00167"></a>00167         xmin = width*i/float(n)
<a name="l00168"></a>00168         xmax = width*(i+1)/float(n)
<a name="l00169"></a>00169         <span class="keywordflow">for</span> j <span class="keywordflow">in</span> range(m):
<a name="l00170"></a>00170             ymin = height*j/float(m)
<a name="l00171"></a>00171             ymax = height*(j+1)/float(m)
<a name="l00172"></a>00172             <span class="comment"># JBC added a dictionary to cache colors to reduce the number of calls</span>
<a name="l00173"></a>00173             <span class="comment"># to rmuller_get_color().  This may lead to a dramatic improvement in the</span>
<a name="l00174"></a>00174             <span class="comment"># performance of rmuller_pcolor_matrix_pil(), which currently makes a call</span>
<a name="l00175"></a>00175             <span class="comment"># to rmuller_get_color() for each of the n**2 elements of A.  The cache will</span>
<a name="l00176"></a>00176             <span class="comment"># reduce that to the number of unique values in A, which should be much</span>
<a name="l00177"></a>00177             <span class="comment"># smaller.</span>
<a name="l00178"></a>00178             _cache_key = <span class="stringliteral">&#39;%s_%s_%s&#39;</span> % (A[i,j],mina,maxa)
<a name="l00179"></a>00179             <span class="keywordflow">try</span>:
<a name="l00180"></a>00180                 color = color_cache[_cache_key]
<a name="l00181"></a>00181             <span class="keywordflow">except</span> KeyError:
<a name="l00182"></a>00182                 color = rmuller_get_color(A[i,j],mina,maxa)
<a name="l00183"></a>00183                 color_cache[_cache_key] = color
<a name="l00184"></a>00184             <span class="comment"># JBC added this to generate a color key.</span>
<a name="l00185"></a>00185             <span class="keywordflow">try</span>:
<a name="l00186"></a>00186                 _v = key_dict[color]
<a name="l00187"></a>00187             <span class="keywordflow">except</span> KeyError:
<a name="l00188"></a>00188                 <span class="comment">#_key = round( (A[i,j] * 1000), 0 )</span>
<a name="l00189"></a>00189                 key_dict[A[i,j]] = color
<a name="l00190"></a>00190             <span class="keywordflow">if</span> do_outline:
<a name="l00191"></a>00191                 draw.rectangle((xmin,ymin,xmax,ymax),fill=color,outline=(0,0,0))
<a name="l00192"></a>00192             <span class="keywordflow">else</span>:
<a name="l00193"></a>00193                 draw.rectangle((xmin,ymin,xmax,ymax),fill=color)
<a name="l00194"></a>00194 
<a name="l00195"></a>00195     <span class="comment">#print key_dict</span>
<a name="l00196"></a>00196     img.save(fname)
<a name="l00197"></a>00197     <span class="keywordflow">return</span>
<a name="l00198"></a>00198 
<a name="l00199"></a>00199 <span class="comment">##</span>
<a name="l00200"></a>00200 <span class="comment"># rmuller_get_color() Converts a float value to one of a continuous range of colors</span>
<a name="l00201"></a>00201 <span class="comment"># using recipe 9.10 from the Python Cookbook.</span>
<a name="l00202"></a>00202 <span class="comment"># @param a Float value to convert to a color.</span>
<a name="l00203"></a>00203 <span class="comment"># @param cmin Minimum value in array.</span>
<a name="l00204"></a>00204 <span class="comment"># @param cmax Maximum value in array.</span>
<a name="l00205"></a>00205 <span class="comment"># @retval An integer containins an RGB triplet.</span>
<a name="l00206"></a>00206 <span class="keyword">def </span>rmuller_get_color(a, cmin, cmax):
<a name="l00207"></a>00207     <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00208"></a>00208 <span class="stringliteral">    Convert a float value to one of a continuous range of colors.</span>
<a name="l00209"></a>00209 <span class="stringliteral">    Rewritten to use recipe 9.10 from the O&#39;Reilly Python Cookbook.</span>
<a name="l00210"></a>00210 <span class="stringliteral">    &quot;&quot;&quot;</span>
<a name="l00211"></a>00211     <span class="keywordflow">try</span>:
<a name="l00212"></a>00212         a = float(a-cmin)/(cmax-cmin)
<a name="l00213"></a>00213     <span class="keywordflow">except</span> ZeroDivisionError:
<a name="l00214"></a>00214         a = 0.5 <span class="comment"># cmax == cmin</span>
<a name="l00215"></a>00215     blue = min((max((4*(0.75-a),0.)),1.))
<a name="l00216"></a>00216     red = min((max((4*(a-0.25),0.)),1.))
<a name="l00217"></a>00217     green = min((max((4*math.fabs(a-0.5)-1.,0)),1.))
<a name="l00218"></a>00218     <span class="keywordflow">return</span> <span class="stringliteral">&#39;#%1x%1x%1x&#39;</span> % (int(15*red),int(15*green),int(15*blue))
<a name="l00219"></a>00219 
<a name="l00220"></a>00220 <span class="comment">##</span>
<a name="l00221"></a>00221 <span class="comment"># draw_pedigree() uses the pydot bindings to the graphviz library -- if they</span>
<a name="l00222"></a>00222 <span class="comment"># are available on your system -- to produce a directed graph of your pedigree</span>
<a name="l00223"></a>00223 <span class="comment"># with paths of inheritance as edges and animals as nodes.  If there is more than</span>
<a name="l00224"></a>00224 <span class="comment"># one generation in the pedigree as determind by the &quot;gen&quot; attributes of the animals</span>
<a name="l00225"></a>00225 <span class="comment"># in the pedigree, draw_pedigree() will use subgraphs to try and group animals in the</span>
<a name="l00226"></a>00226 <span class="comment"># same generation together in the drawing.</span>
<a name="l00227"></a>00227 <span class="comment"># @param pedobj A PyPedal pedigree object.</span>
<a name="l00228"></a>00228 <span class="comment"># @param gfilename The name of the file to which the pedigree should be drawn</span>
<a name="l00229"></a>00229 <span class="comment"># @param gtitle The title of the graph.</span>
<a name="l00230"></a>00230 <span class="comment"># @param gformat The format in which the output file should be written  (JPG|PNG|PS).</span>
<a name="l00231"></a>00231 <span class="comment"># @param gsize The size of the graph: &#39;f&#39;: full-size, &#39;l&#39;: letter-sized page.</span>
<a name="l00232"></a>00232 <span class="comment"># @param gdot Whether or not to write the dot code for the pedigree graph to a file (can produce large files).</span>
<a name="l00233"></a>00233 <span class="comment"># @param gorient The orientation of the graph: &#39;p&#39;: portrait, &#39;l&#39;: landscape.</span>
<a name="l00234"></a>00234 <span class="comment"># @param gdirec Direction of flow from parents to offspring: &#39;TB&#39;: top-bottom, &#39;LR&#39;: left-right, &#39;RL&#39;: right-left.</span>
<a name="l00235"></a>00235 <span class="comment"># @param gname Flag indicating whether ID numbers (0) or names (1) should be used to label nodes.</span>
<a name="l00236"></a>00236 <span class="comment"># @param gfontsize Integer indicating the typeface size to be used in labelling nodes.</span>
<a name="l00237"></a>00237 <span class="comment"># @param garrow Flag indicating whether or not arrowheads should be drawn.</span>
<a name="l00238"></a>00238 <span class="comment"># @param gtitloc Indicates if the title be drawn or above (&#39;t&#39;) or below (&#39;b&#39;) the graph.</span>
<a name="l00239"></a>00239 <span class="comment"># @param gtitjust Indicates if the title should be center- (&#39;c&#39;), left- (&#39;l&#39;), or right-justified (&#39;r&#39;).</span>
<a name="l00240"></a>00240 <span class="comment"># @param gshowall Draws animals with no links to other ancestors in the pedigree (1) or suppresses them (0).</span>
<a name="l00241"></a>00241 <span class="comment"># @param gclusters Indicates if subgraph clusters should be used when drawing the pedigree, which may improve layout in some pedigrees.</span>
<a name="l00242"></a>00242 <span class="comment"># @retval A 1 for success and a 0 for failure.</span>
<a name="l00243"></a>00243 <span class="keyword">def </span>draw_pedigree(pedobj, gfilename=&#39;pedigree&#39;, gtitle=&#39;&#39;, gformat=&#39;jpg&#39;, gsize=&#39;f&#39;, gdot=&#39;1&#39;, gorient=&#39;p&#39;, gdirec=&#39;&#39;, gname=0, gfontsize=10, garrow=1, gtitloc=&#39;b&#39;, gtitjust=&#39;c&#39;, gshowall=1, gclusters=0):
<a name="l00244"></a>00244     <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00245"></a>00245 <span class="stringliteral">    draw_pedigree() uses the pydot bindings to the graphviz library -- if they</span>
<a name="l00246"></a>00246 <span class="stringliteral">    are available on your system -- to produce a directed graph of your pedigree</span>
<a name="l00247"></a>00247 <span class="stringliteral">    with paths of inheritance as edges and animals as nodes.  If there is more than</span>
<a name="l00248"></a>00248 <span class="stringliteral">    one generation in the pedigree as determind by the &quot;gen&quot; attributes of the animals</span>
<a name="l00249"></a>00249 <span class="stringliteral">    in the pedigree, draw_pedigree() will use subgraphs to try and group animals in the</span>
<a name="l00250"></a>00250 <span class="stringliteral">    same generation together in the drawing.</span>
<a name="l00251"></a>00251 <span class="stringliteral">    &quot;&quot;&quot;</span>
<a name="l00252"></a>00252     <span class="keywordflow">if</span> gtitle == <span class="stringliteral">&#39;&#39;</span>:
<a name="l00253"></a>00253         gtitle = pedobj.kw[<span class="stringliteral">&#39;pedname&#39;</span>]
<a name="l00254"></a>00254     <span class="keyword">from</span> pyp_utils <span class="keyword">import</span> string_to_table_name
<a name="l00255"></a>00255     _gtitle = string_to_table_name(gtitle)
<a name="l00256"></a>00256 <span class="comment">#     if pedobj.kw[&#39;messages&#39;] == &#39;verbose&#39;:</span>
<a name="l00257"></a>00257 <span class="comment">#         print &#39;gtitle: %s&#39; % ( gtitle )</span>
<a name="l00258"></a>00258 <span class="comment">#         print &#39;_gtitle: %s&#39; % ( _gtitle )</span>
<a name="l00259"></a>00259 
<a name="l00260"></a>00260     <span class="keywordflow">if</span> gtitloc <span class="keywordflow">not</span> <span class="keywordflow">in</span> [<span class="stringliteral">&#39;t&#39;</span>,<span class="stringliteral">&#39;b&#39;</span>]:
<a name="l00261"></a>00261         gtitloc = <span class="stringliteral">&#39;b&#39;</span>
<a name="l00262"></a>00262     <span class="keywordflow">if</span> gtitjust <span class="keywordflow">not</span> <span class="keywordflow">in</span> [<span class="stringliteral">&#39;c&#39;</span>,<span class="stringliteral">&#39;l&#39;</span>,<span class="stringliteral">&#39;</span><span class="stringliteral">r&#39;]:</span>
<a name="l00263"></a>00263 <span class="stringliteral">        gtitjust = </span><span class="stringliteral">&#39;c&#39;</span>
<a name="l00264"></a>00264 
<a name="l00265"></a>00265     <span class="comment">#print pedobj.metadata.unique_gen_list</span>
<a name="l00266"></a>00266 
<a name="l00267"></a>00267     <span class="keywordflow">if</span> <span class="keywordflow">not</span> pedobj.kw[<span class="stringliteral">&#39;pedigree_is_renumbered&#39;</span>]:
<a name="l00268"></a>00268         <span class="keywordflow">if</span> pedobj.kw[<span class="stringliteral">&#39;messages&#39;</span>] != <span class="stringliteral">&#39;quiet&#39;</span>:
<a name="l00269"></a>00269             <span class="keywordflow">print</span> <span class="stringliteral">&#39;[GRAPH]: The pedigree that you passed to pyp_graphics/draw_pedigree() is not renumbered. Because of this, there may be errors in the rendered pedigree. In order to insure that the pedigree drawing is accurate, you should renumber the pedigree before calling draw_pedigree().&#39;</span>
<a name="l00270"></a>00270         logging.error(<span class="stringliteral">&#39;The pedigree that you passed to pyp_graphics/draw_pedigree() is not renumbered. Because of this, there may be errors in the rendered pedigree. In order to insure that the pedigree drawing is accurate, you should renumber the pedigree before calling draw_pedigree().&#39;</span>)
<a name="l00271"></a>00271 
<a name="l00272"></a>00272     <span class="comment">#try:</span>
<a name="l00273"></a>00273     <span class="keyword">import</span> pydot
<a name="l00274"></a>00274     <span class="comment"># Set some properties for the graph.  The label attribute is based on the gtitle.</span>
<a name="l00275"></a>00275     <span class="comment"># In cases where an empty string, e.g. &#39;&#39;, is provided as the gtitle dot engine</span>
<a name="l00276"></a>00276     <span class="comment"># processing breaks.  In such cases, don&#39;t add a label.</span>
<a name="l00277"></a>00277     <span class="keywordflow">if</span> gtitle == <span class="stringliteral">&#39;&#39;</span>:
<a name="l00278"></a>00278         <span class="keywordflow">if</span> gshowall:
<a name="l00279"></a>00279             g = pydot.Dot(graph_name=str(_gtitle), graph_type=<span class="stringliteral">&#39;digraph&#39;</span>, strict=<span class="keyword">False</span>, suppress_disconnected=<span class="keyword">False</span>, simplify=<span class="keyword">True</span>)
<a name="l00280"></a>00280         <span class="keywordflow">else</span>:
<a name="l00281"></a>00281             g = pydot.Dot(graph_name=str(_gtitle), graph_type=<span class="stringliteral">&#39;digraph&#39;</span>, strict=<span class="keyword">False</span>, suppress_disconnected=<span class="keyword">True</span>, simplify=<span class="keyword">True</span>)
<a name="l00282"></a>00282     <span class="keywordflow">else</span>:
<a name="l00283"></a>00283         <span class="keywordflow">if</span> gshowall:
<a name="l00284"></a>00284             g = pydot.Dot(label=str(_gtitle), labelloc=str(gtitloc), labeljust=str(gtitjust), graph_name=str(_gtitle), graph_type=<span class="stringliteral">&#39;digraph&#39;</span>, strict=<span class="keyword">False</span>, suppress_disconnected=<span class="keyword">False</span>, simplify=<span class="keyword">True</span>)
<a name="l00285"></a>00285         <span class="keywordflow">else</span>:
<a name="l00286"></a>00286             g = pydot.Dot(label=str(_gtitle), labelloc=str(gtitloc), labeljust=str(gtitjust), graph_name=str(_gtitle), graph_type=<span class="stringliteral">&#39;digraph&#39;</span>, strict=<span class="keyword">False</span>, suppress_disconnected=<span class="keyword">True</span>, simplify=<span class="keyword">True</span>)
<a name="l00287"></a>00287     <span class="comment"># Make sure that gfontsize has a valid value.</span>
<a name="l00288"></a>00288     <span class="keywordflow">try</span>:
<a name="l00289"></a>00289         gfontsize = int(gfontsize)
<a name="l00290"></a>00290     <span class="keywordflow">except</span>:
<a name="l00291"></a>00291         gfontsize = 10
<a name="l00292"></a>00292     <span class="keywordflow">if</span> gfontsize &lt; 10:
<a name="l00293"></a>00293         gfontsize = 10
<a name="l00294"></a>00294     gfontsize = str(gfontsize)
<a name="l00295"></a>00295 <span class="comment">#     print &#39;gfontsize = %s&#39; % (gfontsize)</span>
<a name="l00296"></a>00296     g.set_page(<span class="stringliteral">&quot;8.5,11&quot;</span>)
<a name="l00297"></a>00297     g.set_size(<span class="stringliteral">&quot;7.5,10&quot;</span>)
<a name="l00298"></a>00298     <span class="keywordflow">if</span> gorient == <span class="stringliteral">&#39;l&#39;</span>:
<a name="l00299"></a>00299         g.set_orientation(<span class="stringliteral">&quot;landscape&quot;</span>)
<a name="l00300"></a>00300     <span class="keywordflow">else</span>:
<a name="l00301"></a>00301         g.set_orientation(<span class="stringliteral">&quot;portrait&quot;</span>)
<a name="l00302"></a>00302     <span class="keywordflow">if</span> gsize != <span class="stringliteral">&#39;l&#39;</span>:
<a name="l00303"></a>00303         g.set_ratio(<span class="stringliteral">&quot;auto&quot;</span>)
<a name="l00304"></a>00304     <span class="keywordflow">if</span> gdirec == <span class="stringliteral">&#39;RL&#39;</span>:
<a name="l00305"></a>00305         g.set_rankdir(<span class="stringliteral">&#39;RL&#39;</span>)
<a name="l00306"></a>00306     <span class="keywordflow">elif</span> gdirec == <span class="stringliteral">&#39;LR&#39;</span>:
<a name="l00307"></a>00307         g.set_rankdir(<span class="stringliteral">&#39;LR&#39;</span>)
<a name="l00308"></a>00308     <span class="keywordflow">else</span>:
<a name="l00309"></a>00309         <span class="keywordflow">pass</span>
<a name="l00310"></a>00310     g.set_center(<span class="stringliteral">&#39;true&#39;</span>)
<a name="l00311"></a>00311     g.set_concentrate(<span class="stringliteral">&#39;true&#39;</span>)
<a name="l00312"></a>00312     g.set_ordering(<span class="stringliteral">&#39;out&#39;</span>)
<a name="l00313"></a>00313     <span class="keywordflow">if</span> gformat <span class="keywordflow">not</span> <span class="keywordflow">in</span> g.formats:
<a name="l00314"></a>00314         gformat = <span class="stringliteral">&#39;jpg&#39;</span>
<a name="l00315"></a>00315     <span class="comment"># If we do not have any generations, we have to draw a less-nice graph.</span>
<a name="l00316"></a>00316     <span class="keywordflow">if</span> len(pedobj.metadata.unique_gen_list) &lt;= 1:
<a name="l00317"></a>00317         <span class="keywordflow">for</span> _m <span class="keywordflow">in</span> pedobj.pedigree:
<a name="l00318"></a>00318             <span class="comment"># Add a node for the current animal and set some properties.</span>
<a name="l00319"></a>00319             <span class="keywordflow">if</span> gname:
<a name="l00320"></a>00320                 _node_name = _m.name
<a name="l00321"></a>00321             <span class="keywordflow">else</span>:
<a name="l00322"></a>00322                 _node_name = _m.animalID
<a name="l00323"></a>00323             _an_node = pydot.Node(str(_node_name))
<a name="l00324"></a>00324             _an_node.set_fontname(<span class="stringliteral">&#39;Helvetica&#39;</span>)
<a name="l00325"></a>00325             <span class="comment"># _an_node.set_fontsize(&#39;10&#39;)</span>
<a name="l00326"></a>00326             _an_node.set_fontsize(str(gfontsize))
<a name="l00327"></a>00327             _an_node.set_height(<span class="stringliteral">&#39;0.35&#39;</span>)
<a name="l00328"></a>00328             <span class="keywordflow">if</span> _m.sex == <span class="stringliteral">&#39;M&#39;</span> <span class="keywordflow">or</span> _m.sex == <span class="stringliteral">&#39;m&#39;</span>:
<a name="l00329"></a>00329                 _an_node.set_shape(<span class="stringliteral">&#39;box&#39;</span>)
<a name="l00330"></a>00330             <span class="keywordflow">elif</span> _m.sex == <span class="stringliteral">&#39;F&#39;</span> <span class="keywordflow">or</span> _m.sex == <span class="stringliteral">&#39;f&#39;</span>:
<a name="l00331"></a>00331                 _an_node.set_shape(<span class="stringliteral">&#39;ellipse&#39;</span>)
<a name="l00332"></a>00332             <span class="keywordflow">else</span>:
<a name="l00333"></a>00333                 <span class="keywordflow">pass</span>
<a name="l00334"></a>00334             g.add_node(_an_node)
<a name="l00335"></a>00335             <span class="comment"># Add the edges to the parent nodes, if any.</span>
<a name="l00336"></a>00336             <span class="keywordflow">if</span> int(_m.sireID) != pedobj.kw[<span class="stringliteral">&#39;missing_parent&#39;</span>]:
<a name="l00337"></a>00337                 <span class="keywordflow">if</span> gname:
<a name="l00338"></a>00338                     <span class="keywordflow">if</span> garrow:
<a name="l00339"></a>00339                         g.add_edge(pydot.Edge(str(pedobj.pedigree[int(_m.sireID)-1].name), str(_m.name)))
<a name="l00340"></a>00340                     <span class="keywordflow">else</span>:
<a name="l00341"></a>00341                         g.add_edge(pydot.Edge(str(pedobj.pedigree[int(_m.sireID)-1].name), str(_m.name), dir=<span class="stringliteral">&#39;none&#39;</span>))
<a name="l00342"></a>00342                 <span class="keywordflow">else</span>:
<a name="l00343"></a>00343                     <span class="keywordflow">if</span> garrow:
<a name="l00344"></a>00344                         g.add_edge(pydot.Edge(str(pedobj.pedigree[int(_m.sireID)-1].originalID), str(_m.originalID)))
<a name="l00345"></a>00345                     <span class="keywordflow">else</span>:
<a name="l00346"></a>00346                         g.add_edge(pydot.Edge(str(pedobj.pedigree[int(_m.sireID)-1].originalID), str(_m.originalID), dir=<span class="stringliteral">&#39;none&#39;</span>))
<a name="l00347"></a>00347             <span class="keywordflow">if</span> int(_m.damID) != pedobj.kw[<span class="stringliteral">&#39;missing_parent&#39;</span>]:
<a name="l00348"></a>00348                 <span class="keywordflow">if</span> gname:
<a name="l00349"></a>00349                     <span class="keywordflow">if</span> garrow:
<a name="l00350"></a>00350                         g.add_edge(pydot.Edge(str(pedobj.pedigree[int(_m.damID)-1].name), str(_m.name)))
<a name="l00351"></a>00351                     <span class="keywordflow">else</span>:
<a name="l00352"></a>00352                         g.add_edge(pydot.Edge(str(pedobj.pedigree[int(_m.damID)-1].name), str(_m.name), dir=<span class="stringliteral">&#39;none&#39;</span>))
<a name="l00353"></a>00353                 <span class="keywordflow">else</span>:
<a name="l00354"></a>00354                     <span class="keywordflow">if</span> garrow:
<a name="l00355"></a>00355                         g.add_edge(pydot.Edge(str(pedobj.pedigree[int(_m.damID)-1].originalID), str(_m.originalID)))
<a name="l00356"></a>00356                     <span class="keywordflow">else</span>:
<a name="l00357"></a>00357                         g.add_edge(pydot.Edge(str(pedobj.pedigree[int(_m.damID)-1].originalID), str(_m.originalID), dir=<span class="stringliteral">&#39;none&#39;</span>))
<a name="l00358"></a>00358     <span class="comment"># Or test the new subgraph clusters</span>
<a name="l00359"></a>00359     <span class="keywordflow">elif</span> gclusters:
<a name="l00360"></a>00360         <span class="keywordflow">for</span> _g <span class="keywordflow">in</span> pedobj.metadata.unique_gen_list:
<a name="l00361"></a>00361             _sg_anims = []
<a name="l00362"></a>00362             _sg_name = <span class="stringliteral">&#39;sg%s&#39;</span> % (_g)
<a name="l00363"></a>00363             <span class="keywordflow">if</span> gshowall:
<a name="l00364"></a>00364                 sg = pydot.Cluster(graph_name=str(_sg_name), suppress_disconnected=<span class="keyword">False</span>, simplify=<span class="keyword">True</span>)
<a name="l00365"></a>00365             <span class="keywordflow">else</span>:
<a name="l00366"></a>00366                 sg = pydot.Cluster(graph_name=str(_sg_name), suppress_disconnected=<span class="keyword">True</span>, simplify=<span class="keyword">True</span>)
<a name="l00367"></a>00367             <span class="keywordflow">for</span> _m <span class="keywordflow">in</span> pedobj.pedigree:
<a name="l00368"></a>00368                 <span class="keywordflow">if</span> int(_m.gen) == int(_g):
<a name="l00369"></a>00369                     _sg_anims.append(_m.animalID)
<a name="l00370"></a>00370                     <span class="comment"># Add a node for the current animal and set some properties.</span>
<a name="l00371"></a>00371                     <span class="keywordflow">if</span> gname:
<a name="l00372"></a>00372                         _node_name = _m.name
<a name="l00373"></a>00373                     <span class="keywordflow">else</span>:
<a name="l00374"></a>00374                         _node_name = str(_m.animalID)
<a name="l00375"></a>00375                     _an_node = pydot.Node(str(_node_name))
<a name="l00376"></a>00376                     _an_node.set_fontname(<span class="stringliteral">&#39;Helvetica&#39;</span>)
<a name="l00377"></a>00377                     _an_node.set_fontsize(gfontsize)
<a name="l00378"></a>00378                     _an_node.set_height(<span class="stringliteral">&#39;0.35&#39;</span>)
<a name="l00379"></a>00379                     <span class="keywordflow">if</span> _m.sex == <span class="stringliteral">&#39;M&#39;</span> <span class="keywordflow">or</span> _m.sex == <span class="stringliteral">&#39;m&#39;</span>:
<a name="l00380"></a>00380                         _an_node.set_shape(<span class="stringliteral">&#39;box&#39;</span>)
<a name="l00381"></a>00381                     <span class="keywordflow">if</span> _m.sex == <span class="stringliteral">&#39;F&#39;</span> <span class="keywordflow">or</span> _m.sex == <span class="stringliteral">&#39;f&#39;</span>:
<a name="l00382"></a>00382                         _an_node.set_shape(<span class="stringliteral">&#39;ellipse&#39;</span>)
<a name="l00383"></a>00383                     sg.add_node(_an_node)
<a name="l00384"></a>00384             g.add_subgraph(sg)
<a name="l00385"></a>00385         <span class="comment"># Now that we&#39;ve added the clusters to the graph, define the</span>
<a name="l00386"></a>00386         <span class="comment"># edges.</span>
<a name="l00387"></a>00387         <span class="keywordflow">for</span> _m <span class="keywordflow">in</span> pedobj.pedigree:
<a name="l00388"></a>00388             <span class="keywordflow">if</span> _m.sireID != pedobj.kw[<span class="stringliteral">&#39;missing_parent&#39;</span>]:
<a name="l00389"></a>00389                 <span class="keywordflow">if</span> gname:
<a name="l00390"></a>00390                     <span class="keywordflow">if</span> garrow:
<a name="l00391"></a>00391                         g.add_edge(pydot.Edge(str(pedobj.pedigree[int(_m.sireID)-1].name), str(_m.name)))
<a name="l00392"></a>00392                     <span class="keywordflow">else</span>:
<a name="l00393"></a>00393                         g.add_edge(pydot.Edge(str(pedobj.pedigree[int(_m.sireID)-1].name), str(_m.name), dir=<span class="stringliteral">&#39;none&#39;</span>))
<a name="l00394"></a>00394                 <span class="keywordflow">else</span>:
<a name="l00395"></a>00395                     <span class="keywordflow">if</span> garrow:
<a name="l00396"></a>00396                         g.add_edge(pydot.Edge(str(pedobj.pedigree[int(_m.sireID)-1].animalID), str(_m.animalID)))
<a name="l00397"></a>00397                     <span class="keywordflow">else</span>:
<a name="l00398"></a>00398                         g.add_edge(pydot.Edge(str(pedobj.pedigree[int(_m.sireID)-1].animalID), str(_m.animalID), dir=<span class="stringliteral">&#39;none&#39;</span>))
<a name="l00399"></a>00399             <span class="keywordflow">if</span> _m.damID != pedobj.kw[<span class="stringliteral">&#39;missing_parent&#39;</span>]:
<a name="l00400"></a>00400                 <span class="keywordflow">if</span> gname:
<a name="l00401"></a>00401                     <span class="keywordflow">if</span> garrow:
<a name="l00402"></a>00402                         g.add_edge(pydot.Edge(str(pedobj.pedigree[int(_m.damID)-1].name), str(_m.name)))
<a name="l00403"></a>00403                     <span class="keywordflow">else</span>:
<a name="l00404"></a>00404                         g.add_edge(pydot.Edge(str(pedobj.pedigree[int(_m.damID)-1].name), str(_m.name), dir=<span class="stringliteral">&#39;none&#39;</span>))
<a name="l00405"></a>00405                 <span class="keywordflow">else</span>:
<a name="l00406"></a>00406                     <span class="keywordflow">if</span> garrow:
<a name="l00407"></a>00407                         g.add_edge(pydot.Edge(str(pedobj.pedigree[int(_m.damID)-1].animalID), str(_m.animalID)))
<a name="l00408"></a>00408                     <span class="keywordflow">else</span>:
<a name="l00409"></a>00409                         g.add_edge(pydot.Edge(str(pedobj.pedigree[int(_m.damID)-1].animalID), str(_m.animalID), dir=<span class="stringliteral">&#39;none&#39;</span>))
<a name="l00410"></a>00410     <span class="comment"># Otherwise we can draw a nice graph.</span>
<a name="l00411"></a>00411     <span class="keywordflow">else</span>:
<a name="l00412"></a>00412         <span class="keywordflow">for</span> _g <span class="keywordflow">in</span> pedobj.metadata.unique_gen_list:
<a name="l00413"></a>00413             _sg_anims = []
<a name="l00414"></a>00414             _sg_name = <span class="stringliteral">&#39;sg%s&#39;</span> % (_g)
<a name="l00415"></a>00415             <span class="keywordflow">if</span> gshowall:
<a name="l00416"></a>00416                 sg = pydot.Subgraph(graph_name=str(_sg_name), suppress_disconnected=<span class="keyword">False</span>, simplify=<span class="keyword">True</span>, rank=<span class="stringliteral">&#39;same&#39;</span>)
<a name="l00417"></a>00417             <span class="keywordflow">else</span>:
<a name="l00418"></a>00418                 sg = pydot.Subgraph(graph_name=str(_sg_name), suppress_disconnected=<span class="keyword">True</span>, simplify=<span class="keyword">True</span>, rank=<span class="stringliteral">&#39;same&#39;</span>)
<a name="l00419"></a>00419             <span class="keywordflow">for</span> _m <span class="keywordflow">in</span> pedobj.pedigree:
<a name="l00420"></a>00420                 <span class="keywordflow">if</span> int(_m.gen) == int(_g):
<a name="l00421"></a>00421                     _sg_anims.append(_m.animalID)
<a name="l00422"></a>00422                     <span class="comment">## -&gt;</span>
<a name="l00423"></a>00423                     <span class="comment"># Add a node for the current animal and set some properties.</span>
<a name="l00424"></a>00424                     <span class="keywordflow">if</span> gname:
<a name="l00425"></a>00425                         _node_name = _m.name
<a name="l00426"></a>00426                     <span class="keywordflow">else</span>:
<a name="l00427"></a>00427                         _node_name = str(_m.animalID)
<a name="l00428"></a>00428                     _an_node = pydot.Node(str(_node_name))
<a name="l00429"></a>00429                     _an_node.set_fontname(<span class="stringliteral">&#39;Helvetica&#39;</span>)
<a name="l00430"></a>00430                     _an_node.set_fontsize(str(gfontsize))
<a name="l00431"></a>00431                     _an_node.set_height(<span class="stringliteral">&#39;0.35&#39;</span>)
<a name="l00432"></a>00432                     <span class="keywordflow">if</span> _m.sex == <span class="stringliteral">&#39;M&#39;</span> <span class="keywordflow">or</span> _m.sex == <span class="stringliteral">&#39;m&#39;</span>:
<a name="l00433"></a>00433                         _an_node.set_shape(<span class="stringliteral">&#39;box&#39;</span>)
<a name="l00434"></a>00434                     <span class="keywordflow">if</span> _m.sex == <span class="stringliteral">&#39;F&#39;</span> <span class="keywordflow">or</span> _m.sex == <span class="stringliteral">&#39;f&#39;</span>:
<a name="l00435"></a>00435                         _an_node.set_shape(<span class="stringliteral">&#39;ellipse&#39;</span>)
<a name="l00436"></a>00436                     sg.add_node(_an_node)
<a name="l00437"></a>00437                     <span class="comment">## &lt;-</span>
<a name="l00438"></a>00438                     <span class="comment"># Add the edges to the parent nodes, if any.</span>
<a name="l00439"></a>00439                     <span class="keywordflow">if</span> _m.sireID != pedobj.kw[<span class="stringliteral">&#39;missing_parent&#39;</span>]:
<a name="l00440"></a>00440                         <span class="keywordflow">if</span> gname:
<a name="l00441"></a>00441                             <span class="keywordflow">if</span> garrow:
<a name="l00442"></a>00442                                 sg.add_edge(pydot.Edge(str(pedobj.pedigree[int(_m.sireID)-1].name), str(_m.name)))
<a name="l00443"></a>00443                             <span class="keywordflow">else</span>:
<a name="l00444"></a>00444                                 sg.add_edge(pydot.Edge(str(pedobj.pedigree[int(_m.sireID)-1].name), str(_m.name), dir=<span class="stringliteral">&#39;none&#39;</span>))
<a name="l00445"></a>00445                         <span class="keywordflow">else</span>:
<a name="l00446"></a>00446                             <span class="keywordflow">if</span> garrow:
<a name="l00447"></a>00447                                 sg.add_edge(pydot.Edge(str(pedobj.pedigree[int(_m.sireID)-1].animalID), str(_m.animalID)))
<a name="l00448"></a>00448                             <span class="keywordflow">else</span>:
<a name="l00449"></a>00449                                 sg.add_edge(pydot.Edge(str(pedobj.pedigree[int(_m.sireID)-1].animalID), str(_m.animalID), dir=<span class="stringliteral">&#39;none&#39;</span>))
<a name="l00450"></a>00450                     <span class="keywordflow">if</span> _m.damID != pedobj.kw[<span class="stringliteral">&#39;missing_parent&#39;</span>]:
<a name="l00451"></a>00451                         <span class="keywordflow">if</span> gname:
<a name="l00452"></a>00452                             <span class="keywordflow">if</span> garrow:
<a name="l00453"></a>00453                                 sg.add_edge(pydot.Edge(str(pedobj.pedigree[int(_m.damID)-1].name), str(_m.name)))
<a name="l00454"></a>00454                             <span class="keywordflow">else</span>:
<a name="l00455"></a>00455                                 sg.add_edge(pydot.Edge(str(pedobj.pedigree[int(_m.damID)-1].name), str(_m.name), dir=<span class="stringliteral">&#39;none&#39;</span>))
<a name="l00456"></a>00456                         <span class="keywordflow">else</span>:
<a name="l00457"></a>00457                             <span class="keywordflow">if</span> garrow:
<a name="l00458"></a>00458                                 sg.add_edge(pydot.Edge(str(pedobj.pedigree[int(_m.damID)-1].animalID), str(_m.animalID)))
<a name="l00459"></a>00459                             <span class="keywordflow">else</span>:
<a name="l00460"></a>00460                                 sg.add_edge(pydot.Edge(str(pedobj.pedigree[int(_m.damID)-1].animalID), str(_m.animalID), dir=<span class="stringliteral">&#39;none&#39;</span>))
<a name="l00461"></a>00461                     <span class="comment">## &lt;-</span>
<a name="l00462"></a>00462             <span class="keywordflow">if</span> len(_sg_anims) &gt; 0:
<a name="l00463"></a>00463                 _sg_list = <span class="stringliteral">&#39;&#39;</span>
<a name="l00464"></a>00464                 <span class="keywordflow">for</span> _a <span class="keywordflow">in</span> _sg_anims:
<a name="l00465"></a>00465                     <span class="keywordflow">if</span> len(_sg_list) == 0:
<a name="l00466"></a>00466                         _sg_list = <span class="stringliteral">&#39;%s&#39;</span> % (_a)
<a name="l00467"></a>00467                     <span class="keywordflow">else</span>:
<a name="l00468"></a>00468                         _sg_list = <span class="stringliteral">&#39;%s,%s&#39;</span> % (_sg_list,_a)
<a name="l00469"></a>00469             sg.set_rank(_sg_list)
<a name="l00470"></a>00470             g.add_subgraph(sg)
<a name="l00471"></a>00471             <span class="comment">#try:</span>
<a name="l00472"></a>00472                 <span class="comment">#print sg.get_node_list()</span>
<a name="l00473"></a>00473             <span class="comment">#except:</span>
<a name="l00474"></a>00474                 <span class="comment">#print &#39;Could not get node list for subgraph!&#39;</span>
<a name="l00475"></a>00475             <span class="comment">#try:</span>
<a name="l00476"></a>00476                 <span class="comment">#print sg.get_edge_list()</span>
<a name="l00477"></a>00477             <span class="comment">#except:</span>
<a name="l00478"></a>00478                 <span class="comment">#print &#39;Could not get edge list for subgraph!&#39;</span>
<a name="l00479"></a>00479 
<a name="l00480"></a>00480     <span class="comment"># For large graphs it is nice to write out the .dot file so that it does</span>
<a name="l00481"></a>00481     <span class="comment"># not have to be recreated whenever new_draw_pedigree is called.</span>
<a name="l00482"></a>00482     <span class="comment"># Especially when I am debugging.</span>
<a name="l00483"></a>00483     <span class="keywordflow">if</span> gdot:
<a name="l00484"></a>00484         dfn = <span class="stringliteral">&#39;%s.dot&#39;</span> % (gfilename)
<a name="l00485"></a>00485         <span class="keywordflow">try</span>:
<a name="l00486"></a>00486             g.write(dfn)
<a name="l00487"></a>00487         <span class="keywordflow">except</span>:
<a name="l00488"></a>00488             <span class="keywordflow">if</span> pedobj.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span>:
<a name="l00489"></a>00489                 <span class="keywordflow">print</span> <span class="stringliteral">&#39;[ERROR]: pyp_graphics/draw_pedigree() was unable to write the dotfile %s.&#39;</span> % (dfn)
<a name="l00490"></a>00490             logging.error(<span class="stringliteral">&#39;pyp_graphics/draw_pedigree() was unable to draw the dotfile %s.&#39;</span>, (dfn))
<a name="l00491"></a>00491 
<a name="l00492"></a>00492     <span class="comment"># Write the graph to an output file.</span>
<a name="l00493"></a>00493     <span class="keywordflow">try</span>:
<a name="l00494"></a>00494         outfile = <span class="stringliteral">&#39;%s.%s&#39;</span> % (gfilename,gformat)
<a name="l00495"></a>00495         g.write(outfile, prog=<span class="stringliteral">&#39;dot&#39;</span>, format=gformat)
<a name="l00496"></a>00496         <span class="keywordflow">return</span> 1
<a name="l00497"></a>00497     <span class="keywordflow">except</span>:
<a name="l00498"></a>00498         outfile = <span class="stringliteral">&#39;%s.%s&#39;</span> % (gfilename,gformat)
<a name="l00499"></a>00499         <span class="keywordflow">if</span> pedobj.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span>:
<a name="l00500"></a>00500             <span class="keywordflow">print</span> <span class="stringliteral">&#39;[ERROR]: pyp_graphics/draw_pedigree() was unable to draw the pedigree %s.&#39;</span> % (outfile)
<a name="l00501"></a>00501         logging.error(<span class="stringliteral">&#39;pyp_graphics/draw_pedigree() was unable to draw the pedigree %s.&#39;</span>, (outfile))
<a name="l00502"></a>00502         <span class="keywordflow">return</span> 0
<a name="l00503"></a>00503 
<a name="l00504"></a>00504 <span class="comment">##</span>
<a name="l00505"></a>00505 <span class="comment"># founders_by_year() uses matplotlib -- if available on your system -- to produce a</span>
<a name="l00506"></a>00506 <span class="comment"># bar graph of the number (count) of founders in each birthyear.</span>
<a name="l00507"></a>00507 <span class="comment"># @param pedobj A PyPedal pedigree object.</span>
<a name="l00508"></a>00508 <span class="comment"># @param gfilename The name of the file to which the pedigree should be drawn</span>
<a name="l00509"></a>00509 <span class="comment"># @param gtitle The title of the graph.</span>
<a name="l00510"></a>00510 <span class="comment"># @retval A 1 for success and a 0 for failure.</span>
<a name="l00511"></a>00511 <span class="keyword">def </span>plot_founders_by_year(pedobj, gfilename=&#39;founders_by_year&#39;, gtitle=&#39;Founders by Birthyear&#39;):
<a name="l00512"></a>00512     <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00513"></a>00513 <span class="stringliteral">    founders_by_year() uses matplotlib -- if available on your system -- to produce a</span>
<a name="l00514"></a>00514 <span class="stringliteral">    bar graph of the number (count) of founders in each birthyear.</span>
<a name="l00515"></a>00515 <span class="stringliteral">    &quot;&quot;&quot;</span>
<a name="l00516"></a>00516     <span class="keywordflow">try</span>:
<a name="l00517"></a>00517         <span class="keyword">import</span> matplotlib
<a name="l00518"></a>00518         matplotlib.use(<span class="stringliteral">&#39;Agg&#39;</span>)
<a name="l00519"></a>00519         <span class="keyword">import</span> pylab
<a name="l00520"></a>00520     <span class="keywordflow">except</span> ImportError:
<a name="l00521"></a>00521         <span class="keywordflow">if</span> pedobj.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span>:
<a name="l00522"></a>00522             <span class="keywordflow">print</span> <span class="stringliteral">&#39;[ERROR]: pyp_graphics/plot_founders_by_year() was unable to import the matplotlib module!&#39;</span>
<a name="l00523"></a>00523         logging.error(<span class="stringliteral">&#39;pyp_graphics/plot_founders_by_year() was unable to import the matplotlib module!&#39;</span>)
<a name="l00524"></a>00524         <span class="keywordflow">return</span> 0
<a name="l00525"></a>00525 
<a name="l00526"></a>00526     fby = pyp_demog.founders_by_year(pedobj)
<a name="l00527"></a>00527     <span class="comment">#print fby</span>
<a name="l00528"></a>00528     <span class="keywordflow">try</span>:
<a name="l00529"></a>00529         pylab.clf()
<a name="l00530"></a>00530         pylab.bar(fby.keys(),fby.values())
<a name="l00531"></a>00531         pylab.title(gtitle)
<a name="l00532"></a>00532         pylab.xlabel(<span class="stringliteral">&#39;Year&#39;</span>)
<a name="l00533"></a>00533         pylab.ylabel(<span class="stringliteral">&#39;Number of founders&#39;</span>)
<a name="l00534"></a>00534         plotfile = <span class="stringliteral">&#39;%s.png&#39;</span> % (gfilename)
<a name="l00535"></a>00535         <span class="comment">#print &#39;plotfile: &#39;, plotfile</span>
<a name="l00536"></a>00536         myplotfile = open(plotfile,<span class="stringliteral">&#39;w&#39;</span>)
<a name="l00537"></a>00537         <span class="comment">#print &#39;myplotfile: &#39;, myplotfile</span>
<a name="l00538"></a>00538         pylab.savefig(myplotfile)
<a name="l00539"></a>00539         myplotfile.close()
<a name="l00540"></a>00540         <span class="keywordflow">return</span> 1
<a name="l00541"></a>00541     <span class="keywordflow">except</span>:
<a name="l00542"></a>00542         <span class="keywordflow">if</span> pedobj.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span>:
<a name="l00543"></a>00543             <span class="keywordflow">print</span> <span class="stringliteral">&#39;[ERROR]: pyp_graphics/plot_founders_by_year() was unable to create the plot \&#39;%s\&#39; (%s.png).&#39;</span> % ( gtitle, gfilename )
<a name="l00544"></a>00544         <span class="comment">#print gtitle, gfilename</span>
<a name="l00545"></a>00545         logging.error(<span class="stringliteral">&#39;pyp_graphics/plot_founders_by_year() was unable to create the plot \&#39;%s\&#39; (%s.png).&#39;</span>, gtitle, gfilename)
<a name="l00546"></a>00546         <span class="keywordflow">return</span> 0
<a name="l00547"></a>00547 
<a name="l00548"></a>00548 <span class="comment">##</span>
<a name="l00549"></a>00549 <span class="comment"># founders_pct_by_year() uses matplotlib -- if available on your system -- to produce a</span>
<a name="l00550"></a>00550 <span class="comment"># line graph of the frequency (percentage) of founders in each birthyear.</span>
<a name="l00551"></a>00551 <span class="comment"># @param pedobj A PyPedal pedigree object.</span>
<a name="l00552"></a>00552 <span class="comment"># @param gfilename The name of the file to which the pedigree should be drawn</span>
<a name="l00553"></a>00553 <span class="comment"># @param gtitle The title of the graph.</span>
<a name="l00554"></a>00554 <span class="comment"># @retval A 1 for success and a 0 for failure.</span>
<a name="l00555"></a>00555 <span class="keyword">def </span>plot_founders_pct_by_year(pedobj, gfilename=&#39;founders_pct_by_year&#39;, gtitle=&#39;Founders by Birthyear&#39;):
<a name="l00556"></a>00556     <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00557"></a>00557 <span class="stringliteral">    founders_pct_by_year() uses matplotlib -- if available on your system -- to produce a</span>
<a name="l00558"></a>00558 <span class="stringliteral">    line graph of the frequency (percentage) of founders in each birthyear.</span>
<a name="l00559"></a>00559 <span class="stringliteral">    &quot;&quot;&quot;</span>
<a name="l00560"></a>00560     <span class="keywordflow">try</span>:
<a name="l00561"></a>00561         <span class="keyword">import</span> matplotlib
<a name="l00562"></a>00562         matplotlib.use(<span class="stringliteral">&#39;Agg&#39;</span>)
<a name="l00563"></a>00563         <span class="keyword">import</span> pylab
<a name="l00564"></a>00564     <span class="keywordflow">except</span> ImportError:
<a name="l00565"></a>00565         <span class="keywordflow">if</span> pedobj.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span>:
<a name="l00566"></a>00566             <span class="keywordflow">print</span> <span class="stringliteral">&#39;[ERROR]: pyp_graphics/plot_founders_pct_by_year() was unable to import the matplotlib module!&#39;</span>
<a name="l00567"></a>00567         logging.error(<span class="stringliteral">&#39;pyp_graphics/plot_founders_pct_by_year() was unable to import the matplotlib module!&#39;</span>)
<a name="l00568"></a>00568         <span class="keywordflow">return</span> 0
<a name="l00569"></a>00569 
<a name="l00570"></a>00570     fby = pyp_demog.founders_by_year(pedobj)
<a name="l00571"></a>00571     _freqdict = {}
<a name="l00572"></a>00572     <span class="keywordflow">for</span> _k <span class="keywordflow">in</span> fby.keys():
<a name="l00573"></a>00573         _freqdict[_k] = float(fby[_k]) / float(pedobj.metadata.num_unique_founders)
<a name="l00574"></a>00574     <span class="keywordflow">try</span>:
<a name="l00575"></a>00575         <span class="keyword">import</span> matplotlib
<a name="l00576"></a>00576         matplotlib.use(<span class="stringliteral">&#39;Agg&#39;</span>)
<a name="l00577"></a>00577         <span class="keyword">import</span> pylab
<a name="l00578"></a>00578         pylab.clf()
<a name="l00579"></a>00579         pylab.plot(fby.keys(),_freqdict.values())
<a name="l00580"></a>00580         pylab.title(gtitle)
<a name="l00581"></a>00581         pylab.xlabel(<span class="stringliteral">&#39;Year&#39;</span>)
<a name="l00582"></a>00582         pylab.ylabel(<span class="stringliteral">&#39;% founders&#39;</span>)
<a name="l00583"></a>00583         plotfile = <span class="stringliteral">&#39;%s.png&#39;</span> % (gfilename)
<a name="l00584"></a>00584         myplotfile = open(plotfile,<span class="stringliteral">&#39;w&#39;</span>)
<a name="l00585"></a>00585         pylab.savefig(myplotfile)
<a name="l00586"></a>00586         myplotfile.close()
<a name="l00587"></a>00587         <span class="keywordflow">return</span> 1
<a name="l00588"></a>00588     <span class="keywordflow">except</span>:
<a name="l00589"></a>00589         <span class="keywordflow">if</span> pedobj.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span>:
<a name="l00590"></a>00590             <span class="keywordflow">print</span> <span class="stringliteral">&#39;[ERROR]: pyp_graphics/plot_pct_founders_by_year() was unable to create the plot \&#39;%s\&#39; (%s.png).&#39;</span> % (gtitle,gfilename)
<a name="l00591"></a>00591         logging.error(<span class="stringliteral">&#39;pyp_graphics/plot_pct_founders_by_year() was unable to create the plot \&#39;%s\&#39; (%s.png).&#39;</span> % (gtitle,gfilename))
<a name="l00592"></a>00592         <span class="keywordflow">return</span> 0
<a name="l00593"></a>00593 
<a name="l00594"></a>00594 <span class="comment">##</span>
<a name="l00595"></a>00595 <span class="comment"># pcolor_matrix_pylab() implements a matlab-like &#39;pcolor&#39; function to</span>
<a name="l00596"></a>00596 <span class="comment"># display the large elements of a matrix in pseudocolor using the Python Imaging</span>
<a name="l00597"></a>00597 <span class="comment"># Library.</span>
<a name="l00598"></a>00598 <span class="comment"># @param A Input Numpy matrix (such as a numerator relationship matrix).</span>
<a name="l00599"></a>00599 <span class="comment"># @param fname Output filename to which to dump the graphics (default &#39;tmp.png&#39;)</span>
<a name="l00600"></a>00600 <span class="comment"># @retval A list of NewAnimal() objects; a pedigree metadata object.</span>
<a name="l00601"></a>00601 <span class="keyword">def </span>pcolor_matrix_pylab(A, fname=&#39;pcolor_matrix_matplotlib&#39;):
<a name="l00602"></a>00602     <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00603"></a>00603 <span class="stringliteral">    pcolor_matrix_pylab() implements a matlab-like &#39;pcolor&#39; function to</span>
<a name="l00604"></a>00604 <span class="stringliteral">    display the large elements of a matrix in pseudocolor using the Python Imaging</span>
<a name="l00605"></a>00605 <span class="stringliteral">    Library.</span>
<a name="l00606"></a>00606 <span class="stringliteral">    &quot;&quot;&quot;</span>
<a name="l00607"></a>00607     <span class="keywordflow">try</span>:
<a name="l00608"></a>00608         <span class="keyword">import</span> matplotlib
<a name="l00609"></a>00609         matplotlib.use(<span class="stringliteral">&#39;Agg&#39;</span>)
<a name="l00610"></a>00610         <span class="keyword">import</span> pylab
<a name="l00611"></a>00611     <span class="keywordflow">except</span> ImportError:
<a name="l00612"></a>00612         <span class="keywordflow">if</span> pedobj.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span>:
<a name="l00613"></a>00613             <span class="keywordflow">print</span> <span class="stringliteral">&#39;[ERROR]: pyp_graphics/pcolor_matrix_pylab() was unable to import the matplotlib module!&#39;</span>
<a name="l00614"></a>00614         logging.error(<span class="stringliteral">&#39;pyp_graphics/pcolor_matrix_pylab() was unable to import the matplotlib module!&#39;</span>)
<a name="l00615"></a>00615         <span class="keywordflow">return</span> 0
<a name="l00616"></a>00616 
<a name="l00617"></a>00617     <span class="keywordflow">try</span>:
<a name="l00618"></a>00618         <span class="keyword">import</span> numpy
<a name="l00619"></a>00619         pylab.clf()
<a name="l00620"></a>00620         x = pylab.arange(A.shape[0])
<a name="l00621"></a>00621         X, Y = pylab.meshgrid(x,x)
<a name="l00622"></a>00622 
<a name="l00623"></a>00623         xmin = min(pylab.ravel(X))
<a name="l00624"></a>00624         xmax = max(pylab.ravel(X))
<a name="l00625"></a>00625         pylab.xlim(xmin, xmax)
<a name="l00626"></a>00626         ymin = min(pylab.ravel(Y))
<a name="l00627"></a>00627         ymax = max(pylab.ravel(Y))
<a name="l00628"></a>00628         pylab.ylim(ymin, ymax)
<a name="l00629"></a>00629         pylab.axis(<span class="stringliteral">&#39;off&#39;</span>)
<a name="l00630"></a>00630 
<a name="l00631"></a>00631         pylab.pcolor(X, Y, pylab.transpose(A))<span class="comment">#, shading=&#39;flat&#39;)</span>
<a name="l00632"></a>00632         pylab.clim(0.0, 1.0)
<a name="l00633"></a>00633         plotfile = <span class="stringliteral">&#39;%s.png&#39;</span> % (fname)
<a name="l00634"></a>00634         myplotfile = open(plotfile,<span class="stringliteral">&#39;w&#39;</span>)
<a name="l00635"></a>00635         pylab.savefig(myplotfile)
<a name="l00636"></a>00636         myplotfile.close()
<a name="l00637"></a>00637         <span class="keywordflow">return</span> 1
<a name="l00638"></a>00638     <span class="keywordflow">except</span>:
<a name="l00639"></a>00639         <span class="keywordflow">if</span> pedobj.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span>:
<a name="l00640"></a>00640             <span class="keywordflow">print</span> <span class="stringliteral">&#39;[ERROR]: pyp_graphics/pcolor_matrix_pylab() was unable to create the plot %s.&#39;</span> % (plotfile)
<a name="l00641"></a>00641         logging.error(<span class="stringliteral">&#39;pyp_graphics/pcolor_matrix_pylab() was unable to create the plot %s.&#39;</span>, (plotfile))
<a name="l00642"></a>00642         <span class="keywordflow">return</span> 0
<a name="l00643"></a>00643 
<a name="l00644"></a>00644 <span class="comment">##</span>
<a name="l00645"></a>00645 <span class="comment"># spy_matrix_pylab() implements a matlab-like &#39;pcolor&#39; function to</span>
<a name="l00646"></a>00646 <span class="comment"># display the large elements of a matrix in pseudocolor using the Python Imaging</span>
<a name="l00647"></a>00647 <span class="comment"># Library.</span>
<a name="l00648"></a>00648 <span class="comment"># @param A Input Numpy matrix (such as a numerator relationship matrix).</span>
<a name="l00649"></a>00649 <span class="comment"># @param fname Output filename to which to dump the graphics (default &#39;tmp.png&#39;)</span>
<a name="l00650"></a>00650 <span class="comment"># @retval A list of NewAnimal() objects; a pedigree metadata object.</span>
<a name="l00651"></a>00651 <span class="keyword">def </span>spy_matrix_pylab(A, fname=&#39;spy_matrix_matplotlib&#39;):
<a name="l00652"></a>00652     <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00653"></a>00653 <span class="stringliteral">    spy_matrix_pylab() implements a matlab-like &#39;pcolor&#39; function to</span>
<a name="l00654"></a>00654 <span class="stringliteral">    display the large elements of a matrix in pseudocolor using the Python Imaging</span>
<a name="l00655"></a>00655 <span class="stringliteral">    Library.</span>
<a name="l00656"></a>00656 <span class="stringliteral">    &quot;&quot;&quot;</span>
<a name="l00657"></a>00657     <span class="keywordflow">try</span>:
<a name="l00658"></a>00658         <span class="keyword">import</span> matplotlib
<a name="l00659"></a>00659         matplotlib.use(<span class="stringliteral">&#39;Agg&#39;</span>)
<a name="l00660"></a>00660         <span class="keyword">import</span> pylab
<a name="l00661"></a>00661     <span class="keywordflow">except</span> ImportError:
<a name="l00662"></a>00662         <span class="keywordflow">if</span> pedobj.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span>:
<a name="l00663"></a>00663             <span class="keywordflow">print</span> <span class="stringliteral">&#39;[ERROR]: pyp_graphics/spy_matrix_pylab() was unable to import the matplotlib module!&#39;</span>
<a name="l00664"></a>00664         logging.error(<span class="stringliteral">&#39;pyp_graphics/spy_matrix_pylab() was unable to import the matplotlib module!&#39;</span>)
<a name="l00665"></a>00665         <span class="keywordflow">return</span> 0
<a name="l00666"></a>00666 
<a name="l00667"></a>00667     <span class="keywordflow">try</span>:
<a name="l00668"></a>00668         <span class="keyword">import</span> numpy
<a name="l00669"></a>00669         pylab.clf()
<a name="l00670"></a>00670         pylab.spy2(A)
<a name="l00671"></a>00671         plotfile = <span class="stringliteral">&#39;%s.png&#39;</span> % (fname)
<a name="l00672"></a>00672         myplotfile = open(plotfile,<span class="stringliteral">&#39;w&#39;</span>)
<a name="l00673"></a>00673         pylab.savefig(myplotfile)
<a name="l00674"></a>00674         myplotfile.close()
<a name="l00675"></a>00675         <span class="keywordflow">return</span> 1
<a name="l00676"></a>00676     <span class="keywordflow">except</span>:
<a name="l00677"></a>00677         <span class="keywordflow">if</span> pedobj.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span>:
<a name="l00678"></a>00678             <span class="keywordflow">print</span> <span class="stringliteral">&#39;[ERROR]: pyp_graphics/spy_matrix_pylab() was unable to create the plot %s.&#39;</span> % (plotfile)
<a name="l00679"></a>00679         logging.error(<span class="stringliteral">&#39;pyp_graphics/spy_matrix_pylab() was unable to create the plot %s.&#39;</span>, (plotfile))
<a name="l00680"></a>00680         <span class="keywordflow">return</span> 0
<a name="l00681"></a>00681 
<a name="l00682"></a>00682 <span class="comment">##</span>
<a name="l00683"></a>00683 <span class="comment"># plot_line_xy() uses matplotlib -- if available on your system -- to produce a</span>
<a name="l00684"></a>00684 <span class="comment"># line graph of the values in a dictionary for each level of key.</span>
<a name="l00685"></a>00685 <span class="comment"># @param xydict A Python dictionary of x- (keys) and y-values (values) to be plotted. </span>
<a name="l00686"></a>00686 <span class="comment"># @param gfilename The name of the file to which the figure should be written.</span>
<a name="l00687"></a>00687 <span class="comment"># @param gtitle The title of the graph.</span>
<a name="l00688"></a>00688 <span class="comment"># @param gxlabel The label for the x-axis.</span>
<a name="l00689"></a>00689 <span class="comment"># @param gylabel The label for the y-axis.</span>
<a name="l00690"></a>00690 <span class="comment"># @param gformat The format in which the output file should be written  (JPG|PNG|PS).</span>
<a name="l00691"></a>00691 <span class="comment"># @retval A 1 for success and a 0 for failure.</span>
<a name="l00692"></a>00692 <span class="keyword">def </span>plot_line_xy(xydict, gfilename=&#39;plot_line_xy&#39;, gtitle=&#39;Value by key&#39;, gxlabel=&#39;X&#39;, gylabel=&#39;Y&#39;, gformat=&#39;png&#39;):
<a name="l00693"></a>00693     <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00694"></a>00694 <span class="stringliteral">    plot_line_xy() uses matplotlib -- if available on your system -- to produce a</span>
<a name="l00695"></a>00695 <span class="stringliteral">    line graph of the values in a dictionary for each level of key.</span>
<a name="l00696"></a>00696 <span class="stringliteral">    &quot;&quot;&quot;</span>
<a name="l00697"></a>00697     <span class="keywordflow">try</span>:
<a name="l00698"></a>00698         <span class="keyword">import</span> matplotlib
<a name="l00699"></a>00699         matplotlib.use(<span class="stringliteral">&#39;Agg&#39;</span>)
<a name="l00700"></a>00700         <span class="keyword">import</span> pylab
<a name="l00701"></a>00701     <span class="keywordflow">except</span> ImportError:
<a name="l00702"></a>00702         <span class="keywordflow">if</span> pedobj.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span>:
<a name="l00703"></a>00703             <span class="keywordflow">print</span> <span class="stringliteral">&#39;[ERROR]: pyp_graphics/plot_line_xy() was unable to import the matplotlib module!&#39;</span>
<a name="l00704"></a>00704         logging.error(<span class="stringliteral">&#39;pyp_graphics/plot_line_xy() was unable to import the matplotlib module!&#39;</span>)
<a name="l00705"></a>00705         <span class="keywordflow">return</span> 0
<a name="l00706"></a>00706 
<a name="l00707"></a>00707     <span class="keywordflow">if</span> gformat <span class="keywordflow">not</span> <span class="keywordflow">in</span> [<span class="stringliteral">&#39;png&#39;</span>]:
<a name="l00708"></a>00708         gformat = <span class="stringliteral">&#39;png&#39;</span>
<a name="l00709"></a>00709 
<a name="l00710"></a>00710     <span class="keywordflow">try</span>:
<a name="l00711"></a>00711         pylab.clf()
<a name="l00712"></a>00712         <span class="comment"># Dictionary keys are not guaranteed to be listed</span>
<a name="l00713"></a>00713         <span class="comment"># in ascending order, so we have to do it.</span>
<a name="l00714"></a>00714         keylist = xydict.keys()
<a name="l00715"></a>00715         keylist.sort()
<a name="l00716"></a>00716         valuelist = [xydict[key] <span class="keywordflow">for</span> key <span class="keywordflow">in</span> keylist]
<a name="l00717"></a>00717         <span class="comment"># Done with the sorting</span>
<a name="l00718"></a>00718         pylab.plot(keylist,valuelist)
<a name="l00719"></a>00719         pylab.title(gtitle)
<a name="l00720"></a>00720         pylab.xlabel(gxlabel)
<a name="l00721"></a>00721         pylab.ylabel(gylabel)
<a name="l00722"></a>00722         plotfile = <span class="stringliteral">&#39;%s.%s&#39;</span> % (gfilename, gformat)
<a name="l00723"></a>00723         myplotfile = open(plotfile,<span class="stringliteral">&#39;w&#39;</span>)
<a name="l00724"></a>00724         pylab.savefig(myplotfile)
<a name="l00725"></a>00725         myplotfile.close()
<a name="l00726"></a>00726         _status = 1
<a name="l00727"></a>00727     <span class="keywordflow">except</span>:
<a name="l00728"></a>00728         <span class="keywordflow">if</span> pedobj.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span>:
<a name="l00729"></a>00729             <span class="keywordflow">print</span> <span class="stringliteral">&#39;[ERROR]: pyp_graphics/plot_line_xy() was unable to create the plot \&#39;%s\&#39; (%s.%s).&#39;</span> % (gtitle,gfilename,gformat)
<a name="l00730"></a>00730         logging.error(<span class="stringliteral">&#39;pyp_graphics/plot_line_xy() was unable to create the plot \&#39;%s\&#39; (%s.%s).&#39;</span> % (gtitle,gfilename,gformat))
<a name="l00731"></a>00731         _status = 0
<a name="l00732"></a>00732     <span class="keywordflow">return</span> _status
<a name="l00733"></a>00733 
<a name="l00734"></a>00734 <span class="comment">##</span>
<a name="l00735"></a>00735 <span class="comment"># new_draw_pedigree() uses the pygraphviz to produce a directed graph of your</span>
<a name="l00736"></a>00736 <span class="comment"># pedigree with paths of inheritance as edges and animals as nodes.  If there</span>
<a name="l00737"></a>00737 <span class="comment"># is more than one generation in the pedigree as determind by the &quot;gen&quot;</span>
<a name="l00738"></a>00738 <span class="comment"># attributes of the animals in the pedigree, draw_pedigree() will use subgraphs</span>
<a name="l00739"></a>00739 <span class="comment"># to try and group animals in the same generation together in the drawing.</span>
<a name="l00740"></a>00740 <span class="comment"># @param pedobj A PyPedal pedigree object.</span>
<a name="l00741"></a>00741 <span class="comment"># @param gfilename The name of the file to which the pedigree should be drawn</span>
<a name="l00742"></a>00742 <span class="comment"># @param gtitle The title of the graph.</span>
<a name="l00743"></a>00743 <span class="comment"># @param gformat The format in which the output file should be written  (JPG|PNG|PS).</span>
<a name="l00744"></a>00744 <span class="comment"># @param gsize The size of the graph: &#39;f&#39;: full-size, &#39;l&#39;: letter-sized page.</span>
<a name="l00745"></a>00745 <span class="comment"># @param gdot Whether or not to write the dot code for the pedigree graph to a file (can produce large files).</span>
<a name="l00746"></a>00746 <span class="comment"># @param gorient The orientation of the graph: &#39;p&#39;: portrait, &#39;l&#39;: landscape.</span>
<a name="l00747"></a>00747 <span class="comment"># @param gdirec Direction of flow from parents to offspring: &#39;TB&#39;: top-bottom, &#39;LR&#39;: left-right, &#39;RL&#39;: right-left.</span>
<a name="l00748"></a>00748 <span class="comment"># @param gname Flag indicating whether ID numbers (0) or names (1) should be used to label nodes.</span>
<a name="l00749"></a>00749 <span class="comment"># @param garrow Flag indicating whether or not arrowheads should be drawn.</span>
<a name="l00750"></a>00750 <span class="comment"># @param gtitloc Indicates if the title be drawn or above (&#39;t&#39;) or below (&#39;b&#39;) the graph.</span>
<a name="l00751"></a>00751 <span class="comment"># @param gtitjust Indicates if the title should be center- (&#39;c&#39;), left- (&#39;l&#39;), or right-justified (&#39;r&#39;).</span>
<a name="l00752"></a>00752 <span class="comment"># @param gshowall Draws animals with no links to other ancestors in the pedigree (1) or suppresses them (0).</span>
<a name="l00753"></a>00753 <span class="comment"># @param gprog Specify which program should be used to position and render the graph.</span>
<a name="l00754"></a>00754 <span class="comment"># @retval A 1 for success and a 0 for failure.</span>
<a name="l00755"></a>00755 <span class="keyword">def </span>new_draw_pedigree(pedobj, gfilename=&#39;pedigree&#39;, gtitle=&#39;&#39;, gformat=&#39;jpg&#39;, \
<a name="l00756"></a>00756     gsize=<span class="stringliteral">&#39;f&#39;</span>, gdot=1, gorient=<span class="stringliteral">&#39;p&#39;</span>, gdirec=<span class="stringliteral">&#39;&#39;</span>, gname=0, garrow=1, \
<a name="l00757"></a>00757     gtitloc=<span class="stringliteral">&#39;b&#39;</span>, gtitjust=<span class="stringliteral">&#39;c&#39;</span>, gshowall=1, gprog=<span class="stringliteral">&#39;dot&#39;</span>):
<a name="l00758"></a>00758     <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00759"></a>00759 <span class="stringliteral">    new_draw_pedigree() uses the pygraphviz to produce a directed graph of your</span>
<a name="l00760"></a>00760 <span class="stringliteral">    pedigree with paths of inheritance as edges and animals as nodes.  If there</span>
<a name="l00761"></a>00761 <span class="stringliteral">    is more than one generation in the pedigree as determind by the &quot;gen&quot;</span>
<a name="l00762"></a>00762 <span class="stringliteral">    attributes of the animals in the pedigree, draw_pedigree() will use subgraphs</span>
<a name="l00763"></a>00763 <span class="stringliteral">    to try and group animals in the same generation together in the drawing.</span>
<a name="l00764"></a>00764 <span class="stringliteral"></span>
<a name="l00765"></a>00765 <span class="stringliteral">    Note that there is not (AFAIK) a nice way to get pygraphviz installed on vanilla</span>
<a name="l00766"></a>00766 <span class="stringliteral">    Windows, so you&#39;ll have to make due with draw_pedigree() and plain old dot.</span>
<a name="l00767"></a>00767 <span class="stringliteral">    &quot;&quot;&quot;</span>
<a name="l00768"></a>00768 
<a name="l00769"></a>00769     <span class="keywordflow">try</span>:
<a name="l00770"></a>00770         <span class="keyword">import</span> pygraphviz
<a name="l00771"></a>00771     <span class="keywordflow">except</span> ImportError:
<a name="l00772"></a>00772         <span class="keywordflow">if</span> pedobj.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span>:
<a name="l00773"></a>00773             <span class="keywordflow">print</span> <span class="stringliteral">&#39;[ERROR]: pyp_graphics/new_draw_pedigree() was unable to import the pygraphviz module!&#39;</span>
<a name="l00774"></a>00774         logging.error(<span class="stringliteral">&#39;pyp_graphics/new_draw_pedigree() was unable to import the pygraphviz module!&#39;</span>)
<a name="l00775"></a>00775         <span class="keywordflow">return</span> 0
<a name="l00776"></a>00776 
<a name="l00777"></a>00777     <span class="comment"># Maps the 0/1 flags taken by the function and maps them to Python</span>
<a name="l00778"></a>00778     <span class="comment"># True/False for settine edge and node attributes.</span>
<a name="l00779"></a>00779     _tf = {0:<span class="keyword">False</span>, 1:<span class="keyword">True</span>}
<a name="l00780"></a>00780 
<a name="l00781"></a>00781     <span class="keyword">from</span> pyp_utils <span class="keyword">import</span> string_to_table_name
<a name="l00782"></a>00782     _gtitle = string_to_table_name(gtitle)
<a name="l00783"></a>00783 
<a name="l00784"></a>00784     <span class="keywordflow">if</span> gtitloc <span class="keywordflow">not</span> <span class="keywordflow">in</span> [<span class="stringliteral">&#39;t&#39;</span>,<span class="stringliteral">&#39;b&#39;</span>]:
<a name="l00785"></a>00785         gtitloc = <span class="stringliteral">&#39;b&#39;</span>
<a name="l00786"></a>00786     <span class="keywordflow">if</span> gtitjust <span class="keywordflow">not</span> <span class="keywordflow">in</span> [<span class="stringliteral">&#39;c&#39;</span>,<span class="stringliteral">&#39;l&#39;</span>,<span class="stringliteral">&#39;</span><span class="stringliteral">r&#39;]:</span>
<a name="l00787"></a>00787 <span class="stringliteral">        gtitjust = </span><span class="stringliteral">&#39;c&#39;</span>
<a name="l00788"></a>00788 
<a name="l00789"></a>00789     <span class="keywordflow">if</span> <span class="keywordflow">not</span> pedobj.kw[<span class="stringliteral">&#39;pedigree_is_renumbered&#39;</span>]:
<a name="l00790"></a>00790         <span class="keywordflow">if</span> pedobj.kw[<span class="stringliteral">&#39;messages&#39;</span>] != <span class="stringliteral">&#39;quiet&#39;</span>:
<a name="l00791"></a>00791             <span class="keywordflow">print</span> <span class="stringliteral">&#39;[GRAPH]: The pedigree that you passed to pyp_graphics/new_draw_pedigree() is not renumbered. Because of this, there may be errors in the rendered pedigree. In order to insure that the pedigree drawing is accurate, you should renumber the pedigree before calling new_draw_pedigree().&#39;</span>
<a name="l00792"></a>00792         logging.error(<span class="stringliteral">&#39;The pedigree that you passed to pyp_graphics/new_draw_pedigree() is not renumbered. Because of this, there may be errors in the rendered pedigree. In order to insure that the pedigree drawing is accurate, you should renumber the pedigree before calling new_draw_pedigree().&#39;</span>)
<a name="l00793"></a>00793 
<a name="l00794"></a>00794     <span class="comment"># Create an empty pygraphviz graph using the Agraph class.</span>
<a name="l00795"></a>00795     g = pygraphviz.AGraph(directed=<span class="keyword">True</span>,strict=<span class="keyword">False</span>)
<a name="l00796"></a>00796 
<a name="l00797"></a>00797     <span class="comment"># I&#39;m not sure if I need to have this here or not.</span>
<a name="l00798"></a>00798     g.graph_attr[<span class="stringliteral">&#39;type&#39;</span>] = <span class="stringliteral">&#39;graph&#39;</span>
<a name="l00799"></a>00799 
<a name="l00800"></a>00800     <span class="comment"># Name the graph -- _gtitle has the characters removed which would cause</span>
<a name="l00801"></a>00801     <span class="comment"># dotfile processing to break.</span>
<a name="l00802"></a>00802     g.graph_attr[<span class="stringliteral">&#39;name&#39;</span>] = _gtitle
<a name="l00803"></a>00803 
<a name="l00804"></a>00804     <span class="comment"># Set some properties for the graph.  The label attribute is based on the gtitle.</span>
<a name="l00805"></a>00805     <span class="comment"># In cases where an empty string, e.g. &#39;&#39;, is provided as the gtitle dot engine</span>
<a name="l00806"></a>00806     <span class="comment"># processing breaks.  In such cases, don&#39;t add a label.</span>
<a name="l00807"></a>00807 
<a name="l00808"></a>00808     <span class="keywordflow">if</span> gtitle != <span class="stringliteral">&#39;&#39;</span>:
<a name="l00809"></a>00809         g.graph_attr[<span class="stringliteral">&#39;label&#39;</span>] = gtitle
<a name="l00810"></a>00810         g.graph_attr[<span class="stringliteral">&#39;labelloc&#39;</span>] = gtitloc
<a name="l00811"></a>00811         g.graph_attr[<span class="stringliteral">&#39;labeljust&#39;</span>] = gtitjust
<a name="l00812"></a>00812 
<a name="l00813"></a>00813     <span class="comment"># Set the page paper size and writeable area.</span>
<a name="l00814"></a>00814     g.graph_attr[<span class="stringliteral">&#39;page&#39;</span>] = <span class="stringliteral">&#39;8.5,11&#39;</span>
<a name="l00815"></a>00815     g.graph_attr[<span class="stringliteral">&#39;size&#39;</span>] = <span class="stringliteral">&#39;7.5,10&#39;</span>
<a name="l00816"></a>00816 
<a name="l00817"></a>00817     <span class="comment"># Set the page orientation.</span>
<a name="l00818"></a>00818     <span class="keywordflow">if</span> gorient == <span class="stringliteral">&#39;l&#39;</span>:
<a name="l00819"></a>00819         g.graph_attr[<span class="stringliteral">&#39;orientation&#39;</span>] = <span class="stringliteral">&#39;landscape&#39;</span>
<a name="l00820"></a>00820     <span class="keywordflow">else</span>:
<a name="l00821"></a>00821         g.graph_attr[<span class="stringliteral">&#39;orientation&#39;</span>] = <span class="stringliteral">&#39;portrait&#39;</span>
<a name="l00822"></a>00822 
<a name="l00823"></a>00823     <span class="keywordflow">if</span> gsize != <span class="stringliteral">&#39;l&#39;</span>:
<a name="l00824"></a>00824         g.graph_attr[<span class="stringliteral">&#39;ratio&#39;</span>] = <span class="stringliteral">&#39;auto&#39;</span>
<a name="l00825"></a>00825     <span class="keywordflow">if</span> gdirec == <span class="stringliteral">&#39;RL&#39;</span>:
<a name="l00826"></a>00826         g.graph_attr[<span class="stringliteral">&#39;rankdir&#39;</span>] = <span class="stringliteral">&#39;RL&#39;</span>
<a name="l00827"></a>00827     <span class="keywordflow">elif</span> gdirec == <span class="stringliteral">&#39;LR&#39;</span>:
<a name="l00828"></a>00828         g.graph_attr[<span class="stringliteral">&#39;rankdir&#39;</span>] = <span class="stringliteral">&#39;LR&#39;</span>
<a name="l00829"></a>00829     <span class="keywordflow">else</span>:
<a name="l00830"></a>00830         <span class="keywordflow">pass</span>
<a name="l00831"></a>00831 
<a name="l00832"></a>00832     <span class="comment"># Set a few other graph properties.</span>
<a name="l00833"></a>00833     g.graph_attr[<span class="stringliteral">&#39;center&#39;</span>] = <span class="stringliteral">&#39;True&#39;</span>
<a name="l00834"></a>00834     g.graph_attr[<span class="stringliteral">&#39;concentrate&#39;</span>] = <span class="stringliteral">&#39;True&#39;</span>
<a name="l00835"></a>00835     g.graph_attr[<span class="stringliteral">&#39;fontsize&#39;</span>] = str(pedobj.kw[<span class="stringliteral">&#39;default_fontsize&#39;</span>])
<a name="l00836"></a>00836     g.graph_attr[<span class="stringliteral">&#39;ordering&#39;</span>] = <span class="stringliteral">&#39;out&#39;</span>
<a name="l00837"></a>00837 
<a name="l00838"></a>00838     <span class="keywordflow">for</span> _m <span class="keywordflow">in</span> pedobj.pedigree:
<a name="l00839"></a>00839         <span class="comment"># Add a node for the current animal and set some node properties.</span>
<a name="l00840"></a>00840         <span class="keywordflow">if</span> gname:
<a name="l00841"></a>00841             _node_name = _m.name
<a name="l00842"></a>00842         <span class="keywordflow">else</span>:
<a name="l00843"></a>00843             _node_name = _m.animalID
<a name="l00844"></a>00844         g.add_node(_node_name)
<a name="l00845"></a>00845         n = g.get_node(_node_name)
<a name="l00846"></a>00846         n.attr[<span class="stringliteral">&#39;shape&#39;</span>] = <span class="stringliteral">&#39;box&#39;</span>
<a name="l00847"></a>00847         n.attr[<span class="stringliteral">&#39;fontname&#39;</span>] = <span class="stringliteral">&#39;Helvetica&#39;</span>
<a name="l00848"></a>00848         n.attr[<span class="stringliteral">&#39;fontsize&#39;</span>] = str(pedobj.kw[<span class="stringliteral">&#39;default_fontsize&#39;</span>])
<a name="l00849"></a>00849         n.attr[<span class="stringliteral">&#39;height&#39;</span>] = <span class="stringliteral">&#39;0.35&#39;</span>
<a name="l00850"></a>00850         <span class="comment">#print &#39;[DEBUG]: sex = &#39;, _m.sex</span>
<a name="l00851"></a>00851         <span class="keywordflow">if</span> _m.sex == <span class="stringliteral">&#39;M&#39;</span> <span class="keywordflow">or</span> _m.sex == <span class="stringliteral">&#39;m&#39;</span>:
<a name="l00852"></a>00852             n.attr[<span class="stringliteral">&#39;shape&#39;</span>] = <span class="stringliteral">&#39;box&#39;</span>
<a name="l00853"></a>00853         <span class="keywordflow">elif</span> _m.sex == <span class="stringliteral">&#39;F&#39;</span> <span class="keywordflow">or</span> _m.sex == <span class="stringliteral">&#39;f&#39;</span>:
<a name="l00854"></a>00854             n.attr[<span class="stringliteral">&#39;shape&#39;</span>] = <span class="stringliteral">&#39;ellipse&#39;</span>
<a name="l00855"></a>00855         <span class="keywordflow">else</span>:
<a name="l00856"></a>00856             n.attr[<span class="stringliteral">&#39;shape&#39;</span>] = <span class="stringliteral">&#39;octagon&#39;</span>
<a name="l00857"></a>00857             <span class="comment">#pass</span>
<a name="l00858"></a>00858 
<a name="l00859"></a>00859         <span class="comment"># Add the edges to the parent nodes, if any.</span>
<a name="l00860"></a>00860         <span class="keywordflow">if</span> int(_m.sireID) != pedobj.kw[<span class="stringliteral">&#39;missing_parent&#39;</span>]:
<a name="l00861"></a>00861             <span class="keywordflow">if</span> gname:
<a name="l00862"></a>00862                 _sire_edge = pedobj.pedigree[int(_m.sireID)-1].name
<a name="l00863"></a>00863             <span class="keywordflow">else</span>:
<a name="l00864"></a>00864                 <span class="comment"># Check some outputs -- should I be using the animalID or the</span>
<a name="l00865"></a>00865                 <span class="comment"># originalID to assign edges? Nodes are based on the animalID,</span>
<a name="l00866"></a>00866                 <span class="comment"># so edges should also be in order to maintain consistency.</span>
<a name="l00867"></a>00867                 <span class="comment">#_sire_edge = pedobj.pedigree[int(_m.sireID)-1].originalID</span>
<a name="l00868"></a>00868                 _sire_edge = pedobj.pedigree[int(_m.sireID)-1].animalID
<a name="l00869"></a>00869             g.add_edge(_sire_edge,_node_name)
<a name="l00870"></a>00870             <span class="keywordflow">if</span> <span class="keywordflow">not</span> _tf[garrow]:
<a name="l00871"></a>00871                 <span class="comment">#e = g.get_edge(_sire_edge,_anim_node)</span>
<a name="l00872"></a>00872         e = g.get_edge(_sire_edge,n)
<a name="l00873"></a>00873                 e.attr[<span class="stringliteral">&#39;dir&#39;</span>] = <span class="stringliteral">&#39;none&#39;</span>
<a name="l00874"></a>00874         <span class="keywordflow">if</span> int(_m.damID) != pedobj.kw[<span class="stringliteral">&#39;missing_parent&#39;</span>]:
<a name="l00875"></a>00875             <span class="keywordflow">if</span> gname:
<a name="l00876"></a>00876                 _dam_edge = pedobj.pedigree[int(_m.damID)-1].name
<a name="l00877"></a>00877             <span class="keywordflow">else</span>:
<a name="l00878"></a>00878                 _dam_edge = pedobj.pedigree[int(_m.damID)-1].animalID
<a name="l00879"></a>00879             g.add_edge(_dam_edge,_node_name)
<a name="l00880"></a>00880             <span class="keywordflow">if</span> <span class="keywordflow">not</span> _tf[garrow]:
<a name="l00881"></a>00881                 <span class="comment">#e = g.get_edge(_dam_edge,_anim_node)</span>
<a name="l00882"></a>00882         e = g.get_edge(_dam_edge,n)
<a name="l00883"></a>00883                 e.attr[<span class="stringliteral">&#39;dir&#39;</span>] = <span class="stringliteral">&#39;none&#39;</span>
<a name="l00884"></a>00884 
<a name="l00885"></a>00885     <span class="comment"># For large graphs it is nice to write out the .dot file so that it does</span>
<a name="l00886"></a>00886     <span class="comment"># not have to be recreated whenever new_draw_pedigree is called.</span>
<a name="l00887"></a>00887     <span class="comment"># Especially when I am debugging.</span>
<a name="l00888"></a>00888     <span class="keywordflow">if</span> gdot:
<a name="l00889"></a>00889         dfn = <span class="stringliteral">&#39;%s.dot&#39;</span> % (gfilename)
<a name="l00890"></a>00890         <span class="keywordflow">try</span>:
<a name="l00891"></a>00891             g.write(dfn)
<a name="l00892"></a>00892         <span class="keywordflow">except</span>:
<a name="l00893"></a>00893             <span class="keywordflow">if</span> pedobj.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span>:
<a name="l00894"></a>00894                 <span class="keywordflow">print</span> <span class="stringliteral">&#39;[ERROR]: pyp_graphics/new_draw_pedigree() was unable to write the dotfile %s.&#39;</span> % (dfn)
<a name="l00895"></a>00895             logging.error(<span class="stringliteral">&#39;pyp_graphics/new_draw_pedigree() was unable to draw the dotfile %s.&#39;</span>, (dfn))
<a name="l00896"></a>00896 
<a name="l00897"></a>00897     <span class="comment"># Write the graph to an output file.</span>
<a name="l00898"></a>00898     <span class="keywordflow">try</span>:
<a name="l00899"></a>00899         outfile = <span class="stringliteral">&#39;%s.%s&#39;</span> % (gfilename,gformat)
<a name="l00900"></a>00900         g.draw(outfile,prog=gprog)
<a name="l00901"></a>00901         <span class="keywordflow">return</span> 1
<a name="l00902"></a>00902     <span class="keywordflow">except</span>:
<a name="l00903"></a>00903         outfile = <span class="stringliteral">&#39;%s.%s&#39;</span> % (gfilename,gformat)
<a name="l00904"></a>00904         <span class="keywordflow">if</span> pedobj.kw[<span class="stringliteral">&#39;messages&#39;</span>] == <span class="stringliteral">&#39;verbose&#39;</span>:
<a name="l00905"></a>00905             <span class="keywordflow">print</span> <span class="stringliteral">&#39;[ERROR]: pyp_graphics/new_draw_pedigree() was unable to draw the pedigree %s.&#39;</span> % (outfile)
<a name="l00906"></a>00906         logging.error(<span class="stringliteral">&#39;pyp_graphics/new_draw_pedigree() was unable to draw the pedigree %s.&#39;</span>, (outfile))
<a name="l00907"></a>00907         <span class="keywordflow">return</span> 0
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Fri Jul 6 2012 17:02:57 for PyPedal by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </small></address>
</body>
</html>
