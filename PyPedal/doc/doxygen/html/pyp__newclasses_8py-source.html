<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>PyPedal: PyPedal/pyp_newclasses.py Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.7 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="namespaces.html"><span>Packages</span></a></li>
    <li><a href="classes.html"><span>Classes</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
  </ul></div>
<h1>PyPedal/pyp_newclasses.py</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a><a class="code" href="namespacePyPedal_1_1pyp__newclasses.html">00001</a> <span class="comment">#!/usr/bin/python</span>
<a name="l00002"></a>00002 
<a name="l00003"></a>00003 <span class="comment">###############################################################################</span>
<a name="l00004"></a>00004 <span class="comment"># NAME: pyp_newclasses.py</span>
<a name="l00005"></a>00005 <span class="comment"># VERSION: 2.0.0rc9 (01SEPTEMBER2010)</span>
<a name="l00006"></a>00006 <span class="comment"># AUTHOR: John B. Cole, PhD (john.cole@ars.usda.gov)</span>
<a name="l00007"></a>00007 <span class="comment"># LICENSE: LGPL</span>
<a name="l00008"></a>00008 <span class="comment">###############################################################################</span>
<a name="l00009"></a>00009 
<a name="l00010"></a>00010 <span class="comment">## @package pyp_newclasses</span>
<a name="l00011"></a>00011 <span class="comment"># pyp_newclasses contains the new class structure that will be a part of PyPedal 2.0.0Final.</span>
<a name="l00012"></a>00012 <span class="comment"># It includes a master class to which most of the computational routines will be bound as</span>
<a name="l00013"></a>00013 <span class="comment"># methods, a NewAnimal() class, and a PedigreeMetadata() class.</span>
<a name="l00014"></a>00014 <span class="comment">##</span>
<a name="l00015"></a>00015 
<a name="l00016"></a>00016 <span class="keyword">import</span> cPickle
<a name="l00017"></a>00017 <span class="keyword">import</span> logging
<a name="l00018"></a>00018 <span class="keyword">import</span> numpy
<a name="l00019"></a>00019 <span class="keyword">import</span> os
<a name="l00020"></a>00020 <span class="keyword">import</span> string
<a name="l00021"></a>00021 <span class="keyword">import</span> sys
<a name="l00022"></a>00022 
<a name="l00023"></a>00023 <span class="comment"># Import the other pieces of PyPedal.  This will probably go away as most of these are rolled into</span>
<a name="l00024"></a>00024 <span class="comment"># NewPedigree as methods.</span>
<a name="l00025"></a>00025 <span class="keyword">import</span> pyp_db
<a name="l00026"></a>00026 <span class="keyword">import</span> pyp_demog
<a name="l00027"></a>00027 <span class="keyword">import</span> pyp_io
<a name="l00028"></a>00028 <span class="keyword">import</span> pyp_metrics
<a name="l00029"></a>00029 <span class="keyword">import</span> pyp_nrm
<a name="l00030"></a>00030 <span class="keyword">import</span> pyp_utils
<a name="l00031"></a>00031 
<a name="l00032"></a>00032 <span class="keywordflow">try</span>:
<a name="l00033"></a>00033     <span class="keyword">from</span> psyco.classes <span class="keyword">import</span> __metaclass__
<a name="l00034"></a>00034 <span class="keywordflow">except</span> ImportError:
<a name="l00035"></a>00035     <span class="keywordflow">pass</span>
<a name="l00036"></a>00036 
<a name="l00037"></a>00037 <span class="comment">##</span>
<a name="l00038"></a>00038 <span class="comment"># The NewPedigree class is the main data structure for PyP 2.0.0Final.</span>
<a name="l00039"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html">00039</a> <span class="keyword">class </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html">NewPedigree</a>:
<a name="l00040"></a>00040     <span class="comment">##</span>
<a name="l00041"></a>00041     <span class="comment"># __init__() initializes a NewPedigree object.</span>
<a name="l00042"></a>00042     <span class="comment"># @param self Reference to the current NewPedigree() object</span>
<a name="l00043"></a>00043     <span class="comment"># @param kw A dictionary of options.</span>
<a name="l00044"></a>00044     <span class="comment"># @param kwfile An optionsl configuration file name</span>
<a name="l00045"></a>00045     <span class="comment"># @retval An instance of a NewPedigree() object</span>
<a name="l00046"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#1d0bdd21665932e4601f304d1da4c948">00046</a>     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#1d0bdd21665932e4601f304d1da4c948">__init__</a>(self, kw={}, kwfile='pypedal.ini'):
<a name="l00047"></a>00047         <span class="stringliteral">"""</span>
<a name="l00048"></a>00048 <span class="stringliteral">        __init__() initializes a NewPedigree object.</span>
<a name="l00049"></a>00049 <span class="stringliteral">        """</span>
<a name="l00050"></a>00050 
<a name="l00051"></a>00051         <span class="comment"># This hacks-in support for configuration files.  This is not</span>
<a name="l00052"></a>00052         <span class="comment"># a perfect solution because it can let a naked exception</span>
<a name="l00053"></a>00053         <span class="comment"># propagate back to the used, but __init__() methods can only</span>
<a name="l00054"></a>00054         <span class="comment"># return None, so there is no nice way to pass back a message</span>
<a name="l00055"></a>00055         <span class="comment"># if an exception is thrown.  If dict4ini.DictIni(kwfile) fails,</span>
<a name="l00056"></a>00056         <span class="comment"># then kw will be an empty dictionary.  The user will only see</span>
<a name="l00057"></a>00057         <span class="comment"># this when the load() method is called on the NewPedigree</span>
<a name="l00058"></a>00058         <span class="comment"># instance.</span>
<a name="l00059"></a>00059         <span class="keywordflow">if</span> len(kw) == 0:
<a name="l00060"></a>00060             <span class="keyword">import</span> dict4ini
<a name="l00061"></a>00061             kw = dict4ini.DictIni(kwfile)
<a name="l00062"></a>00062             <span class="keywordflow">if</span> kw == {}:
<a name="l00063"></a>00063                 <span class="keywordflow">print</span> <span class="stringliteral">'[ERROR]: pyp_newclasses.NewPedigree.__init__() was unable to load a configuration file named %s!'</span> % ( kwfile )
<a name="l00064"></a>00064                 <span class="keyword">import</span> sys
<a name="l00065"></a>00065                 sys.exit(0)
<a name="l00066"></a>00066             <span class="comment"># The dict method converts the Dict4Ini object to an actual</span>
<a name="l00067"></a>00067             <span class="comment"># Python dictionary.</span>
<a name="l00068"></a>00068 <span class="comment">#             print 'Starting kw: %s' % ( kw )</span>
<a name="l00069"></a>00069             kw = kw.dict()
<a name="l00070"></a>00070             <span class="comment">#print 'Starting kw: %s' % ( kw )</span>
<a name="l00071"></a>00071 
<a name="l00072"></a>00072         <span class="comment"># Handle the Main Keywords.</span>
<a name="l00073"></a>00073 
<a name="l00074"></a>00074         <span class="comment"># Here are the keywords used for simulating pedigrees.  We need to</span>
<a name="l00075"></a>00075         <span class="comment"># set simulate_pedigree before we do anything else; if the user</span>
<a name="l00076"></a>00076         <span class="comment"># wants to simulate a pedigree they do not need to provide a</span>
<a name="l00077"></a>00077         <span class="comment"># pedfile.</span>
<a name="l00078"></a>00078         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">'simulate_pedigree'</span>): kw[<span class="stringliteral">'simulate_pedigree'</span>] = 0
<a name="l00079"></a>00079         <span class="keywordflow">if</span> kw[<span class="stringliteral">'simulate_pedigree'</span>]:
<a name="l00080"></a>00080             <span class="comment"># These defaults will produce a three-generation pedigree</span>
<a name="l00081"></a>00081             <span class="comment"># in which each sire and dam has a single progeny.</span>
<a name="l00082"></a>00082             <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">'simulate_n'</span>): kw[<span class="stringliteral">'simulate_n'</span>] = 15
<a name="l00083"></a>00083             <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">'simulate_g'</span>): kw[<span class="stringliteral">'simulate_g'</span>] = 3
<a name="l00084"></a>00084             <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">'simulate_ns'</span>): kw[<span class="stringliteral">'simulate_ns'</span>] = 4
<a name="l00085"></a>00085             <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">'simulate_nd'</span>): kw[<span class="stringliteral">'simulate_nd'</span>] = 4
<a name="l00086"></a>00086             <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">'simulate_mp'</span>): kw[<span class="stringliteral">'simulate_mp'</span>] = 0
<a name="l00087"></a>00087             <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">'simulate_po'</span>): kw[<span class="stringliteral">'simulate_po'</span>] = 0
<a name="l00088"></a>00088             <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">'simulate_fs'</span>): kw[<span class="stringliteral">'simulate_fs'</span>] = 0
<a name="l00089"></a>00089             <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">'simulate_sr'</span>): kw[<span class="stringliteral">'simulate_sr'</span>] = 0.5
<a name="l00090"></a>00090             <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">'simulate_ir'</span>): kw[<span class="stringliteral">'simulate_ir'</span>] = 0.0
<a name="l00091"></a>00091             <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">'simulate_pmd'</span>): kw[<span class="stringliteral">'simulate_pmd'</span>] = 100
<a name="l00092"></a>00092             <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">'simulate_save'</span>): kw[<span class="stringliteral">'simulate_save'</span>] = 0
<a name="l00093"></a>00093         <span class="keywordflow">else</span>:
<a name="l00094"></a>00094             <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">'pedfile'</span>): <span class="keywordflow">raise</span> PyPedalPedigreeInputFileNameError
<a name="l00095"></a>00095         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">'pedformat'</span>): kw[<span class="stringliteral">'pedformat'</span>] = <span class="stringliteral">'asd'</span>
<a name="l00096"></a>00096         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">'pedname'</span>): kw[<span class="stringliteral">'pedname'</span>] = <span class="stringliteral">'Untitled'</span>
<a name="l00097"></a>00097         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">'messages'</span>): kw[<span class="stringliteral">'messages'</span>] = <span class="stringliteral">'verbose'</span>
<a name="l00098"></a>00098         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">'renumber'</span>): kw[<span class="stringliteral">'renumber'</span>] = 1
<a name="l00099"></a>00099         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">'reorder'</span>): kw[<span class="stringliteral">'reorder'</span>] = 0
<a name="l00100"></a>00100         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">'reorder_max_rounds'</span>): kw[<span class="stringliteral">'reorder_max_rounds'</span>] = 100
<a name="l00101"></a>00101         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">'pedigree_is_renumbered'</span>): kw[<span class="stringliteral">'pedigree_is_renumbered'</span>] = 0
<a name="l00102"></a>00102         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">'set_generations'</span>): kw[<span class="stringliteral">'set_generations'</span>] = 0
<a name="l00103"></a>00103         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">'gen_coeff'</span>): kw[<span class="stringliteral">'gen_coeff'</span>] = 0
<a name="l00104"></a>00104         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">'set_ancestors'</span>): kw[<span class="stringliteral">'set_ancestors'</span>] = 0
<a name="l00105"></a>00105         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">'set_alleles'</span>): kw[<span class="stringliteral">'set_alleles'</span>] = 0
<a name="l00106"></a>00106         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">'set_offspring'</span>): kw[<span class="stringliteral">'set_offspring'</span>] = 0
<a name="l00107"></a>00107         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">'set_sexes'</span>): kw[<span class="stringliteral">'set_sexes'</span>] = 0
<a name="l00108"></a>00108         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">'pedcomp'</span>): kw[<span class="stringliteral">'pedcomp'</span>] = 0
<a name="l00109"></a>00109         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">'pedcomp_gens'</span>): kw[<span class="stringliteral">'pedcomp_gens'</span>] = 3
<a name="l00110"></a>00110         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">'sepchar'</span>): kw[<span class="stringliteral">'sepchar'</span>] = <span class="stringliteral">' '</span>
<a name="l00111"></a>00111         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">'alleles_sepchar'</span>): kw[<span class="stringliteral">'alleles_sepchar'</span>] = <span class="stringliteral">'/'</span>
<a name="l00112"></a>00112         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">'counter'</span>): kw[<span class="stringliteral">'counter'</span>] = 1000
<a name="l00113"></a>00113         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">'slow_reorder'</span>): kw[<span class="stringliteral">'slow_reorder'</span>] = 1
<a name="l00114"></a>00114         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">'missing_bdate'</span>): kw[<span class="stringliteral">'missing_bdate'</span>] = <span class="stringliteral">'01011900'</span>
<a name="l00115"></a>00115         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">'missing_byear'</span>): kw[<span class="stringliteral">'missing_byear'</span>] = 1900
<a name="l00116"></a>00116         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">'missing_parent'</span>): kw[<span class="stringliteral">'missing_parent'</span>] = 0
<a name="l00117"></a>00117         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">'missing_name'</span>): kw[<span class="stringliteral">'missing_name'</span>] = <span class="stringliteral">'Unknown Name'</span>
<a name="l00118"></a>00118         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">'missing_breed'</span>): kw[<span class="stringliteral">'missing_breed'</span>] = <span class="stringliteral">'Unknown Breed'</span>
<a name="l00119"></a>00119         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">'missing_herd'</span>): kw[<span class="stringliteral">'missing_herd'</span>] = <span class="stringliteral">'Unknown Herd'</span>
<a name="l00120"></a>00120         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">'missing_sex'</span>): kw[<span class="stringliteral">'missing_sex'</span>] = <span class="stringliteral">'</span><span class="stringliteral">u'</span>
<a name="l00121"></a>00121 <span class="stringliteral">        </span><span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">'file_io'</span>): kw[<span class="stringliteral">'file_io'</span>] = <span class="stringliteral">'1'</span>
<a name="l00122"></a>00122         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">'debug_messages'</span>): kw[<span class="stringliteral">'debug_messages'</span>] = 0
<a name="l00123"></a>00123         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">'form_nrm'</span>): kw[<span class="stringliteral">'form_nrm'</span>] = 0
<a name="l00124"></a>00124         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">'nrm_method'</span>): kw[<span class="stringliteral">'nrm_method'</span>] = <span class="stringliteral">'nrm'</span>
<a name="l00125"></a>00125         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">'nrm_format'</span>): kw[<span class="stringliteral">'nrm_format'</span>] = <span class="stringliteral">'text'</span>
<a name="l00126"></a>00126         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">'f_computed'</span>): kw[<span class="stringliteral">'f_computed'</span>] = 0
<a name="l00127"></a>00127         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">'log_ped_lines'</span>): kw[<span class="stringliteral">'log_ped_lines'</span>] = 0
<a name="l00128"></a>00128         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">'log_long_filenames'</span>): kw[<span class="stringliteral">'log_long_filenames'</span>] = 0
<a name="l00129"></a>00129         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">'pedigree_summary'</span>): kw[<span class="stringliteral">'pedigree_summary'</span>] = 1
<a name="l00130"></a>00130         <span class="keywordflow">if</span> kw[<span class="stringliteral">'pedigree_summary'</span>] <span class="keywordflow">not</span> <span class="keywordflow">in</span> [0,1,2]:
<a name="l00131"></a>00131             kw[<span class="stringliteral">'pedigree_summary'</span>] = 1
<a name="l00132"></a>00132         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">'animal_type'</span>): kw[<span class="stringliteral">'animal_type'</span>] = <span class="stringliteral">'new'</span>
<a name="l00133"></a>00133         <span class="keywordflow">if</span> kw[<span class="stringliteral">'animal_type'</span>] <span class="keywordflow">not</span> <span class="keywordflow">in</span> [<span class="stringliteral">'new'</span>,<span class="stringliteral">'light'</span>]:
<a name="l00134"></a>00134             kw[<span class="stringliteral">'animal_type'</span>] = <span class="stringliteral">'new'</span>
<a name="l00135"></a>00135         <span class="keywordflow">if</span> <span class="stringliteral">'f'</span> <span class="keywordflow">in</span> kw[<span class="stringliteral">'pedformat'</span>]:
<a name="l00136"></a>00136             kw[<span class="stringliteral">'f_computed'</span>] = 1
<a name="l00137"></a>00137         <span class="comment"># We have to check for the pedfile key in case this is a</span>
<a name="l00138"></a>00138         <span class="comment"># simulated pedigree, which does not have a pedfile.</span>
<a name="l00139"></a>00139         <span class="keywordflow">if</span> kw[<span class="stringliteral">'simulate_pedigree'</span>]:
<a name="l00140"></a>00140             kw[<span class="stringliteral">'pedfile'</span>] = <span class="stringliteral">'simulated_pedigree'</span>
<a name="l00141"></a>00141         kw[<span class="stringliteral">'filetag'</span>] = string.split(kw[<span class="stringliteral">'pedfile'</span>],<span class="stringliteral">'.'</span>)[0]
<a name="l00142"></a>00142         <span class="keywordflow">if</span> len(kw[<span class="stringliteral">'filetag'</span>]) == 0:
<a name="l00143"></a>00143             kw[<span class="stringliteral">'filetag'</span>] = <span class="stringliteral">'untitled_pedigree'</span>
<a name="l00144"></a>00144         <span class="comment"># The database name and default database table name are needed by pyp_db.</span>
<a name="l00145"></a>00145         <span class="comment"># If the defaults are not overridden 'pypedal' and the filetag are used</span>
<a name="l00146"></a>00146         <span class="comment"># for the defaults, respectively.</span>
<a name="l00147"></a>00147         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">'database_name'</span>): kw[<span class="stringliteral">'database_name'</span>] = <span class="stringliteral">'pypedal'</span>
<a name="l00148"></a>00148         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">'database_table'</span>):
<a name="l00149"></a>00149             kw[<span class="stringliteral">'database_table'</span>] = pyp_utils.string_to_table_name(kw[<span class="stringliteral">'filetag'</span>])
<a name="l00150"></a>00150         <span class="keywordflow">else</span>:
<a name="l00151"></a>00151             kw[<span class="stringliteral">'database_table'</span>] = pyp_utils.string_to_table_name(kw[<span class="stringliteral">'database_table'</span>])
<a name="l00152"></a>00152         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">'database_debug'</span>): kw[<span class="stringliteral">'database_debug'</span>] = <span class="keyword">False</span>
<a name="l00153"></a>00153         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">'database_type'</span>): kw[<span class="stringliteral">'database_type'</span>] = <span class="stringliteral">'sqlite'</span>
<a name="l00154"></a>00154         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">'database_host'</span>): kw[<span class="stringliteral">'database_host'</span>] = <span class="stringliteral">'localhost'</span>
<a name="l00155"></a>00155         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">'database_user'</span>): kw[<span class="stringliteral">'database_user'</span>] = <span class="stringliteral">'anonymous'</span>
<a name="l00156"></a>00156         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">'database_passwd'</span>): kw[<span class="stringliteral">'database_passwd'</span>] = <span class="stringliteral">'anonymous'</span>
<a name="l00157"></a>00157         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">'database_port'</span>): kw[<span class="stringliteral">'database_port'</span>] = <span class="stringliteral">''</span>
<a name="l00158"></a>00158         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">'database_sql'</span>): kw[<span class="stringliteral">'database_sql'</span>] = <span class="stringliteral">'SELECT * FROM %s'</span>
<a name="l00159"></a>00159     <span class="comment"># This keyword is used by pyp_nrm/fast_a-Matrix() to determine if the diagonals</span>
<a name="l00160"></a>00160     <span class="comment"># of the relationship matrix should be augmented by founder coefficients of</span>
<a name="l00161"></a>00161     <span class="comment"># inbreeding or not. This is disabled by default.</span>
<a name="l00162"></a>00162     <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">'foundercoi'</span>): kw[<span class="stringliteral">'foundercoi'</span>] = 0
<a name="l00163"></a>00163         <span class="keywordflow">if</span> kw[<span class="stringliteral">'foundercoi'</span>] <span class="keywordflow">not</span> <span class="keywordflow">in</span> [0, 1]: kw[<span class="stringliteral">'foundercoi'</span>] = 0
<a name="l00164"></a>00164         <span class="comment"># If the user provides a paper size make sure that it is a supported value.</span>
<a name="l00165"></a>00165         <span class="comment"># Right now, only a4 and letter are supported.  Note that 'a4' is silently</span>
<a name="l00166"></a>00166         <span class="comment"># changed to 'A4' because ReportLab is case-sensitive.  Also handle setting</span>
<a name="l00167"></a>00167         <span class="comment"># the defualt unit of measurement.</span>
<a name="l00168"></a>00168         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">'paper_size'</span>): kw[<span class="stringliteral">'paper_size'</span>] = <span class="stringliteral">'letter'</span>
<a name="l00169"></a>00169         <span class="keywordflow">if</span> kw[<span class="stringliteral">'paper_size'</span>] == <span class="stringliteral">'a4'</span>:
<a name="l00170"></a>00170             kw[<span class="stringliteral">'paper_size'</span>] = <span class="stringliteral">'A4'</span>
<a name="l00171"></a>00171         <span class="keywordflow">if</span> kw[<span class="stringliteral">'paper_size'</span>] <span class="keywordflow">not</span> <span class="keywordflow">in</span> [<span class="stringliteral">'A4'</span>,<span class="stringliteral">'letter'</span>]:
<a name="l00172"></a>00172             kw[<span class="stringliteral">'paper_size'</span>] = <span class="stringliteral">'letter'</span>
<a name="l00173"></a>00173         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">'default_unit'</span>): kw[<span class="stringliteral">'default_unit'</span>] = <span class="stringliteral">'inch'</span>
<a name="l00174"></a>00174         <span class="keywordflow">if</span> kw[<span class="stringliteral">'default_unit'</span>] <span class="keywordflow">not</span> <span class="keywordflow">in</span> [<span class="stringliteral">'cm'</span>,<span class="stringliteral">'inch'</span>]:
<a name="l00175"></a>00175             kw[<span class="stringliteral">'default_unit'</span>] = <span class="stringliteral">'inch'</span>
<a name="l00176"></a>00176         <span class="comment"># Defining the default font size to be used in graphs as a keyword</span>
<a name="l00177"></a>00177         <span class="comment"># saces some cruft in pyp_graphics and makes it easier for the user</span>
<a name="l00178"></a>00178         <span class="comment"># to understand what is going on.</span>
<a name="l00179"></a>00179         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">'default_fontsize'</span>): kw[<span class="stringliteral">'default_fontsize'</span>] = 10
<a name="l00180"></a>00180         <span class="keywordflow">try</span>:
<a name="l00181"></a>00181             kw[<span class="stringliteral">'default_fontsize'</span>] = int(kw[<span class="stringliteral">'default_fontsize'</span>])
<a name="l00182"></a>00182         <span class="keywordflow">except</span>:
<a name="l00183"></a>00183             kw[<span class="stringliteral">'default_fontsize'</span>] = 10
<a name="l00184"></a>00184         <span class="keywordflow">if</span> kw[<span class="stringliteral">'default_fontsize'</span>] &lt; 1:
<a name="l00185"></a>00185             kw[<span class="stringliteral">'default_fontsize'</span>] = 10
<a name="l00186"></a>00186         <span class="comment"># default_report is used by pyp_reports as a root name when writing</span>
<a name="l00187"></a>00187         <span class="comment"># reports to files.</span>
<a name="l00188"></a>00188         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">'default_report'</span>): kw[<span class="stringliteral">'default_report'</span>] = kw[<span class="stringliteral">'filetag'</span>]
<a name="l00189"></a>00189         <span class="comment"># This is a hack to fix it so that the inbreeding routines in</span>
<a name="l00190"></a>00190         <span class="comment"># pyp_nrm can be told to use sparse matrices when necessary.</span>
<a name="l00191"></a>00191         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">'matrix_type'</span>): kw[<span class="stringliteral">'matrix_type'</span>] = <span class="stringliteral">'dense'</span>
<a name="l00192"></a>00192         <span class="keywordflow">if</span> kw[<span class="stringliteral">'matrix_type'</span>] <span class="keywordflow">not</span> <span class="keywordflow">in</span> [<span class="stringliteral">'dense'</span>,<span class="stringliteral">'sparse'</span>]:
<a name="l00193"></a>00193             kw[<span class="stringliteral">'matrix_type'</span>] = <span class="stringliteral">'dense'</span>
<a name="l00194"></a>00194 
<a name="l00195"></a>00195         <span class="comment">### This is for internal use only! I left it out of the documentation</span>
<a name="l00196"></a>00196         <span class="comment">### on purpose so that people won't break things with it.</span>
<a name="l00197"></a>00197         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">'newanimal_caller'</span>): kw[<span class="stringliteral">'newanimal_caller'</span>] = <span class="stringliteral">'loader'</span>
<a name="l00198"></a>00198 
<a name="l00199"></a>00199         <span class="comment"># Now that we have processed all of the arguments in the options dictionary</span>
<a name="l00200"></a>00200         <span class="comment"># we need to attach it to this object.</span>
<a name="l00201"></a>00201 <span class="comment">#         print 'Ending kw: %s' % ( kw )</span>
<a name="l00202"></a>00202         self.kw = kw
<a name="l00203"></a>00203 
<a name="l00204"></a>00204         <span class="comment"># Initialize the Big Main Data Structures to null values</span>
<a name="l00205"></a>00205         self.pedigree = []                         <span class="comment"># We may start storing animals in a dictionary rather than in a list.  Maybe,</span>
<a name="l00206"></a>00206         self.metadata = {}                         <span class="comment"># Metadata will also be stored in a dictionary.</span>
<a name="l00207"></a>00207         self.idmap = {}                            <span class="comment"># Used to map between original and renumbered IDs.</span>
<a name="l00208"></a>00208         self.backmap = {}                          <span class="comment"># Used to map between renumbered and original IDs.</span>
<a name="l00209"></a>00209         self.namemap = {}                           <span class="comment"># This is needed to map IDs to names when IDs are read using the string formats (ASD).</span>
<a name="l00210"></a>00210         self.backmap = {}
<a name="l00211"></a>00211     self.namebackmap = {}
<a name="l00212"></a>00212         self.stringmap = {}                         <span class="comment"># Maps original IDs to names in ASD pedigrees</span>
<a name="l00213"></a>00213         <span class="comment"># Maybe these will go in a configuration file later</span>
<a name="l00214"></a>00214         self.starline = <span class="stringliteral">'*'</span>*80
<a name="l00215"></a>00215     <span class="comment"># This is the list of valid pedformat codes</span>
<a name="l00216"></a>00216         self.pedformat_codes = [<span class="stringliteral">'a'</span>,<span class="stringliteral">'s'</span>,<span class="stringliteral">'d'</span>,<span class="stringliteral">'g'</span>,<span class="stringliteral">'x'</span>,<span class="stringliteral">'b'</span>,<span class="stringliteral">'f'</span>,<span class="stringliteral">'</span><span class="stringliteral">r','</span>n','y','l','e','p','A','S','D','L','Z','h','H','<span class="stringliteral">u']</span>
<a name="l00217"></a>00217 <span class="stringliteral">    </span><span class="comment"># This dictionary maps pedformat codes to NewAnimal attributes</span>
<a name="l00218"></a>00218     self.new_animal_attr = {
<a name="l00219"></a>00219         <span class="stringliteral">'a'</span>: <span class="stringliteral">'animalID'</span>,
<a name="l00220"></a>00220         <span class="stringliteral">'s'</span>: <span class="stringliteral">'sireID'</span>,
<a name="l00221"></a>00221         <span class="stringliteral">'d'</span>: <span class="stringliteral">'damID'</span>,
<a name="l00222"></a>00222         <span class="stringliteral">'g'</span>: <span class="stringliteral">'generation'</span>,
<a name="l00223"></a>00223         <span class="stringliteral">'x'</span>: <span class="stringliteral">'sex'</span>,
<a name="l00224"></a>00224         <span class="stringliteral">'b'</span>: <span class="stringliteral">'bd'</span>,
<a name="l00225"></a>00225         <span class="stringliteral">'f'</span>: <span class="stringliteral">'fa'</span>,
<a name="l00226"></a>00226         <span class="stringliteral">'</span><span class="stringliteral">r': '</span>breed',
<a name="l00227"></a>00227         <span class="stringliteral">'n'</span>: <span class="stringliteral">'name'</span>,
<a name="l00228"></a>00228         <span class="stringliteral">'y'</span>: <span class="stringliteral">'by'</span>,
<a name="l00229"></a>00229         <span class="stringliteral">'l'</span>: <span class="stringliteral">'alive'</span>,
<a name="l00230"></a>00230         <span class="stringliteral">'e'</span>: <span class="stringliteral">'age'</span>,
<a name="l00231"></a>00231         <span class="stringliteral">'p'</span>: <span class="stringliteral">'gencoeff'</span>,
<a name="l00232"></a>00232         <span class="stringliteral">'A'</span>: <span class="stringliteral">'name'</span>,
<a name="l00233"></a>00233         <span class="stringliteral">'S'</span>: <span class="stringliteral">'sireName'</span>,
<a name="l00234"></a>00234         <span class="stringliteral">'D'</span>: <span class="stringliteral">'damName'</span>,
<a name="l00235"></a>00235         <span class="stringliteral">'L'</span>: <span class="stringliteral">'alleles'</span>,
<a name="l00236"></a>00236         <span class="stringliteral">'Z'</span>: <span class="keyword">False</span>,
<a name="l00237"></a>00237         <span class="stringliteral">'h'</span>: <span class="stringliteral">'herd'</span>,
<a name="l00238"></a>00238         <span class="stringliteral">'H'</span>: <span class="stringliteral">'originalHerd'</span>,
<a name="l00239"></a>00239         <span class="stringliteral">'</span><span class="stringliteral">u': '</span>userfield',
<a name="l00240"></a>00240     }
<a name="l00241"></a>00241         <span class="comment"># Start logging!</span>
<a name="l00242"></a>00242         <span class="keywordflow">if</span> <span class="keywordflow">not</span> self.kw.has_key(<span class="stringliteral">'logfile'</span>):
<a name="l00243"></a>00243             <span class="keywordflow">if</span> kw[<span class="stringliteral">'log_long_filenames'</span>]:
<a name="l00244"></a>00244                 self.kw[<span class="stringliteral">'logfile'</span>] = <span class="stringliteral">'%s_%s.log'</span> % ( self.kw[<span class="stringliteral">'filetag'</span>], pyp_utils.pyp_datestamp() )
<a name="l00245"></a>00245             <span class="keywordflow">else</span>:
<a name="l00246"></a>00246                 self.kw[<span class="stringliteral">'logfile'</span>] = <span class="stringliteral">'%s.log'</span> % ( self.kw[<span class="stringliteral">'filetag'</span>] )
<a name="l00247"></a>00247         logging.basicConfig(level=logging.DEBUG, format=<span class="stringliteral">'%(asctime)s %(levelname)-8s %(message)s'</span>, datefmt=<span class="stringliteral">'%a, %d %b %Y %H:%M:%S'</span>, filename=self.kw[<span class="stringliteral">'logfile'</span>], filemode=<span class="stringliteral">'w'</span>)
<a name="l00248"></a>00248         logging.info(<span class="stringliteral">'Logfile %s instantiated.'</span>,self.kw[<span class="stringliteral">'logfile'</span>])
<a name="l00249"></a>00249         <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span> <span class="keywordflow">and</span> self.kw[<span class="stringliteral">'pedigree_summary'</span>]:
<a name="l00250"></a>00250             <span class="keywordflow">print</span> <span class="stringliteral">'[INFO]: Logfile %s instantiated.'</span> % (self.kw[<span class="stringliteral">'logfile'</span>])
<a name="l00251"></a>00251         <span class="comment"># Deal with abberant cases of log_ped_lines here.</span>
<a name="l00252"></a>00252         <span class="keywordflow">try</span>:
<a name="l00253"></a>00253             _lpl = kw[<span class="stringliteral">'log_ped_lines'</span>]
<a name="l00254"></a>00254             kw[<span class="stringliteral">'log_ped_lines'</span>] = int(kw[<span class="stringliteral">'log_ped_lines'</span>])
<a name="l00255"></a>00255         <span class="keywordflow">except</span> ValueError:
<a name="l00256"></a>00256             kw[<span class="stringliteral">'log_ped_lines'</span>] = 0
<a name="l00257"></a>00257             log.warning(<span class="stringliteral">'An incorrect value (%s) was provided for the option log_ped_lines, which must be a number greater than or equal 0.  It has been set to 0.'</span>, _lpl)
<a name="l00258"></a>00258         <span class="keywordflow">if</span>  kw[<span class="stringliteral">'log_ped_lines'</span>] &lt; 0:
<a name="l00259"></a>00259             kw[<span class="stringliteral">'log_ped_lines'</span>] = 0
<a name="l00260"></a>00260             log.warning(<span class="stringliteral">'A negative value (%s) was provided for the option log_ped_lines, which must be greater than or equal 0.  It has been set to 0.'</span>, kw[<span class="stringliteral">'log_ped_lines'</span>])
<a name="l00261"></a>00261 
<a name="l00262"></a>00262     <span class="comment">##</span>
<a name="l00263"></a>00263     <span class="comment"># load() wraps several processes useful for loading and preparing a pedigree for</span>
<a name="l00264"></a>00264     <span class="comment"># use in an analysis, including reading the animals into a list of animal objects,</span>
<a name="l00265"></a>00265     <span class="comment"># forming lists of sires and dams, checking for common errors, setting ancestor</span>
<a name="l00266"></a>00266     <span class="comment"># flags, and renumbering the pedigree.</span>
<a name="l00267"></a>00267     <span class="comment"># @param self Reference to current object.</span>
<a name="l00268"></a>00268     <span class="comment"># @param pedsource Source of the pedigree ('file'|'graph'|'graphfile'|'db').</span>
<a name="l00269"></a>00269     <span class="comment"># @param pedgraph XDiGraph from which to load the pedigree.</span>
<a name="l00270"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#d77aa12ad18ca97147caa79ab3092452">00270</a>     <span class="comment"># @param pedstream Stream of text from which to load the pedigree.</span>
<a name="l00271"></a>00271     <span class="comment"># @retval None</span>
<a name="l00272"></a>00272     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#d77aa12ad18ca97147caa79ab3092452">load</a>(self, pedsource='file', pedgraph=0, pedstream=''):
<a name="l00273"></a>00273         <span class="stringliteral">"""</span>
<a name="l00274"></a>00274 <span class="stringliteral">        load() wraps several processes useful for loading and preparing a pedigree for</span>
<a name="l00275"></a>00275 <span class="stringliteral">        use in an analysis, including reading the animals into a list of animal objects,</span>
<a name="l00276"></a>00276 <span class="stringliteral">        forming lists of sires and dams, checking for common errors, setting ancestor</span>
<a name="l00277"></a>00277 <span class="stringliteral">        flags, and renumbering the pedigree.</span>
<a name="l00278"></a>00278 <span class="stringliteral">        """</span>
<a name="l00279"></a>00279         <span class="comment"># If the user wants to simulate a pedigree we don't need to</span>
<a name="l00280"></a>00280         <span class="comment"># call self.preprocess(), which loads pedigrees from files.</span>
<a name="l00281"></a>00281         <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'simulate_pedigree'</span>]:
<a name="l00282"></a>00282             self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#5abe1753cecd6d47f66a74720361ecf4">simulate</a>()
<a name="l00283"></a>00283         <span class="comment"># Load an ASDx pedigree from an SQLite databases.</span>
<a name="l00284"></a>00284         <span class="keywordflow">elif</span> pedsource == <span class="stringliteral">'db'</span>:
<a name="l00285"></a>00285             self.kw[<span class="stringliteral">'pedformat'</span>] = <span class="stringliteral">'ASDx'</span>
<a name="l00286"></a>00286             self.kw[<span class="stringliteral">'sepchar'</span>] = <span class="stringliteral">','</span>
<a name="l00287"></a>00287             logging.info(<span class="stringliteral">'Loading from database %s.%s at %s.'</span>,self.kw[<span class="stringliteral">'database_name'</span>], \
<a name="l00288"></a>00288                 self.kw[<span class="stringliteral">'database_table'</span>], pyp_utils.pyp_nice_time())
<a name="l00289"></a>00289             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span> <span class="keywordflow">and</span> self.kw[<span class="stringliteral">'pedigree_summary'</span>]:
<a name="l00290"></a>00290                 <span class="keywordflow">print</span> <span class="stringliteral">'[INFO]: Loading from database %s.%s'</span> % ( self.kw[<span class="stringliteral">'database_name'</span>], \
<a name="l00291"></a>00291                     self.kw[<span class="stringliteral">'database_table'</span>] )        <span class="comment"># Create the table</span>
<a name="l00292"></a>00292             <span class="keywordflow">try</span>:
<a name="l00293"></a>00293                 <span class="comment"># Connect to the database</span>
<a name="l00294"></a>00294                 <span class="keywordflow">if</span> pyp_db.doesTableExist(self):
<a name="l00295"></a>00295                     conn = pyp_db.connectToDatabase(self)
<a name="l00296"></a>00296                     <span class="keywordflow">if</span> conn:
<a name="l00297"></a>00297                         <span class="comment">### Contributed by Matt Kelly -- see also the 'database_sql' option</span>
<a name="l00298"></a>00298                         sql = self.kw[<span class="stringliteral">'database_sql'</span>] % ( self.kw[<span class="stringliteral">'database_table'</span>] )
<a name="l00299"></a>00299                         <span class="comment">#sql = 'SELECT * FROM %s' % ( self.kw['database_table'] )</span>
<a name="l00300"></a>00300                         <span class="comment">#sql = 'SELECT animaltattoo,if(siretattoo is NULL ,"",siretattoo),if(damtattoo is NULL ,"",damtattoo),if(concat(year(bdate)) is NULL ,"",concat(year(bdate))) FROM %s' % ( self.kw['database_table'] )</span>
<a name="l00301"></a>00301                         <span class="comment"># This could fail for VERY large pedigrees or on low-RAM machines.</span>
<a name="l00302"></a>00302                         dbstream = conn.GetAll(sql)
<a name="l00303"></a>00303                         conn.Close()
<a name="l00304"></a>00304                         <span class="comment"># Process the ASDx pedigree file as usual.</span>
<a name="l00305"></a>00305                         self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#8b8bf9fe199dd47854f2208a6751b185">preprocess</a>(dbstream=dbstream)
<a name="l00306"></a>00306                     <span class="keywordflow">else</span>:
<a name="l00307"></a>00307                         logging.error(<span class="stringliteral">'Unable to connect to the database %s at %s.'</span>, \
<a name="l00308"></a>00308                             self.kw[<span class="stringliteral">'database_name'</span>], pyp_utils.pyp_nice_time())
<a name="l00309"></a>00309                         <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span>:
<a name="l00310"></a>00310                             <span class="keywordflow">print</span> <span class="stringliteral">'[ERROR]: Unable to connect to the database %s at %s.'</span> % \
<a name="l00311"></a>00311                                 ( self.kw[<span class="stringliteral">'database_name'</span>], pyp_utils.pyp_nice_time() )
<a name="l00312"></a>00312                         sys.exit(0)
<a name="l00313"></a>00313             <span class="keywordflow">except</span>:
<a name="l00314"></a>00314                 logging.error(<span class="stringliteral">'Unable to load pedigree from database %s.%s at %s.'</span>, \
<a name="l00315"></a>00315                     self.kw[<span class="stringliteral">'database_name'</span>], self.kw[<span class="stringliteral">'database_table'</span>], pyp_utils.pyp_nice_time())
<a name="l00316"></a>00316                 <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span>:
<a name="l00317"></a>00317                     <span class="keywordflow">print</span> <span class="stringliteral">'[ERROR]: Unable to load pedigree from database %s.%s'</span> % ( \
<a name="l00318"></a>00318                         self.kw[<span class="stringliteral">'database_name'</span>], \
<a name="l00319"></a>00319                         self.kw[<span class="stringliteral">'database_table'</span>] )
<a name="l00320"></a>00320                 sys.exit(0)
<a name="l00321"></a>00321         <span class="comment"># Load the pedigree from an XDiGraph object that already exists.</span>
<a name="l00322"></a>00322         <span class="keywordflow">elif</span> pedsource == <span class="stringliteral">'graph'</span>:
<a name="l00323"></a>00323             <span class="keywordflow">if</span> pedgraph:
<a name="l00324"></a>00324                 self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#1b9126f92cdabf0a641df4b43f9fbd88">fromgraph</a>(pedgraph)
<a name="l00325"></a>00325             <span class="keywordflow">else</span>:
<a name="l00326"></a>00326                 logging.error(<span class="stringliteral">'Unable to load pedigree from a directed graph: no pedgraph provided!'</span>)
<a name="l00327"></a>00327                 sys.exit(0)
<a name="l00328"></a>00328         <span class="comment"># The graphfile pedsource uses the read_adjlist() function</span>
<a name="l00329"></a>00329         <span class="comment"># from the NetworkX module to load a graph stored in a file</span>
<a name="l00330"></a>00330         <span class="comment"># as an adjacency list, and then converts it to a PyPedal</span>
<a name="l00331"></a>00331         <span class="comment"># pedigree using the NewPedigree::fromgraph() method.</span>
<a name="l00332"></a>00332         <span class="keywordflow">elif</span> pedsource == <span class="stringliteral">'graphfile'</span>:
<a name="l00333"></a>00333             <span class="keywordflow">try</span>:
<a name="l00334"></a>00334                 <span class="keyword">import</span> networkx <span class="keyword">as</span> NX
<a name="l00335"></a>00335             <span class="keywordflow">except</span>:
<a name="l00336"></a>00336                 logging.error(<span class="stringliteral">'Unable to load pedigree from a directed graph stored in adjacency list format because the NetworkX module could not be imported!'</span>)
<a name="l00337"></a>00337                 sys.exit(0)
<a name="l00338"></a>00338             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'pedfile'</span>]:
<a name="l00339"></a>00339                 <span class="keywordflow">try</span>:
<a name="l00340"></a>00340                     pedgraph = NX.read_adjlist(self.kw[<span class="stringliteral">'pedfile'</span>])
<a name="l00341"></a>00341                     self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#1b9126f92cdabf0a641df4b43f9fbd88">fromgraph</a>(pedgraph)
<a name="l00342"></a>00342                 <span class="keywordflow">except</span>:
<a name="l00343"></a>00343                     logging.error(<span class="stringliteral">'Unable to load pedigree from a directed graph stored in adjacency list format!'</span>)
<a name="l00344"></a>00344                     sys.exit(0)
<a name="l00345"></a>00345             <span class="keywordflow">else</span>:
<a name="l00346"></a>00346                 logging.error(<span class="stringliteral">'Unable to load pedigree from a directed graph stored in adjacency list format because no filename was provided!'</span>)
<a name="l00347"></a>00347                 sys.exit(0)
<a name="l00348"></a>00348         <span class="comment"># The gedcomfile pedsource reads files that conform to the</span>
<a name="l00349"></a>00349         <span class="comment"># GEDCOM 5.5 standard.</span>
<a name="l00350"></a>00350         <span class="keywordflow">elif</span> pedsource == <span class="stringliteral">'gedcomfile'</span>:
<a name="l00351"></a>00351             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'pedfile'</span>]:
<a name="l00352"></a>00352                 <span class="comment">#try:</span>
<a name="l00353"></a>00353                 <span class="comment"># Load a GEDCOM file</span>
<a name="l00354"></a>00354                 <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span> <span class="keywordflow">and</span> self.kw[<span class="stringliteral">'pedigree_summary'</span>]:
<a name="l00355"></a>00355                     <span class="keywordflow">print</span> <span class="stringliteral">'[INFO]: Loading GEDCOM file %s.'</span> % (self.kw[<span class="stringliteral">'pedfile'</span>])
<a name="l00356"></a>00356                 pedformat = pyp_io.load_from_gedcom(infilename=self.kw[<span class="stringliteral">'pedfile'</span>], \
<a name="l00357"></a>00357                     standalone = 0, \
<a name="l00358"></a>00358                     messages=self.kw[<span class="stringliteral">'messages'</span>], \
<a name="l00359"></a>00359                     missing_sex=self.kw[<span class="stringliteral">'missing_sex'</span>], \
<a name="l00360"></a>00360                     missing_parent=self.kw[<span class="stringliteral">'missing_parent'</span>], \
<a name="l00361"></a>00361                     missing_name=self.kw[<span class="stringliteral">'missing_name'</span>], \
<a name="l00362"></a>00362                     missing_byear=self.kw[<span class="stringliteral">'missing_byear'</span>])
<a name="l00363"></a>00363                 <span class="keywordflow">if</span> pedformat != <span class="stringliteral">'xxxx'</span>:
<a name="l00364"></a>00364                     <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span> <span class="keywordflow">and</span> self.kw[<span class="stringliteral">'pedigree_summary'</span>]:
<a name="l00365"></a>00365                         <span class="keywordflow">print</span> <span class="stringliteral">'[INFO]: Changing pedformat from %s to %s as part of GEDCOM file processing.'</span> % ( self.kw[<span class="stringliteral">'pedformat'</span>], pedformat )
<a name="l00366"></a>00366                     logging.info(<span class="stringliteral">'Changing pedformat from %s to %s.tmp as part of GEDCOM file processing.'</span>, self.kw[<span class="stringliteral">'pedformat'</span>], pedformat)
<a name="l00367"></a>00367                     self.kw[<span class="stringliteral">'pedformat'</span>] = pedformat
<a name="l00368"></a>00368 
<a name="l00369"></a>00369                     logging.info(<span class="stringliteral">'Changing sepchar from \'%s\' to \',\' as part of GEDCOM file processing.'</span>,self.kw[<span class="stringliteral">'sepchar'</span>])
<a name="l00370"></a>00370                     self.kw[<span class="stringliteral">'sepchar'</span>] = <span class="stringliteral">','</span>
<a name="l00371"></a>00371 
<a name="l00372"></a>00372                     <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span> <span class="keywordflow">and</span> self.kw[<span class="stringliteral">'pedigree_summary'</span>]:
<a name="l00373"></a>00373                         <span class="keywordflow">print</span> <span class="stringliteral">'[INFO]: Changing pedfile from %s to %s.tmp as part of GEDCOM file processing.'</span> % ( self.kw[<span class="stringliteral">'pedfile'</span>], self.kw[<span class="stringliteral">'pedfile'</span>] )
<a name="l00374"></a>00374                     logging.info(<span class="stringliteral">'Changing pedfile from %s to %s.tmp as part of GEDCOM file processing.'</span>,self.kw[<span class="stringliteral">'pedfile'</span>],self.kw[<span class="stringliteral">'pedfile'</span>])
<a name="l00375"></a>00375                     self.kw[<span class="stringliteral">'pedfile'</span>] = <span class="stringliteral">'%s.tmp'</span> % ( self.kw[<span class="stringliteral">'pedfile'</span>] )
<a name="l00376"></a>00376                     <span class="comment"># Process the ASD pedigree file as usual.</span>
<a name="l00377"></a>00377                     self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#8b8bf9fe199dd47854f2208a6751b185">preprocess</a>()
<a name="l00378"></a>00378                 <span class="keywordflow">else</span>:
<a name="l00379"></a>00379                     <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span>:
<a name="l00380"></a>00380                         <span class="keywordflow">print</span> <span class="stringliteral">'[load] Unable to load pedigree from a GEDCOM file because an invalid pedigree format code, %s, was returned!'</span> % (pedformat)
<a name="l00381"></a>00381                     logging.error(<span class="stringliteral">'Unable to load pedigree from a GEDCOM file because an invalid pedigree format code, %s, was returned!'</span>,pedformat)
<a name="l00382"></a>00382                 <span class="comment">#except:</span>
<a name="l00383"></a>00383                     <span class="comment">#if self.kw['messages'] == 'verbose':</span>
<a name="l00384"></a>00384                         <span class="comment">#print '[load] Unable to load pedigree from a GEDCOM file because an exception was raised!'</span>
<a name="l00385"></a>00385                     <span class="comment">#logging.error('Unable to load pedigree from a GEDCOM file because an exception was raised!')</span>
<a name="l00386"></a>00386                     <span class="comment">#sys.exit(0)</span>
<a name="l00387"></a>00387             <span class="keywordflow">else</span>:
<a name="l00388"></a>00388                 <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span>:
<a name="l00389"></a>00389                     <span class="keywordflow">print</span> <span class="stringliteral">'[load] Unable to load pedigree from a GEDCOM file because no filename was provided!'</span>
<a name="l00390"></a>00390                 logging.error(<span class="stringliteral">'Unable to load pedigree from a GEDCOM file because no filename was provided!'</span>)
<a name="l00391"></a>00391                 sys.exit(0)
<a name="l00392"></a>00392         <span class="comment"># The genesfile pedsource reads files that conform to the dBase III format used by GENES v1.2.</span>
<a name="l00393"></a>00393         <span class="keywordflow">elif</span> pedsource == <span class="stringliteral">'genesfile'</span>:
<a name="l00394"></a>00394             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'pedfile'</span>]:
<a name="l00395"></a>00395                 <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span> <span class="keywordflow">and</span> self.kw[<span class="stringliteral">'pedigree_summary'</span>]:
<a name="l00396"></a>00396                     <span class="keywordflow">print</span> <span class="stringliteral">'[INFO]: Loading GENES v1.20 file %s.'</span> % (self.kw[<span class="stringliteral">'pedfile'</span>])
<a name="l00397"></a>00397                 pedformat = pyp_io.load_from_genes(infilename=self.kw[<span class="stringliteral">'pedfile'</span>], \
<a name="l00398"></a>00398                     standalone = 0, \
<a name="l00399"></a>00399                     messages=self.kw[<span class="stringliteral">'messages'</span>], \
<a name="l00400"></a>00400                     missing_sex=self.kw[<span class="stringliteral">'missing_sex'</span>], \
<a name="l00401"></a>00401                     missing_parent=self.kw[<span class="stringliteral">'missing_parent'</span>], \
<a name="l00402"></a>00402                     missing_name=self.kw[<span class="stringliteral">'missing_name'</span>], \
<a name="l00403"></a>00403                     missing_bdate=self.kw[<span class="stringliteral">'missing_bdate'</span>])
<a name="l00404"></a>00404                 <span class="keywordflow">if</span> pedformat != <span class="stringliteral">'xxxx'</span>:
<a name="l00405"></a>00405                     <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span> <span class="keywordflow">and</span> self.kw[<span class="stringliteral">'pedigree_summary'</span>]:
<a name="l00406"></a>00406                         <span class="keywordflow">print</span> <span class="stringliteral">'[INFO]: Changing pedformat from %s to %s as part of GENES v1.20 file processing.'</span> % ( self.kw[<span class="stringliteral">'pedformat'</span>], pedformat )
<a name="l00407"></a>00407                     logging.info(<span class="stringliteral">'Changing pedformat from %s to %s as part of GENES v1.20 file processing.'</span>, self.kw[<span class="stringliteral">'pedformat'</span>], pedformat)
<a name="l00408"></a>00408                     self.kw[<span class="stringliteral">'pedformat'</span>] = pedformat
<a name="l00409"></a>00409 
<a name="l00410"></a>00410                     logging.info(<span class="stringliteral">'Changing sepchar from \'%s\' to \',\' as part of GENES v1.20 file processing.'</span>,self.kw[<span class="stringliteral">'sepchar'</span>])
<a name="l00411"></a>00411                     self.kw[<span class="stringliteral">'sepchar'</span>] = <span class="stringliteral">','</span>
<a name="l00412"></a>00412 
<a name="l00413"></a>00413                     <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span> <span class="keywordflow">and</span> self.kw[<span class="stringliteral">'pedigree_summary'</span>]:
<a name="l00414"></a>00414                         <span class="keywordflow">print</span> <span class="stringliteral">'[INFO]: Changing pedfile from %s to %s.tmp as part of GENES v1.20 file processing.'</span> % ( self.kw[<span class="stringliteral">'pedfile'</span>], self.kw[<span class="stringliteral">'pedfile'</span>] )
<a name="l00415"></a>00415                     logging.info(<span class="stringliteral">'Changing pedfile from %s to %s.tmp as part of GENES v1.20 file processing.'</span>,self.kw[<span class="stringliteral">'pedfile'</span>],self.kw[<span class="stringliteral">'pedfile'</span>])
<a name="l00416"></a>00416                     self.kw[<span class="stringliteral">'pedfile'</span>] = <span class="stringliteral">'%s.tmp'</span> % ( self.kw[<span class="stringliteral">'pedfile'</span>] )
<a name="l00417"></a>00417                     <span class="comment"># Process the ASD pedigree file as usual.</span>
<a name="l00418"></a>00418                     self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#8b8bf9fe199dd47854f2208a6751b185">preprocess</a>()
<a name="l00419"></a>00419                 <span class="keywordflow">else</span>:
<a name="l00420"></a>00420                     <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span>:
<a name="l00421"></a>00421                         <span class="keywordflow">print</span> <span class="stringliteral">'[load] Unable to load pedigree from a GENES v1.20 file because an invalid pedigree format code, %s, was returned!'</span> % (pedformat)
<a name="l00422"></a>00422                     logging.error(<span class="stringliteral">'Unable to load pedigree from a GENES v1.20 file because an invalid pedigree format code, %s, was returned!'</span>,pedformat)
<a name="l00423"></a>00423             <span class="keywordflow">else</span>:
<a name="l00424"></a>00424                 <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span>:
<a name="l00425"></a>00425                     <span class="keywordflow">print</span> <span class="stringliteral">'[load] Unable to load pedigree from a GENES v1.2 file because no filename was provided!'</span>
<a name="l00426"></a>00426                 logging.error(<span class="stringliteral">'Unable to load pedigree from a GENES v1.2 file because no filename was provided!'</span>)
<a name="l00427"></a>00427                 sys.exit(0)
<a name="l00428"></a>00428         <span class="comment"># A user requested this feature so that he can run PyPedal as a web service</span>
<a name="l00429"></a>00429         <span class="comment"># without worrying about Apache and file creation and etc. I'll see what I</span>
<a name="l00430"></a>00430         <span class="comment"># can do...</span>
<a name="l00431"></a>00431         <span class="keywordflow">elif</span> pedsource == <span class="stringliteral">'textstream'</span>:
<a name="l00432"></a>00432             <span class="comment"># Unpack those tuples...</span>
<a name="l00433"></a>00433             self.kw[<span class="stringliteral">'pedformat'</span>] = <span class="stringliteral">'ASD'</span>
<a name="l00434"></a>00434             self.kw[<span class="stringliteral">'sepchar'</span>] = <span class="stringliteral">','</span>
<a name="l00435"></a>00435             logging.info(<span class="stringliteral">'Preprocessing a textstream'</span>)
<a name="l00436"></a>00436             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span> <span class="keywordflow">and</span> self.kw[<span class="stringliteral">'pedigree_summary'</span>]:
<a name="l00437"></a>00437                 <span class="keywordflow">print</span> <span class="stringliteral">'[INFO]: Preprocessing a textstream'</span>
<a name="l00438"></a>00438             self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#8b8bf9fe199dd47854f2208a6751b185">preprocess</a>(textstream=pedstream)
<a name="l00439"></a>00439         <span class="keywordflow">else</span>:
<a name="l00440"></a>00440             logging.info(<span class="stringliteral">'Preprocessing %s'</span>,self.kw[<span class="stringliteral">'pedfile'</span>])
<a name="l00441"></a>00441             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span> <span class="keywordflow">and</span> self.kw[<span class="stringliteral">'pedigree_summary'</span>]:
<a name="l00442"></a>00442                 <span class="keywordflow">print</span> <span class="stringliteral">'[INFO]: Preprocessing %s'</span> % (self.kw[<span class="stringliteral">'pedfile'</span>])
<a name="l00443"></a>00443             self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#8b8bf9fe199dd47854f2208a6751b185">preprocess</a>()
<a name="l00444"></a>00444         <span class="comment"># Now that we've got the animals loaded, take care of the</span>
<a name="l00445"></a>00445         <span class="comment"># renumbering etc.</span>
<a name="l00446"></a>00446         <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'reorder'</span>] == 1 <span class="keywordflow">and</span> <span class="keywordflow">not</span> self.kw[<span class="stringliteral">'renumber'</span>]:
<a name="l00447"></a>00447             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span> <span class="keywordflow">and</span> self.kw[<span class="stringliteral">'pedigree_summary'</span>]:
<a name="l00448"></a>00448                 <span class="keywordflow">print</span> <span class="stringliteral">'\t[INFO]: Reordering pedigree at %s'</span> % ( pyp_utils.pyp_nice_time() )
<a name="l00449"></a>00449             logging.info(<span class="stringliteral">'Reordering pedigree'</span>)
<a name="l00450"></a>00450             <span class="keywordflow">if</span> <span class="keywordflow">not</span> self.kw[<span class="stringliteral">'slow_reorder'</span>]:
<a name="l00451"></a>00451                 self.pedigree = pyp_utils.fast_reorder(self.pedigree)
<a name="l00452"></a>00452             <span class="keywordflow">else</span>:
<a name="l00453"></a>00453                 self.pedigree = pyp_utils.reorder(self.pedigree,missingparent=self.kw[<span class="stringliteral">'missing_parent'</span>],max_rounds=self.kw[<span class="stringliteral">'reorder_max_rounds'</span>])
<a name="l00454"></a>00454             <span class="comment">#self.pedigree = pyp_utils.reorder(self.pedigree,missingparent=self.kw['missing_parent'],max_rounds=self.kw['reorder_max_rounds'])</span>
<a name="l00455"></a>00455         <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'renumber'</span>] == 1:
<a name="l00456"></a>00456             self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#0a4949ed75e4c820f4464a1a4067f693">renumber</a>()
<a name="l00457"></a>00457         <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'set_generations'</span>]:
<a name="l00458"></a>00458             logging.info(<span class="stringliteral">'Assigning generations'</span>)
<a name="l00459"></a>00459             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span> <span class="keywordflow">and</span> self.kw[<span class="stringliteral">'pedigree_summary'</span>]:
<a name="l00460"></a>00460                 <span class="keywordflow">print</span> <span class="stringliteral">'\t[INFO]: Assigning generations at %s'</span> % ( pyp_utils.pyp_nice_time() )
<a name="l00461"></a>00461             pyp_utils.set_generation(self)
<a name="l00462"></a>00462         <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'set_ancestors'</span>]:
<a name="l00463"></a>00463             logging.info(<span class="stringliteral">'Setting ancestor flags'</span>)
<a name="l00464"></a>00464             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span> <span class="keywordflow">and</span> self.kw[<span class="stringliteral">'pedigree_summary'</span>]:
<a name="l00465"></a>00465                 <span class="keywordflow">print</span> <span class="stringliteral">'\t[INFO]: Setting ancestor flags at %s'</span> % ( pyp_utils.pyp_nice_time() )
<a name="l00466"></a>00466             pyp_utils.set_ancestor_flag(self)
<a name="l00467"></a>00467         <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'set_sexes'</span>]:
<a name="l00468"></a>00468             logging.info(<span class="stringliteral">'Assigning sexes'</span>)
<a name="l00469"></a>00469             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span> <span class="keywordflow">and</span> self.kw[<span class="stringliteral">'pedigree_summary'</span>]:
<a name="l00470"></a>00470                 <span class="keywordflow">print</span> <span class="stringliteral">'\t[INFO]: Assigning sexes at %s'</span> % ( pyp_utils.pyp_nice_time() )
<a name="l00471"></a>00471             pyp_utils.assign_sexes(self)
<a name="l00472"></a>00472         <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'set_alleles'</span>]:
<a name="l00473"></a>00473             logging.info(<span class="stringliteral">'Gene dropping to compute founder genome equivalents'</span>)
<a name="l00474"></a>00474             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span> <span class="keywordflow">and</span> self.kw[<span class="stringliteral">'pedigree_summary'</span>]:
<a name="l00475"></a>00475                 <span class="keywordflow">print</span> <span class="stringliteral">'\t[INFO]: Gene dropping at %s'</span> % ( pyp_utils.pyp_nice_time() )
<a name="l00476"></a>00476             pyp_metrics.effective_founder_genomes(self)
<a name="l00477"></a>00477         <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'form_nrm'</span>]:
<a name="l00478"></a>00478             logging.info(<span class="stringliteral">'Forming numerator relationship matrix'</span>)
<a name="l00479"></a>00479             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span> <span class="keywordflow">and</span> self.kw[<span class="stringliteral">'pedigree_summary'</span>]:
<a name="l00480"></a>00480                 <span class="keywordflow">print</span> <span class="stringliteral">'\t[INFO]: Forming numerator relationship matrix at %s'</span> % ( pyp_utils.pyp_nice_time() )
<a name="l00481"></a>00481             self.nrm = NewAMatrix(self.kw)
<a name="l00482"></a>00482             self.nrm.form_a_matrix(self.pedigree)
<a name="l00483"></a>00483         <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'set_offspring'</span>] <span class="keywordflow">and</span> <span class="keywordflow">not</span> self.kw[<span class="stringliteral">'renumber'</span>]:
<a name="l00484"></a>00484             logging.info(<span class="stringliteral">'Assigning offspring'</span>)
<a name="l00485"></a>00485             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span> <span class="keywordflow">and</span> self.kw[<span class="stringliteral">'pedigree_summary'</span>]:
<a name="l00486"></a>00486                 <span class="keywordflow">print</span> <span class="stringliteral">'\t[INFO]: Assigning offspring at %s'</span> % ( pyp_utils.pyp_nice_time() )
<a name="l00487"></a>00487             pyp_utils.assign_offspring(self)
<a name="l00488"></a>00488         <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span> <span class="keywordflow">and</span> self.kw[<span class="stringliteral">'pedigree_summary'</span>]:
<a name="l00489"></a>00489             <span class="keywordflow">print</span> <span class="stringliteral">'[INFO]: Creating pedigree metadata object'</span>
<a name="l00490"></a>00490         self.metadata = PedigreeMetadata(self.pedigree,self.kw)
<a name="l00491"></a>00491         <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] != <span class="stringliteral">'quiet'</span> <span class="keywordflow">and</span> self.kw[<span class="stringliteral">'pedigree_summary'</span>]:
<a name="l00492"></a>00492             self.metadata.printme()
<a name="l00493"></a>00493         <span class="comment"># Calculate pedigree completeness.</span>
<a name="l00494"></a>00494         <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'pedcomp'</span>]:
<a name="l00495"></a>00495             logging.info(<span class="stringliteral">'Calculating %s generation pedigree completeness'</span>, self.kw[<span class="stringliteral">'pedcomp_gens'</span>])
<a name="l00496"></a>00496             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span> <span class="keywordflow">and</span> self.kw[<span class="stringliteral">'pedigree_summary'</span>]:
<a name="l00497"></a>00497                 <span class="keywordflow">print</span> <span class="stringliteral">'[INFO]: Calculating %s generation pedigree completeness'</span> % ( self.kw[<span class="stringliteral">'pedcomp_gens'</span>] )
<a name="l00498"></a>00498             _foo = pyp_metrics.pedigree_completeness(self,self.kw[<span class="stringliteral">'pedcomp_gens'</span>])
<a name="l00499"></a>00499 
<a name="l00500"></a>00500     <span class="comment">##</span>
<a name="l00501"></a>00501     <span class="comment"># oldsave() writes a PyPedal pedigree to a user-specified file.  The saved pedigree includes</span>
<a name="l00502"></a>00502     <span class="comment"># all fields recognized by PyPedal, not just the original fields read from the input pedigree</span>
<a name="l00503"></a>00503     <span class="comment"># file.</span>
<a name="l00504"></a>00504     <span class="comment"># @param self Reference to current object.</span>
<a name="l00505"></a>00505     <span class="comment"># @param filename The file to which the pedigree should be written.</span>
<a name="l00506"></a>00506     <span class="comment"># @param outformat The format in which the pedigree should be written: 'o' for original (as read) and 'l' for long version (all available variables).</span>
<a name="l00507"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#589c5b24a3acfaf394eabcb3decb565c">00507</a>     <span class="comment"># @param idformat Write 'o' (original) or 'r' (renumbered) animal, sire, and dam IDs.</span>
<a name="l00508"></a>00508     <span class="comment"># @retval A save status indicator (0: failed, 1: success)</span>
<a name="l00509"></a>00509     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#589c5b24a3acfaf394eabcb3decb565c">oldsave</a>(self, filename='', outformat='o', idformat='o'):
<a name="l00510"></a>00510         <span class="stringliteral">"""</span>
<a name="l00511"></a>00511 <span class="stringliteral">        oldsave() writes a PyPedal pedigree to a user-specified file.  The saved pedigree</span>
<a name="l00512"></a>00512 <span class="stringliteral">        includes all fields recognized by PyPedal, not just the original fields read</span>
<a name="l00513"></a>00513 <span class="stringliteral">        from the input pedigree file.</span>
<a name="l00514"></a>00514 <span class="stringliteral">        """</span>
<a name="l00515"></a>00515         <span class="comment">#</span>
<a name="l00516"></a>00516         <span class="comment"># This is VERY important: never overwrite the user's data if it looks like an accidental</span>
<a name="l00517"></a>00517         <span class="comment"># request!  If the user does not pass a filename to save() save the pedigree to a file</span>
<a name="l00518"></a>00518         <span class="comment"># whose name is derived from, but not the same as, the original pedigree file.</span>
<a name="l00519"></a>00519         <span class="comment">#</span>
<a name="l00520"></a>00520         <span class="keywordflow">if</span> filename == <span class="stringliteral">''</span>:
<a name="l00521"></a>00521             filename = <span class="stringliteral">'%s_saved.ped'</span> % ( self.kw[<span class="stringliteral">'filetag'</span>] )
<a name="l00522"></a>00522             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span>:
<a name="l00523"></a>00523                 <span class="keywordflow">print</span> <span class="stringliteral">'[WARNING]: Saving pedigree to file %s to avoid overwriting %s.'</span> % ( filename, self.kw[<span class="stringliteral">'pedfile'</span>] )
<a name="l00524"></a>00524             logging.warning(<span class="stringliteral">'Saving pedigree to file %s to avoid overwriting %s.'</span>,filename,self.kw[<span class="stringliteral">'pedfile'</span>])
<a name="l00525"></a>00525         <span class="keywordflow">try</span>:
<a name="l00526"></a>00526             ofh = file(filename,<span class="stringliteral">'w'</span>)
<a name="l00527"></a>00527             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span>:
<a name="l00528"></a>00528                 <span class="keywordflow">print</span> <span class="stringliteral">'[INFO]: Opened file %s for pedigree save at %s.'</span> % ( filename, pyp_utils.pyp_nice_time() )
<a name="l00529"></a>00529             logging.info(<span class="stringliteral">'Opened file %s for pedigree save at %s.'</span>,filename, pyp_utils.pyp_nice_time())
<a name="l00530"></a>00530 
<a name="l00531"></a>00531             <span class="keywordflow">if</span> outformat == <span class="stringliteral">'l'</span>:
<a name="l00532"></a>00532                 <span class="comment"># We have to form the new pedformat.</span>
<a name="l00533"></a>00533                 _newpedformat = <span class="stringliteral">'asdgx'</span>
<a name="l00534"></a>00534                 <span class="keywordflow">if</span> <span class="stringliteral">'y'</span> <span class="keywordflow">in</span> self.kw[<span class="stringliteral">'pedformat'</span>]:
<a name="l00535"></a>00535                     _newpedformat = <span class="stringliteral">'%sy'</span> % ( _newpedformat )
<a name="l00536"></a>00536                 <span class="keywordflow">else</span>:
<a name="l00537"></a>00537                     _newpedformat = <span class="stringliteral">'%sb'</span> % ( _newpedformat )
<a name="l00538"></a>00538                 _newpedformat = <span class="stringliteral">'%sfrnleh'</span> % (_newpedformat )
<a name="l00539"></a>00539             <span class="keywordflow">else</span>:
<a name="l00540"></a>00540                 <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'f_computed'</span>]:
<a name="l00541"></a>00541                     _newpedformat = <span class="stringliteral">'%sf'</span> % ( self.kw[<span class="stringliteral">'pedformat'</span>] )
<a name="l00542"></a>00542                 <span class="keywordflow">else</span>:
<a name="l00543"></a>00543                     _newpedformat = self.kw[<span class="stringliteral">'pedformat'</span>]
<a name="l00544"></a>00544 
<a name="l00545"></a>00545             <span class="comment"># Write file header.</span>
<a name="l00546"></a>00546             ofh.write(<span class="stringliteral">'# %s created by PyPedal at %s\n'</span> % ( filename, pyp_utils.pyp_nice_time() ) )
<a name="l00547"></a>00547             ofh.write(<span class="stringliteral">'# Current pedigree metadata:\n'</span>)
<a name="l00548"></a>00548             ofh.write(<span class="stringliteral">'#\tpedigree file: %s\n'</span> % (filename) )
<a name="l00549"></a>00549             ofh.write(<span class="stringliteral">'#\tpedigree name: %s\n'</span> % (self.kw[<span class="stringliteral">'pedname'</span>]) )
<a name="l00550"></a>00550             ofh.write(<span class="stringliteral">'#\tpedigree format: \'%s\'\n'</span> % ( _newpedformat) )
<a name="l00551"></a>00551             <span class="keywordflow">if</span> idformat == <span class="stringliteral">'o'</span>:
<a name="l00552"></a>00552                 ofh.write(<span class="stringliteral">'#\tNOTE: Animal, sire, and dam IDs are RENUMBERED IDs, not original IDs!\n'</span>)
<a name="l00553"></a>00553             ofh.write(<span class="stringliteral">'# Original pedigree metadata:\n'</span>)
<a name="l00554"></a>00554             ofh.write(<span class="stringliteral">'#\tpedigree file: %s\n'</span> % (self.kw[<span class="stringliteral">'pedfile'</span>]) )
<a name="l00555"></a>00555             ofh.write(<span class="stringliteral">'#\tpedigree name: %s\n'</span> % (self.kw[<span class="stringliteral">'pedname'</span>]) )
<a name="l00556"></a>00556             ofh.write(<span class="stringliteral">'#\tpedigree format: %s\n'</span> % (self.kw[<span class="stringliteral">'pedformat'</span>]) )
<a name="l00557"></a>00557             <span class="keywordflow">for</span> _a <span class="keywordflow">in</span> self.pedigree:
<a name="l00558"></a>00558                 <span class="keywordflow">if</span> idformat == <span class="stringliteral">'o'</span>:
<a name="l00559"></a>00559                     _outstring = <span class="stringliteral">'%s %s %s'</span> % \
<a name="l00560"></a>00560                         (_a.originalID, self.pedigree[int(_a.sireID)-1].originalID, \
<a name="l00561"></a>00561                         self.pedigree[int(_a.damID)-1].originalID )
<a name="l00562"></a>00562                 <span class="keywordflow">else</span>:
<a name="l00563"></a>00563                     _outstring = <span class="stringliteral">'%s %s %s'</span> % (_a.animalID, _a.sireID, _a.damID )
<a name="l00564"></a>00564                 <span class="keywordflow">if</span> <span class="stringliteral">'g'</span> <span class="keywordflow">in</span> _newpedformat:
<a name="l00565"></a>00565                     _outstring = <span class="stringliteral">'%s %s'</span> % ( _outstring, _a.gen )
<a name="l00566"></a>00566                 <span class="keywordflow">if</span> <span class="stringliteral">'p'</span> <span class="keywordflow">in</span> _newpedformat:
<a name="l00567"></a>00567                     _outstring = <span class="stringliteral">'%s %s'</span> % ( _outstring, _a.gencoeff )
<a name="l00568"></a>00568                 <span class="keywordflow">if</span> <span class="stringliteral">'x'</span> <span class="keywordflow">in</span> _newpedformat:
<a name="l00569"></a>00569                     _outstring = <span class="stringliteral">'%s %s'</span> % ( _outstring, _a.sex )
<a name="l00570"></a>00570                 <span class="keywordflow">if</span> <span class="stringliteral">'y'</span> <span class="keywordflow">in</span> _newpedformat:
<a name="l00571"></a>00571                     _outstring = <span class="stringliteral">'%s %s'</span> % ( _outstring, _a.bd )
<a name="l00572"></a>00572                 <span class="keywordflow">else</span>:
<a name="l00573"></a>00573                     _outstring = <span class="stringliteral">'%s %s'</span> % ( _outstring, _a.by )
<a name="l00574"></a>00574                 <span class="keywordflow">if</span> <span class="stringliteral">'f'</span> <span class="keywordflow">in</span> _newpedformat:
<a name="l00575"></a>00575                     _outstring = <span class="stringliteral">'%s %s'</span> % ( _outstring, _a.fa )
<a name="l00576"></a>00576                 <span class="keywordflow">if</span> <span class="stringliteral">'</span><span class="stringliteral">r' in _newpedformat:</span>
<a name="l00577"></a>00577 <span class="stringliteral">                    _outstring = </span><span class="stringliteral">'%s %s'</span> % ( _outstring, _a.breed )
<a name="l00578"></a>00578                 <span class="keywordflow">if</span> <span class="stringliteral">'n'</span> <span class="keywordflow">in</span> _newpedformat:
<a name="l00579"></a>00579                     _outstring = <span class="stringliteral">'%s %s'</span> % ( _outstring, _a.name )
<a name="l00580"></a>00580                 <span class="keywordflow">if</span> <span class="stringliteral">'l'</span> <span class="keywordflow">in</span> _newpedformat:
<a name="l00581"></a>00581                     _outstring = <span class="stringliteral">'%s %s'</span> % ( _outstring, _a.alive )
<a name="l00582"></a>00582                 <span class="keywordflow">if</span> <span class="stringliteral">'e'</span> <span class="keywordflow">in</span> _newpedformat:
<a name="l00583"></a>00583                     _outstring = <span class="stringliteral">'%s %s'</span> % ( _outstring, _a.age )
<a name="l00584"></a>00584                 <span class="keywordflow">if</span> <span class="stringliteral">'h'</span> <span class="keywordflow">in</span> _newpedformat <span class="keywordflow">or</span> <span class="stringliteral">'H'</span> <span class="keywordflow">in</span> _newpedformat:
<a name="l00585"></a>00585                     _outstring = <span class="stringliteral">'%s %s'</span> % ( _outstring, _a.herd )
<a name="l00586"></a>00586                     _outstring = <span class="stringliteral">'%s %s'</span> % ( _outstring, _a.originalHerd )
<a name="l00587"></a>00587                 <span class="keywordflow">if</span> <span class="stringliteral">'</span><span class="stringliteral">u' in _newpedformat:</span>
<a name="l00588"></a>00588 <span class="stringliteral">                    _outstring = </span><span class="stringliteral">'%s %s'</span> % ( _outstring, _a.userField )
<a name="l00589"></a>00589                 ofh.write( <span class="stringliteral">'%s\n'</span> % (_outstring) )
<a name="l00590"></a>00590             ofh.close()
<a name="l00591"></a>00591             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span>:
<a name="l00592"></a>00592                 <span class="keywordflow">print</span> <span class="stringliteral">'[INFO]: Closed file %s after pedigree save at %s.'</span> % ( filename, pyp_utils.pyp_nice_time() )
<a name="l00593"></a>00593             logging.info(<span class="stringliteral">'Closed file %s after pedigree save at %s.'</span>,filename, pyp_utils.pyp_nice_time())
<a name="l00594"></a>00594             <span class="keywordflow">return</span> 1
<a name="l00595"></a>00595         <span class="keywordflow">except</span>:
<a name="l00596"></a>00596             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span>:
<a name="l00597"></a>00597                 <span class="keywordflow">print</span> <span class="stringliteral">'[ERROR]: Unable to open file %s for pedigree save!'</span> % ( filename )
<a name="l00598"></a>00598             logging.error(<span class="stringliteral">'Unable to open file %s for pedigree save.'</span>,filename)
<a name="l00599"></a>00599             <span class="keywordflow">return</span> 0
<a name="l00600"></a>00600 
<a name="l00601"></a>00601     <span class="comment">##</span>
<a name="l00602"></a>00602     <span class="comment"># save() writes a PyPedal pedigree to a user-specified file.  The saved pedigree includes</span>
<a name="l00603"></a>00603     <span class="comment"># all fields recognized by PyPedal, not just the original fields read from the input pedigree</span>
<a name="l00604"></a>00604     <span class="comment"># file.</span>
<a name="l00605"></a>00605     <span class="comment"># @param self Reference to current object.</span>
<a name="l00606"></a>00606     <span class="comment"># @param filename The file to which the pedigree should be written.</span>
<a name="l00607"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#1deaecb333aff013fb0362bfddcad954">00607</a>     <span class="comment"># @param pedformat Pedigree format string for the pedigree to be written.</span>
<a name="l00608"></a>00608     <span class="comment"># @retval A save status indicator (0: failed, 1: success)</span>
<a name="l00609"></a>00609     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#1deaecb333aff013fb0362bfddcad954">save</a>(self, filename='', pedformat='asd'):
<a name="l00610"></a>00610         <span class="stringliteral">"""</span>
<a name="l00611"></a>00611 <span class="stringliteral">        save() writes a PyPedal pedigree to a user-specified file.  The saved pedigree</span>
<a name="l00612"></a>00612 <span class="stringliteral">        includes all fields recognized by PyPedal, not just the original fields read</span>
<a name="l00613"></a>00613 <span class="stringliteral">        from the input pedigree file.</span>
<a name="l00614"></a>00614 <span class="stringliteral">        """</span>
<a name="l00615"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#013fd13df6bff2864fc36c72956e7c13">00615</a>     <span class="comment"># Check the contents of the pedformat to make sure that each entry is valid. Save the pedformat passed in by the user</span>
<a name="l00616"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a03286a49ff97e8b36529195870f73b5">00616</a>     <span class="comment"># and add the valid entries a new version of pedformat which will be used for the remainder of the processing.</span>
<a name="l00617"></a>00617     pedformat_in = str(pedformat)
<a name="l00618"></a>00618     pedformat = <span class="stringliteral">''</span>
<a name="l00619"></a>00619     <span class="keywordflow">for</span> pf <span class="keywordflow">in</span> pedformat_in:
<a name="l00620"></a>00620         <span class="keywordflow">if</span> pf <span class="keywordflow">in</span> self.pedformat_codes:
<a name="l00621"></a>00621             pedformat.append(p)
<a name="l00622"></a>00622         <span class="keywordflow">else</span>:
<a name="l00623"></a>00623             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span>:
<a name="l00624"></a>00624                         <span class="keywordflow">print</span> <span class="stringliteral">'[WARNING]: Invalid pedigree format code, %s, in NewPedigree::save(). Not included in pedformat_ckd.'</span> % ( pf )
<a name="l00625"></a>00625             logging.warning(<span class="stringliteral">'Invalid pedigree format code, %s, in NewPedigree::save(). Not included in pedformat_ckd.'</span>, pf)
<a name="l00626"></a>00626         <span class="comment"># This is VERY important: never overwrite the user's data if it looks like an accidental</span>
<a name="l00627"></a>00627         <span class="comment"># request!  If the user does not pass a filename to save() save the pedigree to a file</span>
<a name="l00628"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#df9bbec93f7b0748b6f6313777820f72">00628</a>         <span class="comment"># whose name is derived from, but not the same as, the original pedigree file.</span>
<a name="l00629"></a>00629         <span class="keywordflow">if</span> filename == <span class="stringliteral">''</span>:
<a name="l00630"></a>00630             filename = <span class="stringliteral">'%s_saved.ped'</span> % ( self.kw[<span class="stringliteral">'filetag'</span>] )
<a name="l00631"></a>00631             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span>:
<a name="l00632"></a>00632                 <span class="keywordflow">print</span> <span class="stringliteral">'[WARNING]: Saving pedigree to file %s to avoid overwriting %s.'</span> % ( filename, self.kw[<span class="stringliteral">'pedfile'</span>] )
<a name="l00633"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#46755a01d2c86e67f997a6701e8366e8">00633</a>             logging.warning(<span class="stringliteral">'Saving pedigree to file %s to avoid overwriting %s.'</span>,filename,self.kw[<span class="stringliteral">'pedfile'</span>])
<a name="l00634"></a>00634         <span class="keywordflow">try</span>:
<a name="l00635"></a>00635             ofh = file(filename,<span class="stringliteral">'w'</span>)
<a name="l00636"></a>00636             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span>:
<a name="l00637"></a>00637                 <span class="keywordflow">print</span> <span class="stringliteral">'[INFO]: Opened file %s for pedigree save at %s.'</span> % ( filename, pyp_utils.pyp_nice_time() )
<a name="l00638"></a>00638             logging.info(<span class="stringliteral">'Opened file %s for pedigree save at %s.'</span>,filename, pyp_utils.pyp_nice_time())
<a name="l00639"></a>00639 
<a name="l00640"></a>00640         <span class="comment"># Let the user know which pedigree format code is being used.</span>
<a name="l00641"></a>00641             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span>:
<a name="l00642"></a>00642                 <span class="keywordflow">print</span> <span class="stringliteral">'[INFO]: Invalid pedigree format code, %s, in NewPedigree::save(). Not included in pedformat_ckd.'</span> % ( pf )
<a name="l00643"></a>00643             logging.info(<span class="stringliteral">'Pedigree format code %s being used to write pedigree file %s in NewPedigree::save().'</span>, pedformat, filename)
<a name="l00644"></a>00644 
<a name="l00645"></a>00645             <span class="comment"># Write file header.</span>
<a name="l00646"></a>00646             ofh.write(<span class="stringliteral">'# %s created by PyPedal at %s\n'</span> % ( filename, pyp_utils.pyp_nice_time() ) )
<a name="l00647"></a>00647             ofh.write(<span class="stringliteral">'# Current pedigree metadata:\n'</span>)
<a name="l00648"></a>00648             ofh.write(<span class="stringliteral">'#\tpedigree file: %s\n'</span> % (filename) )
<a name="l00649"></a>00649             ofh.write(<span class="stringliteral">'#\tpedigree name: %s\n'</span> % (self.kw[<span class="stringliteral">'pedname'</span>]) )
<a name="l00650"></a>00650             ofh.write(<span class="stringliteral">'#\tpedigree format: \'%s\'\n'</span> % (pedformat) )
<a name="l00651"></a>00651             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'pedigree_is_renumbered'</span>] == 1:
<a name="l00652"></a>00652                 ofh.write(<span class="stringliteral">'#\tNOTE: Animal, sire, and dam IDs are RENUMBERED IDs, not original IDs!\n'</span>)
<a name="l00653"></a>00653             ofh.write(<span class="stringliteral">'# Original pedigree metadata:\n'</span>)
<a name="l00654"></a>00654             ofh.write(<span class="stringliteral">'#\tpedigree file: %s\n'</span> % (self.kw[<span class="stringliteral">'pedfile'</span>]))
<a name="l00655"></a>00655             ofh.write(<span class="stringliteral">'#\tpedigree name: %s\n'</span> % (self.kw[<span class="stringliteral">'pedname'</span>]))
<a name="l00656"></a>00656             ofh.write(<span class="stringliteral">'#\tpedigree format: %s\n'</span> % (self.kw[<span class="stringliteral">'pedformat'</span>]))
<a name="l00657"></a>00657             <span class="keywordflow">for</span> _a <span class="keywordflow">in</span> self.pedigree:
<a name="l00658"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#68241a6e968588b6207a795f0f410507">00658</a>         _outstring = <span class="stringliteral">''</span>
<a name="l00659"></a>00659         <span class="keywordflow">for</span> pf <span class="keywordflow">in</span> pedformat:
<a name="l00660"></a>00660             value = getattr(_a, self.new_animal_attr[pf])
<a name="l00661"></a>00661             <span class="keywordflow">if</span> value != <span class="keyword">False</span>:
<a name="l00662"></a>00662             _outstring = <span class="stringliteral">'%s%s%s'</span> % ( _outstring, self.kw[<span class="stringliteral">'sepchar'</span>], value )
<a name="l00663"></a>00663                 ofh.write( <span class="stringliteral">'%s\n'</span> % (_outstring) )
<a name="l00664"></a>00664             ofh.close()
<a name="l00665"></a>00665             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span>:
<a name="l00666"></a>00666                 <span class="keywordflow">print</span> <span class="stringliteral">'[INFO]: Closed file %s after pedigree save at %s.'</span> % ( filename, pyp_utils.pyp_nice_time() )
<a name="l00667"></a>00667             logging.info(<span class="stringliteral">'Closed file %s after pedigree save at %s.'</span>,filename, pyp_utils.pyp_nice_time())
<a name="l00668"></a>00668             <span class="keywordflow">return</span> 1
<a name="l00669"></a>00669         <span class="keywordflow">except</span>:
<a name="l00670"></a>00670             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span>:
<a name="l00671"></a>00671                 <span class="keywordflow">print</span> <span class="stringliteral">'[ERROR]: Unable to open file %s for pedigree save!'</span> % ( filename )
<a name="l00672"></a>00672             logging.error(<span class="stringliteral">'Unable to open file %s for pedigree save.'</span>,filename)
<a name="l00673"></a>00673             <span class="keywordflow">return</span> 0
<a name="l00674"></a>00674 
<a name="l00675"></a>00675     <span class="comment">##</span>
<a name="l00676"></a>00676     <span class="comment"># savegraph() save a pedigree to a file as an adjacency list.</span>
<a name="l00677"></a>00677     <span class="comment"># @param self Reference to current object.</span>
<a name="l00678"></a>00678     <span class="comment"># @param pedoutfile Name of the file to which the graph is written.</span>
<a name="l00679"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#919b2556f78eaba14ac89f91c261a5ee">00679</a>     <span class="comment"># @param pedgraph Graph object</span>
<a name="l00680"></a>00680     <span class="comment"># @retval None</span>
<a name="l00681"></a>00681     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#919b2556f78eaba14ac89f91c261a5ee">savegraph</a>(self, pedoutfile=0, pedgraph=0):
<a name="l00682"></a>00682         <span class="stringliteral">"""</span>
<a name="l00683"></a>00683 <span class="stringliteral">        Save a pedigree to a file as an adjacency list.</span>
<a name="l00684"></a>00684 <span class="stringliteral">        """</span>
<a name="l00685"></a>00685         <span class="keywordflow">if</span> <span class="keywordflow">not</span> pedoutfile:
<a name="l00686"></a>00686             pedoutfile = <span class="stringliteral">'%s.adjlist'</span> % ( self.kw[<span class="stringliteral">'pedfile'</span>] )
<a name="l00687"></a>00687         <span class="keywordflow">if</span> <span class="keywordflow">not</span> pedgraph:
<a name="l00688"></a>00688             <span class="keywordflow">try</span>:
<a name="l00689"></a>00689                 <span class="keyword">import</span> pyp_network
<a name="l00690"></a>00690                 pedgraph = pyp_network.ped_to_graph(self)
<a name="l00691"></a>00691                 logging.info(<span class="stringliteral">'[savegraph]: Convert pedigree to a directed graph.'</span>)
<a name="l00692"></a>00692             <span class="keywordflow">except</span>:
<a name="l00693"></a>00693                 logging.error(<span class="stringliteral">'[savegraph]: Unable to convert pedigree to a directed graph.'</span>)
<a name="l00694"></a>00694         <span class="keywordflow">try</span>:
<a name="l00695"></a>00695             <span class="keyword">import</span> networkx <span class="keyword">as</span> NX
<a name="l00696"></a>00696             NX.write_adjlist(pedgraph, pedoutfile)
<a name="l00697"></a>00697         <span class="keywordflow">except</span>:
<a name="l00698"></a>00698             logging.error(<span class="stringliteral">'[savegraph]: Unable to save directed graph to a file.'</span>)
<a name="l00699"></a>00699 
<a name="l00700"></a>00700     <span class="comment">##</span>
<a name="l00701"></a>00701     <span class="comment"># savegedcom() save a pedigree to a file in GEDCOM 5.5 format.</span>
<a name="l00702"></a>00702     <span class="comment"># @param self Reference to current object</span>
<a name="l00703"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#e829b44b7d97dd9d1ff1288a2512d76e">00703</a>     <span class="comment"># @param pedoutfile Name of the file to which the graph is written</span>
<a name="l00704"></a>00704     <span class="comment"># @retval None</span>
<a name="l00705"></a>00705     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#e829b44b7d97dd9d1ff1288a2512d76e">savegedcom</a>(self, pedoutfile=0):
<a name="l00706"></a>00706         <span class="stringliteral">"""</span>
<a name="l00707"></a>00707 <span class="stringliteral">        Save a pedigree to a file in GEDCOM 5.5 format.</span>
<a name="l00708"></a>00708 <span class="stringliteral">        """</span>
<a name="l00709"></a>00709         <span class="keywordflow">if</span> <span class="keywordflow">not</span> pedoutfile:
<a name="l00710"></a>00710             pedoutfile = <span class="stringliteral">'%s.ged'</span> % ( self.kw[<span class="stringliteral">'pedfile'</span>] )
<a name="l00711"></a>00711         <span class="keywordflow">try</span>:
<a name="l00712"></a>00712             pyp_io.save_to_gedcom(self,pedoutfile)
<a name="l00713"></a>00713             logging.info(<span class="stringliteral">'[savegedcom]: Saved GEDCOM pedigree to the file %s.'</span>, pedoutfile)
<a name="l00714"></a>00714         <span class="keywordflow">except</span>:
<a name="l00715"></a>00715             logging.error(<span class="stringliteral">'[savegedcom]: Unable to save GEDCOM pedigree to the file %s.'</span>, pedoutfile)
<a name="l00716"></a>00716 
<a name="l00717"></a>00717     <span class="comment">##</span>
<a name="l00718"></a>00718     <span class="comment"># savegenes() save a pedigree to a file in GENES 1.20 (dBase III) format.</span>
<a name="l00719"></a>00719     <span class="comment"># @param self Reference to current object</span>
<a name="l00720"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#128d6a0d698b1c220de4bb6b9a23d4f3">00720</a>     <span class="comment"># @param pedoutfile Name of the file to which the graph is written</span>
<a name="l00721"></a>00721     <span class="comment"># @retval None</span>
<a name="l00722"></a>00722     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#128d6a0d698b1c220de4bb6b9a23d4f3">savegenes</a>(self, pedoutfile=0):
<a name="l00723"></a>00723         <span class="stringliteral">"""</span>
<a name="l00724"></a>00724 <span class="stringliteral">        Save a pedigree to a file in GENES 1.20 (dBase III) format.</span>
<a name="l00725"></a>00725 <span class="stringliteral">        """</span>
<a name="l00726"></a>00726         <span class="keywordflow">if</span> <span class="keywordflow">not</span> pedoutfile:
<a name="l00727"></a>00727             pedoutfile = <span class="stringliteral">'%s.dbf'</span> % ( self.kw[<span class="stringliteral">'pedfile'</span>] )
<a name="l00728"></a>00728         <span class="keywordflow">try</span>:
<a name="l00729"></a>00729             pyp_io.save_to_genes(self,pedoutfile)
<a name="l00730"></a>00730             logging.info(<span class="stringliteral">'[savegenes]: Saved GENES pedigree to the file %s.'</span>, pedoutfile)
<a name="l00731"></a>00731         <span class="keywordflow">except</span>:
<a name="l00732"></a>00732             logging.error(<span class="stringliteral">'[savegenes]: Unable to save GENES pedigree to the file %s.'</span>, pedoutfile)
<a name="l00733"></a>00733 
<a name="l00734"></a>00734     <span class="comment">##</span>
<a name="l00735"></a>00735     <span class="comment"># savedb() saves a pedigree to a database table in ASDx format</span>
<a name="l00736"></a>00736     <span class="comment"># for NewAnimals and LightAnimals.</span>
<a name="l00737"></a>00737     <span class="comment"># @param self Reference to current object.</span>
<a name="l00738"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#1f2aa48947e38c370c66c48a5e307c0e">00738</a>     <span class="comment"># @param drop Boolean indicating if existing data should be kept (False) or deleted (True); the default is False.</span>
<a name="l00739"></a>00739     <span class="comment"># @retval _savedb_status Boolean indicating if the pedigree was successfully saved.</span>
<a name="l00740"></a>00740     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#1f2aa48947e38c370c66c48a5e307c0e">savedb</a>(self, drop=False):
<a name="l00741"></a>00741         <span class="stringliteral">"""</span>
<a name="l00742"></a>00742 <span class="stringliteral">        savedb() saves a pedigree to a database table in ASDx format</span>
<a name="l00743"></a>00743 <span class="stringliteral">        for NewAnimals and LightAnimals.</span>
<a name="l00744"></a>00744 <span class="stringliteral">        """</span>
<a name="l00745"></a>00745         _savedb_status = <span class="keyword">False</span>
<a name="l00746"></a>00746         _table_loaded = <span class="keyword">False</span>
<a name="l00747"></a>00747         _table_created = <span class="keyword">False</span>
<a name="l00748"></a>00748         <span class="comment"># Create the database -- this will overwrite an existing DB with the</span>
<a name="l00749"></a>00749         <span class="comment"># same name!</span>
<a name="l00750"></a>00750         <span class="keywordflow">if</span> pyp_db.doesTableExist(self) <span class="keywordflow">and</span> drop == <span class="keyword">True</span>:
<a name="l00751"></a>00751             pyp_db.deleteTable(self)
<a name="l00752"></a>00752         conn = pyp_db.connectToDatabase(self)
<a name="l00753"></a>00753         <span class="keywordflow">if</span> conn:
<a name="l00754"></a>00754             <span class="keywordflow">if</span> <span class="keywordflow">not</span> pyp_db.doesTableExist(self):
<a name="l00755"></a>00755                 <span class="keywordflow">try</span>:
<a name="l00756"></a>00756                     sql = <span class="stringliteral">'create table %s ( \</span>
<a name="l00757"></a>00757 <span class="stringliteral">                        animalName   varchar(128) primary key, \</span>
<a name="l00758"></a>00758 <span class="stringliteral">                        sireName     varchar(128), \</span>
<a name="l00759"></a>00759 <span class="stringliteral">                        damName      varchar(128), \</span>
<a name="l00760"></a>00760 <span class="stringliteral">                        sex          char(1) \</span>
<a name="l00761"></a>00761 <span class="stringliteral">                    );'</span> % ( self.kw[<span class="stringliteral">'database_table'</span>] )
<a name="l00762"></a>00762                     cursor = conn.Execute(sql)
<a name="l00763"></a>00763                     cursor.Close()
<a name="l00764"></a>00764                     _table_created = <span class="keyword">True</span>
<a name="l00765"></a>00765                 <span class="keywordflow">except</span>:
<a name="l00766"></a>00766                     <span class="keywordflow">pass</span>
<a name="l00767"></a>00767             <span class="keywordflow">else</span>:
<a name="l00768"></a>00768                 <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span>:
<a name="l00769"></a>00769                     <span class="keywordflow">print</span> <span class="stringliteral">'[WARNING]: The table %s already exists in database %s and you told me to save the existing data. You may end up with duplicate data or multiple pedigrees stored in the same table!'</span> % ( self.kw[<span class="stringliteral">'database_table'</span>], self.kw[<span class="stringliteral">'database_name'</span>] )
<a name="l00770"></a>00770                 logging.warning(<span class="stringliteral">'The table %s already exists in database %s and you told me to save the existing data. You may end up with duplicate data or multiple pedigrees stored in the same table!'</span>,self.kw[<span class="stringliteral">'database_table'</span>], self.kw[<span class="stringliteral">'database_name'</span>])
<a name="l00771"></a>00771             <span class="comment"># Load the pedigree data into the table.</span>
<a name="l00772"></a>00772             <span class="keywordflow">if</span> pyp_db.doesTableExist(self):
<a name="l00773"></a>00773                 <span class="keywordflow">try</span>:
<a name="l00774"></a>00774                     <span class="keywordflow">for</span> p <span class="keywordflow">in</span> self.pedigree:
<a name="l00775"></a>00775                         an = p.name
<a name="l00776"></a>00776                         si = p.sireName
<a name="l00777"></a>00777                         da = p.damName
<a name="l00778"></a>00778                         <span class="keywordflow">if</span> si == self.kw[<span class="stringliteral">'missing_name'</span>]:
<a name="l00779"></a>00779                             si = self.kw[<span class="stringliteral">'missing_parent'</span>]
<a name="l00780"></a>00780                         <span class="keywordflow">if</span> da == self.kw[<span class="stringliteral">'missing_name'</span>]:
<a name="l00781"></a>00781                             da = self.kw[<span class="stringliteral">'missing_parent'</span>]
<a name="l00782"></a>00782                         sql = <span class="stringliteral">"INSERT INTO %s ( animalName, sireName, damName, sex ) VALUES ('%s', '%s', '%s', '%s')"</span> % ( self.kw[<span class="stringliteral">'database_table'</span>], an, si, da, p.sex )
<a name="l00783"></a>00783                         cursor = conn.Execute(sql)
<a name="l00784"></a>00784                         cursor.Close()
<a name="l00785"></a>00785                     _table_loaded = <span class="keyword">True</span>
<a name="l00786"></a>00786                 <span class="keywordflow">except</span>:
<a name="l00787"></a>00787                     <span class="keywordflow">pass</span>
<a name="l00788"></a>00788             conn.Close()
<a name="l00789"></a>00789         <span class="keywordflow">else</span>:
<a name="l00790"></a>00790             <span class="keywordflow">pass</span>
<a name="l00791"></a>00791         <span class="keywordflow">if</span> _table_loaded:
<a name="l00792"></a>00792             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span>:
<a name="l00793"></a>00793                 <span class="keywordflow">print</span> <span class="stringliteral">'[INFO]: Saved pedigree to %s.%s at %s.'</span> % ( self.kw[<span class="stringliteral">'database_name'</span>], \
<a name="l00794"></a>00794                     self.kw[<span class="stringliteral">'database_table'</span>], pyp_utils.pyp_nice_time() )
<a name="l00795"></a>00795             logging.info(<span class="stringliteral">'Saved pedigree to %s.%s at %s.'</span>,self.kw[<span class="stringliteral">'database_name'</span>], \
<a name="l00796"></a>00796                 self.kw[<span class="stringliteral">'database_table'</span>], pyp_utils.pyp_nice_time())
<a name="l00797"></a>00797             _savedb_status = <span class="keyword">True</span>
<a name="l00798"></a>00798         <span class="keywordflow">else</span>:
<a name="l00799"></a>00799             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span>:
<a name="l00800"></a>00800                 <span class="keywordflow">print</span> <span class="stringliteral">'[ERROR]: Could not save pedigree to %s.%s at %s.'</span> % ( \
<a name="l00801"></a>00801                     self.kw[<span class="stringliteral">'database_name'</span>], self.kw[<span class="stringliteral">'database_table'</span>], pyp_utils.pyp_nice_time() )
<a name="l00802"></a>00802             logging.error(<span class="stringliteral">'Could not save pedigree to %s.%s at %s.'</span>,self.kw[<span class="stringliteral">'database_name'</span>], \
<a name="l00803"></a>00803                 self.kw[<span class="stringliteral">'database_table'</span>], pyp_utils.pyp_nice_time())
<a name="l00804"></a>00804         <span class="keywordflow">return</span> _savedb_status
<a name="l00805"></a>00805 
<a name="l00806"></a>00806     <span class="comment">##</span>
<a name="l00807"></a>00807     <span class="comment"># preprocess() processes a pedigree file, which includes reading the animals</span>
<a name="l00808"></a>00808     <span class="comment"># into a list of animal objects, forming lists of sires and dams, and checking for</span>
<a name="l00809"></a>00809     <span class="comment"># common errors.</span>
<a name="l00810"></a>00810     <span class="comment"># @param self Reference to current object</span>
<a name="l00811"></a>00811     <span class="comment"># @param textstream String containing animal records</span>
<a name="l00812"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#8b8bf9fe199dd47854f2208a6751b185">00812</a>     <span class="comment"># @param dbstream List of tuples of animal records</span>
<a name="l00813"></a>00813     <span class="comment"># @retval None</span>
<a name="l00814"></a>00814     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#8b8bf9fe199dd47854f2208a6751b185">preprocess</a>(self, textstream='', dbstream=''):
<a name="l00815"></a>00815         <span class="stringliteral">"""</span>
<a name="l00816"></a>00816 <span class="stringliteral">        Preprocess a pedigree file, which includes reading the animals into a list, forming lists of sires and dams, and checking for common errors.</span>
<a name="l00817"></a>00817 <span class="stringliteral">        """</span>
<a name="l00818"></a>00818         lineCounter = 0     <span class="comment"># count the number of lines in the pedigree file</span>
<a name="l00819"></a>00819         animalCounter = 0   <span class="comment"># count the number of animal records in the pedigree file</span>
<a name="l00820"></a>00820         <span class="comment">#pedformat_codes = ['a','s','d','g','x','b','f','r','n','y','l','e','p','A','S','D','L','Z','h','H','u']</span>
<a name="l00821"></a>00821         critical_count = 0  <span class="comment"># Number of critical errors encountered</span>
<a name="l00822"></a>00822         pedformat_locations = {} <span class="comment"># Stores columns numbers for input data</span>
<a name="l00823"></a>00823         _sires = {}         <span class="comment"># We need to track the sires and dams read from the pedigree</span>
<a name="l00824"></a>00824         _dams = {}          <span class="comment"># file in order to insert records for any parents that do not</span>
<a name="l00825"></a>00825                             <span class="comment"># have their own records in the pedigree file.</span>
<a name="l00826"></a>00826         <span class="comment"># A variable, 'pedformat, is passed as a parameter that indicates the format of the</span>
<a name="l00827"></a>00827         <span class="comment"># pedigree in the input file.  Note that A PEDIGREE FORMAT STRING IS NO LONGER</span>
<a name="l00828"></a>00828         <span class="comment"># REQUIRED in the input file, and any found will be ignored.  The index of the single-</span>
<a name="l00829"></a>00829         <span class="comment"># digit code in the format string indicates the column in which the corresponding</span>
<a name="l00830"></a>00830         <span class="comment"># variable is found.  Duplicate values in the pedformat atring are ignored.</span>
<a name="l00831"></a>00831         <span class="comment">#print self.kw['pedformat']</span>
<a name="l00832"></a>00832         <span class="keywordflow">if</span> <span class="keywordflow">not</span> self.kw[<span class="stringliteral">'pedformat'</span>]:
<a name="l00833"></a>00833             self.kw[<span class="stringliteral">'pedformat'</span>] = <span class="stringliteral">'asd'</span>
<a name="l00834"></a>00834             logging.error(<span class="stringliteral">'Null pedigree format string assigned a default value.'</span>)
<a name="l00835"></a>00835             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span>:
<a name="l00836"></a>00836                 <span class="keywordflow">print</span> <span class="stringliteral">'[ERROR]: Null pedigree format string assigned a default value.'</span>
<a name="l00837"></a>00837         <span class="comment"># This is where we check the format string to figure out what we have in the input file.</span>
<a name="l00838"></a>00838         <span class="comment"># Check for valid characters...</span>
<a name="l00839"></a>00839         _pedformat = []
<a name="l00840"></a>00840         <span class="keywordflow">for</span> _char <span class="keywordflow">in</span> self.kw[<span class="stringliteral">'pedformat'</span>]:
<a name="l00841"></a>00841             <span class="keywordflow">if</span> _char <span class="keywordflow">in</span> self.pedformat_codes <span class="keywordflow">and</span> _char != <span class="stringliteral">'Z'</span>:
<a name="l00842"></a>00842                 _pedformat.append(_char)
<a name="l00843"></a>00843             <span class="keywordflow">elif</span> _char <span class="keywordflow">in</span> self.pedformat_codes <span class="keywordflow">and</span> _char == <span class="stringliteral">'Z'</span>:
<a name="l00844"></a>00844                 _pedformat.append(<span class="stringliteral">'.'</span>)
<a name="l00845"></a>00845                 <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span>:
<a name="l00846"></a>00846                     <span class="keywordflow">print</span> <span class="stringliteral">'[INFO]: Skipping one or more columns in the input file'</span>
<a name="l00847"></a>00847                 logging.info(<span class="stringliteral">'Skipping one or more columns in the input file as requested by the pedigree format string %s'</span>,self.kw[<span class="stringliteral">'pedformat'</span>])
<a name="l00848"></a>00848             <span class="keywordflow">else</span>:
<a name="l00849"></a>00849                 <span class="comment"># Replace the invalid code with a period, which is ignored when the string is parsed.</span>
<a name="l00850"></a>00850                 _pedformat.append(<span class="stringliteral">'.'</span>)
<a name="l00851"></a>00851                 <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span>:
<a name="l00852"></a>00852                     <span class="keywordflow">print</span> <span class="stringliteral">'[DEBUG]: Invalid format code, %s, encountered!'</span> % (_char)
<a name="l00853"></a>00853                 logging.error(<span class="stringliteral">'Invalid column format code %s found while reading pedigree format string %s'</span>,_char,self.kw[<span class="stringliteral">'pedformat'</span>])
<a name="l00854"></a>00854         <span class="keywordflow">for</span> _char <span class="keywordflow">in</span> _pedformat:
<a name="l00855"></a>00855             <span class="keywordflow">try</span>:
<a name="l00856"></a>00856                 pedformat_locations[<span class="stringliteral">'animal'</span>] = _pedformat.index(<span class="stringliteral">'a'</span>)
<a name="l00857"></a>00857             <span class="keywordflow">except</span> ValueError:
<a name="l00858"></a>00858                 <span class="keywordflow">try</span>:
<a name="l00859"></a>00859                     pedformat_locations[<span class="stringliteral">'animal'</span>] = _pedformat.index(<span class="stringliteral">'A'</span>)
<a name="l00860"></a>00860                 <span class="keywordflow">except</span> ValueError:
<a name="l00861"></a>00861                     <span class="keywordflow">print</span> <span class="stringliteral">'[CRITICAL]: No animal identification code was specified in the pedigree format string %s!  This is a critical error and the program will halt.'</span> % (_pedformat)
<a name="l00862"></a>00862                     critical_count = critical_count + 1
<a name="l00863"></a>00863             <span class="keywordflow">try</span>:
<a name="l00864"></a>00864                 pedformat_locations[<span class="stringliteral">'sire'</span>] = _pedformat.index(<span class="stringliteral">'s'</span>)
<a name="l00865"></a>00865             <span class="keywordflow">except</span> ValueError:
<a name="l00866"></a>00866                 <span class="keywordflow">try</span>:
<a name="l00867"></a>00867                     pedformat_locations[<span class="stringliteral">'sire'</span>] = _pedformat.index(<span class="stringliteral">'S'</span>)
<a name="l00868"></a>00868                 <span class="keywordflow">except</span> ValueError:
<a name="l00869"></a>00869                     <span class="keywordflow">print</span> <span class="stringliteral">'[CRITICAL]: No sire identification code was specified in the pedigree format string %s!  This is a critical error and the program will halt.'</span> % (_pedformat)
<a name="l00870"></a>00870                     critical_count = critical_count + 1
<a name="l00871"></a>00871             <span class="keywordflow">try</span>:
<a name="l00872"></a>00872                 pedformat_locations[<span class="stringliteral">'dam'</span>] = _pedformat.index(<span class="stringliteral">'d'</span>)
<a name="l00873"></a>00873             <span class="keywordflow">except</span> ValueError:
<a name="l00874"></a>00874                 <span class="keywordflow">try</span>:
<a name="l00875"></a>00875                     pedformat_locations[<span class="stringliteral">'dam'</span>] = _pedformat.index(<span class="stringliteral">'D'</span>)
<a name="l00876"></a>00876                 <span class="keywordflow">except</span> ValueError:
<a name="l00877"></a>00877                     <span class="keywordflow">print</span> <span class="stringliteral">'[CRITICAL]: No dam identification code was specified in the pedigree format string %s!  This is a critical error and the program will halt.'</span> % (_pedformat)
<a name="l00878"></a>00878                     critical_count = critical_count + 1
<a name="l00879"></a>00879             <span class="keywordflow">try</span>:
<a name="l00880"></a>00880                 pedformat_locations[<span class="stringliteral">'generation'</span>] = _pedformat.index(<span class="stringliteral">'g'</span>)
<a name="l00881"></a>00881             <span class="keywordflow">except</span> ValueError:
<a name="l00882"></a>00882                 pedformat_locations[<span class="stringliteral">'generation'</span>] = -999
<a name="l00883"></a>00883                 <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'all'</span>:
<a name="l00884"></a>00884                     <span class="keywordflow">print</span> <span class="stringliteral">'[DEBUG]: No generation code was specified in the pedigree format string %s.  This program will continue.'</span> % (self.kw[<span class="stringliteral">'pedformat'</span>])
<a name="l00885"></a>00885             <span class="keywordflow">try</span>:
<a name="l00886"></a>00886                 pedformat_locations[<span class="stringliteral">'gencoeff'</span>] = _pedformat.index(<span class="stringliteral">'p'</span>)
<a name="l00887"></a>00887                 <span class="keywordflow">if</span> <span class="keywordflow">not</span> self.kw[<span class="stringliteral">'gen_coeff'</span>]:
<a name="l00888"></a>00888                     self.kw[<span class="stringliteral">'gen_coeff'</span>] = 1
<a name="l00889"></a>00889             <span class="keywordflow">except</span> ValueError:
<a name="l00890"></a>00890                 pedformat_locations[<span class="stringliteral">'gencoeff'</span>] = -999
<a name="l00891"></a>00891                 <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'gen_coeff'</span>]:
<a name="l00892"></a>00892                     self.kw[<span class="stringliteral">'gen_coeff'</span>] = 0
<a name="l00893"></a>00893                 <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'all'</span>:
<a name="l00894"></a>00894                     <span class="keywordflow">print</span> <span class="stringliteral">'[DEBUG]: No generation coefficient was specified in the pedigree format string %s.  This program will continue.'</span> % (self.kw[<span class="stringliteral">'pedformat'</span>])
<a name="l00895"></a>00895             <span class="keywordflow">try</span>:
<a name="l00896"></a>00896                 pedformat_locations[<span class="stringliteral">'sex'</span>] = _pedformat.index(<span class="stringliteral">'x'</span>)
<a name="l00897"></a>00897             <span class="keywordflow">except</span> ValueError:
<a name="l00898"></a>00898                 pedformat_locations[<span class="stringliteral">'sex'</span>] = -999
<a name="l00899"></a>00899                 <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'all'</span>:
<a name="l00900"></a>00900                     <span class="keywordflow">print</span> <span class="stringliteral">'[DEBUG]: No sex code was specified in the pedigree format string %s.  This program will continue.'</span> % (self.kw[<span class="stringliteral">'pedformat'</span>])
<a name="l00901"></a>00901             <span class="keywordflow">try</span>:
<a name="l00902"></a>00902                 pedformat_locations[<span class="stringliteral">'birthyear'</span>] = _pedformat.index(<span class="stringliteral">'y'</span>)
<a name="l00903"></a>00903             <span class="keywordflow">except</span> ValueError:
<a name="l00904"></a>00904                 pedformat_locations[<span class="stringliteral">'birthyear'</span>] = -999
<a name="l00905"></a>00905                 <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'all'</span>:
<a name="l00906"></a>00906                     <span class="keywordflow">print</span> <span class="stringliteral">'[DEBUG]: No birth date (YYYY) code was specified in the pedigree format string %s.  This program will continue.'</span> % (self.kw[<span class="stringliteral">'pedformat'</span>])
<a name="l00907"></a>00907             <span class="keywordflow">try</span>:
<a name="l00908"></a>00908                 pedformat_locations[<span class="stringliteral">'inbreeding'</span>] = _pedformat.index(<span class="stringliteral">'f'</span>)
<a name="l00909"></a>00909             <span class="keywordflow">except</span> ValueError:
<a name="l00910"></a>00910                 pedformat_locations[<span class="stringliteral">'inbreeding'</span>] = -999
<a name="l00911"></a>00911                 <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'all'</span>:
<a name="l00912"></a>00912                     <span class="keywordflow">print</span> <span class="stringliteral">'[DEBUG]: No coeffcient of inbreeding code was specified in the pedigree format string %s.  This program will continue.'</span> % (self.kw[<span class="stringliteral">'pedformat'</span>])
<a name="l00913"></a>00913             <span class="keywordflow">try</span>:
<a name="l00914"></a>00914                 pedformat_locations[<span class="stringliteral">'breed'</span>] = _pedformat.index(<span class="stringliteral">'</span><span class="stringliteral">r')</span>
<a name="l00915"></a>00915 <span class="stringliteral">            </span><span class="keywordflow">except</span> ValueError:
<a name="l00916"></a>00916                 pedformat_locations[<span class="stringliteral">'breed'</span>] = -999
<a name="l00917"></a>00917                 <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'all'</span>:
<a name="l00918"></a>00918                     <span class="keywordflow">print</span> <span class="stringliteral">'[DEBUG]: No breed code was specified in the pedigree format string %s.  This program will continue.'</span> % (self.kw[<span class="stringliteral">'pedformat'</span>])
<a name="l00919"></a>00919             <span class="keywordflow">try</span>:
<a name="l00920"></a>00920                 pedformat_locations[<span class="stringliteral">'name'</span>] = _pedformat.index(<span class="stringliteral">'n'</span>)
<a name="l00921"></a>00921             <span class="keywordflow">except</span> ValueError:
<a name="l00922"></a>00922                 pedformat_locations[<span class="stringliteral">'name'</span>] = -999
<a name="l00923"></a>00923                 <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'all'</span>:
<a name="l00924"></a>00924                     <span class="keywordflow">print</span> <span class="stringliteral">'[DEBUG]: No name code was specified in the pedigree format string %s.  This program will continue.'</span> % (self.kw[<span class="stringliteral">'pedformat'</span>])
<a name="l00925"></a>00925             <span class="keywordflow">try</span>:
<a name="l00926"></a>00926                 pedformat_locations[<span class="stringliteral">'birthdate'</span>] = _pedformat.index(<span class="stringliteral">'b'</span>)
<a name="l00927"></a>00927             <span class="keywordflow">except</span> ValueError:
<a name="l00928"></a>00928                 pedformat_locations[<span class="stringliteral">'birthdate'</span>] = -999
<a name="l00929"></a>00929                 <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'all'</span>:
<a name="l00930"></a>00930                     <span class="keywordflow">print</span> <span class="stringliteral">'[DEBUG]: No birth date (MMDDYYYY) code was specified in the pedigree format string %s.  This program will continue.'</span> % ( self.kw[<span class="stringliteral">'pedformat'</span>] )
<a name="l00931"></a>00931             <span class="keywordflow">try</span>:
<a name="l00932"></a>00932                 pedformat_locations[<span class="stringliteral">'alive'</span>] = _pedformat.index(<span class="stringliteral">'l'</span>)
<a name="l00933"></a>00933             <span class="keywordflow">except</span> ValueError:
<a name="l00934"></a>00934                 pedformat_locations[<span class="stringliteral">'alive'</span>] = -999
<a name="l00935"></a>00935                 <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'all'</span>:
<a name="l00936"></a>00936                     <span class="keywordflow">print</span> <span class="stringliteral">'[DEBUG]: No alive/dead code was specified in the pedigree format string %s.  This program will continue.'</span> % ( self.kw[<span class="stringliteral">'pedformat'</span>] )
<a name="l00937"></a>00937             <span class="keywordflow">try</span>:
<a name="l00938"></a>00938                 pedformat_locations[<span class="stringliteral">'age'</span>] = _pedformat.index(<span class="stringliteral">'e'</span>)
<a name="l00939"></a>00939             <span class="keywordflow">except</span> ValueError:
<a name="l00940"></a>00940                 pedformat_locations[<span class="stringliteral">'age'</span>] = -999
<a name="l00941"></a>00941                 <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'all'</span>:
<a name="l00942"></a>00942                     <span class="keywordflow">print</span> <span class="stringliteral">'[DEBUG]: No age code was specified in the pedigree format string %s.  This program will continue.'</span> % (self.kw[<span class="stringliteral">'pedformat'</span>])
<a name="l00943"></a>00943             <span class="keywordflow">try</span>:
<a name="l00944"></a>00944                 pedformat_locations[<span class="stringliteral">'alleles'</span>] = _pedformat.index(<span class="stringliteral">'L'</span>)
<a name="l00945"></a>00945                 <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'alleles_sepchar'</span>] == self.kw[<span class="stringliteral">'sepchar'</span>]:
<a name="l00946"></a>00946                     <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'all'</span>:
<a name="l00947"></a>00947                         <span class="keywordflow">print</span> <span class="stringliteral">'[DEBUG]: The same separating character was specified for both columns of input (option sepchar) and alleles (option alleles_sepchar) in an animal\'s allelotype.  The allelotypes will not be used in this pedigree.'</span>
<a name="l00948"></a>00948                     logging.warning(<span class="stringliteral">'The same separating character was specified for both columns of input (option sepchar) and alleles (option alleles_sepchar) in an animal\'s allelotype.  The allelotypes will not be used in this pedigree.'</span>)
<a name="l00949"></a>00949                     pedformat_locations[<span class="stringliteral">'alleles'</span>] = -999
<a name="l00950"></a>00950             <span class="keywordflow">except</span> ValueError:
<a name="l00951"></a>00951                     pedformat_locations[<span class="stringliteral">'alleles'</span>] = -999
<a name="l00952"></a>00952                     <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'all'</span>:
<a name="l00953"></a>00953                         <span class="keywordflow">print</span> <span class="stringliteral">'[DEBUG]: No alleles code was specified in the pedigree format string %s.  This program will continue.'</span> % (self.kw[<span class="stringliteral">'pedformat'</span>])
<a name="l00954"></a>00954             <span class="keywordflow">try</span>:
<a name="l00955"></a>00955                 pedformat_locations[<span class="stringliteral">'herd'</span>] = _pedformat.index(<span class="stringliteral">'h'</span>)
<a name="l00956"></a>00956             <span class="keywordflow">except</span> ValueError:
<a name="l00957"></a>00957                 pedformat_locations[<span class="stringliteral">'herd'</span>] = -999
<a name="l00958"></a>00958                 <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'all'</span>:
<a name="l00959"></a>00959                     <span class="keywordflow">print</span> <span class="stringliteral">'[DEBUG]: No herd code was specified in the pedigree format string %s.  This program will continue.'</span> % (self.kw[<span class="stringliteral">'pedformat'</span>])
<a name="l00960"></a>00960             <span class="keywordflow">try</span>:
<a name="l00961"></a>00961                 pedformat_locations[<span class="stringliteral">'herd'</span>] = _pedformat.index(<span class="stringliteral">'H'</span>)
<a name="l00962"></a>00962             <span class="keywordflow">except</span> ValueError:
<a name="l00963"></a>00963                 pedformat_locations[<span class="stringliteral">'herd'</span>] = -999
<a name="l00964"></a>00964                 <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'all'</span>:
<a name="l00965"></a>00965                     <span class="keywordflow">print</span> <span class="stringliteral">'[DEBUG]: No herd code was specified in the pedigree format string %s.  This program will continue.'</span> % (self.kw[<span class="stringliteral">'pedformat'</span>])
<a name="l00966"></a>00966             <span class="keywordflow">try</span>:
<a name="l00967"></a>00967                 pedformat_locations[<span class="stringliteral">'userfield'</span>] = _pedformat.index(<span class="stringliteral">'</span><span class="stringliteral">u')</span>
<a name="l00968"></a>00968 <span class="stringliteral">            </span><span class="keywordflow">except</span> ValueError:
<a name="l00969"></a>00969                 pedformat_locations[<span class="stringliteral">'userfield'</span>] = -999
<a name="l00970"></a>00970                 <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'all'</span>:
<a name="l00971"></a>00971                     <span class="keywordflow">print</span> <span class="stringliteral">'[DEBUG]: No user-defined field was specified in the pedigree format string %s. This program will continue.'</span> % (self.kw[<span class="stringliteral">'pedformat'</span>])
<a name="l00972"></a>00972         <span class="comment">#print self.kw['pedformat']</span>
<a name="l00973"></a>00973         <span class="comment">#print _pedformat</span>
<a name="l00974"></a>00974         <span class="comment">#print pedformat_locations</span>
<a name="l00975"></a>00975         <span class="comment"># If the pedigree file includes coefficients of inbreeding flag the</span>
<a name="l00976"></a>00976         <span class="comment"># pedigree.</span>
<a name="l00977"></a>00977         <span class="keywordflow">if</span> <span class="stringliteral">'f'</span> <span class="keywordflow">in</span> self.kw[<span class="stringliteral">'pedformat'</span>]:
<a name="l00978"></a>00978             self.kw[<span class="stringliteral">'f_computed'</span>] = 1
<a name="l00979"></a>00979         <span class="keywordflow">if</span> critical_count &gt; 0:
<a name="l00980"></a>00980             sys.exit(0)
<a name="l00981"></a>00981         <span class="keywordflow">else</span>:
<a name="l00982"></a>00982             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span> <span class="keywordflow">and</span> self.kw[<span class="stringliteral">'pedigree_summary'</span>]:
<a name="l00983"></a>00983                 <span class="keywordflow">print</span> <span class="stringliteral">'[INFO]: Opening pedigree file %s'</span> % ( self.kw[<span class="stringliteral">'pedfile'</span>] )
<a name="l00984"></a>00984             logging.info(<span class="stringliteral">'Opening pedigree file %s'</span>,self.kw[<span class="stringliteral">'pedfile'</span>])
<a name="l00985"></a>00985             <span class="keywordflow">if</span> textstream == <span class="stringliteral">''</span> <span class="keywordflow">and</span> dbstream == <span class="stringliteral">''</span>:
<a name="l00986"></a>00986                 infile = open(self.kw[<span class="stringliteral">'pedfile'</span>],<span class="stringliteral">'</span><span class="stringliteral">r')</span>
<a name="l00987"></a>00987 <span class="stringliteral">            </span><span class="keywordflow">elif</span> dbstream == <span class="stringliteral">''</span>:
<a name="l00988"></a>00988                 <span class="comment"># Parse the textstream</span>
<a name="l00989"></a>00989                 <span class="comment"># Note that this will cause the loss of the last record in the</span>
<a name="l00990"></a>00990                 <span class="comment"># string if that record DOES NOT have a trailing \n as the</span>
<a name="l00991"></a>00991                 <span class="comment"># documentation says it must.</span>
<a name="l00992"></a>00992                 infile = textstream.split(<span class="stringliteral">'\n'</span>)
<a name="l00993"></a>00993                 infile = infile[:-1]
<a name="l00994"></a>00994             <span class="keywordflow">else</span>:
<a name="l00995"></a>00995                 <span class="comment"># dbstream is a list of tuples from a database</span>
<a name="l00996"></a>00996                 infile = dbstream
<a name="l00997"></a>00997                 counter = 0
<a name="l00998"></a>00998             <span class="keywordflow">while</span> 1:
<a name="l00999"></a>00999                 <span class="keywordflow">if</span> textstream == <span class="stringliteral">''</span> <span class="keywordflow">and</span> dbstream == <span class="stringliteral">''</span>:
<a name="l01000"></a>01000                     line = infile.readline()                                    <span class="comment">#print line</span>
<a name="l01001"></a>01001                 <span class="keywordflow">elif</span> dbstream == <span class="stringliteral">''</span>:
<a name="l01002"></a>01002                     <span class="keywordflow">try</span>:
<a name="l01003"></a>01003                         line = infile.pop()
<a name="l01004"></a>01004                         <span class="comment">#print 'line: %s' % ( line )</span>
<a name="l01005"></a>01005                     <span class="keywordflow">except</span> IndexError:
<a name="l01006"></a>01006                         logging.warning(<span class="stringliteral">'Reached the end of the textstream after reading %s records.'</span>, lineCounter)
<a name="l01007"></a>01007                         line = <span class="keyword">False</span>
<a name="l01008"></a>01008                 <span class="keywordflow">else</span>:
<a name="l01009"></a>01009                     <span class="comment"># Do tuple unpacking on database records</span>
<a name="l01010"></a>01010                     <span class="keywordflow">try</span>:
<a name="l01011"></a>01011                         <span class="comment">#dbline = dbstream.pop()</span>
<a name="l01012"></a>01012                         <span class="comment"># Code from Matt Kelly -- dbstream.pop() didn't wprl for him on OS/X 1.0.4</span>
<a name="l01013"></a>01013                         dbline = dbstream[counter]
<a name="l01014"></a>01014                         line = <span class="stringliteral">','</span>.join(dbline)
<a name="l01015"></a>01015                         counter = counter + 1
<a name="l01016"></a>01016                     <span class="keywordflow">except</span> IndexError:
<a name="l01017"></a>01017                         logging.info(<span class="stringliteral">'Reached the end of the dbstream after reading %s records.'</span>, lineCounter)
<a name="l01018"></a>01018                         line = <span class="keyword">False</span>
<a name="l01019"></a>01019                 <span class="keywordflow">if</span> <span class="keywordflow">not</span> line:
<a name="l01020"></a>01020                     logging.info(<span class="stringliteral">'Reached end-of-line in %s after reading %s lines.'</span>, self.kw[<span class="stringliteral">'pedfile'</span>],lineCounter)
<a name="l01021"></a>01021                     <span class="keywordflow">break</span>
<a name="l01022"></a>01022                 <span class="keywordflow">else</span>:
<a name="l01023"></a>01023                     <span class="comment"># 29 March 2005</span>
<a name="l01024"></a>01024                     <span class="comment"># This causes problems b/c it eats the last column of the last record in a pedigree</span>
<a name="l01025"></a>01025                     <span class="comment"># file.  I think I added it way back when to deal with some EOL-character annoyance,</span>
<a name="l01026"></a>01026                     <span class="comment"># but I am not sure.  So...I am turning it off (for now).</span>
<a name="l01027"></a>01027                     <span class="comment">#line = string.strip(line[:-1])</span>
<a name="l01028"></a>01028                     lineCounter = lineCounter + 1
<a name="l01029"></a>01029                     <span class="keywordflow">if</span> lineCounter &lt;= self.kw[<span class="stringliteral">'log_ped_lines'</span>]:
<a name="l01030"></a>01030                         logging.info(<span class="stringliteral">'Pedigree (line %s): %s'</span>,lineCounter,string.strip(line))
<a name="l01031"></a>01031                     <span class="keywordflow">if</span> line[0] == <span class="stringliteral">'#'</span>:
<a name="l01032"></a>01032                         logging.info(<span class="stringliteral">'Pedigree comment (line %s): %s'</span>,lineCounter,string.strip(line))
<a name="l01033"></a>01033                         <span class="keywordflow">pass</span>
<a name="l01034"></a>01034                     <span class="keywordflow">elif</span> line[0] == <span class="stringliteral">'%'</span>:
<a name="l01035"></a>01035                         self.kw[<span class="stringliteral">'old_pedformat'</span>] = string.strip(line[1:]) <span class="comment"># this lets us specify the format of the pedigree file</span>
<a name="l01036"></a>01036                         logging.warning(<span class="stringliteral">'Encountered deprecated pedigree format string (%s) on line %s of the pedigree file.'</span>,line,lineCounter)
<a name="l01037"></a>01037                     <span class="comment"># Thomas von Hassel sent me a pedigree whose last line was blank but for a tab.  In</span>
<a name="l01038"></a>01038                     <span class="comment"># debugging that problem I realized that there was no check for null lines.  This 'elif'</span>
<a name="l01039"></a>01039                     <span class="comment"># catches blank lines so that they are not treated as actuall records and logs them.</span>
<a name="l01040"></a>01040                     <span class="keywordflow">elif</span> len(string.strip(line)) == 0:
<a name="l01041"></a>01041                         logging.warning(<span class="stringliteral">'Encountered an empty (blank) record on line %s of the pedigree file.'</span>,lineCounter)
<a name="l01042"></a>01042                     <span class="keywordflow">else</span>:
<a name="l01043"></a>01043                         animalCounter = animalCounter + 1
<a name="l01044"></a>01044                         <span class="keywordflow">if</span> numpy.fmod(animalCounter,self.kw[<span class="stringliteral">'counter'</span>]) == 0:
<a name="l01045"></a>01045                             logging.info(<span class="stringliteral">'Records read: %s '</span>,animalCounter)
<a name="l01046"></a>01046                         <span class="comment"># string.strip()-ing line deals with problems from trailing sepchars,</span>
<a name="l01047"></a>01047                         <span class="comment"># most notably spaces. Is there a nice way to deal with the situation</span>
<a name="l01048"></a>01048                         <span class="comment"># of multiple sepchars with no data between them?</span>
<a name="l01049"></a>01049                         l = string.split(string.strip(line),self.kw[<span class="stringliteral">'sepchar'</span>])
<a name="l01050"></a>01050                         <span class="comment">#print l</span>
<a name="l01051"></a>01051                         <span class="comment"># I am adding in a check here to make sure that the number of fields</span>
<a name="l01052"></a>01052                         <span class="comment"># expected from the pedigree format string and the number of fields in</span>
<a name="l01053"></a>01053                         <span class="comment"># the datalines of the pedigree are the same.  If they are not, there is</span>
<a name="l01054"></a>01054                         <span class="comment"># a problem that the user needs to handle.</span>
<a name="l01055"></a>01055                         <span class="keywordflow">if</span> len(self.kw[<span class="stringliteral">'pedformat'</span>]) == len(l):
<a name="l01056"></a>01056                             self.namemap = {}
<a name="l01057"></a>01057                             self.namebackmap = {}
<a name="l01058"></a>01058                             <span class="comment">#print line</span>
<a name="l01059"></a>01059                             <span class="comment">#print l</span>
<a name="l01060"></a>01060                             <span class="comment"># Some people *cough* Brad Heins *cough* insist on sending me pedigree</span>
<a name="l01061"></a>01061                             <span class="comment"># files vomited out by Excel, which pads cells in a column with spaces</span>
<a name="l01062"></a>01062                             <span class="comment"># to right-align them...</span>
<a name="l01063"></a>01063                             <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(len(l)):
<a name="l01064"></a>01064                                 l[i] = string.strip(l[i])
<a name="l01065"></a>01065                             <span class="keywordflow">if</span> len(l) &lt; 3:
<a name="l01066"></a>01066                                 errorString = <span class="stringliteral">'The record on line %s of file %s is too short - all records must contain animal, sire, and dam ID numbers (%s fields detected).\n'</span> % (lineCounter,self.kw[<span class="stringliteral">'pedfile'</span>],len(l))
<a name="l01067"></a>01067                                 <span class="keywordflow">print</span> <span class="stringliteral">'[ERROR]: %s'</span> % (errorString)
<a name="l01068"></a>01068                                 <span class="keywordflow">print</span> <span class="stringliteral">'[ERROR]: %s'</span> % (line)
<a name="l01069"></a>01069                                 sys.exit(0)
<a name="l01070"></a>01070                             <span class="keywordflow">else</span>:
<a name="l01071"></a>01071                                 <span class="keywordflow">if</span> l[0] != self.kw[<span class="stringliteral">'missing_parent'</span>]:
<a name="l01072"></a>01072                                     <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'animal_type'</span>] == <span class="stringliteral">'light'</span>:
<a name="l01073"></a>01073                                         an = LightAnimal(pedformat_locations,l,self.kw)
<a name="l01074"></a>01074                                     <span class="keywordflow">else</span>:
<a name="l01075"></a>01075                                         an = NewAnimal(pedformat_locations,l,self.kw)
<a name="l01076"></a>01076                                     <span class="comment">#print an.animalID,' ',an.sireID,' ',an.damID</span>
<a name="l01077"></a>01077                                     <span class="comment">#an.printme()</span>
<a name="l01078"></a>01078                                 <span class="keywordflow">else</span>:
<a name="l01079"></a>01079                                     errorString = <span class="stringliteral">'The record on line %s of file %s has an animal ID that is the same as the missing value code specified for the pedigree. This animal is being skipped and will not have an entry in the pedigree.\n'</span> % ( lineCounter, self.kw[<span class="stringliteral">'pedfile'</span>] )
<a name="l01080"></a>01080                                     <span class="keywordflow">print</span> <span class="stringliteral">'[ERROR]: %s'</span> % (errorString)
<a name="l01081"></a>01081                                     logging.error(errorString)
<a name="l01082"></a>01082                                 <span class="comment">#print 'Animal Name: ', an.name</span>
<a name="l01083"></a>01083                                 <span class="comment"># If strings are used for sire and dam IDs we need</span>
<a name="l01084"></a>01084                                 <span class="comment"># to put the names in the _sires or _dams dictionary</span>
<a name="l01085"></a>01085                                 <span class="comment"># rather than the ID.  If we put in the IDs the</span>
<a name="l01086"></a>01086                                 <span class="comment"># missing sire and dam catcher code will not work</span>
<a name="l01087"></a>01087                                 <span class="comment"># correctly.</span>
<a name="l01088"></a>01088                                 <span class="comment">#print 'Animal ID: ', an.animalID</span>
<a name="l01089"></a>01089                                 <span class="keywordflow">if</span> <span class="stringliteral">'S'</span> <span class="keywordflow">in</span> self.kw[<span class="stringliteral">'pedformat'</span>]:
<a name="l01090"></a>01090                                     <span class="keywordflow">if</span> an.sireName != self.kw[<span class="stringliteral">'missing_name'</span>]:
<a name="l01091"></a>01091                                         _sires[an.sireName] = an.sireName
<a name="l01092"></a>01092                                     <span class="keywordflow">else</span>:
<a name="l01093"></a>01093                                         <span class="comment">#print '\tAnimal %s has sire %s' % ( an.animalID, an.sireID )</span>
<a name="l01094"></a>01094                                         <span class="keywordflow">pass</span>
<a name="l01095"></a>01095                                 <span class="keywordflow">else</span>:
<a name="l01096"></a>01096                                     <span class="comment">#if str(an.sireID) != str(self.kw['missing_parent']):</span>
<a name="l01097"></a>01097                                     <span class="keywordflow">if</span> str(an.sireID) != str(self.kw[<span class="stringliteral">'missing_parent'</span>]):
<a name="l01098"></a>01098                                         _sires[an.sireID] = an.sireID
<a name="l01099"></a>01099                                 <span class="keywordflow">if</span> <span class="stringliteral">'D'</span> <span class="keywordflow">in</span> self.kw[<span class="stringliteral">'pedformat'</span>]:
<a name="l01100"></a>01100                                     <span class="keywordflow">if</span> an.damName != self.kw[<span class="stringliteral">'missing_name'</span>]:
<a name="l01101"></a>01101                                         _dams[an.damName] = an.damName
<a name="l01102"></a>01102                                     <span class="keywordflow">else</span>:
<a name="l01103"></a>01103                                         <span class="comment">#print '\tAnimal %s has dam %s' % ( an.animalID, an.damID )</span>
<a name="l01104"></a>01104                                         <span class="keywordflow">pass</span>
<a name="l01105"></a>01105                                 <span class="keywordflow">else</span>:
<a name="l01106"></a>01106                                     <span class="keywordflow">if</span> str(an.damID) != str(self.kw[<span class="stringliteral">'missing_parent'</span>]):
<a name="l01107"></a>01107                                         _dams[an.damID] = an.damID
<a name="l01108"></a>01108                                 <span class="comment">#print an.sireID</span>
<a name="l01109"></a>01109                                 <span class="comment">#print an.damID</span>
<a name="l01110"></a>01110                                 self.pedigree.append(an)
<a name="l01111"></a>01111                                 <span class="comment"># If strings are used for animals names we need</span>
<a name="l01112"></a>01112                                 <span class="comment"># to put those names in idmap and backmap so that</span>
<a name="l01113"></a>01113                                 <span class="comment"># the missing sire and dam assignment code will</span>
<a name="l01114"></a>01114                                 <span class="comment"># work correctly.</span>
<a name="l01115"></a>01115                                 <span class="comment"># !!! Note that this is broken if you renumber</span>
<a name="l01116"></a>01116                                 <span class="comment"># the pedigree. In that case, use the namemap</span>
<a name="l01117"></a>01117                                 <span class="comment"># to map from name to original ID, and the</span>
<a name="l01118"></a>01118                                 <span class="comment"># backmap to go from the original ID to the</span>
<a name="l01119"></a>01119                                 <span class="comment"># renumbered ID.</span>
<a name="l01120"></a>01120                                 <span class="keywordflow">if</span> <span class="stringliteral">'A'</span> <span class="keywordflow">in</span> self.kw[<span class="stringliteral">'pedformat'</span>]:
<a name="l01121"></a>01121                                     self.idmap[an.name] = an.name
<a name="l01122"></a>01122                                     self.backmap[an.name] = an.name
<a name="l01123"></a>01123                                     <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'animal_type'</span>] == <span class="stringliteral">'new'</span>:
<a name="l01124"></a>01124                                         self.namemap[an.name] = an.name
<a name="l01125"></a>01125                                         self.namebackmap[an.name] = an.name
<a name="l01126"></a>01126                                 <span class="keywordflow">else</span>:
<a name="l01127"></a>01127                                     self.idmap[an.animalID] = an.animalID
<a name="l01128"></a>01128                                     self.backmap[an.animalID] = an.animalID
<a name="l01129"></a>01129                                     <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'animal_type'</span>] == <span class="stringliteral">'new'</span>:
<a name="l01130"></a>01130                                         self.namemap[an.name] = an.animalID
<a name="l01131"></a>01131                                         self.namebackmap[an.animalID] = an.name
<a name="l01132"></a>01132                         <span class="keywordflow">else</span>:
<a name="l01133"></a>01133                             errorString = <span class="stringliteral">'The record on line %s of file %s has %s columns, but the pedigree format string (%s) says that it should have %s columns. Please check your pedigree file and the pedigree format string for errors.\n'</span> % ( lineCounter, self.kw[<span class="stringliteral">'pedfile'</span>], len(l), \
<a name="l01134"></a>01134                             self.kw[<span class="stringliteral">'pedformat'</span>], len(self.kw[<span class="stringliteral">'pedformat'</span>]) )
<a name="l01135"></a>01135                             <span class="keywordflow">print</span> <span class="stringliteral">'[ERROR]: %s'</span> % (errorString)
<a name="l01136"></a>01136                             logging.error(errorString)
<a name="l01137"></a>01137                             sys.exit(0)
<a name="l01138"></a>01138             <span class="comment">#</span>
<a name="l01139"></a>01139             <span class="comment"># This is where we deal with parents with no pedigree file entry.</span>
<a name="l01140"></a>01140             <span class="comment"># Things are kind of tricky when we are working with the S and D</span>
<a name="l01141"></a>01141             <span class="comment"># codes.</span>
<a name="l01142"></a>01142             <span class="comment">#</span>
<a name="l01143"></a>01143             _null_locations = pedformat_locations
<a name="l01144"></a>01144             <span class="keywordflow">for</span> _n <span class="keywordflow">in</span> _null_locations.keys():
<a name="l01145"></a>01145                 _null_locations[_n] = -999
<a name="l01146"></a>01146             _null_locations[<span class="stringliteral">'animal'</span>] = 0
<a name="l01147"></a>01147             _null_locations[<span class="stringliteral">'sire'</span>] = 1
<a name="l01148"></a>01148             _null_locations[<span class="stringliteral">'dam'</span>] = 2
<a name="l01149"></a>01149             <span class="comment">#print _null_locations</span>
<a name="l01150"></a>01150             <span class="comment">#print 'INFO: idmap = %s' % (self.idmap)</span>
<a name="l01151"></a>01151             <span class="comment">#print 'INFO: _sires = %s' % (_sires)</span>
<a name="l01152"></a>01152             <span class="comment">#print 'INFO: _dams = %s' % (_dams)</span>
<a name="l01153"></a>01153             <span class="keywordflow">for</span> _s <span class="keywordflow">in</span> _sires.keys():
<a name="l01154"></a>01154                 <span class="keywordflow">try</span>:
<a name="l01155"></a>01155                     _i = self.idmap[_s]
<a name="l01156"></a>01156                 <span class="keywordflow">except</span> KeyError:
<a name="l01157"></a>01157                     <span class="keywordflow">if</span> ( <span class="stringliteral">'S'</span> <span class="keywordflow">in</span> self.kw[<span class="stringliteral">'pedformat'</span>] <span class="keywordflow">and</span> str(_s) != str(self.kw[<span class="stringliteral">'missing_name'</span>]) ) <span class="keywordflow">or</span> ( <span class="stringliteral">'s'</span> <span class="keywordflow">in</span> self.kw[<span class="stringliteral">'pedformat'</span>] <span class="keywordflow">and</span> str(_s) != str(self.kw[<span class="stringliteral">'missing_parent'</span>]) ):
<a name="l01158"></a>01158                         <span class="keywordflow">print</span> <span class="stringliteral">'[NOTE]: Adding sire %s to the pedigree'</span> % ( _s )
<a name="l01159"></a>01159                         an = NewAnimal(_null_locations,[_s,self.kw[<span class="stringliteral">'missing_parent'</span>],self.kw[<span class="stringliteral">'missing_parent'</span>]],self.kw)
<a name="l01160"></a>01160                         <span class="comment">#an.printme()</span>
<a name="l01161"></a>01161                         self.pedigree.append(an)
<a name="l01162"></a>01162                         self.idmap[an.animalID] = an.animalID
<a name="l01163"></a>01163                         self.backmap[an.animalID] = an.animalID
<a name="l01164"></a>01164                         self.namemap[an.name] = an.animalID
<a name="l01165"></a>01165                         self.namebackmap[an.animalID] = an.name
<a name="l01166"></a>01166                         logging.info(<span class="stringliteral">'Added pedigree entry for sire %s'</span> % (_s))
<a name="l01167"></a>01167                         <span class="keywordflow">print</span> <span class="stringliteral">'[NOTE]: Added pedigree entry for sire %s'</span> % (_s)
<a name="l01168"></a>01168             <span class="keywordflow">for</span> _d <span class="keywordflow">in</span> _dams.keys():
<a name="l01169"></a>01169                 <span class="keywordflow">try</span>:
<a name="l01170"></a>01170                     _i = self.idmap[_d]
<a name="l01171"></a>01171                 <span class="keywordflow">except</span> KeyError:
<a name="l01172"></a>01172                     <span class="keywordflow">if</span> ( <span class="stringliteral">'D'</span> <span class="keywordflow">in</span> self.kw[<span class="stringliteral">'pedformat'</span>] <span class="keywordflow">and</span> str(_d) != str(self.kw[<span class="stringliteral">'missing_name'</span>]) ) <span class="keywordflow">or</span> ( <span class="stringliteral">'d'</span> <span class="keywordflow">in</span> self.kw[<span class="stringliteral">'pedformat'</span>] <span class="keywordflow">and</span> str(_d) != str(self.kw[<span class="stringliteral">'missing_parent'</span>]) ):
<a name="l01173"></a>01173                         an = NewAnimal(_null_locations,[_d,self.kw[<span class="stringliteral">'missing_parent'</span>],self.kw[<span class="stringliteral">'missing_parent'</span>]],self.kw)
<a name="l01174"></a>01174     <span class="comment">#                    an.printme()</span>
<a name="l01175"></a>01175                         self.pedigree.append(an)
<a name="l01176"></a>01176                         self.idmap[an.animalID] = an.animalID
<a name="l01177"></a>01177                         self.backmap[an.animalID] = an.animalID
<a name="l01178"></a>01178                         self.namemap[an.name] = an.animalID
<a name="l01179"></a>01179                         self.namebackmap[an.animalID] = an.name
<a name="l01180"></a>01180                         logging.info(<span class="stringliteral">'Added pedigree entry for dam %s'</span> % (_d))
<a name="l01181"></a>01181                         <span class="keywordflow">print</span> <span class="stringliteral">'[NOTE]: Added pedigree entry for dam %s'</span> % (_d)
<a name="l01182"></a>01182             <span class="comment">#</span>
<a name="l01183"></a>01183             <span class="comment"># Finish up.</span>
<a name="l01184"></a>01184             <span class="comment">#</span>
<a name="l01185"></a>01185             logging.info(<span class="stringliteral">'Closing pedigree file'</span>)
<a name="l01186"></a>01186             <span class="keywordflow">if</span> textstream == <span class="stringliteral">''</span> <span class="keywordflow">and</span> dbstream == <span class="stringliteral">''</span>:
<a name="l01187"></a>01187                 infile.close()
<a name="l01188"></a>01188             <span class="keywordflow">elif</span> textstream == <span class="stringliteral">''</span>:
<a name="l01189"></a>01189                 del dbstream
<a name="l01190"></a>01190                 del infile
<a name="l01191"></a>01191             <span class="keywordflow">else</span>:
<a name="l01192"></a>01192                 del textstream
<a name="l01193"></a>01193                 del infile
<a name="l01194"></a>01194 
<a name="l01195"></a>01195     <span class="comment">##</span>
<a name="l01196"></a>01196     <span class="comment"># fromgraph() loads the animals to populate the pedigree from an</span>
<a name="l01197"></a>01197     <span class="comment"># XDiGraph object.</span>
<a name="l01198"></a>01198     <span class="comment"># @param self Reference to current object.</span>
<a name="l01199"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#1b9126f92cdabf0a641df4b43f9fbd88">01199</a>     <span class="comment"># @param pedgraph XDiGraph object containing a pedigree.</span>
<a name="l01200"></a>01200     <span class="comment"># @retval None</span>
<a name="l01201"></a>01201     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#1b9126f92cdabf0a641df4b43f9fbd88">fromgraph</a>(self, pedgraph):
<a name="l01202"></a>01202         <span class="stringliteral">"""</span>
<a name="l01203"></a>01203 <span class="stringliteral">        fromgraph() loads the animals to populate the pedigree from an</span>
<a name="l01204"></a>01204 <span class="stringliteral">        XDiGraph object.</span>
<a name="l01205"></a>01205 <span class="stringliteral">        """</span>
<a name="l01206"></a>01206         missing = [<span class="stringliteral">'sex'</span>,<span class="stringliteral">'generation'</span>,<span class="stringliteral">'gencoeff'</span>,<span class="stringliteral">'birthyear'</span>,    \
<a name="l01207"></a>01207             <span class="stringliteral">'inbreeding'</span>,<span class="stringliteral">'breed'</span>,<span class="stringliteral">'name'</span>,<span class="stringliteral">'birthdate'</span>,<span class="stringliteral">'alive'</span>,<span class="stringliteral">'age'</span>, \
<a name="l01208"></a>01208             <span class="stringliteral">'alleles'</span>,<span class="stringliteral">'herd'</span>,<span class="stringliteral">'userfield'</span>]
<a name="l01209"></a>01209         pedformat_locations = {}
<a name="l01210"></a>01210         pedformat_locations[<span class="stringliteral">'animal'</span>] = 0
<a name="l01211"></a>01211         pedformat_locations[<span class="stringliteral">'sire'</span>] = 1
<a name="l01212"></a>01212         pedformat_locations[<span class="stringliteral">'dam'</span>] = 2
<a name="l01213"></a>01213         <span class="keywordflow">for</span> _m <span class="keywordflow">in</span> missing:
<a name="l01214"></a>01214             pedformat_locations[_m] = -999
<a name="l01215"></a>01215         <span class="keywordflow">for</span> _n <span class="keywordflow">in</span> pedgraph.nodes():
<a name="l01216"></a>01216             _s = self.kw[<span class="stringliteral">'missing_parent'</span>]
<a name="l01217"></a>01217             _d = self.kw[<span class="stringliteral">'missing_parent'</span>]
<a name="l01218"></a>01218             <span class="keywordflow">for</span> _e <span class="keywordflow">in</span> pedgraph.in_edges(_n):
<a name="l01219"></a>01219                 <span class="keywordflow">if</span> _e[2] == <span class="stringliteral">'s'</span>: _s = _e[0]
<a name="l01220"></a>01220                 <span class="keywordflow">if</span> _e[2] == <span class="stringliteral">'d'</span>: _d = _e[0]
<a name="l01221"></a>01221             an = NewAnimal(pedformat_locations,[_n,_s,_d],self.kw)
<a name="l01222"></a>01222             self.pedigree.append(an)
<a name="l01223"></a>01223             self.idmap[an.animalID] = an.animalID
<a name="l01224"></a>01224             self.backmap[an.animalID] = an.animalID
<a name="l01225"></a>01225             self.namemap[an.name] = an.animalID
<a name="l01226"></a>01226             self.namebackmap[an.animalID] = an.name
<a name="l01227"></a>01227             logging.info(<span class="stringliteral">'Added pedigree entry for animal %s'</span> % (_n))
<a name="l01228"></a>01228 
<a name="l01229"></a>01229     <span class="comment">##</span>
<a name="l01230"></a>01230     <span class="comment"># tostream() creates a text stream from a pedigree.</span>
<a name="l01231"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a998edbd19d1789a469ffa4ec4b27547">01231</a>     <span class="comment"># @param self Reference to current object</span>
<a name="l01232"></a>01232     <span class="comment"># @retval None</span>
<a name="l01233"></a>01233     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#a998edbd19d1789a469ffa4ec4b27547">tostream</a>(self):
<a name="l01234"></a>01234         <span class="stringliteral">"""</span>
<a name="l01235"></a>01235 <span class="stringliteral">        tostream() creates a text stream from a pedigree.</span>
<a name="l01236"></a>01236 <span class="stringliteral">        """</span>
<a name="l01237"></a>01237         streamout = <span class="stringliteral">''</span>
<a name="l01238"></a>01238         <span class="keywordflow">try</span>:
<a name="l01239"></a>01239             <span class="keywordflow">for</span> p <span class="keywordflow">in</span> self.pedigree:
<a name="l01240"></a>01240                 an = p.name
<a name="l01241"></a>01241                 si = p.sireName
<a name="l01242"></a>01242                 da = p.damName
<a name="l01243"></a>01243                 <span class="keywordflow">if</span> si == self.kw[<span class="stringliteral">'missing_name'</span>]:
<a name="l01244"></a>01244                     si = self.kw[<span class="stringliteral">'missing_parent'</span>]
<a name="l01245"></a>01245                 <span class="keywordflow">if</span> da == self.kw[<span class="stringliteral">'missing_name'</span>]:
<a name="l01246"></a>01246                     da = self.kw[<span class="stringliteral">'missing_parent'</span>]
<a name="l01247"></a>01247                 streamout = <span class="stringliteral">'%s%s,%s,%s\\n'</span> % ( streamout, an, si, da )
<a name="l01248"></a>01248             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span>:
<a name="l01249"></a>01249                 <span class="keywordflow">print</span> <span class="stringliteral">'[INFO]: Created text stream from pedigree.'</span>
<a name="l01250"></a>01250             logging.info(<span class="stringliteral">'Created text stream from pedigree.'</span>)
<a name="l01251"></a>01251         <span class="keywordflow">except</span>:
<a name="l01252"></a>01252             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span>:
<a name="l01253"></a>01253                 <span class="keywordflow">print</span> <span class="stringliteral">'[ERROR]: Could not create text stream from pedigree!'</span>
<a name="l01254"></a>01254             logging.error(<span class="stringliteral">'Could not create text stream from pedigree!'</span>)
<a name="l01255"></a>01255         <span class="keywordflow">return</span> streamout
<a name="l01256"></a>01256 
<a name="l01257"></a>01257     <span class="comment">##</span>
<a name="l01258"></a>01258     <span class="comment"># renumber() updates the ID map after a pedigree has been renumbered so that all references</span>
<a name="l01259"></a>01259     <span class="comment"># are to renumbered rather than original IDs.</span>
<a name="l01260"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#0a4949ed75e4c820f4464a1a4067f693">01260</a>     <span class="comment"># @param self Reference to current object</span>
<a name="l01261"></a>01261     <span class="comment"># @retval None</span>
<a name="l01262"></a>01262     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#0a4949ed75e4c820f4464a1a4067f693">renumber</a>(self):
<a name="l01263"></a>01263         <span class="stringliteral">"""</span>
<a name="l01264"></a>01264 <span class="stringliteral">        renumber() updates the ID map after a pedigree has been renumbered so that all</span>
<a name="l01265"></a>01265 <span class="stringliteral">        references are to renumbered rather than original IDs.</span>
<a name="l01266"></a>01266 <span class="stringliteral">        """</span>
<a name="l01267"></a>01267         <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span> <span class="keywordflow">and</span> self.kw[<span class="stringliteral">'pedigree_summary'</span>]:
<a name="l01268"></a>01268             <span class="keywordflow">print</span> <span class="stringliteral">'\t[INFO]: Renumbering pedigree at %s'</span> % ( pyp_utils.pyp_nice_time() )
<a name="l01269"></a>01269             <span class="keywordflow">print</span> <span class="stringliteral">'\t\t[INFO]: Reordering pedigree at %s'</span> % ( pyp_utils.pyp_nice_time() )
<a name="l01270"></a>01270         logging.info(<span class="stringliteral">'Reordering pedigree'</span>)
<a name="l01271"></a>01271         <span class="keywordflow">if</span> ( <span class="stringliteral">'b'</span> <span class="keywordflow">in</span> self.kw[<span class="stringliteral">'pedformat'</span>] <span class="keywordflow">or</span> <span class="stringliteral">'y'</span> <span class="keywordflow">in</span> self.kw[<span class="stringliteral">'pedformat'</span>] ) <span class="keywordflow">and</span> <span class="keywordflow">not</span> self.kw[<span class="stringliteral">'slow_reorder'</span>]:
<a name="l01272"></a>01272             self.pedigree = pyp_utils.fast_reorder(self.pedigree)
<a name="l01273"></a>01273         <span class="keywordflow">else</span>:
<a name="l01274"></a>01274             self.pedigree = pyp_utils.reorder(self.pedigree,missingparent=self.kw[<span class="stringliteral">'missing_parent'</span>],max_rounds=self.kw[<span class="stringliteral">'reorder_max_rounds'</span>])
<a name="l01275"></a>01275         <span class="comment">#self.pedigree = pyp_utils.reorder(self.pedigree,missingparent=self.kw['missing_parent'],max_rounds=self.kw['reorder_max_rounds'])</span>
<a name="l01276"></a>01276         <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span> <span class="keywordflow">and</span> self.kw[<span class="stringliteral">'pedigree_summary'</span>]:
<a name="l01277"></a>01277             <span class="keywordflow">print</span> <span class="stringliteral">'\t\t[INFO]: Renumbering at %s'</span> % ( pyp_utils.pyp_nice_time() )
<a name="l01278"></a>01278         logging.info(<span class="stringliteral">'Renumbering pedigree'</span>)
<a name="l01279"></a>01279         self.pedigree = pyp_utils.renumber(self.pedigree,missingparent=self.kw[<span class="stringliteral">'missing_parent'</span>],animaltype=self.kw[<span class="stringliteral">'animal_type'</span>])
<a name="l01280"></a>01280         <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span> <span class="keywordflow">and</span> self.kw[<span class="stringliteral">'pedigree_summary'</span>]:
<a name="l01281"></a>01281             <span class="keywordflow">print</span> <span class="stringliteral">'\t\t[INFO]: Updating ID map at %s'</span> % ( pyp_utils.pyp_nice_time() )
<a name="l01282"></a>01282         logging.info(<span class="stringliteral">'Updating ID map'</span>)
<a name="l01283"></a>01283         self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#0b46b68901afa096913e9ab85c1148af">updateidmap</a>()
<a name="l01284"></a>01284 
<a name="l01285"></a>01285         <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span> <span class="keywordflow">and</span> self.kw[<span class="stringliteral">'pedigree_summary'</span>]:
<a name="l01286"></a>01286             <span class="keywordflow">print</span> <span class="stringliteral">'\t[INFO]: Assigning offspring at %s'</span> % ( pyp_utils.pyp_nice_time() )
<a name="l01287"></a>01287         logging.info(<span class="stringliteral">'Assigning offspring'</span>)
<a name="l01288"></a>01288         pyp_utils.assign_offspring(self)
<a name="l01289"></a>01289         self.kw[<span class="stringliteral">'pedigree_is_renumbered'</span>] = 1
<a name="l01290"></a>01290         self.kw[<span class="stringliteral">'assign_offspring'</span>] = 1
<a name="l01291"></a>01291 
<a name="l01292"></a>01292     <span class="comment">##</span>
<a name="l01293"></a>01293     <span class="comment"># addanimal() adds a new animal of class NewAnimal to the pedigree.</span>
<a name="l01294"></a>01294     <span class="comment"># @param self Reference to current object.</span>
<a name="l01295"></a>01295     <span class="comment"># @param animalID ID of the new animal to be added to the pedigree.</span>
<a name="l01296"></a>01296     <span class="comment"># @param sireID Sire ID of the new animal to be added to the pedigree.</span>
<a name="l01297"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#b29b1a56379a81b821b6f4eaa9377ad4">01297</a>     <span class="comment"># @param damID Dam ID of the new animal to be added to the pedigree.</span>
<a name="l01298"></a>01298     <span class="comment"># @retval 1 on success, 0 on failure</span>
<a name="l01299"></a>01299     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#b29b1a56379a81b821b6f4eaa9377ad4">addanimal</a>(self, animalID, sireID, damID):
<a name="l01300"></a>01300         <span class="comment">#print 'animalID: ', animalID</span>
<a name="l01301"></a>01301         <span class="comment">#print 'sireID: ', sireID</span>
<a name="l01302"></a>01302         <span class="comment">#print 'damID: ', damID</span>
<a name="l01303"></a>01303         _added = 0
<a name="l01304"></a>01304         <span class="keywordflow">if</span> <span class="keywordflow">not</span> self.kw[<span class="stringliteral">'pedigree_is_renumbered'</span>]:
<a name="l01305"></a>01305             logging.warning(<span class="stringliteral">'Adding an animal to an unrenumbered pedigree using NewPedigree::addanimal() is unsafe!'</span>)
<a name="l01306"></a>01306         <span class="keywordflow">try</span>:
<a name="l01307"></a>01307             missing = [<span class="stringliteral">'sex'</span>,<span class="stringliteral">'generation'</span>,<span class="stringliteral">'gencoeff'</span>,<span class="stringliteral">'birthyear'</span>,    \
<a name="l01308"></a>01308                 <span class="stringliteral">'inbreeding'</span>,<span class="stringliteral">'breed'</span>,<span class="stringliteral">'name'</span>,<span class="stringliteral">'birthdate'</span>,<span class="stringliteral">'alive'</span>,<span class="stringliteral">'age'</span>, \
<a name="l01309"></a>01309                 <span class="stringliteral">'alleles'</span>,<span class="stringliteral">'herd'</span>,<span class="stringliteral">'userfield'</span>]
<a name="l01310"></a>01310             pedformat_locations = {}
<a name="l01311"></a>01311             pedformat_locations[<span class="stringliteral">'animal'</span>] = 0
<a name="l01312"></a>01312             pedformat_locations[<span class="stringliteral">'sire'</span>] = 1
<a name="l01313"></a>01313             pedformat_locations[<span class="stringliteral">'dam'</span>] = 2
<a name="l01314"></a>01314             <span class="keywordflow">for</span> _m <span class="keywordflow">in</span> missing:
<a name="l01315"></a>01315                 pedformat_locations[_m] = -999
<a name="l01316"></a>01316             l = []
<a name="l01317"></a>01317             l.append(animalID)
<a name="l01318"></a>01318             <span class="keywordflow">if</span> sireID == 0:
<a name="l01319"></a>01319                 l.append(self.kw[<span class="stringliteral">'missing_parent'</span>])
<a name="l01320"></a>01320             <span class="keywordflow">elif</span> <span class="stringliteral">'S'</span> <span class="keywordflow">in</span> self.kw[<span class="stringliteral">'pedformat'</span>]:
<a name="l01321"></a>01321                 <span class="comment">#l.append(self.namebackmap[sireID])</span>
<a name="l01322"></a>01322                 l.append(self.namebackmap[self.backmap[sireID]])
<a name="l01323"></a>01323             <span class="keywordflow">else</span>:
<a name="l01324"></a>01324                 l.append(str(sireID))
<a name="l01325"></a>01325             <span class="keywordflow">if</span> damID == 0:
<a name="l01326"></a>01326                 l.append(self.kw[<span class="stringliteral">'missing_parent'</span>])
<a name="l01327"></a>01327             <span class="keywordflow">elif</span> <span class="stringliteral">'D'</span> <span class="keywordflow">in</span> self.kw[<span class="stringliteral">'pedformat'</span>]:
<a name="l01328"></a>01328                 <span class="comment">#l.append(self.namebackmap[damID])</span>
<a name="l01329"></a>01329                 l.append(self.namebackmap[self.backmap[damID]])
<a name="l01330"></a>01330             <span class="keywordflow">else</span>:
<a name="l01331"></a>01331                 l.append(str(damID))
<a name="l01332"></a>01332             <span class="comment"># This is a hack. When the ASD format is used,</span>
<a name="l01333"></a>01333             <span class="comment"># NewAnimal::__init__() will hash the animal</span>
<a name="l01334"></a>01334             <span class="comment"># ID we pass it unless we have some way of</span>
<a name="l01335"></a>01335             <span class="comment"># telling it that this particular animal</span>
<a name="l01336"></a>01336             <span class="comment"># should be handled in a way that is different</span>
<a name="l01337"></a>01337             <span class="comment"># from that specified in the pedformat.</span>
<a name="l01338"></a>01338             self.kw[<span class="stringliteral">'newanimal_caller'</span>] = <span class="stringliteral">'addanimal'</span>
<a name="l01339"></a>01339             an = NewAnimal(pedformat_locations,l,self.kw)
<a name="l01340"></a>01340             self.kw[<span class="stringliteral">'newanimal_caller'</span>] = <span class="stringliteral">'loader'</span>
<a name="l01341"></a>01341             self.pedigree.append(an)
<a name="l01342"></a>01342 
<a name="l01343"></a>01343             <span class="comment"># If the pedigree is renumbered, we need to</span>
<a name="l01344"></a>01344             <span class="comment"># renumber the new animal or we'll get index</span>
<a name="l01345"></a>01345             <span class="comment"># out of range errors.</span>
<a name="l01346"></a>01346             <span class="comment">#print 'animalID: ', an.animalID</span>
<a name="l01347"></a>01347             an.animalID = max(self.idmap.values()) + 1
<a name="l01348"></a>01348             an.renumberedID = an.animalID
<a name="l01349"></a>01349             <span class="keywordflow">if</span> <span class="stringliteral">'n'</span> <span class="keywordflow">in</span> self.kw[<span class="stringliteral">'pedformat'</span>]:
<a name="l01350"></a>01350                 an.name = self.kw[<span class="stringliteral">'missing_name'</span>]
<a name="l01351"></a>01351             <span class="keywordflow">if</span> an.name == an.originalID:
<a name="l01352"></a>01352                 an.name = an.renumberedID
<a name="l01353"></a>01353             an.sireID = self.idmap[an.sireID]
<a name="l01354"></a>01354             an.damID = self.idmap[an.damID]
<a name="l01355"></a>01355             <span class="comment"># Now update the various ID and name maps</span>
<a name="l01356"></a>01356             self.idmap[an.originalID] = an.animalID
<a name="l01357"></a>01357             self.backmap[an.animalID] = an.originalID
<a name="l01358"></a>01358             self.namemap[an.name] = an.originalID
<a name="l01359"></a>01359             self.namebackmap[an.originalID] = an.name
<a name="l01360"></a>01360             <span class="comment">#print self.idmap</span>
<a name="l01361"></a>01361             _added = 1
<a name="l01362"></a>01362         <span class="keywordflow">except</span>:
<a name="l01363"></a>01363             _added = 0
<a name="l01364"></a>01364         <span class="keywordflow">return</span> _added
<a name="l01365"></a>01365 
<a name="l01366"></a>01366     <span class="comment">##</span>
<a name="l01367"></a>01367     <span class="comment"># delanimal() deletes an animal from the pedigree. Note that this</span>
<a name="l01368"></a>01368     <span class="comment"># method DOES not update the metadata attached to the pedigree</span>
<a name="l01369"></a>01369     <span class="comment"># and should only be used if that is not important. As of 04/10/2006</span>
<a name="l01370"></a>01370     <span class="comment"># delanimal() is intended for use by pyp_metrics/mating_coi() rather</span>
<a name="l01371"></a>01371     <span class="comment"># than directly by users.</span>
<a name="l01372"></a>01372     <span class="comment"># @param self Reference to current object</span>
<a name="l01373"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#f881348d3e7ec96469fe9c5a9b2c1ce7">01373</a>     <span class="comment"># @param animalID ID of the animal to be deleted</span>
<a name="l01374"></a>01374     <span class="comment"># @retval 1 on success, 0 on failure</span>
<a name="l01375"></a>01375     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#f881348d3e7ec96469fe9c5a9b2c1ce7">delanimal</a>(self, animalID):
<a name="l01376"></a>01376         _deleted = 0
<a name="l01377"></a>01377         <span class="keywordflow">if</span> <span class="keywordflow">not</span> self.kw[<span class="stringliteral">'pedigree_is_renumbered'</span>]:
<a name="l01378"></a>01378             logging.warning(<span class="stringliteral">'Deleting an animal from an unrenumbered pedigree using NewPedigree::delanimal() is unsafe!'</span>)
<a name="l01379"></a>01379         <span class="keywordflow">try</span>:
<a name="l01380"></a>01380             anidx = self.idmap[animalID]-1
<a name="l01381"></a>01381             del(self.namebackmap[self.pedigree[anidx].originalID])
<a name="l01382"></a>01382             del(self.namemap[self.pedigree[anidx].name])
<a name="l01383"></a>01383             del(self.backmap[self.pedigree[anidx].renumberedID])
<a name="l01384"></a>01384             del(self.idmap[animalID])
<a name="l01385"></a>01385             del(self.pedigree[anidx])
<a name="l01386"></a>01386             _deleted = 1
<a name="l01387"></a>01387         <span class="keywordflow">except</span>:
<a name="l01388"></a>01388             _deleted
<a name="l01389"></a>01389         <span class="keywordflow">return</span> _deleted
<a name="l01390"></a>01390 
<a name="l01391"></a>01391     <span class="comment">##</span>
<a name="l01392"></a>01392     <span class="comment"># updateidmap() updates the ID map after a pedigree has been renumbered so that all references</span>
<a name="l01393"></a>01393     <span class="comment"># are to renumbered rather than original IDs.</span>
<a name="l01394"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#0b46b68901afa096913e9ab85c1148af">01394</a>     <span class="comment"># @param self Reference to current object</span>
<a name="l01395"></a>01395     <span class="comment"># @retval None</span>
<a name="l01396"></a>01396     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#0b46b68901afa096913e9ab85c1148af">updateidmap</a>(self):
<a name="l01397"></a>01397         <span class="stringliteral">"""</span>
<a name="l01398"></a>01398 <span class="stringliteral">        updateidmap() updates the ID map after a pedigree has been renumbered so that</span>
<a name="l01399"></a>01399 <span class="stringliteral">        all references are to renumbered rather than original IDs.</span>
<a name="l01400"></a>01400 <span class="stringliteral">        """</span>
<a name="l01401"></a>01401         <span class="comment">#print '[updateidmap]: Entered...'</span>
<a name="l01402"></a>01402         self.idmap = {}
<a name="l01403"></a>01403         self.backmap = {}
<a name="l01404"></a>01404         self.namemap = {}
<a name="l01405"></a>01405         self.namebackmap = {}
<a name="l01406"></a>01406         <span class="keywordflow">for</span> _a <span class="keywordflow">in</span> self.pedigree:
<a name="l01407"></a>01407             <span class="keywordflow">try</span>:
<a name="l01408"></a>01408                 <span class="comment">#if str(_a.originalID) == '43859378':</span>
<a name="l01409"></a>01409                 <span class="comment">#    print '[updateidmap]: originalID = 43859378'</span>
<a name="l01410"></a>01410                 <span class="comment">#    print '[updateidmap]: animalID = ', _a.animalID</span>
<a name="l01411"></a>01411                 <span class="comment">#    print '[updateidmap]: sireID = ', _a.sireID</span>
<a name="l01412"></a>01412                 <span class="comment">#    print '[updateidmap]: damID = ', _a.damID</span>
<a name="l01413"></a>01413                 self.idmap[_a.originalID] = _a.animalID
<a name="l01414"></a>01414                 self.backmap[_a.renumberedID] = _a.originalID
<a name="l01415"></a>01415                 <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'animal_type'</span>] == <span class="stringliteral">'new'</span>:
<a name="l01416"></a>01416                     self.namemap[_a.name] = _a.originalID
<a name="l01417"></a>01417                     self.namebackmap[_a.originalID] = _a.name
<a name="l01418"></a>01418                 <span class="comment">#print '%s =&gt; %s' % ( _a.renumberedID, self.backmap[_a.renumberedID] )</span>
<a name="l01419"></a>01419             <span class="keywordflow">except</span> KeyError:
<a name="l01420"></a>01420                  <span class="keywordflow">pass</span>
<a name="l01421"></a>01421 <span class="comment">#         print self.idmap</span>
<a name="l01422"></a>01422 <span class="comment">#         print self.backmap</span>
<a name="l01423"></a>01423 
<a name="l01424"></a>01424     <span class="comment">##</span>
<a name="l01425"></a>01425     <span class="comment"># printoptions() prints the contents of the options dictionary.</span>
<a name="l01426"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#fef73d557aedb4c5ccf3f64af4d6036b">01426</a>     <span class="comment"># @param self Reference to current object</span>
<a name="l01427"></a>01427     <span class="comment"># @retval None</span>
<a name="l01428"></a>01428     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#fef73d557aedb4c5ccf3f64af4d6036b">printoptions</a>(self):
<a name="l01429"></a>01429         <span class="stringliteral">"""</span>
<a name="l01430"></a>01430 <span class="stringliteral">        printoptions() prints the contents of the options dictionary.</span>
<a name="l01431"></a>01431 <span class="stringliteral">        """</span>
<a name="l01432"></a>01432         <span class="keywordflow">print</span> <span class="stringliteral">'%s OPTIONS'</span> % (self.kw[<span class="stringliteral">'pedname'</span>])
<a name="l01433"></a>01433         <span class="keywordflow">for</span> _k, _v <span class="keywordflow">in</span> self.kw.iteritems():
<a name="l01434"></a>01434             <span class="keywordflow">if</span> len(_k) &lt;= 14:
<a name="l01435"></a>01435                 <span class="keywordflow">print</span> <span class="stringliteral">'\t%s:\t\t%s'</span> % ( _k, _v )
<a name="l01436"></a>01436             <span class="keywordflow">else</span>:
<a name="l01437"></a>01437                 <span class="keywordflow">print</span> <span class="stringliteral">'\t%s:\t%s'</span> % ( _k, _v )
<a name="l01438"></a>01438 
<a name="l01439"></a>01439     <span class="comment">##</span>
<a name="l01440"></a>01440     <span class="comment"># simulate() simulates an arbitrary pedigree of size n with g generations</span>
<a name="l01441"></a>01441     <span class="comment"># starting from n_s base sires and n_d base dams.  This method is based on</span>
<a name="l01442"></a>01442     <span class="comment"># the concepts and algorithms in the Pedigree::sample method from Matvec</span>
<a name="l01443"></a>01443     <span class="comment"># 1.1a.  The arguments are read from the pedigree object's options</span>
<a name="l01444"></a>01444     <span class="comment"># dictionary.</span>
<a name="l01445"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#5abe1753cecd6d47f66a74720361ecf4">01445</a>     <span class="comment"># @param self Reference to current object</span>
<a name="l01446"></a>01446     <span class="comment"># @retval None</span>
<a name="l01447"></a>01447     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewPedigree.html#5abe1753cecd6d47f66a74720361ecf4">simulate</a>(self):
<a name="l01448"></a>01448         <span class="stringliteral">"""</span>
<a name="l01449"></a>01449 <span class="stringliteral">        Simulate simulates an arbitrary pedigree of size n with g generations</span>
<a name="l01450"></a>01450 <span class="stringliteral">        starting from n_s base sires and n_d base dams.  This method is based</span>
<a name="l01451"></a>01451 <span class="stringliteral">        on the concepts and algorithms in the Pedigree::sample method from</span>
<a name="l01452"></a>01452 <span class="stringliteral">        Matvec 1.1a (src/classes/pedigree.cpp), although all of the code in</span>
<a name="l01453"></a>01453 <span class="stringliteral">        this implementation was written from scratch.</span>
<a name="l01454"></a>01454 <span class="stringliteral">        """</span>
<a name="l01455"></a>01455         <span class="comment">#import random</span>
<a name="l01456"></a>01456         <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span>:
<a name="l01457"></a>01457             <span class="keywordflow">print</span> <span class="stringliteral">'[SIMULATE]: Preparing to simulate a pedigree'</span>
<a name="l01458"></a>01458             logging.info(<span class="stringliteral">'Preparing to simulate a pedigree'</span>)
<a name="l01459"></a>01459         <span class="comment"># If the current pedigree object has already been populated with</span>
<a name="l01460"></a>01460         <span class="comment"># animals simulate() will not overwrite those entries.</span>
<a name="l01461"></a>01461         <span class="keywordflow">if</span> len(self.pedigree) &gt; 0:
<a name="l01462"></a>01462             logging.error(<span class="stringliteral">'The simulate() method did not create a new randomly-generated pedigree because the pedigree %s has already been populated with animals.'</span>, self.kw[<span class="stringliteral">'pedname'</span>])
<a name="l01463"></a>01463             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span>:
<a name="l01464"></a>01464                 <span class="keywordflow">print</span> <span class="stringliteral">'[ERROR]: The simulate() method did not create a new randomly-generated pedigree because the pedigree %s has already been populated with animals.'</span> % ( self.kw[<span class="stringliteral">'pedname'</span>] )
<a name="l01465"></a>01465         <span class="comment"># Check arguments and assign defaults when invalid values are</span>
<a name="l01466"></a>01466         <span class="comment"># provided by the user.  Write messages to the log and console</span>
<a name="l01467"></a>01467         <span class="comment"># whenever user-specified values are overridden.</span>
<a name="l01468"></a>01468         self.kw[<span class="stringliteral">'simulate_n'</span>] = int(self.kw[<span class="stringliteral">'simulate_n'</span>])
<a name="l01469"></a>01469         self.kw[<span class="stringliteral">'simulate_g'</span>] = int(self.kw[<span class="stringliteral">'simulate_g'</span>])
<a name="l01470"></a>01470         self.kw[<span class="stringliteral">'simulate_ns'</span>] = int(self.kw[<span class="stringliteral">'simulate_ns'</span>])
<a name="l01471"></a>01471         self.kw[<span class="stringliteral">'simulate_nd'</span>] = int(self.kw[<span class="stringliteral">'simulate_nd'</span>])
<a name="l01472"></a>01472         self.kw[<span class="stringliteral">'simulate_sr'</span>] = float(self.kw[<span class="stringliteral">'simulate_sr'</span>])
<a name="l01473"></a>01473         self.kw[<span class="stringliteral">'simulate_ir'</span>] = float(self.kw[<span class="stringliteral">'simulate_ir'</span>])
<a name="l01474"></a>01474         self.kw[<span class="stringliteral">'simulate_pmd'</span>] = int(self.kw[<span class="stringliteral">'simulate_pmd'</span>])
<a name="l01475"></a>01475         <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'simulate_n'</span>] &lt; 1:
<a name="l01476"></a>01476             logging.warning(<span class="stringliteral">'You asked that a pedigree containing an invalid number of animals, %s, be simulated. The default number of animals, 15, is being used.'</span>, self.kw[<span class="stringliteral">'simulate_n'</span>])
<a name="l01477"></a>01477             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span>:
<a name="l01478"></a>01478                 <span class="keywordflow">print</span> <span class="stringliteral">'\t[SIMULATE]: You asked that a pedigree containing an invalid number of animals, %s, be simulated. The default number of animals, 15, is being used.'</span> % ( self.kw[<span class="stringliteral">'simulate_n'</span>] )
<a name="l01479"></a>01479             self.kw[<span class="stringliteral">'simulate_n'</span>] = 15
<a name="l01480"></a>01480         <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'simulate_g'</span>] &lt; 1:
<a name="l01481"></a>01481             logging.warning(<span class="stringliteral">'You asked that a pedigree containing an invalid number of generations, %s, be simulated. The default number of generations, 3, is being used.'</span>, self.kw[<span class="stringliteral">'simulate_g'</span>])
<a name="l01482"></a>01482             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span>:
<a name="l01483"></a>01483                 <span class="keywordflow">print</span> <span class="stringliteral">'\t[SIMULATE]: You asked that a pedigree containing an invalid number of generations, %s, be simulated. The default number of generations, 3, is being used.'</span> % ( self.kw[<span class="stringliteral">'simulate_g'</span>] )
<a name="l01484"></a>01484             kw[<span class="stringliteral">'simulate_g'</span>] = 3
<a name="l01485"></a>01485         <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'simulate_ns'</span>] &lt; 1:
<a name="l01486"></a>01486             logging.warning(<span class="stringliteral">'You asked that a pedigree containing an invalid number of sires, %s, be simulated. The default number of sires, 4, is being used.'</span>, self.kw[<span class="stringliteral">'simulate_ns'</span>])
<a name="l01487"></a>01487             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span>:
<a name="l01488"></a>01488                 <span class="keywordflow">print</span> <span class="stringliteral">'\t[SIMULATE]: You asked that a pedigree containing an invalid number of sires, %s, be simulated. The default number of sires, 4, is being used.'</span> % ( self.kw[<span class="stringliteral">'simulate_ns'</span>] )
<a name="l01489"></a>01489             self.kw[<span class="stringliteral">'simulate_ns'</span>] = 4
<a name="l01490"></a>01490         <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'simulate_nd'</span>] &lt; 1:
<a name="l01491"></a>01491             logging.warning(<span class="stringliteral">'You asked that a pedigree containing an invalid number of dams, %s, be simulated. The default number of dams, 4, is being used.'</span>, self.kw[<span class="stringliteral">'simulate_nd'</span>])
<a name="l01492"></a>01492             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span>:
<a name="l01493"></a>01493                 <span class="keywordflow">print</span> <span class="stringliteral">'\t[SIMULATE]: You asked that a pedigree containing an invalid number of dams, %s, be simulated. The default number of dams, 4, is being used.'</span> % ( self.kw[<span class="stringliteral">'simulate_nd'</span>] )
<a name="l01494"></a>01494             self.kw[<span class="stringliteral">'simulate_nd'</span>] = 4
<a name="l01495"></a>01495         <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'simulate_sr'</span>] &lt; 0. <span class="keywordflow">or</span> self.kw[<span class="stringliteral">'simulate_sr'</span>] &gt; 1.:
<a name="l01496"></a>01496             logging.warning(<span class="stringliteral">'You asked that a pedigree with an invalid sex ratio, %s, be simulated. The default sex ratio, 0.5, is being used.'</span>, self.kw[<span class="stringliteral">'simulate_sr'</span>])
<a name="l01497"></a>01497             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span>:
<a name="l01498"></a>01498                 <span class="keywordflow">print</span> <span class="stringliteral">'\t[SIMULATE]: You asked that a pedigree containing an invalid sex ratio, %s, be simulated. The default sex ratio, 0.5, is being used.'</span> % ( self.kw[<span class="stringliteral">'simulate_sr'</span>] )
<a name="l01499"></a>01499             self.kw[<span class="stringliteral">'simulate_sr'</span>] = 0.5
<a name="l01500"></a>01500         <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'simulate_ir'</span>] &lt; 0. <span class="keywordflow">or</span> self.kw[<span class="stringliteral">'simulate_ir'</span>] &gt; 1.:
<a name="l01501"></a>01501             logging.warning(<span class="stringliteral">'You asked that a pedigree with an invalid immigration rate, %s, be simulated. The default rate, 0.5, is being used.'</span>, self.kw[<span class="stringliteral">'simulate_ir'</span>])
<a name="l01502"></a>01502             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span>:
<a name="l01503"></a>01503                 <span class="keywordflow">print</span> <span class="stringliteral">'\t[SIMULATE]: You asked that a pedigree containing an invalid immigration rate, %s, be simulated. The default rate, 0.5, is being used.'</span> % ( self.kw[<span class="stringliteral">'simulate_ir'</span>] )
<a name="l01504"></a>01504             self.kw[<span class="stringliteral">'simulate_ir'</span>] = 0.5
<a name="l01505"></a>01505         <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'simulate_ns'</span>] &gt;= self.kw[<span class="stringliteral">'simulate_n'</span>]:
<a name="l01506"></a>01506             logging.error(<span class="stringliteral">'You asked that a pedigree with more founder sires than total animals be simulated.  This is a fatal error!'</span>)
<a name="l01507"></a>01507             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span>:
<a name="l01508"></a>01508                 <span class="keywordflow">print</span> <span class="stringliteral">'\t[SIMULATE]: You asked that a pedigree with more founder sires than total animals be simulated.  This is a fatal error!'</span>
<a name="l01509"></a>01509             sys.exit(0)
<a name="l01510"></a>01510         <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'simulate_nd'</span>] &gt;= self.kw[<span class="stringliteral">'simulate_n'</span>]:
<a name="l01511"></a>01511             logging.error(<span class="stringliteral">'You asked that a pedigree with more founder dams than total animals be simulated.  This is a fatal error!'</span>)
<a name="l01512"></a>01512             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span>:
<a name="l01513"></a>01513                 <span class="keywordflow">print</span> <span class="stringliteral">'\t[SIMULATE]: You asked that a pedigree with more founder dams than total animals be simulated.  This is a fatal error!'</span>
<a name="l01514"></a>01514             sys.exit(0)
<a name="l01515"></a>01515         <span class="keywordflow">if</span> ( self.kw[<span class="stringliteral">'simulate_ns'</span>] + self.kw[<span class="stringliteral">'simulate_ns'</span>] ) &gt; self.kw[<span class="stringliteral">'simulate_n'</span>]:
<a name="l01516"></a>01516             logging.error(<span class="stringliteral">'You asked that a pedigree with more founder parents than total animals be simulated.  This is a fatal error!'</span>)
<a name="l01517"></a>01517             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span>:
<a name="l01518"></a>01518                 <span class="keywordflow">print</span> <span class="stringliteral">'\t[SIMULATE]: You asked that a pedigree with more founder parents than total animals be simulated.  This is a fatal error!'</span>
<a name="l01519"></a>01519             sys.exit(0)
<a name="l01520"></a>01520         <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'simulate_pmd'</span>] &lt; 1:
<a name="l01521"></a>01521             logging.warning(<span class="stringliteral">'You specified an invalid number of maximum parent draws, %s. The default number of maximum draws, 100, is being used.'</span>, self.kw[<span class="stringliteral">'simulate_pmd'</span>])
<a name="l01522"></a>01522             <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span>:
<a name="l01523"></a>01523                 <span class="keywordflow">print</span> <span class="stringliteral">'\t[SIMULATE]: You specified an invalid number of maximum parent draws, %s. The default number of maximum draws, 100, is being used.'</span> % ( self.kw[<span class="stringliteral">'simulate_pmd'</span>] )
<a name="l01524"></a>01524             kw[<span class="stringliteral">'simulate_pmd'</span>] = 100
<a name="l01525"></a>01525         <span class="comment"># Seed the RNG</span>
<a name="l01526"></a>01526         seed = 5048665
<a name="l01527"></a>01527         numpy.random.seed(seed)
<a name="l01528"></a>01528         <span class="comment"># Now that we've checked the input, go ahead and setup some</span>
<a name="l01529"></a>01529         <span class="comment"># structures that we're going to need.</span>
<a name="l01530"></a>01530         <span class="comment"># Make local copies of the simulation defaults to save lots of typing.</span>
<a name="l01531"></a>01531         <span class="comment">#</span>
<a name="l01532"></a>01532         <span class="comment"># We add two to the requested number of animals because</span>
<a name="l01533"></a>01533         <span class="comment"># one of the initial sires and dams is an unknown parent.</span>
<a name="l01534"></a>01534         <span class="comment"># We give back simulate_n-2 animals, so the bump is needed.</span>
<a name="l01535"></a>01535         _snt = self.kw[<span class="stringliteral">'simulate_n'</span>] + 2
<a name="l01536"></a>01536         _sng = self.kw[<span class="stringliteral">'simulate_g'</span>]
<a name="l01537"></a>01537         _sns = self.kw[<span class="stringliteral">'simulate_ns'</span>]
<a name="l01538"></a>01538         _snd = self.kw[<span class="stringliteral">'simulate_nd'</span>]
<a name="l01539"></a>01539         _ssr = self.kw[<span class="stringliteral">'simulate_sr'</span>]
<a name="l01540"></a>01540         _smp = self.kw[<span class="stringliteral">'simulate_mp'</span>]
<a name="l01541"></a>01541         _sir = self.kw[<span class="stringliteral">'simulate_ir'</span>]
<a name="l01542"></a>01542         _spo = self.kw[<span class="stringliteral">'simulate_po'</span>]
<a name="l01543"></a>01543         _sfs = self.kw[<span class="stringliteral">'simulate_fs'</span>]
<a name="l01544"></a>01544         _spmd = self.kw[<span class="stringliteral">'simulate_pmd'</span>]
<a name="l01545"></a>01545         _sff = int( round( _snt * 0.1 ) )
<a name="l01546"></a>01546         <span class="comment"># _smd is the maximum number of daughters allowed, and is a</span>
<a name="l01547"></a>01547         <span class="comment"># function of the number of the total number of animals in</span>
<a name="l01548"></a>01548         <span class="comment"># the pedigree, the number of foundation sires and dams in</span>
<a name="l01549"></a>01549         <span class="comment"># the pedigree, and the sex ratio.</span>
<a name="l01550"></a>01550         _smd = int( round( ( _snt - _sns - _snd ) * ( 1 - _ssr ) ) )
<a name="l01551"></a>01551         <span class="comment"># _sms is the maximum number of sons allowed</span>
<a name="l01552"></a>01552         _sms = int ( round( ( _snt - _sns - _snd ) * ( _ssr ) ) )
<a name="l01553"></a>01553         <span class="comment"># _smf is the maximum number of females allowed in the</span>
<a name="l01554"></a>01554         <span class="comment"># pedigree, and is a function of the total number of dams,</span>
<a name="l01555"></a>01555         <span class="comment"># total sons, total daughters, and a "fudge factor" of 10%</span>
<a name="l01556"></a>01556         <span class="comment"># of the total pedigree size (arbitrary) that allows the</span>
<a name="l01557"></a>01557         <span class="comment"># number of females to vary from pedigree to pedigree.  _smm</span>
<a name="l01558"></a>01558         <span class="comment"># is the max number of males allowed in the pedigree, computed</span>
<a name="l01559"></a>01559         <span class="comment"># similarly to _smf.</span>
<a name="l01560"></a>01560         _smf = _snd + _smd + _sff
<a name="l01561"></a>01561         _smm = _sns + _sms + _sff
<a name="l01562"></a>01562         <span class="comment"># Total number of generated sires and dams? These values are</span>
<a name="l01563"></a>01563         <span class="comment"># incremented "down below", but there are no helpful comments</span>
<a name="l01564"></a>01564         <span class="comment"># in the Matvec source to guide me here.</span>
<a name="l01565"></a>01565         _tgdam = _snd
<a name="l01566"></a>01566         _tdam = _snd
<a name="l01567"></a>01567         _tgsire = _sns
<a name="l01568"></a>01568         _tsire = _sns
<a name="l01569"></a>01569         <span class="comment"># These dicts will store ???</span>
<a name="l01570"></a>01570         females = []
<a name="l01571"></a>01571         males = []
<a name="l01572"></a>01572         <span class="comment"># Initialize the females and males lists</span>
<a name="l01573"></a>01573         <span class="comment">#for i in range(_smf):</span>
<a name="l01574"></a>01574             <span class="comment">#females.append(None)</span>
<a name="l01575"></a>01575         <span class="comment">#for i in range(_smm):</span>
<a name="l01576"></a>01576             <span class="comment">#males.append(None)</span>
<a name="l01577"></a>01577         <span class="comment"># Assign IDs to the sires and dams. Dam IDs range from</span>
<a name="l01578"></a>01578         <span class="comment"># 0 .. _snd-1 and sire IDs range from _snd .. _sns-1.</span>
<a name="l01579"></a>01579         <span class="comment"># Note that there is always a sire and a dam with ID 0.</span>
<a name="l01580"></a>01580         <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(_snd):
<a name="l01581"></a>01581             <span class="comment">#females[i] = i</span>
<a name="l01582"></a>01582             females.append(i)
<a name="l01583"></a>01583         <span class="comment">#print 'females:\t%s' % ( females )</span>
<a name="l01584"></a>01584         <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(_sns):
<a name="l01585"></a>01585             <span class="keywordflow">if</span> i == 0:
<a name="l01586"></a>01586                 <span class="comment">#males[i] = 0</span>
<a name="l01587"></a>01587                 males.append(0)
<a name="l01588"></a>01588             <span class="keywordflow">else</span>:
<a name="l01589"></a>01589                 <span class="comment">#males[i] = _snd + i</span>
<a name="l01590"></a>01590                 males.append(_snd + i)
<a name="l01591"></a>01591         <span class="comment">#print 'males:\t\t%s' % ( males )</span>
<a name="l01592"></a>01592         <span class="comment"># Number of slots unavailable b/c they are used by sires</span>
<a name="l01593"></a>01593         <span class="comment"># and dams.</span>
<a name="l01594"></a>01594         _totalna = _snd + _sns
<a name="l01595"></a>01595         <span class="comment"># Number of animals per generation. Each generation will</span>
<a name="l01596"></a>01596         <span class="comment"># contain at least 1 animal. We take out the sires and</span>
<a name="l01597"></a>01597         <span class="comment"># dams because those spots are already taken.</span>
<a name="l01598"></a>01598         _npg = ( ( _snt - _snd - _sns ) / _sng ) + 1
<a name="l01599"></a>01599         <span class="comment"># _pedholder is a temporary structure for storing</span>
<a name="l01600"></a>01600         <span class="comment"># animal, sire, and dam IDs and sex codes.</span>
<a name="l01601"></a>01601         _pedholder = []
<a name="l01602"></a>01602         <span class="comment"># So we loop to add entries to _pedholder for the</span>
<a name="l01603"></a>01603         <span class="comment"># sires and dams in the males and females lists.</span>
<a name="l01604"></a>01604         <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(_snt+1):
<a name="l01605"></a>01605             _pedholder.append(<span class="keywordtype">None</span>)
<a name="l01606"></a>01606         <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(_snd):
<a name="l01607"></a>01607             _pedholder[i] = SimAnimal(females[i],0,0,<span class="stringliteral">'f'</span>,0)
<a name="l01608"></a>01608         <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(_snd,_totalna):
<a name="l01609"></a>01609             _pedholder[i] = SimAnimal(males[i-_snd],0,0,<span class="stringliteral">'m'</span>,0)
<a name="l01610"></a>01610 
<a name="l01611"></a>01611         <span class="comment">###</span>
<a name="l01612"></a>01612         <span class="comment">### Start of big. long generate animal loop.</span>
<a name="l01613"></a>01613         <span class="comment">###</span>
<a name="l01614"></a>01614         <span class="comment"># Loop over number of generations:</span>
<a name="l01615"></a>01615         <span class="keywordflow">for</span> g <span class="keywordflow">in</span> range(_sng):
<a name="l01616"></a>01616             _tgdam = _tdam
<a name="l01617"></a>01617             _tgsire = _tsire
<a name="l01618"></a>01618             <span class="keywordflow">if</span> _totalna &gt;= _snt:
<a name="l01619"></a>01619                 <span class="keywordflow">break</span>
<a name="l01620"></a>01620             <span class="keywordflow">for</span> _j <span class="keywordflow">in</span> range(_npg):
<a name="l01621"></a>01621                 <span class="keywordflow">if</span> _totalna &gt;= _snt:
<a name="l01622"></a>01622                   <span class="keywordflow">break</span>
<a name="l01623"></a>01623                 <span class="comment"># If a random uniform variate is greater than the</span>
<a name="l01624"></a>01624                 <span class="comment"># immigration rate, we need to create a new animal</span>
<a name="l01625"></a>01625                 <span class="comment"># with a sire and a dam chosen at random from the</span>
<a name="l01626"></a>01626                 <span class="comment"># males and females dictionaries, respectively.</span>
<a name="l01627"></a>01627                 <span class="comment">#if random.random() &gt; _sir:</span>
<a name="l01628"></a>01628                 <span class="keywordflow">if</span> numpy.random.ranf() &gt; _sir:
<a name="l01629"></a>01629                     <span class="comment"># The number-of-tries counter is used to</span>
<a name="l01630"></a>01630                     <span class="comment"># track the number of draws needed to get</span>
<a name="l01631"></a>01631                     <span class="comment"># a set of parents which meets all of the</span>
<a name="l01632"></a>01632                     <span class="comment"># MP, OP, and FS restrictions.</span>
<a name="l01633"></a>01633                     _ntry = 0
<a name="l01634"></a>01634                     <span class="keywordflow">while</span> 1:
<a name="l01635"></a>01635                         <span class="comment">#print 'females:\t%s' % ( females )</span>
<a name="l01636"></a>01636                         <span class="comment">#print 'males:\t\t%s' % ( males )</span>
<a name="l01637"></a>01637                         <span class="comment"># Select a random sire and dam</span>
<a name="l01638"></a>01638                         <span class="comment">#_selsire = random.randint(0,len(males)-1)</span>
<a name="l01639"></a>01639                         _selsire = numpy.random.randint(0,len(males)-1)
<a name="l01640"></a>01640                         <span class="comment">#_seldam = random.randint(0,len(females)-1)</span>
<a name="l01641"></a>01641                         _seldam = numpy.random.randint(0,len(females)-1)
<a name="l01642"></a>01642                         <span class="comment"># In the Matvec code, when an unknown sire or</span>
<a name="l01643"></a>01643                         <span class="comment"># dam is selected their sire (dam) is set the</span>
<a name="l01644"></a>01644                         <span class="comment"># same ID as the "missing parent" flag. This</span>
<a name="l01645"></a>01645                         <span class="comment"># results in a slight bias in favor of the</span>
<a name="l01646"></a>01646                         <span class="comment"># first non-missing sire (dam) ID. It also</span>
<a name="l01647"></a>01647                         <span class="comment"># means that the definition of the missing</span>
<a name="l01648"></a>01648                         <span class="comment"># parent flag as described on p. 12 of the</span>
<a name="l01649"></a>01649                         <span class="comment"># manual is counterintuitive -- 0 indicates</span>
<a name="l01650"></a>01650                         <span class="comment"># that missing parents are allowed, not 1. I've</span>
<a name="l01651"></a>01651                         <span class="comment"># fixed that here in PyPedal: an MP flag of</span>
<a name="l01652"></a>01652                         <span class="comment"># 1 indicates that MP are allowed. That's the</span>
<a name="l01653"></a>01653                         <span class="comment"># reason for the "1 - _smp" below.</span>
<a name="l01654"></a>01654                         <span class="keywordflow">if</span> _selsire == 0:
<a name="l01655"></a>01655                             _selsire = 1 - _smp
<a name="l01656"></a>01656                         <span class="comment">#print '_selsire:\t%s' % ( _selsire )</span>
<a name="l01657"></a>01657                         <span class="keywordflow">if</span> _seldam == 0:
<a name="l01658"></a>01658                             _seldam = 1 - _smp
<a name="l01659"></a>01659                         <span class="comment">#print '_seldam:\t%s' % ( _seldam )</span>
<a name="l01660"></a>01660                         <span class="comment"># Now we're going to store the sire and dam IDs,</span>
<a name="l01661"></a>01661                         <span class="comment"># as well as their parents' IDs, for use in</span>
<a name="l01662"></a>01662                         <span class="comment"># detecting parent-offspring and full-sib matings.</span>
<a name="l01663"></a>01663                         _d = females[_seldam]
<a name="l01664"></a>01664                         _s = males[_selsire]
<a name="l01665"></a>01665                         _dd = _pedholder[_d].damID
<a name="l01666"></a>01666                         _ds = _pedholder[_d].sireID
<a name="l01667"></a>01667                         _sd = _pedholder[_s].damID
<a name="l01668"></a>01668                         _ss = _pedholder[_s].sireID
<a name="l01669"></a>01669                         _tryagain = 0
<a name="l01670"></a>01670                         <span class="comment">#print 'Animal: %s' % ( _totalna )</span>
<a name="l01671"></a>01671                         <span class="comment">#print 'Sire: %s' % ( _s )</span>
<a name="l01672"></a>01672                         <span class="comment">#print 'Dam: %s' % ( _d )</span>
<a name="l01673"></a>01673                         <span class="comment">#print 'Dam-Dam: %s' % ( _dd )</span>
<a name="l01674"></a>01674                         <span class="comment">#print 'Dam-Sire: %s' % ( _ds )</span>
<a name="l01675"></a>01675                         <span class="comment">#print 'Sire-Dam: %s' % ( _sd )</span>
<a name="l01676"></a>01676                         <span class="comment">#print 'Sire-Sire: %s' % ( _ss )</span>
<a name="l01677"></a>01677                         <span class="comment"># If offspring-parent matings are not allowed,</span>
<a name="l01678"></a>01678                         <span class="comment"># check to see if both parents are known. If one</span>
<a name="l01679"></a>01679                         <span class="comment"># or both is unknown, draw new samples until they</span>
<a name="l01680"></a>01680                         <span class="comment"># are either (i) known or (ii) simulate_pmd</span>
<a name="l01681"></a>01681                         <span class="comment"># (simulate parent max draws) is reached. If _smpd</span>
<a name="l01682"></a>01682                         <span class="comment"># is reached, set the parents to unknown even if</span>
<a name="l01683"></a>01683                         <span class="comment"># _smp == 0.</span>
<a name="l01684"></a>01684                         <span class="keywordflow">if</span> <span class="keywordflow">not</span> _spo:
<a name="l01685"></a>01685                             <span class="keywordflow">if</span> _d &gt; 0 <span class="keywordflow">and</span> _sd == _d:
<a name="l01686"></a>01686                                 <span class="comment"># Draw a new dam</span>
<a name="l01687"></a>01687                                 _tryagain = 1
<a name="l01688"></a>01688                             <span class="keywordflow">if</span> _s &gt; 0 <span class="keywordflow">and</span> _ss == _s:
<a name="l01689"></a>01689                                 <span class="comment"># Draw a new sire</span>
<a name="l01690"></a>01690                                 _tryagain = 1
<a name="l01691"></a>01691                         <span class="comment"># If no full-sib matings are allowed, make sure</span>
<a name="l01692"></a>01692                         <span class="comment"># that the parents aren't brother and sister.</span>
<a name="l01693"></a>01693                         <span class="keywordflow">if</span> <span class="keywordflow">not</span> _sfs:
<a name="l01694"></a>01694                             <span class="keywordflow">if</span> _ss &gt; 0 <span class="keywordflow">and</span> _sd == 0:
<a name="l01695"></a>01695                                 <span class="keywordflow">if</span> _ss == _ds <span class="keywordflow">and</span> _sd == _dd:
<a name="l01696"></a>01696                                     _tryagain = 1
<a name="l01697"></a>01697                         <span class="keywordflow">if</span> _tryagain:
<a name="l01698"></a>01698                             _ntry = _ntry + 1
<a name="l01699"></a>01699                         <span class="keywordflow">if</span> _ntry &gt; _spmd:
<a name="l01700"></a>01700                             <span class="comment">#print '&gt; %d draws required to meet all parental restrictions. Parents set to missing.' % ( _spmd )</span>
<a name="l01701"></a>01701                             _tryagain = 0
<a name="l01702"></a>01702                             _seldam = 0
<a name="l01703"></a>01703                             _selsire = 0
<a name="l01704"></a>01704                         <span class="comment"># If we met the MP, PO, and FS conditions</span>
<a name="l01705"></a>01705                         <span class="comment"># we're done and can exit the loop.</span>
<a name="l01706"></a>01706                         <span class="keywordflow">if</span> <span class="keywordflow">not</span> _tryagain:
<a name="l01707"></a>01707                             <span class="keywordflow">break</span>
<a name="l01708"></a>01708                     <span class="comment">#print '%d draws required to meet all parental restrictions.' % ( _ntry+1 )</span>
<a name="l01709"></a>01709                 <span class="keywordflow">else</span>:
<a name="l01710"></a>01710                     <span class="comment"># The new animal is an immigrant with unknown</span>
<a name="l01711"></a>01711                     <span class="comment"># parents.</span>
<a name="l01712"></a>01712                     _selsire = 0
<a name="l01713"></a>01713                     _seldam = 0
<a name="l01714"></a>01714                 <span class="comment"># We've added an animal to the pedigree.</span>
<a name="l01715"></a>01715                 _totalna = _totalna + 1
<a name="l01716"></a>01716 
<a name="l01717"></a>01717                 <span class="comment">#if random.random() &lt; _ssr and _tgdam &lt; _smf:</span>
<a name="l01718"></a>01718                 <span class="keywordflow">if</span> numpy.random.ranf() &lt; _ssr <span class="keywordflow">and</span> _tgdam &lt; _smf:
<a name="l01719"></a>01719                     _tgdam = _tgdam + 1
<a name="l01720"></a>01720                     <span class="comment">#females[_tgdam] = _totalna</span>
<a name="l01721"></a>01721                     females.append(_totalna)
<a name="l01722"></a>01722                     _pedholder[_totalna] = SimAnimal(_totalna,males[_selsire],females[_seldam],<span class="stringliteral">'f'</span>,g+1)
<a name="l01723"></a>01723                 <span class="keywordflow">else</span>:
<a name="l01724"></a>01724                     <span class="keywordflow">if</span> _tgsire &lt; _smm:
<a name="l01725"></a>01725                         _tgsire = _tgsire + 1
<a name="l01726"></a>01726                         <span class="comment">#males[_tgsire] = _totalna</span>
<a name="l01727"></a>01727                         males.append(_totalna)
<a name="l01728"></a>01728                         _pedholder[_totalna] = SimAnimal(_totalna,males[_selsire],females[_seldam],<span class="stringliteral">'m'</span>,g+1)
<a name="l01729"></a>01729                     <span class="keywordflow">else</span>:
<a name="l01730"></a>01730                         _tgdam = _tgdam + 1
<a name="l01731"></a>01731                         <span class="comment">#females[_tgdam] = _totalna</span>
<a name="l01732"></a>01732                         females.append(_totalna)
<a name="l01733"></a>01733                         _pedholder[_totalna] = SimAnimal(_totalna,males[_selsire],females[_seldam],<span class="stringliteral">'f'</span>,g+1)
<a name="l01734"></a>01734                 _tdam = _tgdam
<a name="l01735"></a>01735                 _tsire = _tgsire
<a name="l01736"></a>01736         <span class="comment">###</span>
<a name="l01737"></a>01737         <span class="comment">### End of big. long generate animal loop.</span>
<a name="l01738"></a>01738         <span class="comment">###</span>
<a name="l01739"></a>01739 
<a name="l01740"></a>01740         <span class="comment">#print '_pedholder:'</span>
<a name="l01741"></a>01741         <span class="comment">#print '\tAnimal\tSire\tDam\tSex'</span>
<a name="l01742"></a>01742         <span class="comment">#for _ip in range(len(_pedholder)):</span>
<a name="l01743"></a>01743             <span class="comment">#if _pedholder[_ip]:</span>
<a name="l01744"></a>01744                 <span class="comment">#_pedholder[_ip].printme()</span>
<a name="l01745"></a>01745 
<a name="l01746"></a>01746         <span class="comment">###</span>
<a name="l01747"></a>01747         <span class="comment">### Now we have to put the animals into an actual pedigree object.</span>
<a name="l01748"></a>01748         <span class="comment">###</span>
<a name="l01749"></a>01749 
<a name="l01750"></a>01750         <span class="comment"># First, process the pedigree format code. This is easy</span>
<a name="l01751"></a>01751         <span class="comment"># b/c we are using SimAnimal() objects.</span>
<a name="l01752"></a>01752         self.kw[<span class="stringliteral">'pedformat'</span>] = <span class="stringliteral">'asdxg'</span>
<a name="l01753"></a>01753         pedformat_locations = {}
<a name="l01754"></a>01754         pedformat_locations[<span class="stringliteral">'animal'</span>] = 0
<a name="l01755"></a>01755         pedformat_locations[<span class="stringliteral">'sire'</span>] = 1
<a name="l01756"></a>01756         pedformat_locations[<span class="stringliteral">'dam'</span>] = 2
<a name="l01757"></a>01757         pedformat_locations[<span class="stringliteral">'sex'</span>] = 3
<a name="l01758"></a>01758         pedformat_locations[<span class="stringliteral">'generation'</span>] = 4
<a name="l01759"></a>01759         pedformat_locations[<span class="stringliteral">'gencoeff'</span>] = -999
<a name="l01760"></a>01760         pedformat_locations[<span class="stringliteral">'birthyear'</span>] = -999
<a name="l01761"></a>01761         pedformat_locations[<span class="stringliteral">'inbreeding'</span>] = -999
<a name="l01762"></a>01762         pedformat_locations[<span class="stringliteral">'breed'</span>] = -999
<a name="l01763"></a>01763         pedformat_locations[<span class="stringliteral">'name'</span>] = -999
<a name="l01764"></a>01764         pedformat_locations[<span class="stringliteral">'birthdate'</span>] = -999
<a name="l01765"></a>01765         pedformat_locations[<span class="stringliteral">'alive'</span>] = -999
<a name="l01766"></a>01766         pedformat_locations[<span class="stringliteral">'age'</span>] = -999
<a name="l01767"></a>01767         pedformat_locations[<span class="stringliteral">'alleles'</span>] = -999
<a name="l01768"></a>01768         pedformat_locations[<span class="stringliteral">'herd'</span>] = -999
<a name="l01769"></a>01769         pedformat_locations[<span class="stringliteral">'userfield'</span>] = -999
<a name="l01770"></a>01770         <span class="comment">#print pedformat_locations</span>
<a name="l01771"></a>01771 
<a name="l01772"></a>01772         <span class="keywordflow">for</span> _ip <span class="keywordflow">in</span> _pedholder:
<a name="l01773"></a>01773             <span class="keywordflow">if</span> _ip:
<a name="l01774"></a>01774                 <span class="comment"># We don't want to include our missing</span>
<a name="l01775"></a>01775                 <span class="comment"># parents in the final pedigree.</span>
<a name="l01776"></a>01776                 <span class="keywordflow">if</span> _ip.animalID &lt;&gt; 0:
<a name="l01777"></a>01777                     <span class="comment">#_ip.printme()</span>
<a name="l01778"></a>01778                     l = []
<a name="l01779"></a>01779                     l.append(str(_ip.animalID))
<a name="l01780"></a>01780                     <span class="comment"># 0 is used in the simulate routine to</span>
<a name="l01781"></a>01781                     <span class="comment"># indicate a missing parent, but the user</span>
<a name="l01782"></a>01782                     <span class="comment"># may have specified a different MP</span>
<a name="l01783"></a>01783                     <span class="comment"># indicator.</span>
<a name="l01784"></a>01784                     <span class="keywordflow">if</span> _ip.sireID == 0:
<a name="l01785"></a>01785                         l.append(self.kw[<span class="stringliteral">'missing_parent'</span>])
<a name="l01786"></a>01786                     <span class="keywordflow">else</span>:
<a name="l01787"></a>01787                         l.append(str(_ip.sireID))
<a name="l01788"></a>01788                     <span class="keywordflow">if</span> _ip.damID == 0:
<a name="l01789"></a>01789                         l.append(self.kw[<span class="stringliteral">'missing_parent'</span>])
<a name="l01790"></a>01790                     <span class="keywordflow">else</span>:
<a name="l01791"></a>01791                         l.append(str(_ip.damID))
<a name="l01792"></a>01792                     l.append(_ip.sex)
<a name="l01793"></a>01793                     l.append(_ip.gen)
<a name="l01794"></a>01794                     <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'animal_type'</span>] == <span class="stringliteral">'light'</span>:
<a name="l01795"></a>01795                         an = LightAnimal(pedformat_locations,l,self.kw)
<a name="l01796"></a>01796                         <span class="comment">#an.printme()</span>
<a name="l01797"></a>01797                         self.pedigree.append(an)
<a name="l01798"></a>01798                         self.idmap[an.animalID] = an.animalID
<a name="l01799"></a>01799                         self.backmap[an.animalID] = an.animalID
<a name="l01800"></a>01800                         self.namemap[an.name] = an.animalID
<a name="l01801"></a>01801                         self.namebackmap[an.animalID] = an.name
<a name="l01802"></a>01802                     <span class="keywordflow">else</span>:
<a name="l01803"></a>01803                         an = NewAnimal(pedformat_locations,l,self.kw)
<a name="l01804"></a>01804                         <span class="comment">#an.printme()</span>
<a name="l01805"></a>01805                         self.pedigree.append(an)
<a name="l01806"></a>01806                         self.idmap[an.animalID] = an.animalID
<a name="l01807"></a>01807                         self.backmap[an.animalID] = an.animalID
<a name="l01808"></a>01808                         self.namemap[an.name] = an.animalID
<a name="l01809"></a>01809                         self.namebackmap[an.animalID] = an.name
<a name="l01810"></a>01810 
<a name="l01811"></a>01811         <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'pedigree_save'</span>]:
<a name="l01812"></a>01812             <span class="keywordflow">try</span>:
<a name="l01813"></a>01813                 _sfn = <span class="stringliteral">'%s.ped'</span> % ( self.kw[<span class="stringliteral">'filetag'</span>] )
<a name="l01814"></a>01814                 of = file(_sfn,<span class="stringliteral">'w'</span>)
<a name="l01815"></a>01815                 <span class="keywordflow">for</span> _ip <span class="keywordflow">in</span> _pedholder:
<a name="l01816"></a>01816                     <span class="keywordflow">if</span> _ip <span class="keywordflow">and</span> _ip.animalID &lt;&gt; 0:
<a name="l01817"></a>01817                         _ofl = <span class="stringliteral">'%s\n'</span> % ( _ip.stringme() )
<a name="l01818"></a>01818                         of.write(_ofl)
<a name="l01819"></a>01819                 of.close()
<a name="l01820"></a>01820             <span class="keywordflow">except</span>:
<a name="l01821"></a>01821                 <span class="keywordflow">pass</span>
<a name="l01822"></a>01822 
<a name="l01823"></a>01823         <span class="comment"># Cleanup</span>
<a name="l01824"></a>01824         del(males)
<a name="l01825"></a>01825         del(females)
<a name="l01826"></a>01826         del(_pedholder)
<a name="l01827"></a>01827 <span class="comment">##</span>
<a name="l01828"></a>01828 <span class="comment"># The SimAnimal() class is a placeholder used for simulating animals.</span>
<a name="l01829"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1SimAnimal.html">01829</a> <span class="keyword">class </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1SimAnimal.html">SimAnimal</a>:
<a name="l01830"></a>01830     <span class="stringliteral">"""The simple class is a placeholder used for simulating animals."""</span>
<a name="l01831"></a>01831     <span class="comment">##</span>
<a name="l01832"></a>01832     <span class="comment"># __init__() initializes a SimAnimal() object.</span>
<a name="l01833"></a>01833     <span class="comment"># @param self Reference to current object.</span>
<a name="l01834"></a>01834     <span class="comment"># @param animalID Animal's ID.</span>
<a name="l01835"></a>01835     <span class="comment"># @param sireID Sire's ID.</span>
<a name="l01836"></a>01836     <span class="comment"># @param damID Dam's ID.</span>
<a name="l01837"></a>01837     <span class="comment"># @param sex Sex of animal.</span>
<a name="l01838"></a>01838     <span class="comment"># @param gen Generation to which an animal belongs.</span>
<a name="l01839"></a>01839     <span class="comment"># @retval An instance of a SimAnimal() object populated with data</span>
<a name="l01840"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1SimAnimal.html#c94fb6aceb9d336c190f7e45c1b397d5">01840</a>     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1SimAnimal.html#c94fb6aceb9d336c190f7e45c1b397d5">__init__</a>(self, animalID, sireID=0, damID=0, sex='u', gen=0):
<a name="l01841"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1SimAnimal.html#96e7aaaeeb62b1db3e85fcc41f10b73e">01841</a>         self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1SimAnimal.html#96e7aaaeeb62b1db3e85fcc41f10b73e">animalID</a> = animalID
<a name="l01842"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1SimAnimal.html#8c08a97ab1aa682c99ae27560f377413">01842</a>         self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1SimAnimal.html#8c08a97ab1aa682c99ae27560f377413">sireID</a> = sireID
<a name="l01843"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1SimAnimal.html#7a62b35e4bed7e7f407ef48e36707006">01843</a>         self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1SimAnimal.html#7a62b35e4bed7e7f407ef48e36707006">damID</a> = damID
<a name="l01844"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1SimAnimal.html#428be84bdd3f63235b75675540dac2f1">01844</a>         self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1SimAnimal.html#428be84bdd3f63235b75675540dac2f1">sex</a> = sex
<a name="l01845"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1SimAnimal.html#0b0af4ac84df1beb930f9ca84b1edc22">01845</a>         self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1SimAnimal.html#0b0af4ac84df1beb930f9ca84b1edc22">gen</a> = gen
<a name="l01846"></a>01846 
<a name="l01847"></a>01847     <span class="comment">##</span>
<a name="l01848"></a>01848     <span class="comment"># printme() prints a summary of the data stored in a SimAnimal() object.</span>
<a name="l01849"></a>01849     <span class="comment"># @param self Reference to current object</span>
<a name="l01850"></a>01850     <span class="comment"># @retval None</span>
<a name="l01851"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1SimAnimal.html#51b18530bad65cf716b893c069780df8">01851</a>     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1SimAnimal.html#51b18530bad65cf716b893c069780df8">printme</a>(self):
<a name="l01852"></a>01852         <span class="keywordflow">try</span>:
<a name="l01853"></a>01853             <span class="keywordflow">print</span> <span class="stringliteral">'\t%s\t%s\t%s\t%s\t%s'</span> % (self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1SimAnimal.html#96e7aaaeeb62b1db3e85fcc41f10b73e">animalID</a>, self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1SimAnimal.html#8c08a97ab1aa682c99ae27560f377413">sireID</a>, \
<a name="l01854"></a>01854                 self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1SimAnimal.html#7a62b35e4bed7e7f407ef48e36707006">damID</a>, self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1SimAnimal.html#428be84bdd3f63235b75675540dac2f1">sex</a>, self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1SimAnimal.html#0b0af4ac84df1beb930f9ca84b1edc22">gen</a>)
<a name="l01855"></a>01855         <span class="keywordflow">except</span>:
<a name="l01856"></a>01856             <span class="keywordflow">pass</span>
<a name="l01857"></a>01857 
<a name="l01858"></a>01858     <span class="comment">##</span>
<a name="l01859"></a>01859     <span class="comment"># stringme() returns the data stored in a SimAnimal() object as a string.</span>
<a name="l01860"></a>01860     <span class="comment"># @param self Reference to current object</span>
<a name="l01861"></a>01861     <span class="comment"># @retval None</span>
<a name="l01862"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1SimAnimal.html#db2a776a9386fb303a500f6bdd1ae012">01862</a>     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1SimAnimal.html#db2a776a9386fb303a500f6bdd1ae012">stringme</a>(self):
<a name="l01863"></a>01863         <span class="keywordflow">try</span>:
<a name="l01864"></a>01864             mystring =  <span class="stringliteral">'%s %s %s %s %s'</span> % (self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1SimAnimal.html#96e7aaaeeb62b1db3e85fcc41f10b73e">animalID</a>, self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1SimAnimal.html#8c08a97ab1aa682c99ae27560f377413">sireID</a>, \
<a name="l01865"></a>01865                 self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1SimAnimal.html#7a62b35e4bed7e7f407ef48e36707006">damID</a>, self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1SimAnimal.html#428be84bdd3f63235b75675540dac2f1">sex</a>, self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1SimAnimal.html#0b0af4ac84df1beb930f9ca84b1edc22">gen</a>)
<a name="l01866"></a>01866             <span class="keywordflow">return</span> mystring
<a name="l01867"></a>01867         <span class="keywordflow">except</span>:
<a name="l01868"></a>01868             <span class="keywordflow">return</span> 0
<a name="l01869"></a>01869 
<a name="l01870"></a>01870 <span class="comment">##</span>
<a name="l01871"></a>01871 <span class="comment"># The NewAnimal() class is holds animals records read from a pedigree file.</span>
<a name="l01872"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html">01872</a> <span class="keyword">class </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html">NewAnimal</a>:
<a name="l01873"></a>01873     <span class="stringliteral">"""A simple class to hold animals records read from a pedigree file."""</span>
<a name="l01874"></a>01874     <span class="comment">##</span>
<a name="l01875"></a>01875     <span class="comment"># __init__() initializes a NewAnimal() object.</span>
<a name="l01876"></a>01876     <span class="comment"># @param self Reference to current object.</span>
<a name="l01877"></a>01877     <span class="comment"># @param locations A dictionary containing the locations of variables in the input line.</span>
<a name="l01878"></a>01878     <span class="comment"># @param data The line of input read from the pedigree file.</span>
<a name="l01879"></a>01879     <span class="comment"># @param mykw A dictionary of keyword arguments.</span>
<a name="l01880"></a>01880     <span class="comment"># @retval An instance of a NewAnimal() object populated with data</span>
<a name="l01881"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#333e2b818b998d342a218ee262dc151a">01881</a>     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#333e2b818b998d342a218ee262dc151a">__init__</a>(self, locations, data, mykw):
<a name="l01882"></a>01882         <span class="stringliteral">"""</span>
<a name="l01883"></a>01883 <span class="stringliteral">        __init__() initializes a NewAnimal() object.</span>
<a name="l01884"></a>01884 <span class="stringliteral">        """</span>
<a name="l01885"></a>01885         <span class="comment">#print locations</span>
<a name="l01886"></a>01886         <span class="comment">#print data</span>
<a name="l01887"></a>01887         <span class="keywordflow">if</span> locations[<span class="stringliteral">'animal'</span>] != -999:
<a name="l01888"></a>01888             <span class="comment"># If the animal's ID is actually a string, we need to be clever.</span>
<a name="l01889"></a>01889             <span class="comment"># Put a copy of the string in the 'Name' field.  Then use the</span>
<a name="l01890"></a>01890             <span class="comment"># hash function to convert the ID to an integer.</span>
<a name="l01891"></a>01891             <span class="keywordflow">if</span> <span class="stringliteral">'A'</span> <span class="keywordflow">in</span> mykw[<span class="stringliteral">'pedformat'</span>]:
<a name="l01892"></a>01892                 <span class="keywordflow">if</span> mykw[<span class="stringliteral">'newanimal_caller'</span>] == <span class="stringliteral">'addanimal'</span>:
<a name="l01893"></a>01893                     self.name = str(data[locations[<span class="stringliteral">'animal'</span>]])
<a name="l01894"></a>01894                     self.animalID = data[locations[<span class="stringliteral">'animal'</span>]]
<a name="l01895"></a>01895                     self.originalID = data[locations[<span class="stringliteral">'animal'</span>]]
<a name="l01896"></a>01896                 <span class="keywordflow">else</span>:
<a name="l01897"></a>01897                     <span class="comment"># If the animal ID is not a string, we have to cast it</span>
<a name="l01898"></a>01898                     <span class="comment"># before we can strip it. At any rate, the animalName</span>
<a name="l01899"></a>01899                     <span class="comment"># needs to be a string.</span>
<a name="l01900"></a>01900                     self.animalID = self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#593124cc539d3909ce00c7d51c02ad3b">string_to_int</a>(data[locations[<span class="stringliteral">'animal'</span>]])
<a name="l01901"></a>01901                     self.originalID = self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#593124cc539d3909ce00c7d51c02ad3b">string_to_int</a>(data[locations[<span class="stringliteral">'animal'</span>]])
<a name="l01902"></a>01902                     self.name = string.strip(str(data[locations[<span class="stringliteral">'animal'</span>]]))
<a name="l01903"></a>01903             <span class="keywordflow">else</span>:
<a name="l01904"></a>01904                 <span class="keywordflow">if</span> locations[<span class="stringliteral">'name'</span>] != -999:
<a name="l01905"></a>01905                     self.name = string.strip(str(data[locations[<span class="stringliteral">'name'</span>]]))
<a name="l01906"></a>01906                 <span class="keywordflow">else</span>:
<a name="l01907"></a>01907                     self.name = string.strip(str(data[locations[<span class="stringliteral">'animal'</span>]]))
<a name="l01908"></a>01908                 self.animalID = int(string.strip(str(data[locations[<span class="stringliteral">'animal'</span>]])))
<a name="l01909"></a>01909                 self.originalID = int(string.strip(str(data[locations[<span class="stringliteral">'animal'</span>]])))
<a name="l01910"></a>01910         <span class="keywordflow">if</span> locations[<span class="stringliteral">'sire'</span>] != -999 <span class="keywordflow">and</span> str(data[locations[<span class="stringliteral">'sire'</span>]]) != str(mykw[<span class="stringliteral">'missing_parent'</span>]):
<a name="l01911"></a>01911             <span class="keywordflow">if</span> <span class="stringliteral">'S'</span> <span class="keywordflow">in</span> mykw[<span class="stringliteral">'pedformat'</span>]:
<a name="l01912"></a>01912                 self.sireID = self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#593124cc539d3909ce00c7d51c02ad3b">string_to_int</a>(data[locations[<span class="stringliteral">'sire'</span>]])
<a name="l01913"></a>01913             <span class="keywordflow">else</span>:
<a name="l01914"></a>01914                 <span class="comment"># We need to check types before trying to strip IDs. If the</span>
<a name="l01915"></a>01915                 <span class="comment"># ID is an integer, we're going to let the int() function</span>
<a name="l01916"></a>01916                 <span class="comment"># eat any leading or trailing whitespace.</span>
<a name="l01917"></a>01917                 <span class="keywordflow">if</span> type(data[locations[<span class="stringliteral">'sire'</span>]]) == <span class="stringliteral">'str'</span>:
<a name="l01918"></a>01918                     self.sireID = int(string.strip(data[locations[<span class="stringliteral">'sire'</span>]]))
<a name="l01919"></a>01919                 <span class="keywordflow">else</span>:
<a name="l01920"></a>01920                     self.sireID = int(data[locations[<span class="stringliteral">'sire'</span>]])
<a name="l01921"></a>01921             <span class="comment"># If the sire ID is not a string, we have to cast it before we</span>
<a name="l01922"></a>01922             <span class="comment"># can strip it. At any rate, the sireName needs to be a string.</span>
<a name="l01923"></a>01923             <span class="keywordflow">if</span> type(data[locations[<span class="stringliteral">'sire'</span>]]) == <span class="stringliteral">'str'</span>:
<a name="l01924"></a>01924                 self.sireName = string.strip(data[locations[<span class="stringliteral">'sire'</span>]])
<a name="l01925"></a>01925             <span class="keywordflow">else</span>:
<a name="l01926"></a>01926                 self.sireName = string.strip(str(data[locations[<span class="stringliteral">'sire'</span>]]))
<a name="l01927"></a>01927         <span class="keywordflow">else</span>:
<a name="l01928"></a>01928             self.sireID = mykw[<span class="stringliteral">'missing_parent'</span>]
<a name="l01929"></a>01929             self.sireName = mykw[<span class="stringliteral">'missing_name'</span>]
<a name="l01930"></a>01930         <span class="keywordflow">if</span> locations[<span class="stringliteral">'dam'</span>] != -999 <span class="keywordflow">and</span> str(data[locations[<span class="stringliteral">'dam'</span>]]) != str(mykw[<span class="stringliteral">'missing_parent'</span>]):
<a name="l01931"></a>01931             <span class="keywordflow">if</span> <span class="stringliteral">'D'</span> <span class="keywordflow">in</span> mykw[<span class="stringliteral">'pedformat'</span>]:
<a name="l01932"></a>01932                 self.damID = self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#593124cc539d3909ce00c7d51c02ad3b">string_to_int</a>(str(data[locations[<span class="stringliteral">'dam'</span>]]))
<a name="l01933"></a>01933             <span class="keywordflow">else</span>:
<a name="l01934"></a>01934                 <span class="keywordflow">if</span> type(data[locations[<span class="stringliteral">'dam'</span>]]) == <span class="stringliteral">'str'</span>:
<a name="l01935"></a>01935                     self.damID = int(string.strip(data[locations[<span class="stringliteral">'dam'</span>]]))
<a name="l01936"></a>01936                 <span class="keywordflow">else</span>:
<a name="l01937"></a>01937                     self.damID = int(data[locations[<span class="stringliteral">'dam'</span>]])
<a name="l01938"></a>01938             <span class="keywordflow">if</span> type(data[locations[<span class="stringliteral">'dam'</span>]]) == <span class="stringliteral">'str'</span>:
<a name="l01939"></a>01939                 self.damName = string.strip(data[locations[<span class="stringliteral">'dam'</span>]])
<a name="l01940"></a>01940             <span class="keywordflow">else</span>:
<a name="l01941"></a>01941                 self.damName = string.strip(str(data[locations[<span class="stringliteral">'dam'</span>]]))
<a name="l01942"></a>01942         <span class="keywordflow">else</span>:
<a name="l01943"></a>01943             self.damID = mykw[<span class="stringliteral">'missing_parent'</span>]
<a name="l01944"></a>01944             self.damName = mykw[<span class="stringliteral">'missing_name'</span>]
<a name="l01945"></a>01945         <span class="keywordflow">if</span> locations[<span class="stringliteral">'generation'</span>] != -999:
<a name="l01946"></a>01946             self.gen = data[locations[<span class="stringliteral">'generation'</span>]]
<a name="l01947"></a>01947         <span class="keywordflow">else</span>:
<a name="l01948"></a>01948             self.gen = -999
<a name="l01949"></a>01949         <span class="keywordflow">if</span> locations[<span class="stringliteral">'gencoeff'</span>] != -999.:
<a name="l01950"></a>01950             self.gencoeff = data[locations[<span class="stringliteral">'gencoeff'</span>]]
<a name="l01951"></a>01951         <span class="keywordflow">else</span>:
<a name="l01952"></a>01952             self.gencoeff = -999.
<a name="l01953"></a>01953         <span class="keywordflow">if</span> locations[<span class="stringliteral">'sex'</span>] != -999:
<a name="l01954"></a>01954             self.sex = string.strip(data[locations[<span class="stringliteral">'sex'</span>]]).lower()
<a name="l01955"></a>01955         <span class="keywordflow">else</span>:
<a name="l01956"></a>01956             self.sex = mykw[<span class="stringliteral">'missing_sex'</span>]
<a name="l01957"></a>01957         <span class="keywordflow">if</span> locations[<span class="stringliteral">'birthdate'</span>] != -999:
<a name="l01958"></a>01958             self.bd = string.strip(data[locations[<span class="stringliteral">'birthdate'</span>]])
<a name="l01959"></a>01959         <span class="keywordflow">else</span>:
<a name="l01960"></a>01960             self.bd = mykw[<span class="stringliteral">'missing_bdate'</span>]
<a name="l01961"></a>01961         <span class="keywordflow">if</span> locations[<span class="stringliteral">'birthyear'</span>] != -999:
<a name="l01962"></a>01962             self.by = int(string.strip(data[locations[<span class="stringliteral">'birthyear'</span>]]))
<a name="l01963"></a>01963             <span class="keywordflow">if</span> self.by == 0:
<a name="l01964"></a>01964                 self.by = mykw[<span class="stringliteral">'missing_byear'</span>]
<a name="l01965"></a>01965         <span class="keywordflow">elif</span> locations[<span class="stringliteral">'birthyear'</span>] == -999 <span class="keywordflow">and</span> locations[<span class="stringliteral">'birthdate'</span>] != -999:
<a name="l01966"></a>01966             self.by = int(string.strip(data[locations[<span class="stringliteral">'birthdate'</span>]])[:4])
<a name="l01967"></a>01967         <span class="keywordflow">else</span>:
<a name="l01968"></a>01968             self.by = mykw[<span class="stringliteral">'missing_byear'</span>]
<a name="l01969"></a>01969         <span class="keywordflow">if</span> locations[<span class="stringliteral">'inbreeding'</span>] != -999:
<a name="l01970"></a>01970             self.fa = float(string.strip(data[locations[<span class="stringliteral">'inbreeding'</span>]]))
<a name="l01971"></a>01971         <span class="keywordflow">else</span>:
<a name="l01972"></a>01972             self.fa = 0.
<a name="l01973"></a>01973         <span class="keywordflow">if</span> locations[<span class="stringliteral">'breed'</span>] != -999:
<a name="l01974"></a>01974             self.breed = string.strip(data[locations[<span class="stringliteral">'breed'</span>]])
<a name="l01975"></a>01975         <span class="keywordflow">else</span>:
<a name="l01976"></a>01976             self.breed = mykw[<span class="stringliteral">'missing_breed'</span>]
<a name="l01977"></a>01977         <span class="keywordflow">if</span> locations[<span class="stringliteral">'age'</span>] != -999:
<a name="l01978"></a>01978             self.age = int(string.strip(data[locations[<span class="stringliteral">'age'</span>]]))
<a name="l01979"></a>01979         <span class="keywordflow">else</span>:
<a name="l01980"></a>01980             self.age = -999
<a name="l01981"></a>01981         <span class="keywordflow">if</span> locations[<span class="stringliteral">'alive'</span>] != -999:
<a name="l01982"></a>01982             self.alive = int(string.strip(data[locations[<span class="stringliteral">'alive'</span>]]))
<a name="l01983"></a>01983         <span class="keywordflow">else</span>:
<a name="l01984"></a>01984             self.alive = 0
<a name="l01985"></a>01985         <span class="keywordflow">if</span> locations[<span class="stringliteral">'herd'</span>] != -999:
<a name="l01986"></a>01986             <span class="keywordflow">if</span> <span class="stringliteral">'H'</span> <span class="keywordflow">in</span> mykw[<span class="stringliteral">'pedformat'</span>]:
<a name="l01987"></a>01987                 self.herd = self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#593124cc539d3909ce00c7d51c02ad3b">string_to_int</a>(data[locations[<span class="stringliteral">'herd'</span>]])
<a name="l01988"></a>01988             <span class="keywordflow">else</span>:
<a name="l01989"></a>01989                 self.herd = int(string.strip(data[locations[<span class="stringliteral">'herd'</span>]]))
<a name="l01990"></a>01990             self.originalHerd = string.strip(data[locations[<span class="stringliteral">'herd'</span>]])
<a name="l01991"></a>01991         <span class="keywordflow">else</span>:
<a name="l01992"></a>01992             self.herd = self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#593124cc539d3909ce00c7d51c02ad3b">string_to_int</a>(mykw[<span class="stringliteral">'missing_herd'</span>])
<a name="l01993"></a>01993             self.originalHerd = mykw[<span class="stringliteral">'missing_herd'</span>]
<a name="l01994"></a>01994         self.renumberedID = -999
<a name="l01995"></a>01995         self.igen = -999
<a name="l01996"></a>01996         <span class="keywordflow">if</span> str(self.sireID) == str(mykw[<span class="stringliteral">'missing_parent'</span>]) <span class="keywordflow">and</span> str(self.damID) == str(mykw[<span class="stringliteral">'missing_parent'</span>]):
<a name="l01997"></a>01997             self.founder = <span class="stringliteral">'y'</span>
<a name="l01998"></a>01998         <span class="keywordflow">else</span>:
<a name="l01999"></a>01999             self.founder = <span class="stringliteral">'n'</span>
<a name="l02000"></a>02000         self.paddedID = self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#d29d925b5a9c53f67a1cc6c092ccbd82">pad_id</a>()
<a name="l02001"></a>02001         self.ancestor = 0
<a name="l02002"></a>02002         self.sons = {}
<a name="l02003"></a>02003         self.daus = {}
<a name="l02004"></a>02004         self.unks = {}
<a name="l02005"></a>02005         <span class="comment"># Assign alleles for use in gene-dropping runs.  Automatically assign two</span>
<a name="l02006"></a>02006         <span class="comment"># distinct alleles to founders.</span>
<a name="l02007"></a>02007         <span class="keywordflow">if</span> locations[<span class="stringliteral">'alleles'</span>] != -999:
<a name="l02008"></a>02008             self.alleles = [string.split(data[locations[<span class="stringliteral">'alleles'</span>]], self.kw[<span class="stringliteral">'alleles_sepchar'</span>])[0], \
<a name="l02009"></a>02009                 string.split(data[locations[<span class="stringliteral">'alleles'</span>]],self.kw[<span class="stringliteral">'alleles_sepchar'</span>])[1]]
<a name="l02010"></a>02010         <span class="keywordflow">else</span>:
<a name="l02011"></a>02011             <span class="comment"># Founders contribute two novel alleles</span>
<a name="l02012"></a>02012             <span class="keywordflow">if</span> self.founder == <span class="stringliteral">'y'</span>:
<a name="l02013"></a>02013                 _allele_1 = <span class="stringliteral">'%s%s'</span> % (self.paddedID,<span class="stringliteral">'__1'</span>)
<a name="l02014"></a>02014                 _allele_2 = <span class="stringliteral">'%s%s'</span> % (self.paddedID,<span class="stringliteral">'__2'</span>)
<a name="l02015"></a>02015                 self.alleles = [_allele_1,_allele_2]
<a name="l02016"></a>02016             <span class="comment"># Half-founders contribute one novel allele</span>
<a name="l02017"></a>02017             <span class="keywordflow">elif</span> self.sireID == mykw[<span class="stringliteral">'missing_parent'</span>]:
<a name="l02018"></a>02018                 _allele_1 = <span class="stringliteral">'%s%s'</span> % (self.paddedID,<span class="stringliteral">'__1'</span>)
<a name="l02019"></a>02019                 _allele_2 = <span class="stringliteral">''</span>
<a name="l02020"></a>02020                 self.alleles = [_allele_1,_allele_2]
<a name="l02021"></a>02021             <span class="keywordflow">elif</span> self.damID == mykw[<span class="stringliteral">'missing_parent'</span>]:
<a name="l02022"></a>02022                 _allele_1 = <span class="stringliteral">''</span>
<a name="l02023"></a>02023                 _allele_2 = <span class="stringliteral">'%s%s'</span> % (self.paddedID,<span class="stringliteral">'__2'</span>)
<a name="l02024"></a>02024                 self.alleles = [_allele_1,_allele_2]
<a name="l02025"></a>02025             <span class="keywordflow">else</span>:
<a name="l02026"></a>02026                 self.alleles = [<span class="stringliteral">''</span>,<span class="stringliteral">''</span>]
<a name="l02027"></a>02027         self.pedcomp = -999.9
<a name="l02028"></a>02028         <span class="keywordflow">if</span> locations[<span class="stringliteral">'userfield'</span>] != -999:
<a name="l02029"></a>02029             self.userField = string.strip(data[locations[<span class="stringliteral">'userfield'</span>]])
<a name="l02030"></a>02030         <span class="keywordflow">else</span>:
<a name="l02031"></a>02031             self.userField = <span class="stringliteral">''</span>
<a name="l02032"></a>02032         <span class="comment"># print '%s\t%s\t%s' % (self.animalID, self.sireID, self.damID)</span>
<a name="l02033"></a>02033 
<a name="l02034"></a>02034     <span class="comment">##</span>
<a name="l02035"></a>02035     <span class="comment"># The NewAnimal class is not iterable, so raise an exception if anyonw tries it.</span>
<a name="l02036"></a>02036     <span class="comment"># @param self Reference to current object</span>
<a name="l02037"></a>02037     <span class="comment"># @retval None</span>
<a name="l02038"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a05eafecc809b9759401d925e08d7825">02038</a>     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#a05eafecc809b9759401d925e08d7825">__iter__</a>(self):
<a name="l02039"></a>02039         <span class="keywordflow">raise</span> Exception(<span class="stringliteral">"The NewAnimal class is not iterable"</span>)
<a name="l02040"></a>02040 
<a name="l02041"></a>02041     <span class="comment">##</span>
<a name="l02042"></a>02042     <span class="comment"># printme() prints a summary of the data stored in the NewAnimal() object.</span>
<a name="l02043"></a>02043     <span class="comment"># @param self Reference to current object</span>
<a name="l02044"></a>02044     <span class="comment"># @retval None</span>
<a name="l02045"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#0022e845925efed1be23039d732bcb2c">02045</a>     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#0022e845925efed1be23039d732bcb2c">printme</a>(self):
<a name="l02046"></a>02046         <span class="stringliteral">"""</span>
<a name="l02047"></a>02047 <span class="stringliteral">        Print the contents of an animal record - used for debugging.</span>
<a name="l02048"></a>02048 <span class="stringliteral">        """</span>
<a name="l02049"></a>02049         <span class="keywordflow">print</span> <span class="stringliteral">'ANIMAL %s RECORD'</span> % (self.animalID)
<a name="l02050"></a>02050         <span class="keywordflow">print</span> <span class="stringliteral">'\tAnimal ID:\t%s'</span> % (self.animalID)
<a name="l02051"></a>02051         <span class="keywordflow">print</span> <span class="stringliteral">'\tAnimal name:\t%s'</span> % (self.name)
<a name="l02052"></a>02052         <span class="keywordflow">print</span> <span class="stringliteral">'\tSire ID:\t%s'</span> % (self.sireID)
<a name="l02053"></a>02053         <span class="keywordflow">print</span> <span class="stringliteral">'\tSire name:\t%s'</span> % (self.sireName)
<a name="l02054"></a>02054         <span class="keywordflow">print</span> <span class="stringliteral">'\tDam ID:\t\t%s'</span> % (self.damID)
<a name="l02055"></a>02055         <span class="keywordflow">print</span> <span class="stringliteral">'\tDam name:\t%s'</span> % (self.damName)
<a name="l02056"></a>02056         <span class="keywordflow">print</span> <span class="stringliteral">'\tGeneration:\t%s'</span> % (self.gen)
<a name="l02057"></a>02057         <span class="keywordflow">print</span> <span class="stringliteral">'\tGen coeff:\t%s'</span> % (self.gencoeff)
<a name="l02058"></a>02058         <span class="keywordflow">print</span> <span class="stringliteral">'\tInferred gen.:\t%s'</span> % (self.igen)
<a name="l02059"></a>02059         <span class="keywordflow">print</span> <span class="stringliteral">'\tBirth Year:\t%s'</span> % (self.by)
<a name="l02060"></a>02060         <span class="keywordflow">print</span> <span class="stringliteral">'\tBirth Date:\t%s'</span> % (self.bd)
<a name="l02061"></a>02061         <span class="keywordflow">print</span> <span class="stringliteral">'\tSex:\t\t%s'</span> % (self.sex)
<a name="l02062"></a>02062         <span class="keywordflow">print</span> <span class="stringliteral">'\tCoI (f_a):\t%s'</span> % (self.fa)
<a name="l02063"></a>02063         <span class="keywordflow">print</span> <span class="stringliteral">'\tFounder:\t%s'</span> % (self.founder)
<a name="l02064"></a>02064         <span class="keywordflow">print</span> <span class="stringliteral">'\tSons:\t\t%s'</span> % (self.sons)
<a name="l02065"></a>02065         <span class="keywordflow">print</span> <span class="stringliteral">'\tDaughters:\t%s'</span> % (self.daus)
<a name="l02066"></a>02066         <span class="keywordflow">print</span> <span class="stringliteral">'\tUnknowns:\t%s'</span> % (self.unks)
<a name="l02067"></a>02067         <span class="keywordflow">print</span> <span class="stringliteral">'\tAncestor:\t%s'</span> % (self.ancestor)
<a name="l02068"></a>02068         <span class="keywordflow">print</span> <span class="stringliteral">'\tAlleles:\t%s'</span> % (self.alleles)
<a name="l02069"></a>02069         <span class="keywordflow">print</span> <span class="stringliteral">'\tOriginal ID:\t%s'</span> % (self.originalID)
<a name="l02070"></a>02070         <span class="keywordflow">print</span> <span class="stringliteral">'\tRenumbered ID:\t%s'</span> % (self.renumberedID)
<a name="l02071"></a>02071         <span class="keywordflow">print</span> <span class="stringliteral">'\tPedigree Comp.:\t%s'</span> % (self.pedcomp)
<a name="l02072"></a>02072         <span class="keywordflow">print</span> <span class="stringliteral">'\tBreed:\t%s'</span> % (self.breed)
<a name="l02073"></a>02073         <span class="keywordflow">print</span> <span class="stringliteral">'\tAge:\t%s'</span> % (self.age)
<a name="l02074"></a>02074         <span class="keywordflow">print</span> <span class="stringliteral">'\tAlive:\t%s'</span> % (self.alive)
<a name="l02075"></a>02075         <span class="keywordflow">print</span> <span class="stringliteral">'\tHerd:\t%s'</span> % (self.herd)
<a name="l02076"></a>02076         <span class="keywordflow">print</span> <span class="stringliteral">'\tHerd name:\t%s'</span> % (self.originalHerd)
<a name="l02077"></a>02077         <span class="keywordflow">if</span> self.originalHerd != <span class="stringliteral">''</span>:
<a name="l02078"></a>02078             <span class="keywordflow">print</span> <span class="stringliteral">'\tUser field:\t%s'</span> % (self.userField)
<a name="l02079"></a>02079     <span class="comment">##</span>
<a name="l02080"></a>02080     <span class="comment"># stringme() returns a summary of the data stored in the NewAnimal() object</span>
<a name="l02081"></a>02081     <span class="comment"># as a string.</span>
<a name="l02082"></a>02082     <span class="comment"># @param self Reference to current object</span>
<a name="l02083"></a>02083     <span class="comment"># @retval None</span>
<a name="l02084"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#72ea49cbac0d47c151ef387a0f18b573">02084</a>     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#72ea49cbac0d47c151ef387a0f18b573">stringme</a>(self):
<a name="l02085"></a>02085         <span class="stringliteral">"""</span>
<a name="l02086"></a>02086 <span class="stringliteral">        Return the contents of an animal record as a string.</span>
<a name="l02087"></a>02087 <span class="stringliteral">        """</span>
<a name="l02088"></a>02088         _me = <span class="stringliteral">''</span>
<a name="l02089"></a>02089         _me = <span class="stringliteral">'%s%s'</span> % ( _me, <span class="stringliteral">'ANIMAL %s RECORD\n'</span> % (int(self.animalID)) )
<a name="l02090"></a>02090         _me = <span class="stringliteral">'%s%s'</span> % ( _me, <span class="stringliteral">'\tAnimal ID:\t%s\n'</span> % (int(self.animalID)) )
<a name="l02091"></a>02091         _me = <span class="stringliteral">'%s%s'</span> % ( _me, <span class="stringliteral">'\tAnimal name:\t%s\n'</span> % (self.name) )
<a name="l02092"></a>02092         _me = <span class="stringliteral">'%s%s'</span> % ( _me, <span class="stringliteral">'\tSire ID:\t%s\n'</span> % (int(self.sireID)) )
<a name="l02093"></a>02093         _me = <span class="stringliteral">'%s%s'</span> % ( _me, <span class="stringliteral">'\tSire name:\t%s\n'</span> % (self.sireName) )
<a name="l02094"></a>02094         _me = <span class="stringliteral">'%s%s'</span> % ( _me, <span class="stringliteral">'\tDam ID:\t\t%s\n'</span> % (int(self.damID)) )
<a name="l02095"></a>02095         _me = <span class="stringliteral">'%s%s'</span> % ( _me, <span class="stringliteral">'\tDam name:\t%s\n'</span> % (self.damName) )
<a name="l02096"></a>02096         _me = <span class="stringliteral">'%s%s'</span> % ( _me, <span class="stringliteral">'\tGeneration:\t%s\n'</span> % (self.gen) )
<a name="l02097"></a>02097         _me = <span class="stringliteral">'%s%s'</span> % ( _me, <span class="stringliteral">'\tGen coeff:\t%s\n'</span> % (self.gencoeff) )
<a name="l02098"></a>02098         _me = <span class="stringliteral">'%s%s'</span> % ( _me, <span class="stringliteral">'\tInferred gen.:\t%s\n'</span> % (self.igen) )
<a name="l02099"></a>02099         _me = <span class="stringliteral">'%s%s'</span> % ( _me, <span class="stringliteral">'\tBirth Year:\t%s\n'</span> % (int(self.by)) )
<a name="l02100"></a>02100         _me = <span class="stringliteral">'%s%s'</span> % ( _me, <span class="stringliteral">'\tBirth Date:\t%s\n'</span> % (int(self.bd)) )
<a name="l02101"></a>02101         _me = <span class="stringliteral">'%s%s'</span> % ( _me, <span class="stringliteral">'\tSex:\t\t%s\n'</span> % (self.sex) )
<a name="l02102"></a>02102         _me = <span class="stringliteral">'%s%s'</span> % ( _me, <span class="stringliteral">'\tCoI (f_a):\t%s\n'</span> % (self.fa) )
<a name="l02103"></a>02103         _me = <span class="stringliteral">'%s%s'</span> % ( _me, <span class="stringliteral">'\tFounder:\t%s\n'</span> % (self.founder) )
<a name="l02104"></a>02104         _me = <span class="stringliteral">'%s%s'</span> % ( _me, <span class="stringliteral">'\tSons:\t\t%s\n'</span> % (self.sons) )
<a name="l02105"></a>02105         _me = <span class="stringliteral">'%s%s'</span> % ( _me, <span class="stringliteral">'\tDaughters:\t%s\n'</span> % (self.daus) )
<a name="l02106"></a>02106         _me = <span class="stringliteral">'%s%s'</span> % ( _me, <span class="stringliteral">'\tUnknowns:\t%s\n'</span> % (self.unks) )
<a name="l02107"></a>02107         _me = <span class="stringliteral">'%s%s'</span> % ( _me, <span class="stringliteral">'\tAncestor:\t%s\n'</span> % (self.ancestor) )
<a name="l02108"></a>02108         _me = <span class="stringliteral">'%s%s'</span> % ( _me, <span class="stringliteral">'\tAlleles:\t%s\n'</span> % (self.alleles) )
<a name="l02109"></a>02109         _me = <span class="stringliteral">'%s%s'</span> % ( _me, <span class="stringliteral">'\tOriginal ID:\t%s\n'</span> % (self.originalID) )
<a name="l02110"></a>02110         _me = <span class="stringliteral">'%s%s'</span> % ( _me, <span class="stringliteral">'\tRenumbered ID:\t%s\n'</span> % (self.renumberedID) )
<a name="l02111"></a>02111         _me = <span class="stringliteral">'%s%s'</span> % ( _me, <span class="stringliteral">'\tPedigree Comp.:\t%s\n'</span> % (self.pedcomp) )
<a name="l02112"></a>02112         _me = <span class="stringliteral">'%s%s'</span> % ( _me, <span class="stringliteral">'\tBreed:\t%s'</span> % (self.breed) )
<a name="l02113"></a>02113         _me = <span class="stringliteral">'%s%s'</span> % ( _me, <span class="stringliteral">'\tAge:\t%s'</span> % (self.age) )
<a name="l02114"></a>02114         _me = <span class="stringliteral">'%s%s'</span> % ( _me, <span class="stringliteral">'\tAlive:\t%s'</span> % (self.alive) )
<a name="l02115"></a>02115         _me = <span class="stringliteral">'%s%s'</span> % ( _me, <span class="stringliteral">'\tHerd:\t%s\n'</span> % (self.herd) )
<a name="l02116"></a>02116         _me = <span class="stringliteral">'%s%s'</span> % ( _me, <span class="stringliteral">'\tHerd name:\t%s\n'</span> % (self.originalHerd) )
<a name="l02117"></a>02117         <span class="keywordflow">if</span> self.originalHerd != <span class="stringliteral">''</span>:
<a name="l02118"></a>02118             _me = <span class="stringliteral">'%s%s'</span> % ( _me, <span class="stringliteral">'\tUser field:\t%s\n'</span> % (self.userField) )
<a name="l02119"></a>02119         <span class="keywordflow">return</span> _me
<a name="l02120"></a>02120 
<a name="l02121"></a>02121     <span class="comment">##</span>
<a name="l02122"></a>02122     <span class="comment"># dictme() returns a summary of the data stored in the NewAnimal() object</span>
<a name="l02123"></a>02123     <span class="comment"># as a dictionary.</span>
<a name="l02124"></a>02124     <span class="comment"># @param self Reference to current object</span>
<a name="l02125"></a>02125     <span class="comment"># @retval None</span>
<a name="l02126"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#c0edcaf3f350f7255d79f6fba408ae73">02126</a>     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#c0edcaf3f350f7255d79f6fba408ae73">dictme</a>(self):
<a name="l02127"></a>02127         <span class="stringliteral">"""</span>
<a name="l02128"></a>02128 <span class="stringliteral">        Return the contents of an animal record in a dictionary.</span>
<a name="l02129"></a>02129 <span class="stringliteral">        """</span>
<a name="l02130"></a>02130         <span class="keywordflow">try</span>:
<a name="l02131"></a>02131             _dict = {}
<a name="l02132"></a>02132             _dict[animalID] = self.animalID
<a name="l02133"></a>02133             _dict[name] = self.name
<a name="l02134"></a>02134             _dict[sireID] = self.sireID
<a name="l02135"></a>02135             _dict[sireName] = self.sireName
<a name="l02136"></a>02136             _dict[damID] = self.damID
<a name="l02137"></a>02137             _dict[damName] = self.damName
<a name="l02138"></a>02138             _dict[gen] = self.gen
<a name="l02139"></a>02139             _dict[gencoeff] = self.gencoeff
<a name="l02140"></a>02140             _dict[igen] = self.igen
<a name="l02141"></a>02141             _dict[by] = self.by
<a name="l02142"></a>02142             _dict[bd] = self.bd
<a name="l02143"></a>02143             _dict[sex] = self.sex
<a name="l02144"></a>02144             _dict[fa] = self.fa
<a name="l02145"></a>02145             _dict[founder] = self.founder
<a name="l02146"></a>02146             _dict[sons] = self.sons
<a name="l02147"></a>02147             _dict[daus] = self.daus
<a name="l02148"></a>02148             _dict[unks] = self.unks
<a name="l02149"></a>02149             _dict[ancestor] = self.ancestor
<a name="l02150"></a>02150             _dict[alleles] = self.alleles
<a name="l02151"></a>02151             _dict[originalID] = self.originalID
<a name="l02152"></a>02152             _dict[renumberedID] = self.renumberedID
<a name="l02153"></a>02153             _dict[pedcomp] = self.pedcomp
<a name="l02154"></a>02154             _dict[breed] = self.breed
<a name="l02155"></a>02155             _dict[age] = self.age
<a name="l02156"></a>02156             _dict[alive] = self.alive
<a name="l02157"></a>02157             _dict[herd] = self.herd
<a name="l02158"></a>02158             _dict[originalHerd] = self.originalHerd
<a name="l02159"></a>02159             <span class="keywordflow">return</span> _dict
<a name="l02160"></a>02160         <span class="keywordflow">except</span>:
<a name="l02161"></a>02161             <span class="keywordflow">return</span> {}
<a name="l02162"></a>02162 
<a name="l02163"></a>02163     <span class="comment">##</span>
<a name="l02164"></a>02164     <span class="comment"># trap() checks for common errors in NewAnimal() objects</span>
<a name="l02165"></a>02165     <span class="comment"># @param self Reference to current object</span>
<a name="l02166"></a>02166     <span class="comment"># @retval None</span>
<a name="l02167"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#4c160b4c1746a9f09282ae19a02956b1">02167</a>     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#4c160b4c1746a9f09282ae19a02956b1">trap</a>(self):
<a name="l02168"></a>02168         <span class="stringliteral">"""</span>
<a name="l02169"></a>02169 <span class="stringliteral">        Trap common errors in pedigree file entries.</span>
<a name="l02170"></a>02170 <span class="stringliteral">        """</span>
<a name="l02171"></a>02171         <span class="keywordflow">if</span> int(self.animalID) == int(self.sireID):
<a name="l02172"></a>02172             <span class="keywordflow">print</span> <span class="stringliteral">'[ERROR]: Animal %s has an ID number equal to its sire\'s ID (sire ID %s).\n'</span> % (self.animalID,self.sireID)
<a name="l02173"></a>02173         <span class="keywordflow">if</span> int(self.animalID) == int(self.damID):
<a name="l02174"></a>02174             <span class="keywordflow">print</span> <span class="stringliteral">'[ERROR]: Animal %s has an ID number equal to its dam\'s ID (dam ID %s).\n'</span> % (self.animalID,self.damID)
<a name="l02175"></a>02175         <span class="keywordflow">if</span> int(self.animalID) &lt; int(self.sireID):
<a name="l02176"></a>02176             <span class="keywordflow">print</span> <span class="stringliteral">'[ERROR]: Animal %s is older than its sire (sire ID %s).\n'</span> % (self.animalID,self.sireID)
<a name="l02177"></a>02177         <span class="keywordflow">if</span> int(self.animalID) &lt; int(self.damID):
<a name="l02178"></a>02178             <span class="keywordflow">print</span> <span class="stringliteral">'[ERROR]: Animal %s is older than its dam (dam ID %s).\n'</span> % (self.animalID,self.damID)
<a name="l02179"></a>02179     <span class="comment">##</span>
<a name="l02180"></a>02180     <span class="comment"># pad_id() takes an Animal ID, pads it to fifteen digits, and prepends the birthyear</span>
<a name="l02181"></a>02181     <span class="comment"># (or 1950 if the birth year is unknown).  The order of elements is: birthyear, animalID,</span>
<a name="l02182"></a>02182     <span class="comment"># count of zeros, zeros.</span>
<a name="l02183"></a>02183     <span class="comment"># @param self Reference to current object</span>
<a name="l02184"></a>02184     <span class="comment"># @retval A padded ID number that is supposed to be unique across animals</span>
<a name="l02185"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#d29d925b5a9c53f67a1cc6c092ccbd82">02185</a>     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#d29d925b5a9c53f67a1cc6c092ccbd82">pad_id</a>(self):
<a name="l02186"></a>02186         <span class="stringliteral">"""</span>
<a name="l02187"></a>02187 <span class="stringliteral">        Take an Animal ID, pad it to fifteen digits, and prepend the birthyear (or 1900</span>
<a name="l02188"></a>02188 <span class="stringliteral">        if the birth year is unknown).  The order of elements is: birthyear, animalID,</span>
<a name="l02189"></a>02189 <span class="stringliteral">        count of zeros, zeros.</span>
<a name="l02190"></a>02190 <span class="stringliteral">        """</span>
<a name="l02191"></a>02191         <span class="comment">#print 'Animal ID: ', self.animalID</span>
<a name="l02192"></a>02192         l = len(str(self.animalID))
<a name="l02193"></a>02193         pl = 15 - l - 1
<a name="l02194"></a>02194         <span class="keywordflow">if</span> pl &gt; 0:
<a name="l02195"></a>02195             zs = <span class="stringliteral">'0'</span>*pl
<a name="l02196"></a>02196             pid = <span class="stringliteral">'%s%s%s%s'</span> % (self.by,zs,self.animalID,l)
<a name="l02197"></a>02197         <span class="keywordflow">else</span>:
<a name="l02198"></a>02198             pid = <span class="stringliteral">'%s%s%s'</span> % (self.by,self.animalID,l)
<a name="l02199"></a>02199         <span class="keywordflow">return</span> pid
<a name="l02200"></a>02200 
<a name="l02201"></a>02201     <span class="comment">##</span>
<a name="l02202"></a>02202     <span class="comment"># string_to_int() takes an Animal/Sire/Dam ID as a string and returns a</span>
<a name="l02203"></a>02203     <span class="comment"># hash.</span>
<a name="l02204"></a>02204     <span class="comment"># @param self Reference to current object.</span>
<a name="l02205"></a>02205     <span class="comment"># @param idstring String to be hashed using the Python hashlib MD5 implementation.</span>
<a name="l02206"></a>02206     <span class="comment"># @param mymaxint Constant used by earlier iterations of this function.</span>
<a name="l02207"></a>02207     <span class="comment"># @retval A hashed value representing the input string.</span>
<a name="l02208"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#593124cc539d3909ce00c7d51c02ad3b">02208</a>     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#593124cc539d3909ce00c7d51c02ad3b">string_to_int</a>(self, idstring, mymaxint=9223372036854775807):
<a name="l02209"></a>02209         <span class="stringliteral">"""</span>
<a name="l02210"></a>02210 <span class="stringliteral">        Convert a string to an integer.</span>
<a name="l02211"></a>02211 <span class="stringliteral">        """</span>
<a name="l02212"></a>02212         <span class="comment"># This algorithm is taken from "Character String Keys" in "Data</span>
<a name="l02213"></a>02213         <span class="comment"># Structures and Algorithms with Object-Oriented Design Patterns</span>
<a name="l02214"></a>02214         <span class="comment"># in Python" by Bruno R. Preiss:</span>
<a name="l02215"></a>02215         <span class="comment"># http://www.brpreiss.com/books/opus7/html/page220.html#progstrnga</span>
<a name="l02216"></a>02216         <span class="comment">#shift = 6</span>
<a name="l02217"></a>02217         <span class="comment">#mask = ~0 &lt;&lt; ( 31 - shift )</span>
<a name="l02218"></a>02218         <span class="comment">#result = 0</span>
<a name="l02219"></a>02219         <span class="comment">#for c in idstring:</span>
<a name="l02220"></a>02220         <span class="comment">#    result = ( ( result &amp; mask ) ^ result &lt;&lt; shift ^ ord(c) ) &amp; sys.maxint</span>
<a name="l02221"></a>02221 
<a name="l02222"></a>02222         <span class="comment"># This is a test to try and fix the problems on Mac OS/X and Windows.</span>
<a name="l02223"></a>02223         <span class="comment">#import md5</span>
<a name="l02224"></a>02224     <span class="keyword">import</span> hashlib
<a name="l02225"></a>02225         <span class="keywordflow">try</span>:
<a name="l02226"></a>02226             <span class="comment"># If we can, let's use the Python MD5 implementation</span>
<a name="l02227"></a>02227             <span class="comment">#md5hash = md5.md5(idstring)</span>
<a name="l02228"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#2ed1e78b146d6e51d74af9236938821b">02228</a>             result = hashlib.md5(idstring).hexdigest()
<a name="l02229"></a>02229             <span class="comment">#result = string.atoi(md5hash.hexdigest(),16)</span>
<a name="l02230"></a>02230         <span class="keywordflow">except</span>:
<a name="l02231"></a>02231             <span class="comment"># If we have some sort of problem with the MD5 hash then try this.</span>
<a name="l02232"></a>02232             <span class="comment"># WARNING -- This algorithm was broken on Mac OS/X and Windows,</span>
<a name="l02233"></a>02233             <span class="comment"># but not on (some) Linuxes. The problem may have been related to</span>
<a name="l02234"></a>02234             <span class="comment"># platform-specific values of sys.maxint, so I've hard-coded that</span>
<a name="l02235"></a>02235             <span class="comment"># as sys.maxint from a 64-bit system. It gets cast to a long on 32-</span>
<a name="l02236"></a>02236             <span class="comment"># bit platforms, but I haven't found that to be a problem -- yet.</span>
<a name="l02237"></a>02237             <span class="comment">#</span>
<a name="l02238"></a>02238             <span class="comment"># This algorithm is taken from "Character String Keys" in "Data</span>
<a name="l02239"></a>02239             <span class="comment"># Structures and Algorithms with Object-Oriented Design Patterns</span>
<a name="l02240"></a>02240             <span class="comment"># in Python" by Bruno R. Preiss:</span>
<a name="l02241"></a>02241             <span class="comment"># http://www.brpreiss.com/books/opus7/html/page220.html#progstrnga</span>
<a name="l02242"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#cf260f02406882d37a73720dd247f694">02242</a>             shift = 6
<a name="l02243"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#b8ed4560af753c3a106246f5f718c1f0">02243</a>             mask = ~0 &lt;&lt; ( 31 - shift )
<a name="l02244"></a>02244             result = 0
<a name="l02245"></a>02245             <span class="keywordflow">for</span> c <span class="keywordflow">in</span> idstring:
<a name="l02246"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAnimal.html#55e0c4f075a4d71be19c33edd005ae94">02246</a>                 result = ( ( result &amp; mask ) ^ result &lt;&lt; shift ^ ord(c) ) &amp; mymaxint
<a name="l02247"></a>02247         <span class="keywordflow">return</span> result
<a name="l02248"></a>02248 
<a name="l02249"></a>02249 <span class="comment">##</span>
<a name="l02250"></a>02250 <span class="comment"># The LightAnimal() class holds animals records read from a pedigree file. It</span>
<a name="l02251"></a>02251 <span class="comment"># is a much simpler object than the NewAnimal() object and is intended for use</span>
<a name="l02252"></a>02252 <span class="comment"># with the graph theoretic routines in pyp_network. The only attributes of these</span>
<a name="l02253"></a>02253 <span class="comment"># objects are: animal ID, sire ID, dam ID, original ID, birth year, and sex.</span>
<a name="l02254"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html">02254</a> <span class="keyword">class </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html">LightAnimal</a>:
<a name="l02255"></a>02255     <span class="stringliteral">"""</span>
<a name="l02256"></a>02256 <span class="stringliteral">    The LightAnimal() class holds animals records read from a pedigree file. It</span>
<a name="l02257"></a>02257 <span class="stringliteral">    is a much simpler object than the NewAnimal() object and is intended for use</span>
<a name="l02258"></a>02258 <span class="stringliteral">    with the graph theoretic routines in pyp_network. The only attributes of these</span>
<a name="l02259"></a>02259 <span class="stringliteral">    objects are: animal ID, sire ID, dam ID, original ID, birth year, and sex.A simple class to</span>
<a name="l02260"></a>02260 <span class="stringliteral">    hold animals records read from a pedigree file.</span>
<a name="l02261"></a>02261 <span class="stringliteral">    """</span>
<a name="l02262"></a>02262     <span class="comment">##</span>
<a name="l02263"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#7ca30b9b94abc91c484dc5cb8c536d43">02263</a>     <span class="comment"># __init__() initializes a LightAnimal() object.</span>
<a name="l02264"></a>02264     <span class="comment"># @param self Reference to current object.</span>
<a name="l02265"></a>02265     <span class="comment"># @param locations A dictionary containing the locations of variables in the input line.</span>
<a name="l02266"></a>02266     <span class="comment"># @param data The line of input read from the pedigree file.</span>
<a name="l02267"></a>02267     <span class="comment"># @param mykw A dictionary of keyword arguments.</span>
<a name="l02268"></a>02268     <span class="comment"># @retval An instance of a LightAnimal() object populated with data</span>
<a name="l02269"></a>02269     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#7ca30b9b94abc91c484dc5cb8c536d43">__init__</a>(self, locations, data, mykw):
<a name="l02270"></a>02270         <span class="stringliteral">"""</span>
<a name="l02271"></a>02271 <span class="stringliteral">        __init__() initializes a LightAnimal() object.</span>
<a name="l02272"></a>02272 <span class="stringliteral">        """</span>
<a name="l02273"></a>02273         <span class="keywordflow">if</span> locations[<span class="stringliteral">'animal'</span>] != -999:
<a name="l02274"></a>02274             <span class="comment"># If the animal's ID is actually a string, we need to be clever.  Put a copy of</span>
<a name="l02275"></a>02275             <span class="comment"># the string in the 'Name' field.  Then use the hash function to convert the ID</span>
<a name="l02276"></a>02276             <span class="comment"># to an integer.</span>
<a name="l02277"></a>02277             <span class="keywordflow">if</span> <span class="stringliteral">'A'</span> <span class="keywordflow">in</span> mykw[<span class="stringliteral">'pedformat'</span>]:
<a name="l02278"></a>02278                 self.animalID = self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#cf2e3f1be5c9b23efbff5afeb5126c83">string_to_int</a>(data[locations[<span class="stringliteral">'animal'</span>]])
<a name="l02279"></a>02279                 self.originalID = self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#cf2e3f1be5c9b23efbff5afeb5126c83">string_to_int</a>(data[locations[<span class="stringliteral">'animal'</span>]])
<a name="l02280"></a>02280             <span class="keywordflow">else</span>:
<a name="l02281"></a>02281                 self.animalID = string.strip(data[locations[<span class="stringliteral">'animal'</span>]])
<a name="l02282"></a>02282                 self.originalID = string.strip(data[locations[<span class="stringliteral">'animal'</span>]])
<a name="l02283"></a>02283         <span class="keywordflow">if</span> locations[<span class="stringliteral">'sire'</span>] != -999 <span class="keywordflow">and</span> string.strip(data[locations[<span class="stringliteral">'sire'</span>]]) != mykw[<span class="stringliteral">'missing_parent'</span>]:
<a name="l02284"></a>02284             <span class="keywordflow">if</span> <span class="stringliteral">'S'</span> <span class="keywordflow">in</span> mykw[<span class="stringliteral">'pedformat'</span>]:
<a name="l02285"></a>02285                 <span class="keywordflow">if</span> data[locations[<span class="stringliteral">'sire'</span>]] == mykw[<span class="stringliteral">'missing_parent'</span>]:
<a name="l02286"></a>02286                     self.sireID = data[locations[<span class="stringliteral">'sire'</span>]]
<a name="l02287"></a>02287                 <span class="keywordflow">else</span>:
<a name="l02288"></a>02288                     self.sireID = self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#cf2e3f1be5c9b23efbff5afeb5126c83">string_to_int</a>(data[locations[<span class="stringliteral">'sire'</span>]])
<a name="l02289"></a>02289             <span class="keywordflow">else</span>:
<a name="l02290"></a>02290                 self.sireID = string.strip(data[locations[<span class="stringliteral">'sire'</span>]])
<a name="l02291"></a>02291         <span class="keywordflow">else</span>:
<a name="l02292"></a>02292             <span class="comment">#self.sireID = '0'</span>
<a name="l02293"></a>02293             self.sireID = mykw[<span class="stringliteral">'missing_parent'</span>]
<a name="l02294"></a>02294         <span class="keywordflow">if</span> locations[<span class="stringliteral">'dam'</span>] != -999 <span class="keywordflow">and</span> string.strip(data[locations[<span class="stringliteral">'dam'</span>]]) != mykw[<span class="stringliteral">'missing_parent'</span>]:
<a name="l02295"></a>02295             <span class="keywordflow">if</span> <span class="stringliteral">'D'</span> <span class="keywordflow">in</span> mykw[<span class="stringliteral">'pedformat'</span>]:
<a name="l02296"></a>02296                 <span class="keywordflow">if</span> data[locations[<span class="stringliteral">'dam'</span>]] == mykw[<span class="stringliteral">'missing_parent'</span>]:
<a name="l02297"></a>02297                     self.damID = data[locations[<span class="stringliteral">'dam'</span>]]
<a name="l02298"></a>02298                 <span class="keywordflow">else</span>:
<a name="l02299"></a>02299                     self.damID = self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#cf2e3f1be5c9b23efbff5afeb5126c83">string_to_int</a>(data[locations[<span class="stringliteral">'dam'</span>]])
<a name="l02300"></a>02300             <span class="keywordflow">else</span>:
<a name="l02301"></a>02301                 self.damID = string.strip(data[locations[<span class="stringliteral">'dam'</span>]])
<a name="l02302"></a>02302         <span class="keywordflow">else</span>:
<a name="l02303"></a>02303             <span class="comment">#self.damID = '0'</span>
<a name="l02304"></a>02304             self.damID = mykw[<span class="stringliteral">'missing_parent'</span>]
<a name="l02305"></a>02305         <span class="keywordflow">if</span> locations[<span class="stringliteral">'sex'</span>] != -999:
<a name="l02306"></a>02306             self.sex = string.strip(data[locations[<span class="stringliteral">'sex'</span>]])
<a name="l02307"></a>02307         <span class="keywordflow">else</span>:
<a name="l02308"></a>02308             self.sex = <span class="stringliteral">'</span><span class="stringliteral">u'</span>
<a name="l02309"></a>02309 <span class="stringliteral">        </span><span class="keywordflow">if</span> locations[<span class="stringliteral">'birthyear'</span>] != -999:
<a name="l02310"></a>02310             self.by = int(string.strip(data[locations[<span class="stringliteral">'birthyear'</span>]]))
<a name="l02311"></a>02311             <span class="keywordflow">if</span> self.by == 0:
<a name="l02312"></a>02312                 self.by = mykw[<span class="stringliteral">'missing_byear'</span>]
<a name="l02313"></a>02313         <span class="keywordflow">elif</span> locations[<span class="stringliteral">'birthyear'</span>] == -999 <span class="keywordflow">and</span> locations[<span class="stringliteral">'birthdate'</span>] != -999:
<a name="l02314"></a>02314             self.by = int(string.strip(data[locations[<span class="stringliteral">'birthdate'</span>]]))
<a name="l02315"></a>02315             self.by = self.by[:4]
<a name="l02316"></a>02316         <span class="keywordflow">else</span>:
<a name="l02317"></a>02317             self.by = mykw[<span class="stringliteral">'missing_byear'</span>]
<a name="l02318"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#7ca54c7f2ca36edd25006a8645c4e10d">02318</a>         self.paddedID = self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#7a4a49d418a580678e32c214cd7aee7c">pad_id</a>()
<a name="l02319"></a>02319 
<a name="l02320"></a>02320     <span class="comment">##</span>
<a name="l02321"></a>02321     <span class="comment"># printme() prints a summary of the data stored in the LightAnimal() object.</span>
<a name="l02322"></a>02322     <span class="comment"># @param self Reference to current object</span>
<a name="l02323"></a>02323     <span class="comment"># @retval None</span>
<a name="l02324"></a>02324     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#7ca54c7f2ca36edd25006a8645c4e10d">printme</a>(self):
<a name="l02325"></a>02325         <span class="stringliteral">"""</span>
<a name="l02326"></a>02326 <span class="stringliteral">        Print the contents of an animal record - used for debugging.</span>
<a name="l02327"></a>02327 <span class="stringliteral">        """</span>
<a name="l02328"></a>02328         <span class="keywordflow">print</span> <span class="stringliteral">'ANIMAL %s RECORD'</span> % (int(self.animalID))
<a name="l02329"></a>02329         <span class="keywordflow">print</span> <span class="stringliteral">'\tAnimal ID:\t%s'</span> % (int(self.animalID))
<a name="l02330"></a>02330         <span class="keywordflow">print</span> <span class="stringliteral">'\tSire ID:\t%s'</span> % (int(self.sireID))
<a name="l02331"></a>02331         <span class="keywordflow">print</span> <span class="stringliteral">'\tDam ID:\t\t%s'</span> % (int(self.damID))
<a name="l02332"></a>02332         <span class="keywordflow">print</span> <span class="stringliteral">'\tBirth Year:\t%s'</span> % (int(self.by))
<a name="l02333"></a>02333         <span class="keywordflow">print</span> <span class="stringliteral">'\tSex:\t\t%s'</span> % (self.sex)
<a name="l02334"></a>02334         <span class="keywordflow">print</span> <span class="stringliteral">'\tOriginal ID:\t%s'</span> % (self.originalID)
<a name="l02335"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#156735a4b74a97106a95a73b5d351fbb">02335</a>         <span class="keywordflow">print</span> <span class="stringliteral">'\tRenumbered ID:\t%s'</span> % (self.renumberedID)
<a name="l02336"></a>02336     <span class="comment">##</span>
<a name="l02337"></a>02337     <span class="comment"># stringme() returns a summary of the data stored in the LightAnimal() object</span>
<a name="l02338"></a>02338     <span class="comment"># as a string.</span>
<a name="l02339"></a>02339     <span class="comment"># @param self Reference to current object.</span>
<a name="l02340"></a>02340     <span class="comment"># @retval A string containing the contents of a LightAnimal object.</span>
<a name="l02341"></a>02341     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#156735a4b74a97106a95a73b5d351fbb">stringme</a>(self):
<a name="l02342"></a>02342         <span class="stringliteral">"""</span>
<a name="l02343"></a>02343 <span class="stringliteral">        Return the contents of an animal record as a string.</span>
<a name="l02344"></a>02344 <span class="stringliteral">        """</span>
<a name="l02345"></a>02345         _me = <span class="stringliteral">''</span>
<a name="l02346"></a>02346         _me = <span class="stringliteral">'%s%s'</span> % ( _me, <span class="stringliteral">'ANIMAL %s RECORD\n'</span> % (int(self.animalID)) )
<a name="l02347"></a>02347         _me = <span class="stringliteral">'%s%s'</span> % ( _me, <span class="stringliteral">'\tAnimal ID:\t%s\n'</span> % (int(self.animalID)) )
<a name="l02348"></a>02348         _me = <span class="stringliteral">'%s%s'</span> % ( _me, <span class="stringliteral">'\tSire ID:\t%s\n'</span> % (int(self.sireID)) )
<a name="l02349"></a>02349         _me = <span class="stringliteral">'%s%s'</span> % ( _me, <span class="stringliteral">'\tDam ID:\t\t%s\n'</span> % (int(self.damID)) )
<a name="l02350"></a>02350         _me = <span class="stringliteral">'%s%s'</span> % ( _me, <span class="stringliteral">'\tBirth Year:\t%s\n'</span> % (int(self.by)) )
<a name="l02351"></a>02351         _me = <span class="stringliteral">'%s%s'</span> % ( _me, <span class="stringliteral">'\tSex:\t\t%s\n'</span> % (self.sex) )
<a name="l02352"></a>02352         _me = <span class="stringliteral">'%s%s'</span> % ( _me, <span class="stringliteral">'\tOriginal ID:\t%s\n'</span> % (self.originalID) )
<a name="l02353"></a>02353         _me = <span class="stringliteral">'%s%s'</span> % ( _me, <span class="stringliteral">'\tRenumbered ID:\t%s\n'</span> % (self.renumberedID) )
<a name="l02354"></a>02354         <span class="keywordflow">return</span> _me
<a name="l02355"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#50c9622a7a154df22c05bf9cfadfce30">02355</a> 
<a name="l02356"></a>02356     <span class="comment">##</span>
<a name="l02357"></a>02357     <span class="comment"># dictme() returns a summary of the data stored in the NewAnimal() object</span>
<a name="l02358"></a>02358     <span class="comment"># as a dictionary.</span>
<a name="l02359"></a>02359     <span class="comment"># @param self Reference to current object</span>
<a name="l02360"></a>02360     <span class="comment"># @retval A dictionary containing the contents of a LightAnimal object.</span>
<a name="l02361"></a>02361     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#50c9622a7a154df22c05bf9cfadfce30">dictme</a>(self):
<a name="l02362"></a>02362         <span class="stringliteral">"""</span>
<a name="l02363"></a>02363 <span class="stringliteral">        Return the contents of an animal record in a dictionary.</span>
<a name="l02364"></a>02364 <span class="stringliteral">        """</span>
<a name="l02365"></a>02365         <span class="keywordflow">try</span>:
<a name="l02366"></a>02366             _dict = {}
<a name="l02367"></a>02367             _dict[animalID] = self.animalID
<a name="l02368"></a>02368             _dict[sireID] = self.sireID
<a name="l02369"></a>02369             _dict[damID] = self.damID
<a name="l02370"></a>02370             _dict[by] = self.by
<a name="l02371"></a>02371             _dict[sex] = self.sex
<a name="l02372"></a>02372             _dict[originalID] = self.originalID
<a name="l02373"></a>02373             _dict[renumberedID] = self.renumberedID
<a name="l02374"></a>02374             <span class="keywordflow">return</span> _dict
<a name="l02375"></a>02375         <span class="keywordflow">except</span>:
<a name="l02376"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#8c3211fcb1c67fffb7b07970ee53b96c">02376</a>             <span class="keywordflow">return</span> {}
<a name="l02377"></a>02377 
<a name="l02378"></a>02378     <span class="comment">##</span>
<a name="l02379"></a>02379     <span class="comment"># trap() checks for common errors in LightAnimal() objects</span>
<a name="l02380"></a>02380     <span class="comment"># @param self Reference to current object</span>
<a name="l02381"></a>02381     <span class="comment"># @retval None</span>
<a name="l02382"></a>02382     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#8c3211fcb1c67fffb7b07970ee53b96c">trap</a>(self):
<a name="l02383"></a>02383         <span class="stringliteral">"""</span>
<a name="l02384"></a>02384 <span class="stringliteral">        Trap common errors in pedigree file entries.</span>
<a name="l02385"></a>02385 <span class="stringliteral">        """</span>
<a name="l02386"></a>02386         <span class="keywordflow">if</span> int(self.animalID) == int(self.sireID):
<a name="l02387"></a>02387             <span class="keywordflow">print</span> <span class="stringliteral">'[ERROR]: Animal %s has an ID number equal to its sire\'s ID (sire ID %s).\n'</span> % (self.animalID,self.sireID)
<a name="l02388"></a>02388         <span class="keywordflow">if</span> int(self.animalID) == int(self.damID):
<a name="l02389"></a>02389             <span class="keywordflow">print</span> <span class="stringliteral">'[ERROR]: Animal %s has an ID number equal to its dam\'s ID (dam ID %s).\n'</span> % (self.animalID,self.damID)
<a name="l02390"></a>02390         <span class="keywordflow">if</span> int(self.animalID) &lt; int(self.sireID):
<a name="l02391"></a>02391             <span class="keywordflow">print</span> <span class="stringliteral">'[ERROR]: Animal %s is older than its sire (sire ID %s).\n'</span> % (self.animalID,self.sireID)
<a name="l02392"></a>02392         <span class="keywordflow">if</span> int(self.animalID) &lt; int(self.damID):
<a name="l02393"></a>02393             <span class="keywordflow">print</span> <span class="stringliteral">'[ERROR]: Animal %s is older than its dam (dam ID %s).\n'</span> % (self.animalID,self.damID)
<a name="l02394"></a>02394 
<a name="l02395"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#7a4a49d418a580678e32c214cd7aee7c">02395</a>     <span class="comment">##</span>
<a name="l02396"></a>02396     <span class="comment"># pad_id() takes an Animal ID, pads it to fifteen digits, and prepends the birthyear</span>
<a name="l02397"></a>02397     <span class="comment"># (or 1950 if the birth year is unknown).  The order of elements is: birthyear, animalID,</span>
<a name="l02398"></a>02398     <span class="comment"># count of zeros, zeros.</span>
<a name="l02399"></a>02399     <span class="comment"># @param self Reference to current object</span>
<a name="l02400"></a>02400     <span class="comment"># @retval A padded ID number that is supposed to be unique across animals</span>
<a name="l02401"></a>02401     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#7a4a49d418a580678e32c214cd7aee7c">pad_id</a>(self):
<a name="l02402"></a>02402         <span class="stringliteral">"""</span>
<a name="l02403"></a>02403 <span class="stringliteral">        Take an Animal ID, pad it to fifteen digits, and prepend the birthyear (or 1900</span>
<a name="l02404"></a>02404 <span class="stringliteral">        if the birth year is unknown).  The order of elements is: birthyear, animalID,</span>
<a name="l02405"></a>02405 <span class="stringliteral">        count of zeros, zeros.</span>
<a name="l02406"></a>02406 <span class="stringliteral">        """</span>
<a name="l02407"></a>02407         <span class="comment">#print self.animalID</span>
<a name="l02408"></a>02408         l = len(self.animalID)
<a name="l02409"></a>02409         pl = 15 - l - 1
<a name="l02410"></a>02410         <span class="keywordflow">if</span> pl &gt; 0:
<a name="l02411"></a>02411             zs = <span class="stringliteral">'0'</span>*pl
<a name="l02412"></a>02412             pid = <span class="stringliteral">'%s%s%s%s'</span> % (self.by,zs,self.animalID,l)
<a name="l02413"></a>02413         <span class="keywordflow">else</span>:
<a name="l02414"></a>02414             pid = <span class="stringliteral">'%s%s%s'</span> % (self.by,self.animalID,l)
<a name="l02415"></a>02415         <span class="keywordflow">return</span> pid
<a name="l02416"></a>02416 
<a name="l02417"></a>02417     <span class="comment">##</span>
<a name="l02418"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#cf2e3f1be5c9b23efbff5afeb5126c83">02418</a>     <span class="comment"># string_to_int() takes an Animal/Sire/Dam ID as a string and returns a</span>
<a name="l02419"></a>02419     <span class="comment"># hash.</span>
<a name="l02420"></a>02420     <span class="comment"># @param self Reference to current object.</span>
<a name="l02421"></a>02421     <span class="comment"># @param idstring String to be hashed using the Python hashlib MD5 implementation.</span>
<a name="l02422"></a>02422     <span class="comment"># @param mymaxint Constant used by earlier iterations of this function.</span>
<a name="l02423"></a>02423     <span class="comment"># @retval A hashed value representing the input string.</span>
<a name="l02424"></a>02424     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1LightAnimal.html#cf2e3f1be5c9b23efbff5afeb5126c83">string_to_int</a>(self, idstring, mymaxint=9223372036854775807):
<a name="l02425"></a>02425         <span class="stringliteral">"""</span>
<a name="l02426"></a>02426 <span class="stringliteral">        Convert a string to an integer.</span>
<a name="l02427"></a>02427 <span class="stringliteral">        """</span>
<a name="l02428"></a>02428         <span class="comment"># This algorithm is taken from "Character String Keys" in "Data</span>
<a name="l02429"></a>02429         <span class="comment"># Structures and Algorithms with Object-Oriented Design Patterns</span>
<a name="l02430"></a>02430         <span class="comment"># in Python" by Bruno R. Preiss:</span>
<a name="l02431"></a>02431         <span class="comment"># http://www.brpreiss.com/books/opus7/html/page220.html#progstrnga</span>
<a name="l02432"></a>02432         <span class="comment">#shift = 6</span>
<a name="l02433"></a>02433         <span class="comment">#mask = ~0 &lt;&lt; ( 31 - shift )</span>
<a name="l02434"></a>02434         <span class="comment">#result = 0</span>
<a name="l02435"></a>02435         <span class="comment">#for c in idstring:</span>
<a name="l02436"></a>02436         <span class="comment">#    result = ( ( result &amp; mask ) ^ result &lt;&lt; shift ^ ord(c) ) &amp; sys.maxint</span>
<a name="l02437"></a>02437 
<a name="l02438"></a>02438         <span class="comment"># This is a test to try and fix the problems on Mac OS/X and Windows.</span>
<a name="l02439"></a>02439         <span class="comment">#import md5</span>
<a name="l02440"></a>02440         <span class="keyword">import</span> hashlib
<a name="l02441"></a>02441         <span class="keywordflow">try</span>:
<a name="l02442"></a>02442             <span class="comment"># If we can, let's use the Python MD5 implementation</span>
<a name="l02443"></a>02443             <span class="comment">#md5hash = md5.md5(idstring)</span>
<a name="l02444"></a>02444             result = hashlib.md5(idstring).hexdigest()
<a name="l02445"></a>02445             <span class="comment">#result = string.atoi(md5hash.hexdigest(),16)</span>
<a name="l02446"></a>02446         <span class="keywordflow">except</span>:
<a name="l02447"></a>02447             <span class="comment"># If we have some sort of problem with the MD5 hash then try this.</span>
<a name="l02448"></a>02448             <span class="comment"># WARNING -- This algorithm was broken on Mac OS/X and Windows,</span>
<a name="l02449"></a>02449             <span class="comment"># but not on 9some) Linuxes. The problem may have been related to</span>
<a name="l02450"></a>02450             <span class="comment"># platform-specific values of sys.maxint, so I've hard-coded that</span>
<a name="l02451"></a>02451             <span class="comment"># as sys.maxint from a 64-bit system. It gets cast to a long on 32-</span>
<a name="l02452"></a>02452             <span class="comment"># bit platforms, but I haven't found that to be a problem -- yet.</span>
<a name="l02453"></a>02453             <span class="comment">#</span>
<a name="l02454"></a>02454             <span class="comment"># This algorithm is taken from "Character String Keys" in "Data</span>
<a name="l02455"></a>02455             <span class="comment"># Structures and Algorithms with Object-Oriented Design Patterns</span>
<a name="l02456"></a>02456             <span class="comment"># in Python" by Bruno R. Preiss:</span>
<a name="l02457"></a>02457             <span class="comment"># http://www.brpreiss.com/books/opus7/html/page220.html#progstrnga</span>
<a name="l02458"></a>02458             shift = 6
<a name="l02459"></a>02459             mask = ~0 &lt;&lt; ( 31 - shift )
<a name="l02460"></a>02460             result = 0
<a name="l02461"></a>02461             <span class="keywordflow">for</span> c <span class="keywordflow">in</span> idstring:
<a name="l02462"></a>02462                 result = ( ( result &amp; mask ) ^ result &lt;&lt; shift ^ ord(c) ) &amp; mymaxint
<a name="l02463"></a>02463         <span class="keywordflow">return</span> result
<a name="l02464"></a>02464 
<a name="l02465"></a>02465 <span class="comment">##</span>
<a name="l02466"></a>02466 <span class="comment"># The PedigreeMetadata() class stores metadata about pedigrees.  Hopefully this will help improve performance in some procedures,</span>
<a name="l02467"></a>02467 <span class="comment"># as well as provide some useful summary data.</span>
<a name="l02468"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html">02468</a> <span class="keyword">class </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html">PedigreeMetadata</a>:
<a name="l02469"></a>02469     <span class="stringliteral">"""A class to hold metadata about pedigrees.  Hopefully this will help improve performance in some procedures, as well as</span>
<a name="l02470"></a>02470 <span class="stringliteral">    provide some useful summary data."""</span>
<a name="l02471"></a>02471     <span class="comment">##</span>
<a name="l02472"></a>02472     <span class="comment"># __init__() initializes a PedigreeMetadata object.</span>
<a name="l02473"></a>02473     <span class="comment"># @param self Reference to current object.</span>
<a name="l02474"></a>02474     <span class="comment"># @param myped A PyPedal pedigree.</span>
<a name="l02475"></a>02475     <span class="comment"># @param kw A dictionary of options.</span>
<a name="l02476"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#2a79838a249918d09f11cf837296ecfe">02476</a>     <span class="comment"># @retval An instance of a Pedigree() object populated with data.</span>
<a name="l02477"></a>02477     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#2a79838a249918d09f11cf837296ecfe">__init__</a>(self, myped, kw):
<a name="l02478"></a>02478         <span class="stringliteral">"""</span>
<a name="l02479"></a>02479 <span class="stringliteral">        Initialize a pedigree record.</span>
<a name="l02480"></a>02480 <span class="stringliteral">        """</span>
<a name="l02481"></a>02481         self.kw = kw
<a name="l02482"></a>02482         <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span> <span class="keywordflow">and</span> self.kw[<span class="stringliteral">'pedigree_summary'</span>]:
<a name="l02483"></a>02483             <span class="keywordflow">print</span> <span class="stringliteral">'\t[INFO]:  Instantiating a new PedigreeMetadata() object...'</span>
<a name="l02484"></a>02484         <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span> <span class="keywordflow">and</span> self.kw[<span class="stringliteral">'pedigree_summary'</span>]:
<a name="l02485"></a>02485             <span class="keywordflow">print</span> <span class="stringliteral">'\t[INFO]:  Naming the Pedigree()...'</span>
<a name="l02486"></a>02486         self.name = kw[<span class="stringliteral">'pedname'</span>]
<a name="l02487"></a>02487         <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span> <span class="keywordflow">and</span> self.kw[<span class="stringliteral">'pedigree_summary'</span>]:
<a name="l02488"></a>02488             <span class="keywordflow">print</span> <span class="stringliteral">'\t[INFO]:  Assigning a filename...'</span>
<a name="l02489"></a>02489         self.filename = kw[<span class="stringliteral">'pedfile'</span>]
<a name="l02490"></a>02490         <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span> <span class="keywordflow">and</span> self.kw[<span class="stringliteral">'pedigree_summary'</span>]:
<a name="l02491"></a>02491             <span class="keywordflow">print</span> <span class="stringliteral">'\t[INFO]:  Attaching a pedigree...'</span>
<a name="l02492"></a>02492         self.myped = myped
<a name="l02493"></a>02493         <span class="keywordflow">if</span> kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span> <span class="keywordflow">and</span> self.kw[<span class="stringliteral">'pedigree_summary'</span>]:
<a name="l02494"></a>02494             <span class="keywordflow">print</span> <span class="stringliteral">'\t[INFO]:  Setting the pedcode...'</span>
<a name="l02495"></a>02495         self.pedcode = kw[<span class="stringliteral">'pedformat'</span>]
<a name="l02496"></a>02496         <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span> <span class="keywordflow">and</span> self.kw[<span class="stringliteral">'pedigree_summary'</span>]:
<a name="l02497"></a>02497             <span class="keywordflow">print</span> <span class="stringliteral">'\t[INFO]:  Counting the number of animals in the pedigree...'</span>
<a name="l02498"></a>02498         self.num_records = len(self.myped)
<a name="l02499"></a>02499         <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span> <span class="keywordflow">and</span> self.kw[<span class="stringliteral">'pedigree_summary'</span>]:
<a name="l02500"></a>02500             <span class="keywordflow">print</span> <span class="stringliteral">'\t[INFO]:  Counting and finding unique sires...'</span>
<a name="l02501"></a>02501         self.num_unique_sires, self.unique_sire_list = self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#f9cfc208dcbdede54584e79232ff7e8b">nus</a>()
<a name="l02502"></a>02502         <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span> <span class="keywordflow">and</span> self.kw[<span class="stringliteral">'pedigree_summary'</span>]:
<a name="l02503"></a>02503             <span class="keywordflow">print</span> <span class="stringliteral">'\t[INFO]:  Counting and finding unique dams...'</span>
<a name="l02504"></a>02504         self.num_unique_dams, self.unique_dam_list = self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#45b04c77b944ad39d9a5b17fb09f39fa">nud</a>()
<a name="l02505"></a>02505         <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span> <span class="keywordflow">and</span> self.kw[<span class="stringliteral">'pedigree_summary'</span>]:
<a name="l02506"></a>02506             <span class="keywordflow">print</span> <span class="stringliteral">'\t[INFO]:  Setting renumbered flag...'</span>
<a name="l02507"></a>02507         self.renumbered = kw[<span class="stringliteral">'renumber'</span>]
<a name="l02508"></a>02508         <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span> <span class="keywordflow">and</span> self.kw[<span class="stringliteral">'pedigree_summary'</span>]:
<a name="l02509"></a>02509             <span class="keywordflow">print</span> <span class="stringliteral">'\t[INFO]:  Counting and finding unique generations...'</span>
<a name="l02510"></a>02510         self.num_unique_gens, self.unique_gen_list = self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#28d365914cafb8f29adba7c5a6f2a299">nug</a>()
<a name="l02511"></a>02511         <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span> <span class="keywordflow">and</span> self.kw[<span class="stringliteral">'pedigree_summary'</span>]:
<a name="l02512"></a>02512             <span class="keywordflow">print</span> <span class="stringliteral">'\t[INFO]:  Counting and finding unique birthyears...'</span>
<a name="l02513"></a>02513         self.num_unique_years, self.unique_year_list = self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#b4eb371d67c944d8586940b3e80b5433">nuy</a>()
<a name="l02514"></a>02514         <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span> <span class="keywordflow">and</span> self.kw[<span class="stringliteral">'pedigree_summary'</span>]:
<a name="l02515"></a>02515             <span class="keywordflow">print</span> <span class="stringliteral">'\t[INFO]:  Counting and finding unique founders...'</span>
<a name="l02516"></a>02516         self.num_unique_founders, self.unique_founder_list = self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#6cc8a29dd016121deb52044a3cf96106">nuf</a>()
<a name="l02517"></a>02517         <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span> <span class="keywordflow">and</span> self.kw[<span class="stringliteral">'pedigree_summary'</span>]:
<a name="l02518"></a>02518             <span class="keywordflow">print</span> <span class="stringliteral">'\t[INFO]:  Counting and finding unique herds...'</span>
<a name="l02519"></a>02519         self.num_unique_herds, self.unique_herd_list = self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#490f5fb946a92500e2e65cc1e1ef2f91">nuherds</a>()
<a name="l02520"></a>02520         <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span> <span class="keywordflow">and</span> self.kw[<span class="stringliteral">'pedigree_summary'</span>]:
<a name="l02521"></a>02521             <span class="keywordflow">print</span> <span class="stringliteral">'\t[INFO]:  Detaching pedigree...'</span>
<a name="l02522"></a>02522         self.myped = []
<a name="l02523"></a>02523     <span class="comment">##</span>
<a name="l02524"></a>02524     <span class="comment"># printme() prints a summary of the metadata stored in the Pedigree() object.</span>
<a name="l02525"></a>02525     <span class="comment"># @param self Reference to current object</span>
<a name="l02526"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#18ba74ff1ce53efca995dee9a3c89a77">02526</a>     <span class="comment"># @retval None</span>
<a name="l02527"></a>02527     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#18ba74ff1ce53efca995dee9a3c89a77">printme</a>(self):
<a name="l02528"></a>02528         <span class="stringliteral">"""</span>
<a name="l02529"></a>02529 <span class="stringliteral">        Print the pedigree metadata.</span>
<a name="l02530"></a>02530 <span class="stringliteral">        """</span>
<a name="l02531"></a>02531         <span class="keywordflow">print</span> <span class="stringliteral">'Metadata for %s (%s)'</span> % (self.name,self.filename)
<a name="l02532"></a>02532         <span class="keywordflow">print</span> <span class="stringliteral">'\tRecords:\t\t%s'</span> % (self.num_records)
<a name="l02533"></a>02533         <span class="keywordflow">print</span> <span class="stringliteral">'\tUnique Sires:\t\t%s'</span> % (self.num_unique_sires)
<a name="l02534"></a>02534         <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span> <span class="keywordflow">and</span> self.kw[<span class="stringliteral">'pedigree_summary'</span>] &gt; 1:
<a name="l02535"></a>02535             <span class="keywordflow">print</span> <span class="stringliteral">'\tSires:\t\t%s'</span> % (self.unique_sire_list)
<a name="l02536"></a>02536         <span class="keywordflow">print</span> <span class="stringliteral">'\tUnique Dams:\t\t%s'</span> % (self.num_unique_dams)
<a name="l02537"></a>02537         <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span> <span class="keywordflow">and</span> self.kw[<span class="stringliteral">'pedigree_summary'</span>] &gt; 1:
<a name="l02538"></a>02538             <span class="keywordflow">print</span> <span class="stringliteral">'\tDams:\t\t%s'</span> % (self.unique_dam_list)
<a name="l02539"></a>02539         <span class="keywordflow">print</span> <span class="stringliteral">'\tUnique Gens:\t\t%s'</span> % (self.num_unique_gens)
<a name="l02540"></a>02540         <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span> <span class="keywordflow">and</span> self.kw[<span class="stringliteral">'pedigree_summary'</span>] &gt; 1:
<a name="l02541"></a>02541             <span class="keywordflow">print</span> <span class="stringliteral">'\tGenerations:\t\t%s'</span> % (self.unique_gen_list)
<a name="l02542"></a>02542         <span class="keywordflow">print</span> <span class="stringliteral">'\tUnique Years:\t\t%s'</span> % (self.num_unique_years)
<a name="l02543"></a>02543         <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span> <span class="keywordflow">and</span> self.kw[<span class="stringliteral">'pedigree_summary'</span>] &gt; 1:
<a name="l02544"></a>02544             <span class="keywordflow">print</span> <span class="stringliteral">'\tYear:\t\t%s'</span> % (self.unique_year_list)
<a name="l02545"></a>02545         <span class="keywordflow">print</span> <span class="stringliteral">'\tUnique Founders:\t%s'</span> % (self.num_unique_founders)
<a name="l02546"></a>02546         <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span> <span class="keywordflow">and</span> self.kw[<span class="stringliteral">'pedigree_summary'</span>] &gt; 1:
<a name="l02547"></a>02547             <span class="keywordflow">print</span> <span class="stringliteral">'\tFounders:\t\t%s'</span> % (self.unique_founder_list)
<a name="l02548"></a>02548         <span class="keywordflow">print</span> <span class="stringliteral">'\tUnique Herds:\t\t%s'</span> % (self.num_unique_herds)
<a name="l02549"></a>02549         <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span> <span class="keywordflow">and</span> self.kw[<span class="stringliteral">'pedigree_summary'</span>] &gt; 1:
<a name="l02550"></a>02550             <span class="keywordflow">print</span> <span class="stringliteral">'\tHerds:\t\t%s'</span> % (self.unique_herd_list)
<a name="l02551"></a>02551         <span class="keywordflow">print</span> <span class="stringliteral">'\tPedigree Code:\t\t%s'</span> % (self.pedcode)
<a name="l02552"></a>02552 
<a name="l02553"></a>02553     <span class="comment">##</span>
<a name="l02554"></a>02554     <span class="comment"># stringme() returns a summary of the metadata stored in the pedigree as</span>
<a name="l02555"></a>02555     <span class="comment"># a string.</span>
<a name="l02556"></a>02556     <span class="comment"># @param self Reference to current object.</span>
<a name="l02557"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#c5646087f6dae80c33b20b3cff4f7876">02557</a>     <span class="comment"># @retval A summary of the metadata stored in the pedigree as a string.</span>
<a name="l02558"></a>02558     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#c5646087f6dae80c33b20b3cff4f7876">stringme</a>(self):
<a name="l02559"></a>02559         <span class="stringliteral">"""</span>
<a name="l02560"></a>02560 <span class="stringliteral">        Build a string from the pedigree metadata.</span>
<a name="l02561"></a>02561 <span class="stringliteral">        """</span>
<a name="l02562"></a>02562         _me = <span class="stringliteral">''</span>
<a name="l02563"></a>02563         _me = <span class="stringliteral">'%s%s'</span> % ( _me, <span class="stringliteral">'PEDIGREE %s (%s)\n'</span> % (self.name,self.filename) )
<a name="l02564"></a>02564         _me = <span class="stringliteral">'%s%s'</span> % ( _me, <span class="stringliteral">'\tRecords:\t\t\t%s\n'</span> % (self.num_records) )
<a name="l02565"></a>02565         _me = <span class="stringliteral">'%s%s'</span> % ( _me, <span class="stringliteral">'\tUnique Sires:\t\t%s\n'</span> % (self.num_unique_sires) )
<a name="l02566"></a>02566         _me = <span class="stringliteral">'%s%s'</span> % ( _me, <span class="stringliteral">'\tUnique Dams:\t\t%s\n'</span> % (self.num_unique_dams) )
<a name="l02567"></a>02567         _me = <span class="stringliteral">'%s%s'</span> % ( _me, <span class="stringliteral">'\tUnique Gens:\t\t%s\n'</span> % (self.num_unique_gens) )
<a name="l02568"></a>02568         _me = <span class="stringliteral">'%s%s'</span> % ( _me, <span class="stringliteral">'\tUnique Years:\t\t%s\n'</span> % (self.num_unique_years) )
<a name="l02569"></a>02569         _me = <span class="stringliteral">'%s%s'</span> % ( _me, <span class="stringliteral">'\tUnique Founders:\t%s\n'</span> % (self.num_unique_founders) )
<a name="l02570"></a>02570         _me = <span class="stringliteral">'%s%s'</span> % ( _me, <span class="stringliteral">'\tUnique Herds:\t%s\n'</span> % (self.num_unique_herds) )
<a name="l02571"></a>02571         _me = <span class="stringliteral">'%s%s'</span> % ( _me, <span class="stringliteral">'\tPedigree Code:\t\t%s\n'</span> % (self.pedcode) )
<a name="l02572"></a>02572         <span class="keywordflow">return</span> _me
<a name="l02573"></a>02573     <span class="comment">##</span>
<a name="l02574"></a>02574     <span class="comment"># fileme() writes the metada stored in the Pedigree() object to disc.</span>
<a name="l02575"></a>02575     <span class="comment"># @param self Reference to current object</span>
<a name="l02576"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#e978c28ac14f83c0c14bc177858d0b6c">02576</a>     <span class="comment"># @retval None</span>
<a name="l02577"></a>02577     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#e978c28ac14f83c0c14bc177858d0b6c">fileme</a>(self):
<a name="l02578"></a>02578         <span class="stringliteral">"""</span>
<a name="l02579"></a>02579 <span class="stringliteral">        Save the pedigree metadata to a file.</span>
<a name="l02580"></a>02580 <span class="stringliteral">        """</span>
<a name="l02581"></a>02581         outputfile = <span class="stringliteral">'%s%s%s'</span> % (self.name,<span class="stringliteral">'_ped_metadata_'</span>,<span class="stringliteral">'.dat'</span>)
<a name="l02582"></a>02582         aout = open(outputfile,<span class="stringliteral">'w'</span>)
<a name="l02583"></a>02583         line = <span class="stringliteral">'='</span>*60+<span class="stringliteral">'\n'</span>
<a name="l02584"></a>02584         aout.write(<span class="stringliteral">'%s\n'</span> % line)
<a name="l02585"></a>02585         aout.write(<span class="stringliteral">'PEDIGREE %s (%s)\n'</span> % self.name,self.filename)
<a name="l02586"></a>02586         aout.write(<span class="stringliteral">'\tPedigree Code:\t%s\n'</span> % self.pedcode)
<a name="l02587"></a>02587         aout.write(<span class="stringliteral">'\tRecords:\t%s\n'</span> % self.num_records)
<a name="l02588"></a>02588         aout.write(<span class="stringliteral">'\tUnique Sires:\t%s\n'</span> % self.num_unique_sires)
<a name="l02589"></a>02589         aout.write(<span class="stringliteral">'\tUnique Dams:\t%s\n'</span> % self.num_unique_dams)
<a name="l02590"></a>02590         aout.write(<span class="stringliteral">'\tUnique Founders:\t%s\n'</span> % self.num_unique_founders)
<a name="l02591"></a>02591         aout.write(<span class="stringliteral">'\tUnique Gens:\t%s\n'</span> % self.num_unique_gens)
<a name="l02592"></a>02592         aout.write(<span class="stringliteral">'\tUnique Years:\t%s\n'</span> % self.num_unique_years)
<a name="l02593"></a>02593         aout.write(<span class="stringliteral">'\tUnique Herds:\t%s\n'</span> % self.num_unique_herds)
<a name="l02594"></a>02594         aout.write(<span class="stringliteral">'%s\n'</span> % line)
<a name="l02595"></a>02595         aout.write(<span class="stringliteral">'\tUnique Sire List:\t%s\n'</span> % self.unique_sire_list)
<a name="l02596"></a>02596         aout.write(<span class="stringliteral">'\tUnique Dam List:\t%s\n'</span> % self.unique_dam_list)
<a name="l02597"></a>02597         aout.write(<span class="stringliteral">'\tUnique Founder List:\t%s\n'</span> % self.unique_founder_list)
<a name="l02598"></a>02598         aout.write(<span class="stringliteral">'\tUnique Gen List:\t%s\n'</span> % self.unique_gen_list)
<a name="l02599"></a>02599         aout.write(<span class="stringliteral">'\tUnique Year List:\t%s\n'</span> % self.unique_year_list)
<a name="l02600"></a>02600         aout.write(<span class="stringliteral">'\tUnique Herd List:\t%s\n'</span> % self.unique_herd_list)
<a name="l02601"></a>02601         aout.write(<span class="stringliteral">'%s\n'</span> % line)
<a name="l02602"></a>02602         aout.close()
<a name="l02603"></a>02603 
<a name="l02604"></a>02604     <span class="comment">##</span>
<a name="l02605"></a>02605     <span class="comment"># nus() returns the number of unique sires in the pedigree along with a list of the sires</span>
<a name="l02606"></a>02606     <span class="comment"># @param self Reference to current object</span>
<a name="l02607"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#f9cfc208dcbdede54584e79232ff7e8b">02607</a>     <span class="comment"># @retval The number of unique sires in the pedigree and a list of those sires</span>
<a name="l02608"></a>02608     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#f9cfc208dcbdede54584e79232ff7e8b">nus</a>(self):
<a name="l02609"></a>02609         <span class="stringliteral">"""</span>
<a name="l02610"></a>02610 <span class="stringliteral">        Count the number of unique sire IDs in the pedigree.  Returns an integer count</span>
<a name="l02611"></a>02611 <span class="stringliteral">        and a Python list of the unique sire IDs.</span>
<a name="l02612"></a>02612 <span class="stringliteral">        """</span>
<a name="l02613"></a>02613         sirelist = set([x.sireID <span class="keywordflow">for</span> x <span class="keywordflow">in</span> self.myped <span class="keywordflow">if</span> x.sireID != self.kw[<span class="stringliteral">'missing_parent'</span>]])
<a name="l02614"></a>02614         <span class="keywordflow">return</span> len(sirelist), sirelist
<a name="l02615"></a>02615 
<a name="l02616"></a>02616     <span class="comment">##</span>
<a name="l02617"></a>02617     <span class="comment"># nud() returns the number of unique dams in the pedigree along with a list of the dams</span>
<a name="l02618"></a>02618     <span class="comment"># @param self Reference to current object</span>
<a name="l02619"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#45b04c77b944ad39d9a5b17fb09f39fa">02619</a>     <span class="comment"># @retval The number of unique dams in the pedigree and a list of those dams</span>
<a name="l02620"></a>02620     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#45b04c77b944ad39d9a5b17fb09f39fa">nud</a>(self):
<a name="l02621"></a>02621         <span class="stringliteral">"""</span>
<a name="l02622"></a>02622 <span class="stringliteral">        Count the number of unique dam IDs in the pedigree.  Returns an integer count</span>
<a name="l02623"></a>02623 <span class="stringliteral">        and a Python list of the unique dam IDs.</span>
<a name="l02624"></a>02624 <span class="stringliteral">        """</span>
<a name="l02625"></a>02625         damlist = set([x.damID <span class="keywordflow">for</span> x <span class="keywordflow">in</span> self.myped <span class="keywordflow">if</span> x.damID != self.kw[<span class="stringliteral">'missing_parent'</span>]])
<a name="l02626"></a>02626         <span class="keywordflow">return</span> len(damlist), damlist
<a name="l02627"></a>02627 
<a name="l02628"></a>02628     <span class="comment">##</span>
<a name="l02629"></a>02629     <span class="comment"># nug() returns the number of unique generations in the pedigree along with a list of the generations</span>
<a name="l02630"></a>02630     <span class="comment"># @param self Reference to current object</span>
<a name="l02631"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#28d365914cafb8f29adba7c5a6f2a299">02631</a>     <span class="comment"># @retval The number of unique generations in the pedigree and a list of those generations</span>
<a name="l02632"></a>02632     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#28d365914cafb8f29adba7c5a6f2a299">nug</a>(self):
<a name="l02633"></a>02633         <span class="stringliteral">"""</span>
<a name="l02634"></a>02634 <span class="stringliteral">        Count the number of unique generations in the pedigree.  Returns an integer</span>
<a name="l02635"></a>02635 <span class="stringliteral">        count and a Python list of the unique generations.</span>
<a name="l02636"></a>02636 <span class="stringliteral">        """</span>
<a name="l02637"></a>02637         <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'animal_type'</span>] == <span class="stringliteral">'light'</span>:
<a name="l02638"></a>02638             genlist = []
<a name="l02639"></a>02639         <span class="keywordflow">else</span>:
<a name="l02640"></a>02640             genlist = set([x.gen <span class="keywordflow">for</span> x <span class="keywordflow">in</span> self.myped])
<a name="l02641"></a>02641         <span class="keywordflow">return</span> len(genlist), genlist
<a name="l02642"></a>02642 
<a name="l02643"></a>02643     <span class="comment">##</span>
<a name="l02644"></a>02644     <span class="comment"># nuy() returns the number of unique birthyears in the pedigree along with a list of the birthyears</span>
<a name="l02645"></a>02645     <span class="comment"># @param self Reference to current object</span>
<a name="l02646"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#b4eb371d67c944d8586940b3e80b5433">02646</a>     <span class="comment"># @retval The number of unique birthyears in the pedigree and a list of those birthyears</span>
<a name="l02647"></a>02647     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#b4eb371d67c944d8586940b3e80b5433">nuy</a>(self):
<a name="l02648"></a>02648         <span class="stringliteral">"""</span>
<a name="l02649"></a>02649 <span class="stringliteral">        Count the number of unique birth years in the pedigree.  Returns an integer</span>
<a name="l02650"></a>02650 <span class="stringliteral">        count and a Python list of the unique birth years.</span>
<a name="l02651"></a>02651 <span class="stringliteral">        """</span>
<a name="l02652"></a>02652         bylist = set([x.by <span class="keywordflow">for</span> x <span class="keywordflow">in</span> self.myped])
<a name="l02653"></a>02653         <span class="keywordflow">return</span> len(bylist), bylist
<a name="l02654"></a>02654 
<a name="l02655"></a>02655     <span class="comment">##</span>
<a name="l02656"></a>02656     <span class="comment"># nuf() returns the number of unique founders in the pedigree along with a list of the founders</span>
<a name="l02657"></a>02657     <span class="comment"># @param self Reference to current object</span>
<a name="l02658"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#6cc8a29dd016121deb52044a3cf96106">02658</a>     <span class="comment"># @retval The number of unique founders in the pedigree and a list of those founders</span>
<a name="l02659"></a>02659     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#6cc8a29dd016121deb52044a3cf96106">nuf</a>(self):
<a name="l02660"></a>02660         <span class="stringliteral">"""</span>
<a name="l02661"></a>02661 <span class="stringliteral">        Count the number of unique founders in the pedigree.</span>
<a name="l02662"></a>02662 <span class="stringliteral">        """</span>
<a name="l02663"></a>02663         <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'animal_type'</span>] == <span class="stringliteral">'light'</span>:
<a name="l02664"></a>02664             <span class="comment"># There is no 'founder' flag on LightAnimal records, so we need to</span>
<a name="l02665"></a>02665             <span class="comment"># check for unknown parents in order to identify founders.</span>
<a name="l02666"></a>02666             flist = set([x.animalID <span class="keywordflow">for</span> x <span class="keywordflow">in</span> self.myped <span class="keywordflow">if</span> x.sireID == self.kw[<span class="stringliteral">'missing_parent'</span>] <span class="keywordflow">and</span> x.damID == self.kw[<span class="stringliteral">'missing_parent'</span>]])
<a name="l02667"></a>02667         <span class="keywordflow">else</span>:
<a name="l02668"></a>02668             flist = set([x.animalID <span class="keywordflow">for</span> x <span class="keywordflow">in</span> self.myped <span class="keywordflow">if</span> x.founder == <span class="stringliteral">'y'</span>])
<a name="l02669"></a>02669         <span class="keywordflow">return</span> len(flist), flist
<a name="l02670"></a>02670 
<a name="l02671"></a>02671     <span class="comment">##</span>
<a name="l02672"></a>02672     <span class="comment"># nuherds() returns the number of unique herds in the pedigree along with a list of the herds.</span>
<a name="l02673"></a>02673     <span class="comment"># @param self Reference to the current Pedigree() object</span>
<a name="l02674"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#490f5fb946a92500e2e65cc1e1ef2f91">02674</a>     <span class="comment"># @retval The number of unique herds in the pedigree and a list of those herds</span>
<a name="l02675"></a>02675     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PedigreeMetadata.html#490f5fb946a92500e2e65cc1e1ef2f91">nuherds</a>(self):
<a name="l02676"></a>02676         <span class="stringliteral">"""</span>
<a name="l02677"></a>02677 <span class="stringliteral">        Count the number of unique herds in the pedigree.</span>
<a name="l02678"></a>02678 <span class="stringliteral">        """</span>
<a name="l02679"></a>02679         <span class="keywordflow">if</span> self.kw[<span class="stringliteral">'animal_type'</span>] == <span class="stringliteral">'light'</span>:
<a name="l02680"></a>02680             herdlist = []
<a name="l02681"></a>02681         <span class="keywordflow">else</span>:
<a name="l02682"></a>02682             herdlist = set([x.originalHerd <span class="keywordflow">for</span> x <span class="keywordflow">in</span> self.myped])
<a name="l02683"></a>02683         <span class="keywordflow">return</span> len(herdlist), herdlist
<a name="l02684"></a>02684 
<a name="l02685"></a>02685 <span class="comment">##</span>
<a name="l02686"></a>02686 <span class="comment"># NewAMatrix provides an instance of a numerator relationship matrix as a Numarray array of</span>
<a name="l02687"></a>02687 <span class="comment"># floats with some convenience methods.  The idea here is to provide a wrapper around a NRM</span>
<a name="l02688"></a>02688 <span class="comment"># so that it is easier to work with.  For large pedigrees it can take a long time to compute</span>
<a name="l02689"></a>02689 <span class="comment"># the elements of A, so there is real value in providing an easy way to save and retrieve a</span>
<a name="l02690"></a>02690 <span class="comment"># NRM once it has been formed.</span>
<a name="l02691"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html">02691</a> <span class="keyword">class </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html">NewAMatrix</a>:
<a name="l02692"></a>02692     <span class="comment">##</span>
<a name="l02693"></a>02693     <span class="comment"># __init__() initializes a NewAMatrix object.</span>
<a name="l02694"></a>02694     <span class="comment"># @param self Reference to current object.</span>
<a name="l02695"></a>02695     <span class="comment"># @param kw A dictionary of options.</span>
<a name="l02696"></a>02696     <span class="comment"># @retval An instance of a NewAMatrix() object</span>
<a name="l02697"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html#3e97c784c797a371eff6241ceec2b01a">02697</a>     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html#3e97c784c797a371eff6241ceec2b01a">__init__</a>(self, kw):
<a name="l02698"></a>02698         <span class="stringliteral">"""</span>
<a name="l02699"></a>02699 <span class="stringliteral">        Initialize a new numerator relationship matrix.</span>
<a name="l02700"></a>02700 <span class="stringliteral">        """</span>
<a name="l02701"></a>02701         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">'messages'</span>): kw[<span class="stringliteral">'messages'</span>] = <span class="stringliteral">'verbose'</span>
<a name="l02702"></a>02702         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">'nrm_method'</span>): kw[<span class="stringliteral">'nrm_method'</span>] = <span class="stringliteral">'nrm'</span>
<a name="l02703"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html#1163a14c623f4b0e398c4ed197506669">02703</a>         <span class="comment"># nrm_format can take the values 'text' or 'binary'.</span>
<a name="l02704"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html#c46946fea84f8a3bd2a11b252397931e">02704</a>         <span class="keywordflow">if</span> <span class="keywordflow">not</span> kw.has_key(<span class="stringliteral">'nrm_format'</span>): kw[<span class="stringliteral">'nrm_format'</span>] = <span class="stringliteral">'text'</span>
<a name="l02705"></a>02705         self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html#1163a14c623f4b0e398c4ed197506669">kw</a> = kw
<a name="l02706"></a>02706         self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html#c46946fea84f8a3bd2a11b252397931e">nrm</a> = <span class="keyword">False</span>
<a name="l02707"></a>02707 
<a name="l02708"></a>02708     <span class="comment">##</span>
<a name="l02709"></a>02709     <span class="comment"># form_a_matrix() calls pyp_nrm/fast_a_matrix() or pyp_nrm/fast_a_matrix_r()</span>
<a name="l02710"></a>02710     <span class="comment"># to form a NRM from a pedigree.</span>
<a name="l02711"></a>02711     <span class="comment"># @param self Reference to current object.</span>
<a name="l02712"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html#13abc11f92967491f1f7f0f7da789540">02712</a>     <span class="comment"># @param pedigree The pedigree used to form the NRM.</span>
<a name="l02713"></a>02713     <span class="comment"># @retval A NRM on success, 0 on failure.</span>
<a name="l02714"></a>02714     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html#13abc11f92967491f1f7f0f7da789540">form_a_matrix</a>(self, pedigree):
<a name="l02715"></a>02715         <span class="stringliteral">"""</span>
<a name="l02716"></a>02716 <span class="stringliteral">        form_a_matrix() calls pyp_nrm/fast_a_matrix() or pyp_nrm/fast_a_matrix_r()</span>
<a name="l02717"></a>02717 <span class="stringliteral">        to form a NRM from a pedigree.</span>
<a name="l02718"></a>02718 <span class="stringliteral">        """</span>
<a name="l02719"></a>02719         <span class="keywordflow">if</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html#1163a14c623f4b0e398c4ed197506669">kw</a>[<span class="stringliteral">'nrm_method'</span>] <span class="keywordflow">not</span> <span class="keywordflow">in</span> [<span class="stringliteral">'nrm'</span>,<span class="stringliteral">'frm'</span>]:
<a name="l02720"></a>02720             self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html#1163a14c623f4b0e398c4ed197506669">kw</a>[<span class="stringliteral">'nrm_method'</span>] = <span class="stringliteral">'nrm'</span>
<a name="l02721"></a>02721         <span class="keywordflow">if</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html#1163a14c623f4b0e398c4ed197506669">kw</a>[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span>:
<a name="l02722"></a>02722             <span class="keywordflow">print</span> <span class="stringliteral">'[INFO]: Forming A-matrix from pedigree at %s.'</span> % ( pyp_utils.pyp_nice_time() )
<a name="l02723"></a>02723         logging.info(<span class="stringliteral">'Forming A-matrix from pedigree'</span>)
<a name="l02724"></a>02724         <span class="comment"># Try and form the NRM where COI are not adjusted for the inbreeding</span>
<a name="l02725"></a>02725         <span class="comment"># of parents.</span>
<a name="l02726"></a>02726         <span class="keywordflow">if</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html#1163a14c623f4b0e398c4ed197506669">kw</a>[<span class="stringliteral">'nrm_method'</span>] == <span class="stringliteral">'nrm'</span>:
<a name="l02727"></a>02727             <span class="keywordflow">try</span>:
<a name="l02728"></a>02728                 self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html#c46946fea84f8a3bd2a11b252397931e">nrm</a> = pyp_nrm.fast_a_matrix(pedigree,self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html#1163a14c623f4b0e398c4ed197506669">kw</a>)
<a name="l02729"></a>02729                 <span class="keywordflow">if</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html#1163a14c623f4b0e398c4ed197506669">kw</a>[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span>:
<a name="l02730"></a>02730                     <span class="keywordflow">print</span> <span class="stringliteral">'[INFO]: Formed A-matrix from pedigree using pyp_nrm.fast_a_matrix() at %s.'</span> % ( pyp_utils.pyp_nice_time() )
<a name="l02731"></a>02731                 logging.info(<span class="stringliteral">'Formed A-matrix from pedigree using pyp_nrm.fast_a_matrix()'</span>)
<a name="l02732"></a>02732             <span class="keywordflow">except</span>:
<a name="l02733"></a>02733                 <span class="keywordflow">if</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html#1163a14c623f4b0e398c4ed197506669">kw</a>[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span>:
<a name="l02734"></a>02734                     <span class="keywordflow">print</span> <span class="stringliteral">'[ERROR]: Unable to form A-matrix from pedigree using pyp_nrm.fast_a_matrix() at %s.'</span> % ( pyp_utils.pyp_nice_time() )
<a name="l02735"></a>02735                 logging.error(<span class="stringliteral">'Unable to form A-matrix from pedigree using pyp_nrm.fast_a_matrix()'</span>)
<a name="l02736"></a>02736                 <span class="keywordflow">return</span> 0
<a name="l02737"></a>02737         <span class="comment"># Otherwise try and form the NRM where COI are adjusted for the inbreeding</span>
<a name="l02738"></a>02738         <span class="comment"># of parents.</span>
<a name="l02739"></a>02739         <span class="keywordflow">else</span>:
<a name="l02740"></a>02740             <span class="keywordflow">try</span>:
<a name="l02741"></a>02741                 self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html#c46946fea84f8a3bd2a11b252397931e">nrm</a> = pyp_nrm.fast_a_matrix_r(pedigree,self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html#1163a14c623f4b0e398c4ed197506669">kw</a>)
<a name="l02742"></a>02742                 <span class="keywordflow">if</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html#1163a14c623f4b0e398c4ed197506669">kw</a>[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span>:
<a name="l02743"></a>02743                     <span class="keywordflow">print</span> <span class="stringliteral">'[INFO]: Formed A-matrix from pedigree using pyp_nrm.fast_a_matrix_r() at %s.'</span> % ( pyp_utils.pyp_nice_time() )
<a name="l02744"></a>02744                 logging.info(<span class="stringliteral">'Formed A-matrix from pedigree using pyp_nrm.fast_a_matrix_r()'</span>)
<a name="l02745"></a>02745             <span class="keywordflow">except</span>:
<a name="l02746"></a>02746                 <span class="keywordflow">if</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html#1163a14c623f4b0e398c4ed197506669">kw</a>[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span>:
<a name="l02747"></a>02747                     <span class="keywordflow">print</span> <span class="stringliteral">'[ERROR]: Unable to form A-matrix from pedigree using pyp_nrm.fast_a_matrix_r() at %s.'</span> % ( pyp_utils.pyp_nice_time() )
<a name="l02748"></a>02748                 logging.error(<span class="stringliteral">'Unable to form A-matrix from pedigree using pyp_nrm.fast_a_matrix_r()'</span>)
<a name="l02749"></a>02749                 <span class="keywordflow">return</span> 0
<a name="l02750"></a>02750 
<a name="l02751"></a>02751     <span class="comment">##</span>
<a name="l02752"></a>02752     <span class="comment"># load() uses the Numarray Array Function "fromfile()" to load an array from a</span>
<a name="l02753"></a>02753     <span class="comment"># binary file.  If the load is successful, self.nrm contains the matrix.</span>
<a name="l02754"></a>02754     <span class="comment"># @param self Reference to current object.</span>
<a name="l02755"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html#f2999b4ef8c9174cc7fcd8f9ab875ef2">02755</a>     <span class="comment"># @param nrm_filename The file from which the matrix should be read.</span>
<a name="l02756"></a>02756     <span class="comment"># @retval A load status indicator (0: failed, 1: success).</span>
<a name="l02757"></a>02757     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html#f2999b4ef8c9174cc7fcd8f9ab875ef2">load</a>(self, nrm_filename):
<a name="l02758"></a>02758         <span class="stringliteral">"""</span>
<a name="l02759"></a>02759 <span class="stringliteral">        load() uses the Numarray Array Function "fromfile()" to load an array from a</span>
<a name="l02760"></a>02760 <span class="stringliteral">        binary file.  If the load is successful, self.nrm contains the matrix.</span>
<a name="l02761"></a>02761 <span class="stringliteral">        """</span>
<a name="l02762"></a>02762         <span class="keyword">import</span> math
<a name="l02763"></a>02763         <span class="keywordflow">if</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html#1163a14c623f4b0e398c4ed197506669">kw</a>[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span>:
<a name="l02764"></a>02764             <span class="keywordflow">print</span> <span class="stringliteral">'[INFO]: Loading A-matrix from file %s at %s.'</span> % ( nrm_filename, pyp_utils.pyp_nice_time() )
<a name="l02765"></a>02765         logging.info(<span class="stringliteral">'Loading A-matrix from file %s'</span>, nrm_filename)
<a name="l02766"></a>02766         <span class="keywordflow">try</span>:
<a name="l02767"></a>02767             self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html#c46946fea84f8a3bd2a11b252397931e">nrm</a> = numpy.fromfile(nrm_filename,dtype=<span class="stringliteral">'Float64'</span>,sep=self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html#1163a14c623f4b0e398c4ed197506669">kw</a>[<span class="stringliteral">'sepchar'</span>])
<a name="l02768"></a>02768             self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html#c46946fea84f8a3bd2a11b252397931e">nrm</a> = numpy.reshape( self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html#c46946fea84f8a3bd2a11b252397931e">nrm</a>, ( int(math.sqrt(self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html#c46946fea84f8a3bd2a11b252397931e">nrm</a>.shape[0])), int(math.sqrt(self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html#c46946fea84f8a3bd2a11b252397931e">nrm</a>.shape[0])) ) )
<a name="l02769"></a>02769             <span class="keywordflow">if</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html#1163a14c623f4b0e398c4ed197506669">kw</a>[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span>:
<a name="l02770"></a>02770                 <span class="keywordflow">print</span> <span class="stringliteral">'[INFO]: A-matrix successfully loaded from file %s at %s.'</span> % ( nrm_filename, pyp_utils.pyp_nice_time() )
<a name="l02771"></a>02771             logging.info(<span class="stringliteral">'A-matrix successfully loaded from file %s'</span>, nrm_filename)
<a name="l02772"></a>02772             <span class="keywordflow">return</span> 1
<a name="l02773"></a>02773         <span class="keywordflow">except</span>:
<a name="l02774"></a>02774             <span class="keywordflow">if</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html#1163a14c623f4b0e398c4ed197506669">kw</a>[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span>:
<a name="l02775"></a>02775                 <span class="keywordflow">print</span> <span class="stringliteral">'[ERROR]: Unable to load A-matrix from file %s at %s.'</span> % ( nrm_filename, pyp_utils.pyp_nice_time() )
<a name="l02776"></a>02776             logging.error(<span class="stringliteral">'Unable to load A-matrix from file %s'</span>, nrm_filename)
<a name="l02777"></a>02777             <span class="keywordflow">return</span> 0
<a name="l02778"></a>02778 
<a name="l02779"></a>02779     <span class="comment">##</span>
<a name="l02780"></a>02780     <span class="comment"># save() uses the Numarray method "tofile()" to save an array to a binary file.</span>
<a name="l02781"></a>02781     <span class="comment"># @param self Reference to current object.</span>
<a name="l02782"></a>02782     <span class="comment"># @param nrm_filename The file to which the matrix should be written.</span>
<a name="l02783"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html#3126917ee38a60f58f374e29410d66a5">02783</a>     <span class="comment"># @param nrm_format String indicating the format to use when writing the NRM to a file (binary|string).</span>
<a name="l02784"></a>02784     <span class="comment"># @retval A save status indicator (0: failed, 1: success).</span>
<a name="l02785"></a>02785     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html#3126917ee38a60f58f374e29410d66a5">save</a>(self, nrm_filename, nrm_format=''):
<a name="l02786"></a>02786         <span class="stringliteral">"""</span>
<a name="l02787"></a>02787 <span class="stringliteral">        save() uses the NumPy method "tofile()" to save an array to a binary file.</span>
<a name="l02788"></a>02788 <span class="stringliteral">        """</span>
<a name="l02789"></a>02789         <span class="keywordflow">if</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html#1163a14c623f4b0e398c4ed197506669">kw</a>[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span>:
<a name="l02790"></a>02790             <span class="keywordflow">print</span> <span class="stringliteral">'[INFO]: Saving A-matrix to file %s at %s.'</span> % ( nrm_filename, pyp_utils.pyp_nice_time() )
<a name="l02791"></a>02791         logging.info(<span class="stringliteral">'Saving A-matrix to file %s'</span>, nrm_filename)
<a name="l02792"></a>02792         <span class="keywordflow">try</span>:
<a name="l02793"></a>02793             <span class="comment"># If the user passes in an nrm_format keyword it overrides the</span>
<a name="l02794"></a>02794             <span class="comment"># option in the keywords dictionary.</span>
<a name="l02795"></a>02795             <span class="keywordflow">if</span> nrm_format == <span class="stringliteral">''</span>:
<a name="l02796"></a>02796                 nrm_format = self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html#1163a14c623f4b0e398c4ed197506669">kw</a>[<span class="stringliteral">'nrm_format'</span>]
<a name="l02797"></a>02797             <span class="comment"># If the nrm_format is not binary the matrix is written as a text file.</span>
<a name="l02798"></a>02798             <span class="keywordflow">if</span> nrm_format == <span class="stringliteral">'binary'</span>:
<a name="l02799"></a>02799                 self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html#c46946fea84f8a3bd2a11b252397931e">nrm</a>.tofile(nrm_filename)
<a name="l02800"></a>02800             <span class="keywordflow">else</span>:
<a name="l02801"></a>02801                 self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html#c46946fea84f8a3bd2a11b252397931e">nrm</a>.tofile(nrm_filename, sep=self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html#1163a14c623f4b0e398c4ed197506669">kw</a>[<span class="stringliteral">'sepchar'</span>])
<a name="l02802"></a>02802             <span class="keywordflow">if</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html#1163a14c623f4b0e398c4ed197506669">kw</a>[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span>:
<a name="l02803"></a>02803                 <span class="keywordflow">print</span> <span class="stringliteral">'[INFO]: A-matrix successfully saved to file %s at %s.'</span> % ( nrm_filename, pyp_utils.pyp_nice_time() )
<a name="l02804"></a>02804             logging.info(<span class="stringliteral">'A-matrix successfully saved to file %s'</span>, nrm_filename)
<a name="l02805"></a>02805             <span class="keywordflow">return</span> 1
<a name="l02806"></a>02806         <span class="keywordflow">except</span>:
<a name="l02807"></a>02807             <span class="keywordflow">if</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html#1163a14c623f4b0e398c4ed197506669">kw</a>[<span class="stringliteral">'messages'</span>] == <span class="stringliteral">'verbose'</span>:
<a name="l02808"></a>02808                 <span class="keywordflow">print</span> <span class="stringliteral">'[ERROR]: Unable to save A-matrix to file %s at %s.'</span> % ( nrm_filename, pyp_utils.pyp_nice_time() )
<a name="l02809"></a>02809             logging.error(<span class="stringliteral">'Unable to save A-matrix to file %s'</span>, nrm_filename)
<a name="l02810"></a>02810             <span class="keywordflow">return</span> 0
<a name="l02811"></a>02811 
<a name="l02812"></a>02812     <span class="comment">##</span>
<a name="l02813"></a>02813     <span class="comment"># printme() prints the NRM to the screen.</span>
<a name="l02814"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html#98a4524d97cfb680c0ec316a71d0ace9">02814</a>     <span class="comment"># @param self Reference to current object.</span>
<a name="l02815"></a>02815     <span class="comment"># @retval None</span>
<a name="l02816"></a>02816     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html#98a4524d97cfb680c0ec316a71d0ace9">printme</a>(self):
<a name="l02817"></a>02817         <span class="stringliteral">"""</span>
<a name="l02818"></a>02818 <span class="stringliteral">        printme() prints the NRM to the screen.</span>
<a name="l02819"></a>02819 <span class="stringliteral">        """</span>
<a name="l02820"></a>02820         <span class="keywordflow">try</span>:
<a name="l02821"></a>02821             <span class="keywordflow">print</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1NewAMatrix.html#c46946fea84f8a3bd2a11b252397931e">nrm</a>
<a name="l02822"></a>02822         <span class="keywordflow">except</span>:
<a name="l02823"></a>02823             <span class="keywordflow">pass</span>
<a name="l02824"></a>02824 
<a name="l02825"></a>02825 <span class="comment">##</span>
<a name="l02826"></a>02826 <span class="comment"># loadPedigree() wraps pedigree creation and loading into a one-step</span>
<a name="l02827"></a>02827 <span class="comment"># process.  If the user passes both a dictionary and a filename, the</span>
<a name="l02828"></a>02828 <span class="comment"># dictionary will be used instead of the filename unless the dictionary</span>
<a name="l02829"></a>02829 <span class="comment"># is empty.</span>
<a name="l02830"></a>02830 <span class="comment"># @param options Dictionary of pedigree options.</span>
<a name="l02831"></a>02831 <span class="comment"># @param optionsfile File from which pedigree options should be read.</span>
<a name="l02832"></a>02832 <span class="comment"># @param pedsource Source of the pedigree ('file'|'graph'|'graphfile'|'db'|'gedcomfile'|'genesfile'|'textstream').</span>
<a name="l02833"></a>02833 <span class="comment"># @param pedgraph XDiGraph from which to load the pedigree.</span>
<a name="l02834"></a>02834 <span class="comment"># @param pedstream String of tuples to unpack into a pedigree.</span>
<a name="l02835"></a>02835 <span class="comment"># @param debugLoad When True, print debugging messages while loading (True|False).</span>
<a name="l02836"></a>02836 <span class="comment"># @retval An instance of a NewPedigree object on success, a 0 on failure.</span>
<a name="l02837"></a><a class="code" href="namespacePyPedal_1_1pyp__newclasses.html#35a47ad1c56cecbe403dfa79c4bacb35">02837</a> <span class="keyword">def </span><a class="code" href="namespacePyPedal_1_1pyp__newclasses.html#35a47ad1c56cecbe403dfa79c4bacb35">loadPedigree</a>(options='', optionsfile='pypedal.ini', pedsource='file', pedgraph=0, pedstream='', debugLoad=False):
<a name="l02838"></a>02838     <span class="stringliteral">"""</span>
<a name="l02839"></a>02839 <span class="stringliteral">    loadPedigree() wraps pedigree creation and loading into a one-step</span>
<a name="l02840"></a>02840 <span class="stringliteral">    process.  If the user passes both a dictionary and a filename, the</span>
<a name="l02841"></a>02841 <span class="stringliteral">    dictionary will be used instead of the filename unless the dictionary</span>
<a name="l02842"></a>02842 <span class="stringliteral">    is empty.</span>
<a name="l02843"></a>02843 <span class="stringliteral">    """</span>
<a name="l02844"></a>02844     <span class="keywordflow">if</span> debugLoad == <span class="keyword">True</span>:
<a name="l02845"></a>02845         <span class="keywordflow">print</span> <span class="stringliteral">'[DEBUG]: Debugging pyp_newclasses/loadPedigree()...'</span>
<a name="l02846"></a>02846         _pedigree = NewPedigree(kw=options,kwfile=optionsfile)
<a name="l02847"></a>02847         _pedigree.load(pedsource=pedsource,pedgraph=pedgraph,pedstream=pedstream)
<a name="l02848"></a>02848         <span class="keywordflow">return</span> _pedigree
<a name="l02849"></a>02849     <span class="keywordflow">else</span>:
<a name="l02850"></a>02850         <span class="keywordflow">try</span>:
<a name="l02851"></a>02851             _pedigree = NewPedigree(kw=options,kwfile=optionsfile)
<a name="l02852"></a>02852             _pedigree.load(pedsource=pedsource,pedgraph=pedgraph,pedstream=pedstream)
<a name="l02853"></a>02853             <span class="keywordflow">return</span> _pedigree
<a name="l02854"></a>02854         <span class="keywordflow">except</span>:
<a name="l02855"></a>02855             <span class="keywordflow">print</span> <span class="stringliteral">'[ERROR]: pyp_newclasses.loadPedigree() was unable to instantiate and load the pedigree.'</span>
<a name="l02856"></a>02856         <span class="keywordflow">return</span> 0
<a name="l02857"></a>02857 
<a name="l02858"></a>02858 <span class="comment">##</span>
<a name="l02859"></a>02859 <span class="comment"># PyPedalError is the base class for exceptions in PyPedal. The exceptions</span>
<a name="l02860"></a>02860 <span class="comment"># are based on the examples from "An Introduction to Python" by Guido van</span>
<a name="l02861"></a>02861 <span class="comment"># Rossum and Fred L. Drake,Jr.</span>
<a name="l02862"></a>02862 <span class="comment"># (http://www.network-theory.co.uk/docs/pytut/tut_64.html).</span>
<a name="l02863"></a>02863 <span class="comment"># @param None</span>
<a name="l02864"></a>02864 <span class="comment"># @retval None</span>
<a name="l02865"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PyPedalError.html">02865</a> <span class="keyword">class </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PyPedalError.html">PyPedalError</a>(Exception):
<a name="l02866"></a>02866     <span class="stringliteral">"""PyPedalError is the base class for exceptions in PyPedal."""</span>
<a name="l02867"></a>02867     <span class="keywordflow">pass</span>
<a name="l02868"></a>02868 
<a name="l02869"></a>02869 <span class="comment">##</span>
<a name="l02870"></a>02870 <span class="comment"># PyPedalPedigreeInputFileNameError is raised when a simulated pedigree</span>
<a name="l02871"></a>02871 <span class="comment"># is not requested and a pedigree file name is not provided.</span>
<a name="l02872"></a>02872 <span class="comment"># @param None</span>
<a name="l02873"></a>02873 <span class="comment"># @retval None</span>
<a name="l02874"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PyPedalPedigreeInputFileNameError.html">02874</a> <span class="keyword">class </span>PyPedalPedigreeInputFileNameError(PyPedalError):
<a name="l02875"></a>02875     <span class="stringliteral">"""PyPedalPedigreeInputFileNameError is raised when a simulated pedigree</span>
<a name="l02876"></a>02876 <span class="stringliteral">    is not requested and a pedigree file name is not provided.</span>
<a name="l02877"></a>02877 <span class="stringliteral">    """</span>
<a name="l02878"></a>02878     <span class="comment">##</span>
<a name="l02879"></a>02879     <span class="comment"># __init__() returns a new instance of a PyPedalPedigreeInputFileNameError object</span>
<a name="l02880"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PyPedalPedigreeInputFileNameError.html#1fae46c3c7996efc312d33a701ebed06">02880</a>     <span class="comment"># @param self Reference to current object</span>
<a name="l02881"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PyPedalPedigreeInputFileNameError.html#9b344ec6c10dbf7d83f40941026265be">02881</a>     <span class="comment"># @retval A new PyPedalPedigreeInputFileNameError object</span>
<a name="l02882"></a>02882     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PyPedalPedigreeInputFileNameError.html#1fae46c3c7996efc312d33a701ebed06">__init__</a>(self):
<a name="l02883"></a>02883         self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PyPedalPedigreeInputFileNameError.html#9b344ec6c10dbf7d83f40941026265be">message</a> = <span class="stringliteral">'You did not request that a pedigree be simulated, and you did not provide the name of a pedigree file to be read.'</span>
<a name="l02884"></a>02884     <span class="comment">##</span>
<a name="l02885"></a>02885     <span class="comment"># __str__() returns an instance of a PyPedalPedigreeInputFileNameError object represented as a string</span>
<a name="l02886"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PyPedalPedigreeInputFileNameError.html#8b42d0f7665ce6243b09e45ac53dce02">02886</a>     <span class="comment"># @param self Reference to current object</span>
<a name="l02887"></a>02887     <span class="comment"># @retval A string representation of a  PyPedalPedigreeInputFileNameError object</span>
<a name="l02888"></a>02888     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PyPedalPedigreeInputFileNameError.html#8b42d0f7665ce6243b09e45ac53dce02">__str__</a>(self):
<a name="l02889"></a>02889         <span class="keywordflow">return</span> repr(self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1PyPedalPedigreeInputFileNameError.html#9b344ec6c10dbf7d83f40941026265be">message</a>)
<a name="l02890"></a>02890 
<a name="l02891"></a>02891 <span class="comment">##</span>
<a name="l02892"></a>02892 <span class="comment"># tail_recursive is a tail recursion decorator that eliminates tail calls</span>
<a name="l02893"></a>02893 <span class="comment"># for recursive functions. It was taken from the Python Cookbook entry</span>
<a name="l02894"></a>02894 <span class="comment"># "New Tail Recursion Decorator" submitted by Kay Schlueh. This version was</span>
<a name="l02895"></a>02895 <span class="comment"># provided by Michele Simionato on 2006/05/15. The URL is:</span>
<a name="l02896"></a>02896 <span class="comment"># http://aspn.activestate.com/ASPN/Cookbook/Python/Recipe/496691.</span>
<a name="l02897"></a>02897 <span class="comment"># param object A tail recursion decorator that eliminates tail calls for recursive functions.</span>
<a name="l02898"></a>02898 <span class="comment"># retval The object resulting from the recursive call.</span>
<a name="l02899"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1tail__recursive.html">02899</a> <span class="keyword">class </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1tail__recursive.html">tail_recursive</a>(object):
<a name="l02900"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1tail__recursive.html#3f3d5036a7c464a9f77a729a3f930a89">02900</a>     CONTINUE = object() <span class="comment"># sentinel</span>
<a name="l02901"></a>02901     <span class="comment">##</span>
<a name="l02902"></a>02902     <span class="comment"># __init__() returns a new instance of a PyPedalPedigreeInputFileNameError object</span>
<a name="l02903"></a>02903     <span class="comment"># @param self Reference to current object</span>
<a name="l02904"></a>02904     <span class="comment"># @param func The name of the function to recursively call</span>
<a name="l02905"></a>02905     <span class="comment"># @retval A new tail_recursive object</span>
<a name="l02906"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1tail__recursive.html#627e57bc13bb3676eed5776955e79d61">02906</a>     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1tail__recursive.html#627e57bc13bb3676eed5776955e79d61">__init__</a>(self, func):
<a name="l02907"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1tail__recursive.html#d7fac9ddee69c32ceba5b6d5c057347e">02907</a>         self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1tail__recursive.html#d7fac9ddee69c32ceba5b6d5c057347e">func</a> = func
<a name="l02908"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1tail__recursive.html#1a068b65d47afed583858e9913e66e2d">02908</a>         self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1tail__recursive.html#1a068b65d47afed583858e9913e66e2d">firstcall</a> = <span class="keyword">True</span>
<a name="l02909"></a>02909     <span class="comment">##</span>
<a name="l02910"></a>02910     <span class="comment"># __call__() returns a new instance of a PyPedalPedigreeInputFileNameError object</span>
<a name="l02911"></a>02911     <span class="comment"># @param self Reference to current object</span>
<a name="l02912"></a>02912     <span class="comment"># @param *args Positional arguments</span>
<a name="l02913"></a>02913     <span class="comment"># @param **kwd Optional keyword arguments</span>
<a name="l02914"></a>02914     <span class="comment"># @retval The result of the function call</span>
<a name="l02915"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1tail__recursive.html#7a33ee622ac5126dab27458c5e3813ef">02915</a>     <span class="keyword">def </span><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1tail__recursive.html#7a33ee622ac5126dab27458c5e3813ef">__call__</a>(self, *args, **kwd):
<a name="l02916"></a>02916         <span class="keywordflow">try</span>:
<a name="l02917"></a>02917             <span class="keywordflow">if</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1tail__recursive.html#1a068b65d47afed583858e9913e66e2d">firstcall</a>: <span class="comment"># start looping</span>
<a name="l02918"></a>02918                 self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1tail__recursive.html#1a068b65d47afed583858e9913e66e2d">firstcall</a> = <span class="keyword">False</span>
<a name="l02919"></a>02919                 <span class="keywordflow">while</span> <span class="keyword">True</span>:
<a name="l02920"></a>02920                     result = self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1tail__recursive.html#d7fac9ddee69c32ceba5b6d5c057347e">func</a>(*args, **kwd)
<a name="l02921"></a>02921                     <span class="keywordflow">if</span> result <span class="keywordflow">is</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1tail__recursive.html#3f3d5036a7c464a9f77a729a3f930a89">CONTINUE</a>: <span class="comment"># update arguments</span>
<a name="l02922"></a>02922                         args, kwd = self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1tail__recursive.html#ed2575563ba75d62bef69813fcc5604b">argskwd</a>
<a name="l02923"></a>02923                     <span class="keywordflow">else</span>: <span class="comment"># last call</span>
<a name="l02924"></a>02924                         <span class="keywordflow">break</span>
<a name="l02925"></a>02925             <span class="keywordflow">else</span>: <span class="comment"># return the arguments of the tail call</span>
<a name="l02926"></a><a class="code" href="classPyPedal_1_1pyp__newclasses_1_1tail__recursive.html#ed2575563ba75d62bef69813fcc5604b">02926</a>                 self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1tail__recursive.html#ed2575563ba75d62bef69813fcc5604b">argskwd</a> = args, kwd
<a name="l02927"></a>02927                 <span class="keywordflow">return</span> self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1tail__recursive.html#3f3d5036a7c464a9f77a729a3f930a89">CONTINUE</a>
<a name="l02928"></a>02928         <span class="keywordflow">except</span>: <span class="comment"># reset and re-raise</span>
<a name="l02929"></a>02929             self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1tail__recursive.html#1a068b65d47afed583858e9913e66e2d">firstcall</a> = <span class="keyword">True</span>
<a name="l02930"></a>02930             <span class="keywordflow">raise</span>
<a name="l02931"></a>02931         <span class="keywordflow">else</span>: <span class="comment"># reset and exit</span>
<a name="l02932"></a>02932             self.<a class="code" href="classPyPedal_1_1pyp__newclasses_1_1tail__recursive.html#1a068b65d47afed583858e9913e66e2d">firstcall</a> = <span class="keyword">True</span>
<a name="l02933"></a>02933             <span class="keywordflow">return</span> result
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Tue Sep 28 14:09:57 2010 for PyPedal by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.7 </small></address>
</body>
</html>
