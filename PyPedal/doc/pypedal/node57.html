<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<link rel="STYLESHEET" href="pypedal.css" type='text/css' />
<link rel="SHORTCUT ICON" href="manicons/pyfav.png" type="image/png" />
<link rel='start' href='../index.html' title='Python Documentation Index' />
<link rel="first" href="pypedal.html" title='A Manual for use of PyPedal
<BR>
A software package for pedigree analysis' />
<link rel='contents' href='contents.html' title="Contents" />
<link rel='last' href='about.html' title='About this document...' />
<link rel='help' href='about.html' title='About this document...' />
<link rel="prev" href="node56.html" />
<link rel="parent" href="node52.html" />
<link rel="next" href="node58.html" />
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<meta name='aesop' content='information' />
<title>5.5 Decomposition and Direct Inverses of Numerator Relationship Matrices</title>
</head>
<body>
<DIV CLASS="navigation">
<div id='top-navigation-panel' xml:id='top-navigation-panel'>
<table align="center" width="100%" cellpadding="0" cellspacing="2">
<tr>
<td class='online-navigation'><a rel="prev" title="5.4 Relatives"
  href="node56.html"><img src='manicons/previous.png'
  border='0' height='32'  alt='Previous Page' width='32' /></A></td>
<td class='online-navigation'><a rel="parent" title="5. Working with Pedigrees"
  href="node52.html"><img src='manicons/up.png'
  border='0' height='32'  alt='Up One Level' width='32' /></A></td>
<td class='online-navigation'><a rel="next" title="6. Using PyPedal Objects"
  href="node58.html"><img src='manicons/next.png'
  border='0' height='32'  alt='Next Page' width='32' /></A></td>
<td align="center" width="100%">A Manual for use of PyPedal
<BR>
A software package for pedigree analysis</td>
<td class='online-navigation'><a rel="contents" title="Table of Contents"
  href="contents.html"><img src='manicons/contents.png'
  border='0' height='32'  alt='Contents' width='32' /></A></td>
<td class='online-navigation'><img src='manicons/blank.png'
  border='0' height='32'  alt='' width='32' /></td>
<td class='online-navigation'><a rel="index" title="Index"
  href="genindex.html"><img src='manicons/index.png'
  border='0' height='32'  alt='Index' width='32' /></A></td>
</tr></table>
<div class='online-navigation'>
<b class="navlabel">Previous:</b>
<a class="sectref" rel="prev" href="node56.html">5.4 Relatives</A>
<b class="navlabel">Up:</b>
<a class="sectref" rel="parent" href="node52.html">5. Working with Pedigrees</A>
<b class="navlabel">Next:</b>
<a class="sectref" rel="next" href="node58.html">6. Using PyPedal Objects</A>
</div>
<hr /></div>
</DIV>
<!--End of Navigation Panel-->

<H1><A NAME="SECTION045500000000000000000"></A><A NAME="sec:computing-decomposition"></A><a id='l2h-58' xml:id='l2h-58'></a>
<BR>
5.5 Decomposition and Direct Inverses of Numerator Relationship Matrices
</H1>
 PyPedal provides routines in the <tt class="method">pyp_nrm</tt> module for decomposing and forming direct inverses of numerator relationship matrices (NRM). The NRM, <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="14" ALIGN="BOTTOM" BORDER="0"
 SRC="img1.png"
 ALT="$ A$"></SPAN>
, may be written as <SPAN CLASS="MATH"><IMG
 WIDTH="78" HEIGHT="15" ALIGN="BOTTOM" BORDER="0"
 SRC="img4.png"
 ALT="$ A=TDT'$"></SPAN>
, where <SPAN CLASS="MATH"><IMG
 WIDTH="15" HEIGHT="14" ALIGN="BOTTOM" BORDER="0"
 SRC="img2.png"
 ALT="$ T$"></SPAN>
 is a lower triangular matrix and <SPAN CLASS="MATH"><IMG
 WIDTH="17" HEIGHT="14" ALIGN="BOTTOM" BORDER="0"
 SRC="img3.png"
 ALT="$ D$"></SPAN>
 is a diagonal matrix [<A
 HREF="node124.html#ref143">HendersonHenderson1976</A>,<A
 HREF="node124.html#ref1060">ThompsonThompson1977</A>]. <SPAN CLASS="MATH"><IMG
 WIDTH="15" HEIGHT="14" ALIGN="BOTTOM" BORDER="0"
 SRC="img2.png"
 ALT="$ T$"></SPAN>
 traces the flow of genes from one generation to another, while <SPAN CLASS="MATH"><IMG
 WIDTH="17" HEIGHT="14" ALIGN="BOTTOM" BORDER="0"
 SRC="img3.png"
 ALT="$ D$"></SPAN>
 provides varianced and covariances of Mendelian sampling. Mrode ref224 presents a more detailed discussion of this decomposition. The examples in this section all use the pedigree presented in Table 2.1 of that work, which is contained in the file "<tt class="samp">examples/new_decompose.ped</tt>":
<div class="verbatim"><pre>
# Pedigree from Table 2.1 of
# Mrode (1996)
1 0 0
2 0 0
3 1 2
4 1 0
5 4 3
6 5 2
</pre></div>
The results presented below may be obtained by running the "<tt class="samp">new_decompose.py</tt>" example program. The <tt class="method">pyp_nrm.a_decompose()</tt> function takes as its argument a pedigree object and returns the matrices <SPAN CLASS="MATH"><IMG
 WIDTH="15" HEIGHT="14" ALIGN="BOTTOM" BORDER="0"
 SRC="img2.png"
 ALT="$ T$"></SPAN>
 and <SPAN CLASS="MATH"><IMG
 WIDTH="17" HEIGHT="14" ALIGN="BOTTOM" BORDER="0"
 SRC="img3.png"
 ALT="$ D$"></SPAN>
. The code
<div class="verbatim"><pre>
print 'Calling a_decompose()'
print '====================='
D, T  = pyp_nrm.a_decompose(example)
print 'D: ', D
print
print 'T: ', T
</pre></div>
produces identical answers to those presented by Mrode ref224 (note that outputs may have been reformatted slightly to improve readability).
<div class="verbatim"><pre>
Calling a_decompose()
=====================
D:  [[ 1.       0.       0.       0.       0.       0.     ]
 [ 0.       1.       0.       0.       0.       0.     ]
 [ 0.       0.       0.5      0.       0.       0.     ]
 [ 0.       0.       0.       0.75     0.       0.     ]
 [ 0.       0.       0.       0.       0.5      0.     ]
 [ 0.       0.       0.       0.       0.       0.46875]]

T:  [[ 1.     0.     0.     0.     0.     0.   ]
 [ 0.     1.     0.     0.     0.     0.   ]
 [ 0.5    0.5    1.     0.     0.     0.   ]
 [ 0.5    0.     0.     1.     0.     0.   ]
 [ 0.5    0.25   0.5    0.5    1.     0.   ]
 [ 0.25   0.625  0.25   0.25   0.5    1.   ]]
</pre></div>
It is not generally feasible to directly compute the inverse, <SPAN CLASS="MATH"><IMG
 WIDTH="33" HEIGHT="16" ALIGN="BOTTOM" BORDER="0"
 SRC="img15.png"
 ALT="$ A^{-1}$"></SPAN>
, of large NRM. However, it is possible to formulate simple rules for computing the inverse directly from. Henderson ref143 presented a simple procedure for calculating <SPAN CLASS="MATH"><IMG
 WIDTH="33" HEIGHT="16" ALIGN="BOTTOM" BORDER="0"
 SRC="img15.png"
 ALT="$ A^{-1}$"></SPAN>
 without accounting for inbreeding taking advantage of the fact that <!-- MATH
 $A^{-1}=(T^{-1})'D^{-1}T^{-1}$
 -->
<SPAN CLASS="MATH"><IMG
 WIDTH="159" HEIGHT="34" ALIGN="MIDDLE" BORDER="0"
 SRC="img16.png"
 ALT="$ A^{-1}=(T^{-1})'D^{-1}T^{-1}$"></SPAN>
, which is implemented as <tt class="method">pyp_nrm.form_d_nof()</tt>:
<div class="verbatim"><pre>
print 'Calling a_inverse_dnf()'
print '======================='
Ainv = pyp_nrm.a_inverse_dnf(example)
print 'Ainv: ', Ainv
</pre></div>
produces <SPAN CLASS="MATH"><IMG
 WIDTH="33" HEIGHT="16" ALIGN="BOTTOM" BORDER="0"
 SRC="img15.png"
 ALT="$ A^{-1}$"></SPAN>
 without accounting for inbreeding in the pedigree:
<div class="verbatim"><pre>
Calling a_inverse_dnf()
=======================
Ainv:  [[ 1.83333333  0.5        -1.         -0.66666667  0.          0.        ]
 [ 0.5         2.         -1.          0.          0.5        -1.        ]
 [-1.         -1.          2.5         0.5        -1.          0.        ]
 [-0.66666667  0.          0.5         1.83333333 -1.          0.        ]
 [ 0.          0.5        -1.         -1.          2.5        -1.        ]
 [ 0.         -1.          0.          0.         -1.          2.        ]]
</pre></div>
Quaas ref235 built on Henderson's earlier work by providing an algorithm for the computation of <SPAN CLASS="MATH"><IMG
 WIDTH="33" HEIGHT="16" ALIGN="BOTTOM" BORDER="0"
 SRC="img15.png"
 ALT="$ A^{-1}$"></SPAN>
 accounting for inbreeding, which is implemented as the function  <tt class="function">pyp_nrm.a_inverse_df()</tt>.
<div class="verbatim"><pre>
print 'Calling a_inverse_df()'
print '======================'
Ainv = pyp_nrm.a_inverse_df(example)
print 'Ainv: ', Ainv
</pre></div>
You will note that the numbers in this matric are slightly different from those in the previous example. Those differences are due to the inbreeding in the pedigree, which was not accounted for by <tt class="function">a_inverse_dnf()</tt>.
<div class="verbatim"><pre>
Calling a_inverse_df()
======================
Ainv:  [[ 1.83333333  0.5        -1.         -0.66666667  0.          0.        ]
 [ 0.5         2.03333333 -1.          0.          0.53333333 -1.06666667]
 [-1.         -1.          2.5         0.5        -1.          0.        ]
 [-0.66666667  0.          0.5         1.83333333 -1.          0.        ]
 [ 0.          0.53333333 -1.         -1.          2.53333333 -1.06666667]
 [ 0.         -1.06666667  0.          0.         -1.06666667  2.13333333]]
</pre></div>
The correctness of the results from <tt class="function"></tt> can be verified by using some linear algebra to compute <SPAN CLASS="MATH"><IMG
 WIDTH="33" HEIGHT="16" ALIGN="BOTTOM" BORDER="0"
 SRC="img15.png"
 ALT="$ A^{-1}$"></SPAN>
 directly:
<div class="verbatim"><pre>
    print 'Calculating Ainv from D and T'
    print '============================='
    l = example.metadata.num_records
    Tinv = numpy.linalg.inv(T)
    print 'Tinv: ', Tinv
    Tpinv = numpy.linalg.inv(T.T)
    print 'Tpinv: ', Tpinv
    Dinv = numpy.linalg.inv(D)
    print 'Dinv: ', Dinv
    Ainvhalf = numpy.dot(Tpinv,Dinv)
    Ainv = numpy.dot(Ainvhalf,Tinv)
    print 'Ainv: ', Ainv
</pre></div>
The output includes several intermediate matrices that have been verified against Mrode's book [<A
 HREF="node124.html#ref224">MrodeMrode1996</A>].
<div class="verbatim"><pre>
Calculating Ainv from D and T
=============================
Tinv:  [[ 1.   0.   0.   0.   0.   0. ]
 [ 0.   1.   0.   0.   0.   0. ]
 [-0.5 -0.5  1.   0.   0.   0. ]
 [-0.5  0.   0.   1.   0.   0. ]
 [ 0.   0.  -0.5 -0.5  1.   0. ]
 [ 0.  -0.5  0.   0.  -0.5  1. ]]

Tpinv:  [[ 1.   0.  -0.5 -0.5  0.   0. ]
 [ 0.   1.  -0.5  0.   0.  -0.5]
 [ 0.   0.   1.   0.  -0.5  0. ]
 [ 0.   0.   0.   1.  -0.5  0. ]
 [ 0.   0.   0.   0.   1.  -0.5]
 [ 0.   0.   0.   0.   0.   1. ]]

Dinv:  [[ 1.          0.          0.          0.          0.          0.        ]
 [ 0.          1.          0.          0.          0.          0.        ]
 [ 0.          0.          2.          0.          0.          0.        ]
 [ 0.          0.          0.          1.33333333  0.          0.        ]
 [ 0.          0.          0.          0.          2.          0.        ]
 [ 0.          0.          0.          0.          0.          2.13333333]]

Ainv:  [[ 1.83333333  0.5        -1.         -0.66666667  0.          0.        ]
 [ 0.5         2.03333333 -1.          0.          0.53333333 -1.06666667]
 [-1.         -1.          2.5         0.5        -1.          0.        ]
 [-0.66666667  0.          0.5         1.83333333 -1.          0.        ]
 [ 0.          0.53333333 -1.         -1.          2.53333333 -1.06666667]
 [ 0.         -1.06666667  0.          0.         -1.06666667  2.13333333]]
</pre></div>
The function <tt class="method">pyp_nrm.form_d_nof()</tt> is provided as a convenience function. The form of <SPAN CLASS="MATH"><IMG
 WIDTH="17" HEIGHT="14" ALIGN="BOTTOM" BORDER="0"
 SRC="img3.png"
 ALT="$ D$"></SPAN>
 is the same when calculating <SPAN CLASS="MATH"><IMG
 WIDTH="33" HEIGHT="16" ALIGN="BOTTOM" BORDER="0"
 SRC="img15.png"
 ALT="$ A^{-1}$"></SPAN>
 regardless of the form <SPAN CLASS="MATH"><IMG
 WIDTH="15" HEIGHT="14" ALIGN="BOTTOM" BORDER="0"
 SRC="img2.png"
 ALT="$ T$"></SPAN>
 takes (i.e., accounts for inbreeding or not). The code
<div class="verbatim"><pre>
print 'Calling form_d_nof()'
print '===================='
D  = pyp_nrm.form_d_nof(example)
print 'D: ', D
</pre></div>
produces the result
<div class="verbatim"><pre>
Calling form_d_nof()
====================
D:  [[ 1.    0.    0.    0.    0.    0.  ]
 [ 0.    1.    0.    0.    0.    0.  ]
 [ 0.    0.    0.5   0.    0.    0.  ]
 [ 0.    0.    0.    0.75  0.    0.  ]
 [ 0.    0.    0.    0.    0.5   0.  ]
 [ 0.    0.    0.    0.    0.    0.5 ]]
</pre></div>
which may be verified against the values of <SPAN CLASS="MATH"><IMG
 WIDTH="17" HEIGHT="14" ALIGN="BOTTOM" BORDER="0"
 SRC="img3.png"
 ALT="$ D$"></SPAN>
 presented above.

<DIV CLASS="navigation">
<div class='online-navigation'>
<p></p><hr />
<table align="center" width="100%" cellpadding="0" cellspacing="2">
<tr>
<td class='online-navigation'><a rel="prev" title="5.4 Relatives"
  href="node56.html"><img src='manicons/previous.png'
  border='0' height='32'  alt='Previous Page' width='32' /></A></td>
<td class='online-navigation'><a rel="parent" title="5. Working with Pedigrees"
  href="node52.html"><img src='manicons/up.png'
  border='0' height='32'  alt='Up One Level' width='32' /></A></td>
<td class='online-navigation'><a rel="next" title="6. Using PyPedal Objects"
  href="node58.html"><img src='manicons/next.png'
  border='0' height='32'  alt='Next Page' width='32' /></A></td>
<td align="center" width="100%">A Manual for use of PyPedal
<BR>
A software package for pedigree analysis</td>
<td class='online-navigation'><a rel="contents" title="Table of Contents"
  href="contents.html"><img src='manicons/contents.png'
  border='0' height='32'  alt='Contents' width='32' /></A></td>
<td class='online-navigation'><img src='manicons/blank.png'
  border='0' height='32'  alt='' width='32' /></td>
<td class='online-navigation'><a rel="index" title="Index"
  href="genindex.html"><img src='manicons/index.png'
  border='0' height='32'  alt='Index' width='32' /></A></td>
</tr></table>
<div class='online-navigation'>
<b class="navlabel">Previous:</b>
<a class="sectref" rel="prev" href="node56.html">5.4 Relatives</A>
<b class="navlabel">Up:</b>
<a class="sectref" rel="parent" href="node52.html">5. Working with Pedigrees</A>
<b class="navlabel">Next:</b>
<a class="sectref" rel="next" href="node58.html">6. Using PyPedal Objects</A>
</div>
</div>
<hr />
<span class="release-info">Release 2.0.3, documentation updated on November 29, 2005 
<BR>
Revised May 15, 2012.</span>
</DIV>
<!--End of Navigation Panel-->
<ADDRESS>
See <i><a href="about.html">About this document...</a></i> for information on suggesting changes.
</ADDRESS>
</BODY>
</HTML>
